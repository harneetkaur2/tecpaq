require.config({
    config: {
        'jsbuild':{"Ess_M2ePro/js/Ebay/Account/PickupStore.js":"define([\r\n    'jquery',\r\n    'mage/apply/main',\r\n    'M2ePro/Common'\r\n], function (jQuery, mage) {\r\n\r\n    window.EbayPickupStore = Class.create(Common, {\r\n\r\n        autogenerate: false,\r\n        geocodeObject: {},\r\n\r\n        defaultBusinessHours: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-pickup-store-location-id',\r\n                M2ePro.translator.translate('The specified Title is already used for another In-Store Pickup. In-Store Pickup Title must be unique.'),\r\n                'Ebay\\\\Account\\\\PickupStore', 'location_id', 'id',\r\n                M2ePro.formData.id\r\n            );\r\n\r\n            jQuery.validator.addMethod('M2ePro-pickup-store-location-id-length', function(value) {\r\n                return value.length <= 32;\r\n            }, M2ePro.translator.translate('Max length 32 character.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-must-arrive-date', function(value, el) {\r\n                if (el.up('#special_hours_grid') && !el.up('#special_hours_grid').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                return value.match('^[0-9]{4}-[0-9]{2}-[0-9]{1,2}$');\r\n            }, M2ePro.translator.translate('Please enter a valid date.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-pickup-store-dropdown', function(value) {\r\n                return value != '';\r\n            }, M2ePro.translator.translate('Select value.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-week-days', function(value, el) {\r\n\r\n                var countOfCheckedDays = 0;\r\n\r\n                $$('.week_day_mode').each(function(el) {\r\n                    el.checked && countOfCheckedDays++;\r\n                });\r\n\r\n                return countOfCheckedDays > 0;\r\n            }, M2ePro.translator.translate('You need to choose at set at least one time.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-selected-schedule-time', function(value, el) {\r\n\r\n                var countUnselectedControls = 0;\r\n\r\n                if (el.up('#special_hours_grid')) {\r\n                    if (!el.up('#special_hours_grid').visible()) {\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    if (!el.up('tr').select('.week_day_mode').shift().checked) {\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                el.up('td').select('select').each(function(el) {\r\n                    el.value == '' && countUnselectedControls++;\r\n                });\r\n\r\n                return countUnselectedControls == 0;\r\n            }, M2ePro.translator.translate('You should specify time.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-wrong-interval-time', function(value, el) {\r\n\r\n                if (el.up('#special_hours_grid')) {\r\n                    if (!el.up('#special_hours_grid').visible()) {\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    if (!el.up('tr').select('.week_day_mode').shift().checked) {\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                var now      = new Date(),\r\n                    fromTime = new Date(now.toDateString() + ' ' + $(el.id.replace('validator_to','from')).value),\r\n                    toTime   = new Date(now.toDateString() + ' ' + $(el.id.replace('validator_to','to')).value);\r\n\r\n                return (toTime - fromTime) > 0;\r\n            }, M2ePro.translator.translate('Must be greater than \"Open Time\".'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-max-length-128', function(value) {\r\n                return value.length <= 128;\r\n            }, M2ePro.translator.translate('Max length 128 character.'));\r\n\r\n            this.validateLocation();\r\n        },\r\n\r\n        init: function()\r\n        {\r\n            this.observeFields();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        observeFields: function()\r\n        {\r\n            var self = this;\r\n\r\n            if ($('google_map').href.indexOf('#empty') != -1) {\r\n                $('google_map').hide();\r\n            }\r\n\r\n            if ($('auto_generate_field').visible()) {\r\n                var autoGenerate = $('auto_generate');\r\n                autoGenerate.observe('click', function() {\r\n                    self.generateLocationId();\r\n                });\r\n                autoGenerate.observe('change', self.switchAutoGeneration)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $('country').observe('change', self.countryChange)\r\n                .simulate('change');\r\n\r\n            $$('.get_geocord').shift().observe('click', self.calculateLatitudeLongitude);\r\n\r\n            $('utc_offset').observe('change', function(event) {\r\n                if (event.target.value != '' && this.down('option').value == '') {\r\n                    this.down('option').remove();\r\n                }\r\n            });\r\n\r\n            $$('.week_day_mode').each(function(el){\r\n                el.observe('change', self.scheduleDayModeChange)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $$('.week_time_select').each(function(el){\r\n                el.observe('change', self.scheduleTimeSelectChange)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $$('.date_time_select').each(function(el){\r\n                el.observe('change', self.scheduleTimeSelectChange)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $$('.add_date').shift().observe('click', self.addDateColumn);\r\n            $$('.remove_date').each(function(el) {\r\n                el.observe('click', self.removeDateColumn);\r\n            });\r\n\r\n            self.hideSpecialHoursGrid();\r\n\r\n            $('default_mode')\r\n                .observe('change', self.changeDefaultMode)\r\n                .simulate('change');\r\n\r\n            $('qty_mode')\r\n                .observe('change', self.qtyModeChange)\r\n                .simulate('change');\r\n\r\n            $('qty_modification_mode')\r\n                .observe('change', self.qtyPostedModeChange)\r\n                .simulate('change');\r\n\r\n            setTimeout(function() {\r\n                self.initGeocodeAPI();\r\n            }, 0);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchAutoGeneration: function(event)\r\n        {\r\n            var self = EbayPickupStoreObj,\r\n                nameField = $('name');\r\n\r\n            self.autogenerate = !self.autogenerate;\r\n\r\n            if (!self.autogenerate) {\r\n                nameField.stopObserving('keyup', self.generateLocationId);\r\n            } else {\r\n                nameField.observe('keyup', self.generateLocationId);\r\n            }\r\n        },\r\n\r\n        generateLocationId: function()\r\n        {\r\n            var nameField = $('name'),\r\n                locationIdFiled = $('location_id');\r\n\r\n            if (nameField.value) {\r\n                locationIdFiled.value = nameField.value.toLowerCase()\r\n                    .replace(/[^a-z0-9 _]+/g, '')\r\n                    .replace(/\\s/g, '_').slice(0, 32);\r\n            } else {\r\n                locationIdFiled.value = '';\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        countryChange: function(event) {\r\n            var self = EbayPickupStoreObj,\r\n                countryCode = '';\r\n\r\n            if (event.target.value != '' && this.down('option').value == '') {\r\n                this.down('option').remove();\r\n            }\r\n\r\n            if (event.target.selectedOptions.length) {\r\n                countryCode = event.target.value;\r\n            }\r\n\r\n            self.updateHiddenValue(this, $('marketplace_id'));\r\n\r\n            new Ajax.Request(M2ePro.url.get('getRegions'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    country_code : countryCode\r\n                },\r\n                onSuccess: function(transport) {\r\n                    var regions = transport.responseText.evalJSON(),\r\n                        insertData,\r\n                        defaultValue = $('region_hidden').value;\r\n\r\n                    $('region') && $('region').remove();\r\n\r\n                    if (!regions.length) {\r\n                        insertData = {\r\n                            top: new Element('input', {\r\n                                type: 'text',\r\n                                id: 'region',\r\n                                name: 'region',\r\n                                class: 'input-text M2ePro-required-when-visible',\r\n                                value: defaultValue\r\n                            })\r\n                        };\r\n                    } else {\r\n                        insertData = {\r\n                            top: self.renderRegions(regions, defaultValue)\r\n                        };\r\n                    }\r\n\r\n                    $('region_container').up().insert(insertData)\r\n                }\r\n            });\r\n        },\r\n\r\n        renderRegions: function(regionsData, defaultValue)\r\n        {\r\n            var select = new Element('select', {\r\n                id: 'region',\r\n                name: 'region',\r\n                class: 'M2ePro-pickup-store-dropdown'\r\n            });\r\n\r\n            select.observe('change', function(event) {\r\n                if (event.target.value != '' && this.down('option').value == '') {\r\n                    this.down('option').remove();\r\n                }\r\n            });\r\n\r\n            var emptyOption = new Element('option', {value: ''});\r\n            select.appendChild(emptyOption);\r\n\r\n            regionsData.each(function(region) {\r\n                var option = new Element('option', {\r\n                    value: region.name\r\n                });\r\n\r\n                if (defaultValue == region.name) {\r\n                    option.selected = true;\r\n                }\r\n\r\n                option.innerHTML = region.name;\r\n                select.appendChild(option);\r\n            });\r\n\r\n            return select;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initGeocodeAPI: function()\r\n        {\r\n            var src = '//maps.googleapis.com/maps/api/js?' +\r\n                      'key=AIzaSyC2t7txYJJe10PryITwaIL8FmjdjxR9xeQ&signed_in=true&' +\r\n                      'callback=EbayPickupStoreObj.getGeocodeObject';\r\n\r\n            require([src]);\r\n        },\r\n\r\n        getGeocodeObject: function()\r\n        {\r\n            EbayPickupStoreObj.geocodeObject = new google.maps.Geocoder();\r\n        },\r\n\r\n        calculateLatitudeLongitude: function(event)\r\n        {\r\n            event.preventDefault();\r\n\r\n            var self = EbayPickupStoreObj,\r\n                address = '';\r\n\r\n            if ($('country').selectedOptions.length) {\r\n                address += $('country').selectedOptions[0].innerHTML;\r\n            }\r\n\r\n            var region = $('region').value;\r\n            region && (address += ', ' + region);\r\n\r\n            var city = $('city').value;\r\n            city && (address += ', ' + city);\r\n\r\n            var address1 = $('address_1').value;\r\n            address1 && (address += ', ' + address1);\r\n\r\n            self.geocodeObject.geocode({'address': address}, function(results, status) {\r\n                if (status === google.maps.GeocoderStatus.OK) {\r\n                    if (results.length) {\r\n                        var geometry = results[0].geometry;\r\n                        window.test_geo = geometry;\r\n\r\n                        var lat = +geometry.location.lat().toFixed(3),\r\n                            lng = +geometry.location.lng().toFixed(3);\r\n\r\n                        $('latitude').value = lat;\r\n                        $('longitude').value = lng;\r\n\r\n                        $('google_map').href = 'https://www.google.com/maps/place/'+lat+','+lng;\r\n                        $('google_map').show();\r\n                    }\r\n                } else {\r\n                    self.alert('Location not found.');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        scheduleDayModeChange: function(event)\r\n        {\r\n            var self = EbayPickupStoreObj,\r\n                topElement = event.target.up('tr'),\r\n                containerFrom = topElement.down('#' + this.id.replace('mode','') + 'container_from'),\r\n                containerTo   = topElement.down('#' + this.id.replace('mode','') + 'container_to');\r\n\r\n            containerFrom.hide();\r\n            containerTo.hide();\r\n\r\n            if (this.checked) {\r\n                if (self.defaultBusinessHours.from && self.defaultBusinessHours.to) {\r\n                    var timeFrom = self.defaultBusinessHours.from || [],\r\n                        timeTo = self.defaultBusinessHours.to || [];\r\n\r\n                    topElement.down('#' + this.id.replace('mode','') + 'from_hours').value = timeFrom[0] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'from_minutes').value = timeFrom[1] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'from')\r\n                        .value = (timeFrom[0] || '00')+':'+(timeFrom[1] || '00')+':00';\r\n\r\n                    topElement.down('#' + this.id.replace('mode','') + 'to_hours').value = timeTo[0] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'to_minutes').value = timeTo[1] || '';\r\n                    topElement.down('#' + this.id.replace('mode','') + 'to')\r\n                        .value = (timeTo[0] || '00')+':'+(timeTo[1] || '00')+':00';\r\n                }\r\n\r\n                containerFrom.show();\r\n                containerTo.show();\r\n            }\r\n        },\r\n\r\n        scheduleTimeSelectChange: function(event)\r\n        {\r\n            var topElement = event.target.up('td'),\r\n                inputId = this.id.match('(.)*(?=_)')[0];\r\n\r\n            var hours   = topElement.down('#' + inputId + '_hours').value,\r\n                minutes = topElement.down('#' + inputId + '_minutes').value;\r\n\r\n            if (hours == '' || minutes == '') {\r\n                return;\r\n            }\r\n\r\n            if ((event.target.id.indexOf('week_day') != -1) && (event.target.id.indexOf('from') != -1)) {\r\n                EbayPickupStoreObj.defaultBusinessHours.from = [hours, minutes];\r\n            } else if((event.target.id.indexOf('week_day') != -1) && (event.target.id.indexOf('to') != -1)) {\r\n                EbayPickupStoreObj.defaultBusinessHours.to = [hours, minutes];\r\n            }\r\n\r\n            topElement.up('tr').down('#'+inputId).value =  hours + ':' + minutes + ':00';\r\n        },\r\n\r\n        addDateColumn: function(event)\r\n        {\r\n            event.preventDefault();\r\n\r\n            var self = EbayPickupStoreObj,\r\n                template = $('special_hours_template'),\r\n                specialHoursFieldsCount = ++($$('.date-field').length);\r\n\r\n            if (!$('special_hours_grid').visible()) {\r\n                self.showSpecialHoursGrid();\r\n            }\r\n\r\n            var newColumn = jQuery('<div>').html(template.innerHTML)[0];\r\n            newColumn = newColumn.down('tr');\r\n\r\n            newColumn.down('input[name^=\"date_validator_to_\"]').name = 'date_validator_to_'\r\n                                                                        +specialHoursFieldsCount;\r\n            newColumn.down('input[name^=\"date_validator_from_\"]').name = 'date_validator_from_'\r\n                                                                         +specialHoursFieldsCount;\r\n\r\n            $('special_hours_grid_rows').down('tbody').appendChild(newColumn);\r\n\r\n            newColumn.down('.remove_date').observe('click', self.removeDateColumn);\r\n            newColumn.getElementsBySelector('.date_time_select').each(function(el) {\r\n                el.observe('change', self.scheduleTimeSelectChange)\r\n                .simulate('change');\r\n            });\r\n\r\n            var parent = newColumn.down('#date').up();\r\n            parent.innerHTML = '';\r\n            var newElementKey = 'date-' + specialHoursFieldsCount;\r\n\r\n            parent.insert({\r\n                top: new Element('input', {\r\n                    type: 'text',\r\n                    id: newElementKey,\r\n                    value: '',\r\n                    name: newElementKey,\r\n                    class: 'input-text date-field M2ePro-required-when-visible M2ePro-validate-must-arrive-date',\r\n                    'data-mage-init': '{\"calendar\": ' +\r\n                                        '{\"showTime\": false, \"dateFormat\": \"yy-mm-dd\", \"showButtonPanel\": false}' +\r\n                                      '}',\r\n                    onchange: 'EbayPickupStoreObj.dateOnChange(this)'\r\n                })\r\n            });\r\n\r\n            mage.apply();\r\n        },\r\n\r\n        dateOnChange: function(el) {\r\n            var dateContainer = el,\r\n                dateStr = dateContainer.value,\r\n                dateFrom = dateContainer.up('tr').down('#date_from'),\r\n                dateTo = dateContainer.up('tr').down('#date_to');\r\n\r\n            dateFrom.name = 'special_hours[date_settings][' + dateStr + '][open]';\r\n            dateTo.name = 'special_hours[date_settings][' + dateStr + '][close]';\r\n        },\r\n\r\n        removeDateColumn: function(event)\r\n        {\r\n            var self = EbayPickupStoreObj;\r\n\r\n            event.preventDefault();\r\n            event.target.up('tr').remove();\r\n            self.hideSpecialHoursGrid();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeDefaultMode: function()\r\n        {\r\n            var self = EbayPickupStoreObj;\r\n\r\n            if (+this.value) {\r\n                $('magento_block_ebay_account_pickup_store_form_data_quantity_custom_settings').show();\r\n\r\n                var mode = M2ePro.formData.qty_mode;\r\n                if (mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_SELLING_FORMAT_TEMPLATE')) {\r\n                    M2ePro.formData.qty_mode = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_PRODUCT');\r\n                }\r\n            } else {\r\n                $('magento_block_ebay_account_pickup_store_form_data_quantity_custom_settings').hide();\r\n            }\r\n        },\r\n\r\n        qtyModeChange: function()\r\n        {\r\n            var self               = EbayPickupStoreObj,\r\n\r\n                customValueTr      = $('qty_mode_cv_tr'),\r\n                attributeElement   = $('qty_custom_attribute'),\r\n\r\n                maxPostedValueTr   = $('qty_modification_mode_tr'),\r\n                maxPostedValueMode = $('qty_modification_mode');\r\n\r\n            customValueTr.hide();\r\n            attributeElement.value = '';\r\n\r\n            if (isNaN(+this.value) || $('default_mode').value == '0') {\r\n                return;\r\n            }\r\n\r\n             if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_NUMBER')) {\r\n                customValueTr.show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, attributeElement);\r\n            }\r\n\r\n            maxPostedValueTr.hide();\r\n            maxPostedValueMode.value = 0;\r\n\r\n            if (self.isMaxPostedQtyAvailable(this.value)) {\r\n\r\n                maxPostedValueTr.show();\r\n                maxPostedValueMode.value = 1;\r\n\r\n                if (self.isMaxPostedQtyAvailable(M2ePro.formData.qty_mode)) {\r\n                    maxPostedValueMode.value = M2ePro.formData.qty_modification_mode;\r\n                }\r\n            }\r\n\r\n            maxPostedValueMode.simulate('change');\r\n\r\n            self.updateQtyPercentage();\r\n        },\r\n\r\n        isMaxPostedQtyAvailable: function(qtyMode)\r\n        {\r\n            return qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_PRODUCT') ||\r\n                   qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_ATTRIBUTE') ||\r\n                   qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_PRODUCT_FIXED');\r\n        },\r\n\r\n        qtyPostedModeChange: function()\r\n        {\r\n            var minPosterValueTr = $('qty_min_posted_value_tr'),\r\n                maxPosterValueTr = $('qty_max_posted_value_tr');\r\n\r\n            minPosterValueTr.hide();\r\n            maxPosterValueTr.hide();\r\n\r\n            if (this.value == 1) {\r\n                minPosterValueTr.show();\r\n                maxPosterValueTr.show();\r\n            }\r\n        },\r\n\r\n        updateQtyPercentage: function()\r\n        {\r\n            var qtyPercentageTr = $('qty_percentage_tr');\r\n\r\n            qtyPercentageTr.hide();\r\n\r\n            var qtyMode = $('qty_mode').value;\r\n\r\n            if (qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_SINGLE') ||\r\n                qtyMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Account_PickupStore::QTY_MODE_NUMBER')) {\r\n                return;\r\n            }\r\n\r\n            qtyPercentageTr.show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        hideSpecialHoursGrid: function()\r\n        {\r\n            if ($$('.date-field').length > 0) {\r\n                return;\r\n            }\r\n\r\n            $('special_hours_grid').hide();\r\n\r\n            var addDateBtn = $$('.add_date').shift();\r\n            addDateBtn.removeClassName('right');\r\n            addDateBtn.style.width = '';\r\n            addDateBtn.up('div')\r\n                      .removeClassName('add_btn_wrapper')\r\n                      .addClassName('add_btn_wrapper_center');\r\n        },\r\n\r\n        showSpecialHoursGrid: function()\r\n        {\r\n            $('special_hours_grid').show();\r\n\r\n            var addDateBtn = $$('.add_date').shift();\r\n            addDateBtn.addClassName('right');\r\n            addDateBtn.style.width = '12.5%';\r\n            addDateBtn.up('div')\r\n                      .removeClassName('add_btn_wrapper_center')\r\n                      .addClassName('add_btn_wrapper');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($headId, chapter_when_duplicate_text)\r\n        {\r\n            $$('.loading-mask').invoke('show');\r\n\r\n            this.setValidationCheckRepetitionValue('M2ePro-pickup-store-location-id',\r\n                M2ePro.translator.translate('The specified Title is already used for another In-Store Pickup. In-Store Pickup Title must be unique.'),\r\n                'Ebay\\\\Account\\\\PickupStore', 'location_id', 'id',0\r\n            );\r\n\r\n            M2ePro.formData.id = 0;\r\n\r\n            $('name').value = $('location_id').value = $('pickup_store_id').value =  '';\r\n            $('location_id').disabled = false;\r\n\r\n            if (!$('auto_generate_field').visible()) {\r\n                $('auto_generate_field').show();\r\n                $('auto_generate').observe('change', EbayPickupStoreObj.switchAutoGeneration)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $$('.page-title').each(function(o) { o.innerHTML = chapter_when_duplicate_text; });\r\n            $$('.M2ePro_duplicate_button').each(function(o) { o.hide(); });\r\n            $$('.M2ePro_delete_button').each(function(o) { o.hide(); });\r\n\r\n            window.setTimeout(function() {\r\n                $$('.loading-mask').invoke('hide')\r\n            }, 1200);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isValidForm: function()\r\n        {\r\n            var result = jQuery('#edit_form').valid();\r\n\r\n            if (result) {\r\n                $('location_id').disabled = false;\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        validateLocation: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-check-location', function(value) {\r\n                var preValidation = true;\r\n                ['country', 'region', 'city', 'address_1',\r\n                'postal_code', 'latitude', 'longitude'].each(function(el) {\r\n                    if (!$(el) || $(el).value == '') {\r\n                        preValidation = false;\r\n                    }\r\n                });\r\n\r\n                if (!preValidation) {\r\n                    return true;\r\n                }\r\n\r\n                var checkResult = false;\r\n                new Ajax.Request(M2ePro.url.get('validateLocation'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        id: M2ePro.formData.id,\r\n                        country: $('country').value,\r\n                        region: $('region').value,\r\n                        city: $('city').value,\r\n                        address_1: $('address_1').value,\r\n                        address_2: $('address_2').value,\r\n                        postal_code: $('postal_code').value,\r\n                        latitude: $('latitude').value,\r\n                        longitude: $('longitude').value,\r\n                        utc_offset: $('utc_offset').value\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        checkResult = transport.responseText.evalJSON()['result'];\r\n                    }\r\n                });\r\n\r\n                return checkResult;\r\n            }, M2ePro.translator.translate('Same Location is already exists.'));\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/EditCompatibilityMode.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Confirm',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal, confirm) {\r\n\r\n    window.EditCompatibilityMode = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (gridId) {\r\n            this.gridId = gridId;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopup: function(listingId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getChangePartsCompatibilityModePopupHtml'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    listing_id: listingId\r\n                },\r\n                onSuccess: (function(transport) {\r\n\r\n                    if ($('edit_mode_form')) {\r\n                        $('edit_mode_form').remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    var form = jQuery('#edit_mode_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Edit Parts Compatibility Mode'),\r\n                        type: 'popup',\r\n                        modalClass: 'width-50',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.closePopup();\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.saveListingMode();\r\n                            }\r\n                        }]\r\n                    }, form);\r\n\r\n                    this.oldMode = trim($('listing_compatibility_mode_' + listingId).innerHTML);\r\n                    this.listingId = listingId;\r\n\r\n                    jQuery('#edit_mode_form').modal('openModal');\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        saveListingMode: function()\r\n        {\r\n            var self = this,\r\n                newMode = $('edit_mode_form').select('#parts_compatibility_mode')[0].value;\r\n\r\n            if (self.oldMode == newMode) {\r\n\r\n                this.closePopup();\r\n                return;\r\n            }\r\n\r\n            if (!jQuery('#edit_mode_form').valid()) {\r\n                return false;\r\n            }\r\n\r\n            confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('ebay_listing/savePartsCompatibilityMode'), {\r\n                            method: 'post',\r\n                            asynchronous: true,\r\n                            parameters: {\r\n                                listing_id: self.listingId,\r\n                                mode:       newMode\r\n                            },\r\n                            onSuccess: function(transport) {\r\n                                self.closePopup();\r\n                            }.bind(this)\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        closePopup: function()\r\n        {\r\n            jQuery('#edit_mode_form').modal('closeModal');\r\n            window[this.gridId + 'JsObject'].reload();\r\n\r\n            return true;\r\n        }\r\n\r\n    })\r\n        // ---------------------------------------\r\n});","Ess_M2ePro/js/Ebay/Listing/Preview.js":"define(function () {\r\n\r\n    window.EbayListingPreviewItems = Class.create(Common, {\r\n\r\n        initialize: function () {\r\n            var self = this;\r\n\r\n            jQuery('.price_container button').click(function () {\r\n                self.alert(M2ePro.translator.translate('This is Item Preview Mode'));\r\n            });\r\n\r\n            self.onTabClick(jQuery('.tabs-horiz li:first'));\r\n        },\r\n\r\n        getVariation: function(chosenOptions) {\r\n            var returnVariation = {};\r\n\r\n            M2ePro.formData.variations.variations.forEach(function (variation) {\r\n\r\n                var countOfOptions = 0;\r\n\r\n                for (var variationSpecific in variation.specifics) {\r\n                    chosenOptions.forEach(function (option) {\r\n                        if (variationSpecific === option.attribute) {\r\n                            if (variation.specifics[variationSpecific] === option.value) {\r\n                                countOfOptions++;\r\n                            } else {\r\n                                return false;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (countOfOptions === chosenOptions.length) {\r\n                    returnVariation = variation;\r\n                    return false;\r\n                }\r\n\r\n            });\r\n\r\n            return returnVariation;\r\n        },\r\n\r\n        onChangeVariationSelect: function (currentSelect) {\r\n            $$('option').each(function (option) {\r\n                option.show();\r\n            });\r\n\r\n            choseSelects = $$(\"select[value!=]\").length;\r\n\r\n            if (choseSelects < $$('select').length - 1) {\r\n                return;\r\n            }\r\n\r\n            if (choseSelects === $$('select').length - 1) {\r\n                var otherSelectsValues = [];\r\n\r\n                $$('select[value!=]').each(function (select) {\r\n                    otherSelectsValues.push({\r\n                        attribute: select.name,\r\n                        value: select.value\r\n                    });\r\n                });\r\n\r\n                $$(\"select[value=]\")[0].select('option[value!=]').each(function (option) {\r\n                    otherSelectsValues.push({\r\n                        attribute: option.up().name,\r\n                        value: option.value\r\n                    });\r\n\r\n                    variation = EbayListingPreviewItemsObj.getVariation(otherSelectsValues);\r\n\r\n                    if (variation.data === undefined) {\r\n                        option.hide();\r\n                    }\r\n\r\n                    otherSelectsValues.pop();\r\n                });\r\n            } else {\r\n                $$('select').each(function (select) {\r\n                    var otherSelectsValues = [];\r\n\r\n                    $$('select').each(function (otherSelects) {\r\n                        if (otherSelects !== select) {\r\n                            otherSelectsValues.push({\r\n                                attribute: otherSelects.name,\r\n                                value: otherSelects.value\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    select.select('option[value!=]').each(function (option) {\r\n\r\n                        otherSelectsValues.push({\r\n                            attribute: option.up().name,\r\n                            value: option.value\r\n                        });\r\n\r\n                        variation = EbayListingPreviewItemsObj.getVariation(otherSelectsValues);\r\n\r\n                        if (variation.data === undefined) {\r\n                            if (select.value === option.value) {\r\n                                select.value = \"\";\r\n                            }\r\n                            option.hide();\r\n\r\n                        }\r\n\r\n                        otherSelectsValues.pop();\r\n                    });\r\n                });\r\n\r\n                var otherSelectsValues = [];\r\n\r\n                $$('select').each(function (otherSelects) {\r\n                    otherSelectsValues.push({\r\n                        attribute: otherSelects.name,\r\n                        value: otherSelects.value\r\n                    });\r\n                });\r\n\r\n                variation = EbayListingPreviewItemsObj.getVariation(otherSelectsValues);\r\n\r\n                if($('product_discount_stp')) {\r\n                    $('product_discount_stp').hide();\r\n                    $('product_price_stp').hide();\r\n                }\r\n                if($('product_discount_map')) {\r\n                    $('product_discount_map').hide();\r\n                    $('product_price_map').hide();\r\n                }\r\n\r\n                if (variation.data.price_stp !== null) {\r\n                    $('product_discount_stp').show();\r\n                    $('product_price_stp').show().update(variation.data.price_stp);\r\n                } else {\r\n                    if (variation.data.price_map !== null) {\r\n                        $('product_discount_map').show();\r\n                        $('product_price_map').show().update(variation.data.price_map);\r\n                    }\r\n                }\r\n\r\n                $('product_price').update(variation.data.price);\r\n                $('product_qty').update(variation.data.qty);\r\n\r\n            }\r\n\r\n            if (M2ePro.formData.images.variations &&\r\n                M2ePro.formData.images.variations.specific === currentSelect.name && currentSelect.value) {\r\n                $('product_image').src = M2ePro.formData.images.variations.images[currentSelect.value][0];\r\n            }\r\n        },\r\n\r\n        onClickGalleryImage: function (image) {\r\n            $('product_image').src = image.src;\r\n        },\r\n\r\n        onTabClick: function (tab){\r\n            jQuery('.' + jQuery('li.active').attr('data-tab') + '_container').hide();\r\n            jQuery('li.active').removeClass('active');\r\n\r\n            jQuery(tab).addClass('active');\r\n            jQuery('.' + jQuery(tab).attr('data-tab') + '_container').show();\r\n        },\r\n\r\n        initVariations: function () {\r\n            $$('select').each(function(currentSelect){\r\n                if(currentSelect.select('option[value!=]').length === 1){\r\n                    currentSelect.select('option[value!=]')[0].selected = true;\r\n                    EbayListingPreviewItemsObj.onChangeVariationSelect(currentSelect);\r\n                }\r\n            });\r\n        }\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/VariationProductManage.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (jQuery, modal, messageObj) {\r\n    window.EbayListingVariationProductManage = Class.create(Action,{\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridHandler)\r\n        {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options,options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function(response)\r\n        {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(productId, title, filter)\r\n        {\r\n            var self = this;\r\n\r\n            messageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('variationProductManage'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id : productId,\r\n                    filter: filter\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var modalDialog = $('modal_variation_product_manage');\r\n                    if (!modalDialog) {\r\n                        modalDialog = new Element('div', {\r\n                            id: 'modal_variation_product_manage'\r\n                        });\r\n                    } else {\r\n                        modalDialog.innerHTML = '';\r\n                    }\r\n\r\n                    window.variationProductManagePopup = jQuery(modalDialog).modal({\r\n                        title: title.escapeHTML(),\r\n                        type: 'slide',\r\n                        buttons: []\r\n                    });\r\n                    variationProductManagePopup.modal('openModal');\r\n\r\n                    modalDialog.insert(transport.responseText);\r\n                    modalDialog.innerHTML.evalScripts();\r\n\r\n                    variationProductManagePopup.productId = productId;\r\n                }\r\n            });\r\n        },\r\n\r\n        closeManageVariationsPopup: function()\r\n        {\r\n            variationProductManagePopup.modal('closeModal');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/VariationProductManageVariationsGrid.js":"define([\r\n    'jquery',\r\n    'M2ePro/Grid'\r\n], function (jQuery) {\r\n    window.EbayListingVariationProductManageVariationsGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super, gridId)\r\n        {\r\n            $super(gridId);\r\n\r\n            jQuery.validator.addMethod('M2ePro-upc', function(value, el) {\r\n\r\n                if (value.length == 0) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length != 12) {\r\n                    return false;\r\n                }\r\n\r\n                var barcode = value.substr(0, value.length-1);\r\n\r\n                var sum = 0;\r\n                var length  = barcode.length-1;\r\n\r\n                for (var i = 0; i <= length; i++) {\r\n                    if ((i % 2) === 0) {\r\n                        sum += parseInt(barcode.charAt(length - i) * 3);\r\n                    } else {\r\n                        sum += parseInt(barcode.charAt(length - i));\r\n                    }\r\n                }\r\n\r\n                var calc  = sum % 10;\r\n                var checksum = (calc === 0) ? 0 : (10 - calc);\r\n\r\n                return value.charAt(length+1) == checksum;\r\n            }, M2ePro.translator.translate('Please enter valid UPC'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-ean', function(value, el) {\r\n\r\n                if (value.length == 0) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length != 13) {\r\n                    return false;\r\n                }\r\n\r\n                var barcode = value.substr(0, value.length-1);\r\n\r\n                var sum = 0;\r\n                var length  = barcode.length-1;\r\n\r\n                for (var i = 0; i <= length; i++) {\r\n                    if ((i % 2) === 0) {\r\n                        sum += parseInt(barcode.charAt(length - i) * 3);\r\n                    } else {\r\n                        sum += parseInt(barcode.charAt(length - i));\r\n                    }\r\n                }\r\n\r\n                var calc  = sum % 10;\r\n                var checksum = (calc === 0) ? 0 : (10 - calc);\r\n\r\n                return value.charAt(length+1) == checksum;\r\n\r\n            }, M2ePro.translator.translate('Please enter valid EAN'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-isbn', function(value, el) {\r\n\r\n                if (value.length == 0) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length == 10) {\r\n\r\n                    var a = 0;\r\n                    for (var i = 0; i < 10; i++) {\r\n                        if (value.charAt(i) == \"X\" || value.charAt(i) == \"x\") {\r\n                            a += 10 * parseInt(10 - i);\r\n                        } else {\r\n                            a += parseInt(value.charAt(i)) * parseInt(10 - i);\r\n                        }\r\n                    }\r\n                    return (a % 11 == 0);\r\n\r\n                } else if (value.length == 13) {\r\n\r\n                    if (value.substr(0,3) != '978') {\r\n                        return false;\r\n                    }\r\n\r\n                    var check = 0;\r\n                    for (var i = 0; i < 13; i += 2) {\r\n                        check += parseInt(value.substr(i,1));\r\n                    }\r\n                    for (var i = 1; i < 12; i += 2) {\r\n                        check += 3 * parseInt(value.substr(i,1));\r\n                    }\r\n\r\n                    return check % 10 == 0;\r\n                }\r\n\r\n                return false;\r\n            }, M2ePro.translator.translate('Please enter valid ISBN'));\r\n\r\n            this.initFormValidation('form[id^=\"variation_identifiers_edit_\"]');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function()\r\n        {\r\n            return 'ebay';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            return false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function($super)\r\n        {\r\n            $super();\r\n\r\n            $$('.attributes-options-filter').each(this.initAttributesOptionsFilter, this);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function(response)\r\n        {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initAttributesOptionsFilter: function(filterEl)\r\n        {\r\n            var srcElement = Element.down(filterEl, 'select');\r\n\r\n            srcElement.observe('change', this.onAttributesOptionsFilterChange.bind(this));\r\n\r\n            var valuesDiv = Element.down(filterEl, '.attributes-options-filter-values');\r\n            valuesDiv.optionsCount = valuesDiv.childElementCount;\r\n\r\n            if(valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            valuesDiv.optionsIterator = 0;\r\n            valuesDiv.childElements().each(function(attrValue) {\r\n\r\n                var removeImg = Element.down(attrValue, '.filter-param-remove'),\r\n                    attrName = Element.down(attrValue, 'input[type=\"hidden\"]'),\r\n                    selectedOption = Element.down(filterEl, 'select option[value=\"' + attrName.value + '\"]');\r\n\r\n                selectedOption.hide();\r\n\r\n                valuesDiv.optionsIterator++;\r\n\r\n                removeImg.show();\r\n                removeImg.observe('click', function() {\r\n                    valuesDiv.optionsCount--;\r\n                    selectedOption.show();\r\n                    srcElement.show();\r\n                    Element.remove(attrValue);\r\n                });\r\n            }, this);\r\n        },\r\n\r\n        onAttributesOptionsFilterChange: function(e)\r\n        {\r\n            var srcElement = e.target || e.srcElement,\r\n                parentDiv = Element.up(srcElement, '.attributes-options-filter'),\r\n                valuesDiv = Element.down(parentDiv, '.attributes-options-filter-values'),\r\n                selectedOption = Element.down(srcElement, '[value=\"' + srcElement.value + '\"]');\r\n\r\n            selectedOption.hide();\r\n\r\n            valuesDiv.optionsCount++;\r\n            valuesDiv.optionsIterator++;\r\n\r\n            srcElement.enable();\r\n            if(valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            var filterName = parentDiv.id.replace('attributes-options-filter_', '');\r\n\r\n            var newOptionContainer = new Element('div'),\r\n                newOptionLabel = new Element('div'),\r\n                newOptionValue = new Element('input', {\r\n                    type: 'text',\r\n                    class: 'input-text admin__control-text',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][value]'\r\n                }),\r\n                newOptionAttr = new Element('input', {\r\n                    type: 'hidden',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][attr]',\r\n                    value: srcElement.value\r\n                }),\r\n                removeImg = Element.clone(Element.down(parentDiv, '.attributes-options-filter-selector .filter-param-remove'));\r\n\r\n            newOptionLabel.innerHTML = srcElement.value + ': ';\r\n            removeImg.show();\r\n\r\n            Event.observe(newOptionValue, 'keypress', this.getGridObj().filterKeyPress.bind(this.getGridObj()));\r\n\r\n            newOptionContainer.insert({ bottom: newOptionLabel });\r\n            newOptionContainer.insert({ bottom: newOptionValue });\r\n            newOptionContainer.insert({ bottom: newOptionAttr });\r\n            newOptionContainer.insert({ bottom: removeImg });\r\n\r\n            valuesDiv.insert({ bottom: newOptionContainer });\r\n\r\n            removeImg.observe('click', function() {\r\n                valuesDiv.optionsCount--;\r\n                selectedOption.show();\r\n                srcElement.show();\r\n                newOptionContainer.remove();\r\n            }, this);\r\n\r\n            srcElement.value = '';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editVariationIdentifiers: function(editBtn, variationId)\r\n        {\r\n            $('variation_identifiers_edit_'+variationId).show();\r\n            $('variation_identifiers_'+variationId).hide();\r\n            editBtn.hide();\r\n        },\r\n\r\n        confirmVariationIdentifiers: function(editBtn, variationId)\r\n        {\r\n            var self = this,\r\n                form = $('variation_identifiers_edit_'+variationId)\r\n\r\n            if (!self.isValid(form)) {\r\n                return;\r\n            }\r\n\r\n            var data = form.serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_variation_product_manage/setIdentifiers'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = self.parseResponse(transport);\r\n                    if(response.success) {\r\n                        VariationsGridObj.getGridObj().reload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        cancelVariationIdentifiers: function(variationId)\r\n        {\r\n            var form = $('variation_identifiers_edit_'+variationId);\r\n            form.reset();\r\n            this.isValid(form);\r\n            form.hide();\r\n            $('variation_identifiers_'+variationId).show();\r\n            $('edit_variations_'+variationId).show();\r\n        },\r\n\r\n        isValid: function (form)\r\n        {\r\n            var upc = form.down('.M2ePro-upc'),\r\n                ean = form.down('.M2ePro-ean'),\r\n                isbn = form.down('.M2ePro-isbn'),\r\n                mpn = form.down('.M2ePro-mpn');\r\n\r\n            upc.value = trim(upc.value);\r\n            ean.value = trim(ean.value);\r\n            isbn.value = trim(isbn.value.replace('-',''));\r\n            mpn.value = trim(mpn.value);\r\n\r\n            return jQuery(form).valid();\r\n        }\r\n\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Create/General.js":"define([\r\n    'underscore',\r\n    'Magento_Ui/js/modal/alert',\r\n    'M2ePro/Ebay/Listing/Create/General/MarketplaceSynchProgress',\r\n    'M2ePro/Plugin/ProgressBar',\r\n    'M2ePro/Plugin/AreaWrapper'\r\n], function (_, alert) {\r\n\r\n    window.EbayListingCreateGeneral = Class.create();\r\n    EbayListingCreateGeneral.prototype = {\r\n\r\n        marketplaceSynchProgressObj: null,\r\n        accounts: null,\r\n        selectedAccountId: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (marketplaces) {\r\n\r\n            var self = this;\r\n\r\n            self.marketplaceSynchProgressObj = new EbayListingCreateGeneralMarketplaceSynchProgress(\r\n                new ProgressBar('progress_bar'),\r\n                new AreaWrapper('content_container')\r\n            );\r\n\r\n            CommonObj.setValidationCheckRepetitionValue(\r\n                'M2ePro-listing-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Listing. Listing Title must be unique.'),\r\n                'Listing', 'title', 'id', null, M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay::NICK')\r\n            );\r\n\r\n            self.initAccount();\r\n            self.initMarketplace(marketplaces);\r\n        },\r\n\r\n        initAccount: function () {\r\n\r\n            var self = this;\r\n\r\n            $('add_account_button').observe('click', function() {\r\n                var win = window.open(M2ePro.url.get('ebay_account/newAction'));\r\n\r\n                var intervalId = setInterval(function() {\r\n\r\n                    if (!win.closed) {\r\n                        return;\r\n                    }\r\n\r\n                    clearInterval(intervalId);\r\n\r\n                    self.renderAccounts();\r\n\r\n                }, 1000);\r\n            });\r\n\r\n            $('account_id').observe('change', function () {\r\n                self.selectedAccountId = this.value;\r\n            });\r\n\r\n            self.renderAccounts();\r\n        },\r\n\r\n        renderAccounts: function (callback) {\r\n\r\n            var self = this;\r\n\r\n            var account_add_btn = $('add_account_button');\r\n            var account_label_el = $('account_label');\r\n            var account_select_el = $('account_id');\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/getAccounts'), {\r\n                method: 'get',\r\n                onSuccess: function(transport) {\r\n                    var accounts = transport.responseText.evalJSON();\r\n\r\n                    if (_.isNull(self.accounts)) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (_.isNull(self.selectedAccountId)) {\r\n                        self.selectedAccountId = $('account_id').value;\r\n                    }\r\n\r\n                    var isAccountsChanged = !self.isAccountsEqual(accounts);\r\n\r\n                    if (isAccountsChanged) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (accounts.length === 0) {\r\n                        account_add_btn.down('span').update(M2ePro.translator.translate('Add'));\r\n                        account_label_el.update(M2ePro.translator.translate('Account not found, please create it.'));\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                        return;\r\n                    }\r\n\r\n                    account_select_el.update();\r\n                    account_select_el.appendChild(new Element('option', {style: 'display: none'}));\r\n                    accounts.each(function(account) {\r\n                        account_select_el.appendChild(new Element('option', {value: account.id})).insert(account.title);\r\n                    });\r\n\r\n                    account_add_btn.down('span').update(M2ePro.translator.translate('Add Another'));\r\n\r\n                    if (accounts.length === 1) {\r\n                        var account = _.first(accounts);\r\n\r\n                        self.selectedAccountId = account.id;\r\n\r\n                        var accountElement;\r\n\r\n                        if (M2ePro.formData.wizard) {\r\n                            accountElement = new Element('span').update(account.title);\r\n                        } else {\r\n                            var accountLink = M2ePro.url.get('ebay_account/edit', {'id': account.id, close_on_save: 1});\r\n                            accountElement = new Element('a', {\r\n                                'href': accountLink,\r\n                                'target': '_blank'\r\n                            }).update(account.title);\r\n                        }\r\n\r\n                        account_label_el.update(accountElement);\r\n\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                    } else if (isAccountsChanged) {\r\n                        self.selectedAccountId = _.last(accounts).id;\r\n\r\n                        account_label_el.hide();\r\n                        account_select_el.show();\r\n                    }\r\n\r\n                    account_select_el.setValue(self.selectedAccountId);\r\n\r\n                    callback && callback();\r\n                }\r\n            });\r\n        },\r\n\r\n        initMarketplace: function (marketplaces) {\r\n\r\n            var self = this;\r\n\r\n            $$('.next_step_button').each(function(btn) { btn.observe('click',function() {\r\n                if (self.marketplaceSynchProgressObj.runningNow) {\r\n                    alert({\r\n                        content: M2ePro.translator.translate('Please wait while Synchronization is finished.')\r\n                    });\r\n                    return;\r\n                }\r\n                jQuery('#edit_form').valid() && self.synchronizeMarketplace($('marketplace_id').value);\r\n            }) });\r\n\r\n            $('marketplace_id')\r\n                .observe('click', function() {\r\n                    if (!this.value) {\r\n                        return;\r\n                    }\r\n                    var marketplace = _.findWhere(marketplaces, {value: this.value});\r\n                    $('marketplace_url_note').update(marketplace.url).show();\r\n                })\r\n                .simulate('click')\r\n            ;\r\n        },\r\n\r\n        synchronizeMarketplace: function (marketplaceId) {\r\n\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/isMarketplaceEnabled'), {\r\n                method: 'get',\r\n                parameters: { marketplace_id: marketplaceId },\r\n                onSuccess: function(transport) {\r\n\r\n                    var result = transport.responseText.evalJSON();\r\n                    if (result.status) {\r\n                        return self.marketplaceSynchProgressObj.end();\r\n                    }\r\n\r\n                    var params = {};\r\n                    params['status_' + marketplaceId] = 1;\r\n\r\n                    new Ajax.Request(M2ePro.url.get('ebay_marketplace/save'), {\r\n                        method: 'post',\r\n                        parameters: params,\r\n                        onSuccess: function() {\r\n\r\n                            var title = 'eBay ' + $('marketplace_id').down('option[value='+$('marketplace_id').value+']').innerHTML;\r\n\r\n                            $('next').disable();\r\n\r\n                            self.marketplaceSynchProgressObj.runTask(\r\n                                title,\r\n                                M2ePro.url.get('ebay_marketplace/runSynchNow', {marketplace_id: marketplaceId})\r\n                            );\r\n\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        isAccountsEqual: function (newAccounts) {\r\n            if (!newAccounts.length && !this.accounts.length) {\r\n                return true;\r\n            }\r\n\r\n            if (newAccounts.length !== this.accounts.length) {\r\n                return false;\r\n            }\r\n\r\n            return _.every(this.accounts, function (account) {\r\n                return _.where(newAccounts, account).length > 0;\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Ebay/Listing/Create/General/MarketplaceSynchProgress.js":"define([\n    'M2ePro/SynchProgress'\n], function () {\n    EbayListingCreateGeneralMarketplaceSynchProgress = Class.create(SynchProgress, {\n\n        // ---------------------------------------\n\n        runningNow: false,\n\n        // ---------------------------------------\n\n        start: function ($super, title, status) {\n            $super(title, status);\n            this.runningNow = true;\n        },\n\n        end: function ($super) {\n            $super();\n            this.runningNow = false;\n            this.saveClick(M2ePro.url.get('ebay_listing_create/index'), true)\n        },\n\n        runTask: function (title, url, callBackWhenEnd) {\n            title = title || '';\n            url = url || '';\n            callBackWhenEnd = callBackWhenEnd || '';\n\n            if (url == '') {\n                return;\n            }\n\n            var self = this;\n            new Ajax.Request(M2ePro.url.get('general/synchCheckState'), {\n                method: 'get',\n                asynchronous: true,\n                onSuccess: function (transport) {\n\n                    if (transport.responseText == self.stateExecuting) {\n\n                        self.start(\n                            M2ePro.translator.translate('Another Synchronization Is Already Running.'),\n                            M2ePro.translator.translate('Getting information. Please wait ...')\n                        );\n\n                        setTimeout(function () {\n                            self.startGetExecutingInfo('self.runTask(\\'' + title + '\\',\\'' + url + '\\',\"' + callBackWhenEnd + '\");');\n                        }, 2000);\n\n                    } else {\n\n                        self.start(title, M2ePro.translator.translate('Preparing to start. Please wait ...'));\n\n                        new Ajax.Request(url, {\n                            method: 'get', asynchronous: true\n                        });\n\n                        setTimeout(function () {\n                            self.startGetExecutingInfo(callBackWhenEnd);\n                        }, 2000);\n                    }\n                }\n            });\n        },\n\n        startGetExecutingInfo: function (callBackWhenEnd) {\n            callBackWhenEnd = callBackWhenEnd || '';\n\n            var self = this;\n            new Ajax.Request(M2ePro.url.get('general/synchGetExecutingInfo'), {\n                method: 'get',\n                asynchronous: true,\n                onSuccess: function (transport) {\n\n                    var data = transport.responseText.evalJSON(true);\n\n                    if (data.mode == self.stateExecuting) {\n\n                        self.progressBarObj.setTitle(data.title);\n                        if (data.percents <= 0) {\n                            self.progressBarObj.setPercents(0, 0);\n                        } else if (data.percents >= 100) {\n                            self.progressBarObj.setPercents(100, 0);\n                        } else {\n                            self.progressBarObj.setPercents(data.percents, 1);\n                        }\n                        self.progressBarObj.setStatus(data.status);\n\n                        self.wrapperObj.lock();\n                        $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\n\n                        setTimeout(function () {\n                            self.startGetExecutingInfo(callBackWhenEnd);\n                        }, 3000);\n\n                    } else {\n\n                        self.progressBarObj.setPercents(100, 0);\n\n                        // ---------------------------------------\n                        setTimeout(function () {\n\n                            if (callBackWhenEnd != '') {\n                                eval(callBackWhenEnd);\n                            } else {\n                                self.end();\n                            }\n\n                        }, 1500);\n                        // ---------------------------------------\n                    }\n                }\n            });\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Listing/Other/Grid.js":"define([\r\n    'M2ePro/Listing/Other/Grid'\r\n], function () {\r\n    window.EbayListingOtherGrid = Class.create(ListingOtherGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function()\r\n        {\r\n            return 'ebay';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function(rowId)\r\n        {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Other\\\\AbstractGrid::LISTING_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('ebay_log_listing_other/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedItemsParts: function()\r\n        {\r\n            var selectedProductsArray = this.getSelectedProductsArray();\r\n\r\n            if (this.getSelectedProductsString() == '' || selectedProductsArray.length == 0) {\r\n                return [];\r\n            }\r\n\r\n            var maxProductsInPart = this.getMaxProductsInPart();\r\n\r\n            var result = [];\r\n            for (var i=0;i<selectedProductsArray.length;i++) {\r\n                if (result.length == 0 || result[result.length-1].length == maxProductsInPart) {\r\n                    result[result.length] = [];\r\n                }\r\n                result[result.length-1][result[result.length-1].length] = selectedProductsArray[i];\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 10;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Add.js":"define([\n    'jquery',\n    'Magento_Ui/js/modal/modal',\n    'M2ePro/Common'\n], function (jQuery, modal) {\n    window.EbayListingProductAdd = Class.create(Common, {\n\n        // ---------------------------------------\n\n        options: {\n            show_autoaction_popup: false,\n\n            get_selected_products: function (callback) {}\n        },\n\n        // ---------------------------------------\n\n        initialize: function (options) {\n            this.options = Object.extend(this.options, options);\n        },\n\n        // ---------------------------------------\n\n        continue: function () {\n            var self = this;\n\n            self.options.get_selected_products(function (selectedProducts) {\n\n                if (!selectedProducts) {\n                    self.alert(M2ePro.translator.translate('Please select the Products you want to perform the Action on.'));\n                    return;\n                }\n\n                if (self.options.show_autoaction_popup) {\n                    return self.showAutoactionPopup();\n                }\n\n                self.add(selectedProducts);\n\n            });\n        },\n\n        // ---------------------------------------\n\n        add: function (products) {\n            var self = this;\n\n            self.products = products;\n\n            var parts = self.makeProductsParts();\n\n            ProgressBarObj.reset();\n            ProgressBarObj.setTitle('Adding Products to Listing');\n            ProgressBarObj.setStatus('Adding in process. Please wait...');\n            ProgressBarObj.show();\n            self.scrollPageToTop();\n\n            WrapperObj.lock();\n\n            self.sendPartsProducts(parts, parts.length);\n        },\n\n        makeProductsParts: function () {\n            var self = this;\n\n            var productsInPart = 50;\n            var productsArray = explode(',', self.products);\n            var parts = new Array();\n\n            if (productsArray.length < productsInPart) {\n                return parts[0] = productsArray;\n            }\n\n            var result = new Array();\n            for (var i = 0; i < productsArray.length; i++) {\n                if (result.length == 0 || result[result.length - 1].length == productsInPart) {\n                    result[result.length] = new Array();\n                }\n                result[result.length - 1][result[result.length - 1].length] = productsArray[i];\n            }\n\n            return result;\n        },\n\n        sendPartsProducts: function (parts, partsCount) {\n            var self = this;\n\n            if (parts.length == 0) {\n                return;\n            }\n\n            var part = parts.splice(0, 1);\n            part = part[0];\n            var partString = implode(',', part);\n\n            var isLastPart = '';\n            if (parts.length <= 0) {\n                isLastPart = 'yes';\n            }\n\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_add/add'), {\n                method: 'post',\n                parameters: {\n                    is_last_part: isLastPart,\n                    products: partString\n                },\n                onSuccess: function (transport) {\n\n                    var percents = (100 / partsCount) * (partsCount - parts.length);\n\n                    if (percents <= 0) {\n                        ProgressBarObj.setPercents(0, 0);\n                    } else if (percents >= 100) {\n                        ProgressBarObj.setPercents(100, 0);\n                        ProgressBarObj.setStatus('Adding has been completed.');\n\n                        setLocation(M2ePro.url.get('ebay_listing_product_category_settings', {step: 1}));\n                    } else {\n                        ProgressBarObj.setPercents(percents, 1);\n                    }\n\n                    setTimeout(function () {\n                        self.sendPartsProducts(parts, partsCount);\n                    }, 500);\n                }\n            });\n\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\n        },\n\n        // ---------------------------------------\n\n        showAutoactionPopup: function () {\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_add/setAutoActionPopupShown'), {\n                method: 'get',\n                onSuccess: function () {\n\n                    this.options.show_autoaction_popup = false;\n\n                    var modalDialogMessage = $('modal_auto_action_dialog_message');\n\n                    if (!modalDialogMessage) {\n                        modalDialogMessage = new Element('div', {\n                            id: 'modal_auto_action_dialog_message'\n                        });\n\n                        this.autoactionPopup = jQuery(modalDialogMessage).modal({\n                            title: M2ePro.translator.translate('Auto Add/Remove Rules'),\n                            type: 'popup',\n                            buttons: [\n                                {\n                                    text: M2ePro.translator.translate('Cancel'),\n                                    class: 'action-secondary action-dismiss',\n                                    click: ListingProductAddObj.cancelAutoActionPopup\n                                },\n                                {\n                                    text: M2ePro.translator.translate('Start Configure'),\n                                    class: 'action-primary action-accept',\n                                    click: function () {\n                                        ListingProductAddObj.autoactionPopup.modal('closeModal');\n                                        ListingAutoActionObj.loadAutoActionHtml();\n                                    }\n                                }\n                            ]\n                        });\n                        modalDialogMessage.insert($('autoaction_popup_content').show());\n                    }\n\n                    this.autoactionPopup.modal('openModal');\n\n                }.bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        cancelAutoActionPopup: function () {\n            ListingProductAddObj.autoactionPopup.modal('closeModal');\n            ListingProductAddObj.continue();\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal'\r\n], function (jQuery, modal) {\r\n\r\n    window.EbayListingProductCategorySettingsMode = Class.create();\r\n    EbayListingProductCategorySettingsMode.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (lastModeValue) {\r\n\r\n            $$('input[name=\"mode\"]').each(function(element) {\r\n                element.observe('change', function() {\r\n                    var modeSameRememberCheckbox = $('mode_same_remember_checkbox');\r\n                    modeSameRememberCheckbox.checked = false;\r\n                    modeSameRememberCheckbox.disabled = true;\r\n                    this.value == 'same' && (modeSameRememberCheckbox.disabled = false);\r\n                })\r\n            });\r\n\r\n            var modeElement = $$('input[value=\"'+lastModeValue+'\"]').shift();\r\n\r\n            modeElement.checked = true;\r\n            modeElement.simulate('change');\r\n\r\n            $('mode_same_remember_checkbox').observe('click', function(event) {\r\n\r\n                if (!this.checked) {\r\n                    return;\r\n                }\r\n\r\n                event.preventDefault();\r\n\r\n                var content = jQuery('#mode_same_remember_pop_up_content');\r\n\r\n                modal({\r\n                    title: M2ePro.translator.translate('Apply Settings'),\r\n                    type: 'popup',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        class: 'action-secondary action-dismiss',\r\n                        click: function () {\r\n                            content.modal('closeModal');\r\n                        }\r\n                    },{\r\n                        text: M2ePro.translator.translate('Continue'),\r\n                        class: 'action-primary action-accept',\r\n                        click: function () {\r\n                            $('categories_mode_form').submit();\r\n                        }\r\n                    }]\r\n                }, content);\r\n\r\n                content.modal('openModal');\r\n            });\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingProductCategorySettingsGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n\r\n                editCategoriesAction: function (id) {\r\n\r\n                    id && this.selectByRowId(id);\r\n                    this.editCategories();\r\n\r\n                }.bind(this),\r\n\r\n                editPrimaryCategoriesAction: function (id) {\r\n\r\n                    id && this.selectByRowId(id);\r\n                    this.editPrimaryCategories();\r\n\r\n                }.bind(this),\r\n\r\n                editStorePrimaryCategoriesAction: function (id) {\r\n\r\n                    id && this.selectByRowId(id);\r\n                    this.editStorePrimaryCategories();\r\n\r\n                }.bind(this)\r\n\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPrimaryCategories: function () {\r\n            alert('abstract editPrimaryCategories');\r\n        },\r\n\r\n        editStorePrimaryCategories: function () {\r\n            alert('abstract editPrimaryCategories');\r\n        },\r\n\r\n        editCategoriesByType: function (type, validationRequired) {\r\n            validationRequired = validationRequired || false;\r\n\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/getChooserBlockHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    products_ids: this.getSelectedProductsString()\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var temp = document.createElement('div');\r\n                    temp.innerHTML = transport.responseText;\r\n                    temp.innerHTML.evalScripts();\r\n\r\n                    setTimeout(function go() {\r\n                        if (typeof EbayListingProductCategorySettingsChooserObj == 'undefined') {\r\n                            setTimeout(go, 50);\r\n                        } else {\r\n                            EbayListingProductCategorySettingsChooserObj.showEditPopUp(type);\r\n\r\n                            validationRequired && (EbayListingProductCategorySettingsChooserObj.categoriesRequiringValidation[type] = true);\r\n\r\n                            EbayListingProductCategorySettingsChooserObj.doneCallback = function () {\r\n                                self.saveCategoriesData(EbayListingProductCategorySettingsChooserObj.getInternalDataByType(type));\r\n\r\n                                EbayListingProductCategorySettingsChooserObj.doneCallback = null;\r\n                                EbayListingProductCategorySettingsChooserObj.cancelCallback = null;\r\n\r\n                                validationRequired && (delete EbayListingProductCategorySettingsChooserObj.categoriesRequiringValidation[type]);\r\n                            };\r\n\r\n                            EbayListingProductCategorySettingsChooserObj.cancelCallback = function () {\r\n                                self.unselectAll();\r\n\r\n                                EbayListingProductCategorySettingsChooserObj.doneCallback = null;\r\n                                EbayListingProductCategorySettingsChooserObj.cancelCallback = null;\r\n\r\n                                validationRequired && (delete EbayListingProductCategorySettingsChooserObj.categoriesRequiringValidation[type]);\r\n                            };\r\n                        }\r\n                    }, 50);\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        saveCategoriesData: function (templateData) {\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoSaveToSession'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: this.getSelectedProductsString(),\r\n                    template_data: Object.toJSON(templateData)\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    this.unselectAll();\r\n                    this.getGridObj().doFilter();\r\n\r\n                    jQuery('#m2epro-popup').modal('closeModal');\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategories: function () {\r\n            alert('abstract editCategories');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'ebay';\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Chooser.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common',\r\n    'M2ePro/Plugin/Magento/AttributeCreator'\r\n], function (jQuery, modal) {\r\n\r\n    window.EbayListingProductCategorySettingsChooser = Class.create();\r\n    EbayListingProductCategorySettingsChooser.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        marketplaceId: null,\r\n        accountId: null,\r\n        divId: null,\r\n\r\n        selectedCategories: {},\r\n        categoryTitles: {},\r\n        attributes: [],\r\n\r\n        selectCallback: null,\r\n        unselectCallback: null,\r\n        doneCallback: null,\r\n        cancelCallback: null,\r\n\r\n        isShowEditLinks: true,\r\n        categoriesRequiringValidation: {},\r\n\r\n        isSingleCategoryMode: false,\r\n        singleCategoryType: null,\r\n\r\n        tempUnselectedCategory: {},\r\n        tempSelectedCategory: {},\r\n\r\n        isWizardMode: false,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (div, marketplace, account) {\r\n            this.marketplaceId = marketplace;\r\n            this.accountId = account;\r\n            this.divId = div;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setSelectCallback: function (callback) {\r\n            this.selectCallback = callback;\r\n        },\r\n\r\n        setUnselectCallback: function (callback) {\r\n            this.unselectCallback = callback;\r\n        },\r\n\r\n        getMarketplaceId: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.marketplaceId;\r\n        },\r\n\r\n        getAccountId: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.accountId;\r\n        },\r\n\r\n        setAttributes: function (attributes) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.attributes = attributes;\r\n        },\r\n\r\n        getAttributes: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.attributes;\r\n        },\r\n\r\n        setSingleCategoryMode: function (mode) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.isSingleCategoryMode = mode;\r\n        },\r\n\r\n        setSingleCategoryType: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.singleCategoryType = type;\r\n        },\r\n\r\n        setShowEditLinks: function (mode) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.isShowEditLinks = mode;\r\n        },\r\n\r\n        setSelectedCategory: function (type, mode, value) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.selectedCategories[type] = {\r\n                mode: mode,\r\n                value: value\r\n            };\r\n        },\r\n\r\n        setSelectedCategories: function (categories) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.selectedCategories = categories;\r\n        },\r\n\r\n        getSelectedCategory: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (typeof type == 'undefined') {\r\n                return self.selectedCategories;\r\n            }\r\n\r\n            if (typeof self.selectedCategories[type] == 'undefined') {\r\n\r\n                return {mode: 0, value: ''};\r\n            }\r\n\r\n            return self.selectedCategories[type];\r\n        },\r\n\r\n        getInternalData: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (self.isSingleCategoryMode) {\r\n                return self.selectedCategories[self.singleCategoryType];\r\n            }\r\n\r\n            var internalData = {};\r\n\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN'),\r\n                'category_main_',\r\n                internalData\r\n            );\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY'),\r\n                'category_secondary_',\r\n                internalData\r\n            );\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN'),\r\n                'store_category_main_',\r\n                internalData\r\n            );\r\n            self.setCategoryToInternalData(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_SECONDARY'),\r\n                'store_category_secondary_',\r\n                internalData\r\n            );\r\n\r\n            return internalData;\r\n        },\r\n\r\n        getInternalDataByType: function (type) {\r\n            var prefixByType = {};\r\n\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN')] = 'category_main_';\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY')] = 'category_secondary_';\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN')] = 'store_category_main_';\r\n            prefixByType[M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_SECONDARY')] = 'store_category_secondary_';\r\n\r\n            var data = {};\r\n\r\n            this.setCategoryToInternalData(\r\n                type,\r\n                prefixByType[type],\r\n                data\r\n            );\r\n\r\n            return data;\r\n        },\r\n\r\n        getConvertedInternalData: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            return self.selectedCategories;\r\n        },\r\n\r\n        setCategoryToInternalData: function (type, prefix, data) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            data[prefix + 'mode'] = 0;\r\n            data[prefix + 'id'] = null;\r\n            data[prefix + 'attribute'] = null;\r\n\r\n            if (typeof self.selectedCategories[type] != 'undefined' &&\r\n                typeof self.selectedCategories[type]['mode'] != 'undefined') {\r\n\r\n                data[prefix + 'mode'] = self.selectedCategories[type].mode;\r\n\r\n                if (data[prefix + 'mode'] == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY')) {\r\n                    data[prefix + 'id'] = self.selectedCategories[type].value;\r\n                } else if (data[prefix + 'mode'] == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_ATTRIBUTE')) {\r\n                    data[prefix + 'attribute'] = self.selectedCategories[type].value;\r\n                }\r\n            }\r\n\r\n            return data;\r\n        },\r\n\r\n        getCategoryTitle: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (typeof self.categoryTitles[type] == 'undefined') {\r\n                return '';\r\n            }\r\n\r\n            return self.categoryTitles[type];\r\n        },\r\n\r\n        setCategoryTitles: function (titles) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.categoryTitles = titles;\r\n        },\r\n\r\n        setIsWizardMode: function (mode) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            self.isWizardMode = mode;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showEditPopUp: function (type) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var selected = self.getSelectedCategory(type);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getChooserEditHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    category_type: type,\r\n                    selected_mode: selected.mode,\r\n                    selected_value: selected.value,\r\n                    selected_path: selected.path\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var title = M2ePro.translator.translate('Edit') + ' ' + self.getCategoryTitle(type);\r\n\r\n                    self.openPopUp(title, transport.responseText);\r\n                    self.renderRecent();\r\n                    self.renderAttributes();\r\n                }\r\n            });\r\n        },\r\n\r\n        openPopUp: function (title, html) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if ($('chooser_container')) {\r\n                $('chooser_container').remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: html});\r\n\r\n            var content = jQuery('#chooser_container');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                closed: function(){\r\n                    var type = $('category_type').value;\r\n\r\n                    delete self.tempSelectedCategory[type];\r\n                    delete self.tempUnselectedCategory[type];\r\n                },\r\n                buttons: [{\r\n                    text : M2ePro.translator.translate('Cancel'),\r\n                    click : function () {\r\n                        EbayListingProductCategorySettingsChooserObj.cancelPopUp();\r\n                    }\r\n                },{\r\n                    class : 'action primary',\r\n                    text : M2ePro.translator.translate('Confirm'),\r\n                    click : function () {\r\n                        EbayListingProductCategorySettingsChooserObj.confirmCategory();\r\n                    }\r\n                }]\r\n            }, content);\r\n\r\n            content.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        cancelPopUp: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            jQuery('#chooser_container').modal('closeModal');\r\n\r\n            if (typeof self.cancelCallback == 'function') {\r\n                self.cancelCallback();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selectCategory: function (mode, value) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var type = $('category_type').value;\r\n\r\n            self.tempSelectedCategory[type] = {\r\n                mode: mode,\r\n                value: value\r\n            };\r\n            delete self.tempUnselectedCategory[type];\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getPath'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    value: value,\r\n                    mode: mode,\r\n                    category_type: type\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('selected_category_path').innerHTML = transport.responseText;\r\n                    $('category_reset_link').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        unSelectCategory: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var type = $('category_type').value;\r\n            self.tempUnselectedCategory[type] = true;\r\n            delete self.tempSelectedCategory[type];\r\n\r\n            $('selected_category_path').innerHTML = '';\r\n            $('category_reset_link').hide();\r\n            $('selected_category_path').innerHTML = '<span style=\"color: grey; font-style: italic\">' + M2ePro.translator.translate('Not Selected') + '</span>';\r\n        },\r\n\r\n        isCategoryTemporarySelected: function (type) {\r\n            return typeof this.tempSelectedCategory[type] != 'undefined'\r\n                && typeof this.tempSelectedCategory[type].mode != 'undefined'\r\n                && this.tempSelectedCategory[type].mode != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_NONE');\r\n        },\r\n\r\n        isCategoryTemporaryUnselected: function (type) {\r\n            return typeof this.tempUnselectedCategory[type] != 'undefined';\r\n        },\r\n\r\n        isCategorySelected: function (type) {\r\n            return typeof this.selectedCategories[type] != 'undefined'\r\n                && typeof this.selectedCategories[type].mode != 'undefined'\r\n                && this.selectedCategories[type].mode != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_NONE');\r\n        },\r\n\r\n        isCategoryValidationRequired: function (type) {\r\n            return typeof this.categoriesRequiringValidation[type] != 'undefined' && this.categoriesRequiringValidation[type];\r\n        },\r\n\r\n        confirmCategory: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var type = $('category_type').value;\r\n\r\n            $('category_validation').value = this.isCategoryTemporarySelected(type) ? 1 :\r\n                (this.isCategorySelected(type) && !this.isCategoryTemporaryUnselected(type)) ? 1 : '';\r\n\r\n            if (this.isCategoryValidationRequired(type) && !Validation.validate($('category_validation'))) {\r\n                return;\r\n            }\r\n\r\n            if (typeof self.tempSelectedCategory[type] != 'undefined') {\r\n                self.selectedCategories[type] = self.tempSelectedCategory[type];\r\n\r\n                if (type == 0 && this.selectCallback != null) {\r\n                    (this.selectCallback)(self.selectedCategories[type].mode, self.selectedCategories[type].value);\r\n                }\r\n            }\r\n\r\n            if (typeof self.tempUnselectedCategory[type] != 'undefined') {\r\n                delete self.selectedCategories[type];\r\n\r\n                if (this.unselectCallback != null) {\r\n                    (this.unselectCallback)();\r\n                }\r\n            }\r\n\r\n            delete self.tempSelectedCategory[type];\r\n            delete self.tempUnselectedCategory[type];\r\n\r\n            jQuery('#chooser_container').modal('closeModal');\r\n\r\n            self.reload();\r\n\r\n            if (typeof self.doneCallback == 'function') {\r\n                self.doneCallback();\r\n            }\r\n        },\r\n\r\n        reload: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var selectedCategories = {};\r\n            var types = [\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN'),\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY'),\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN'),\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_SECONDARY')\r\n            ];\r\n\r\n            types.each(function (type) {\r\n                if (typeof self.selectedCategories[type] == 'undefined') {\r\n                    selectedCategories[type] = null;\r\n                } else {\r\n                    selectedCategories[type] = self.selectedCategories[type];\r\n                }\r\n            });\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getChooserHtml'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    div_id: self.divId,\r\n                    selected_categories: Object.toJSON(selectedCategories),\r\n                    is_single_category_mode: self.isSingleCategoryMode,\r\n                    single_category_type: self.singleCategoryType,\r\n                    is_show_edit_links: self.isShowEditLinks,\r\n                    select_callback: self.selectCallback,\r\n                    unselect_callback: self.unselectCallback\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if ($(self.divId)) {\r\n                        $(self.divId).innerHTML = transport.responseText;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        reloadPopUp: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var type = $('category_type').value;\r\n            self.showEditPopUp(type);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderAttributes: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (!$('chooser_attributes_table')) {\r\n                return;\r\n            }\r\n\r\n            var handlerObj = new AttributeCreator('category_chooser_' + this.marketplaceId +'_'+ this.accountId +'_'+ this.divId);\r\n            handlerObj.setOnSuccessCallback(function(attributeParams, result) {\r\n\r\n                $$('#chooser_attributes_table tbody').first().update();\r\n\r\n                self.attributes.push({\r\n                    code:  attributeParams.code,\r\n                    label: attributeParams.store_label\r\n                });\r\n                self.renderAttributes();\r\n                self.selectCategory(M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category::CATEGORY_MODE_ATTRIBUTE'), attributeParams.code);\r\n            });\r\n\r\n            handlerObj.setOnFailedCallback(function(attributeParams, result) {\r\n                self.alert(result['error']);\r\n            });\r\n\r\n            var totalHtml = '',\r\n                rowHtml   = '',\r\n                newAttrHtml = '<td style=\"color: brown\">'+M2ePro.translator.translate('Create a New One...')+'</td>' +\r\n                    '<td style=\"padding-left: 55px\"><a href=\"javascript:void(0)\" ' +\r\n                    'onclick=\"' + handlerObj.id + '.showPopup({\\'allowed_attribute_types\\':\\'text,select\\'});\">' +\r\n                    M2ePro.translator.translate('Select') + '</a></td>';\r\n\r\n            self.attributes.each(function (attribute, index) {\r\n\r\n                rowHtml += '<td>' + attribute.label + '</td>' +\r\n                    '<td style=\"padding-left: 55px\"><a href=\"javascript:void(0)\" ' +\r\n                    'onclick=\"EbayListingProductCategorySettingsChooserObj.selectCategory(' + M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_ATTRIBUTE') + ', \\'' + attribute.code + '\\')\">' +\r\n                    M2ePro.translator.translate('Select') + '</a></td>';\r\n\r\n                if ((index + 1) == self.attributes.length && (index + 1) % 2 != 0) {\r\n                    rowHtml += newAttrHtml;\r\n                }\r\n\r\n                if (((index + 1) % 2 == 0) ||\r\n                    (index + 1) == self.attributes.length) {\r\n\r\n                    totalHtml += '<tr>' + rowHtml + '</tr>';\r\n                    rowHtml = '';\r\n                }\r\n\r\n                if ((index + 1) == self.attributes.length && (index + 1) % 2 == 0) {\r\n                    totalHtml += '<tr>' + newAttrHtml + '</tr>';\r\n                }\r\n            });\r\n\r\n            $$('#chooser_attributes_table tbody').first().insert(totalHtml);\r\n        },\r\n\r\n        renderRecent: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (!$('chooser_recent_table')) {\r\n                return;\r\n            }\r\n\r\n            var type = $('category_type').value;\r\n\r\n            var selected = null;\r\n            if (typeof self.selectedCategories[type] != \"undefined\" &&\r\n                self.selectedCategories[type].mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY')) {\r\n\r\n                selected = self.selectedCategories[type].value;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getRecent'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace: self.marketplaceId,\r\n                    account: self.accountId,\r\n                    selected_category: selected,\r\n                    category_type: type\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var categories = transport.responseText.evalJSON();\r\n                    var html = '';\r\n\r\n                    if (transport.responseText.length > 2) {\r\n                        categories.each(function (category) {\r\n                            html += '<tr><td>' + category.path + '</td>' +\r\n                                '<td><a href=\"javascript:void(0)\" ' +\r\n                                'onclick=\"EbayListingProductCategorySettingsChooserObj.selectCategory(' + M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY') + ', \\'' + category.id + '\\')\">' +\r\n                                M2ePro.translator.translate('Select') + '</a></td></tr>';\r\n                        });\r\n                    } else {\r\n                        html += '<tr><td colspan=\"2\" style=\"padding-left: 200px\"><strong>' + M2ePro.translator.translate('No recently used Categories') + '</strong></td></tr>';\r\n                    }\r\n\r\n                    $('chooser_recent_table').innerHTML = html;\r\n                }\r\n            });\r\n        },\r\n\r\n        search: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            var query = $('query').value;\r\n            if (query.length < 3) {\r\n                return;\r\n            }\r\n\r\n            var type = $('category_type').value;\r\n            $('chooser_search_results').innerHTML = '';\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/search'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    account_id: self.accountId,\r\n                    query: query,\r\n                    category_type: type\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var html = '<table id=\"search_results_table\">';\r\n\r\n                    if (transport.responseText.length > 2) {\r\n                        var result = transport.responseText.evalJSON();\r\n                        result.each(function (category) {\r\n                            html += '<tr><td style=\"padding: 2px;\">';\r\n                            html += category.titles + ' (' + category.id + ')';\r\n                            html += '</td><td style=\"padding: 2px;\">';\r\n                            html += '<a href=\"javascript:void(0)\" ' +\r\n                                'onclick=\"EbayListingProductCategorySettingsChooserObj.selectCategory(' + M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_EBAY') + ', ' + category.id + ')\">' +\r\n                                M2ePro.translator.translate('Select') + '</a>';\r\n                            html += '</td>';\r\n                        });\r\n                    } else {\r\n                        html += '<tr><td colspan=\"2\" style=\"text-align: center;\"><strong>' + M2ePro.translator.translate('No results') + '</strong></td></tr>';\r\n\r\n                        var refreshMessage = '';\r\n\r\n                        if (!self.isWizardMode) {\r\n\r\n                            if ($('category_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN') ||\r\n                                $('category_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_SECONDARY')\r\n                            ) {\r\n                                refreshMessage = M2ePro.translator.translate('Try to <a href=\"javascript:void(0)\" onclick=\"EbayListingProductCategorySettingsChooserObj.refreshEbayCategories()\">update Marketplaces Data</a> and repeate the Search.');\r\n                            } else {\r\n                                refreshMessage = M2ePro.translator.translate('Try to <a href=\"javascript:void(0)\" onclick=\"EbayListingProductCategorySettingsChooserObj.refreshStoreCategories()\">refresh eBay Store Data</a> and repeate the Search.');\r\n                            }\r\n                        }\r\n\r\n                        html += '<tr><td colspan=\"2\" style=\"text-align: center;\">' + refreshMessage + '</td></tr>';\r\n                    }\r\n\r\n                    html += '</table>';\r\n\r\n                    $('chooser_search_results').innerHTML = html;\r\n                }\r\n            });\r\n        },\r\n\r\n        searchReset: function () {\r\n            $('chooser_search_results').update();\r\n            $('query').value = '';\r\n            $('query').focus();\r\n        },\r\n\r\n        refreshStoreCategories: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (self.accountId == null) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/refreshStoreCategories'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    account_id: self.accountId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    EbayListingProductCategorySettingsChooserTabsBrowseObj.renderTopLevelCategories('chooser_browser');\r\n\r\n                    if ($('query').value.length != 0) {\r\n                        self.search();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        refreshEbayCategories: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var win = window.open(M2ePro.url.get('ebay_marketplace/index'));\r\n\r\n            var intervalId = setInterval(function () {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                EbayListingProductCategorySettingsChooserTabsBrowseObj.renderTopLevelCategories('chooser_browser');\r\n\r\n                if ($('query').value.length != 0) {\r\n                    self.search();\r\n                }\r\n            }, 1000);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n            var mainStore = false;\r\n\r\n            if ($$('#' + self.divId + ' .main-empty-advice').length <= 0) {\r\n                return true;\r\n            }\r\n\r\n            if ($$('.main-store-empty-advice').length > 0) {\r\n                mainStore = true;\r\n            }\r\n\r\n            $$('#' + self.divId + ' .main-empty-advice')[0].hide();\r\n            if (mainStore) {\r\n                $$('.main-store-empty-advice')[0].hide();\r\n            }\r\n\r\n            var typeEbayMain = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN');\r\n            if (typeof self.selectedCategories[typeEbayMain] == 'undefined' ||\r\n                typeof self.selectedCategories[typeEbayMain]['mode'] == 'undefined' ||\r\n                self.selectedCategories[typeEbayMain]['mode'] == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Category::CATEGORY_MODE_NONE')) {\r\n\r\n                $$('#' + self.divId + ' .main-empty-advice')[0].show();\r\n                return false;\r\n            }\r\n\r\n            if (!mainStore) {\r\n                return true;\r\n            }\r\n\r\n            var primary = $('magento_block_ebay_listing_category_chooser_store_primary_not_selected') == null;\r\n            var secondary = $('magento_block_ebay_listing_category_chooser_store_secondary_not_selected') == null;\r\n\r\n            if (primary == false && secondary == true) {\r\n                $$('.main-store-empty-advice')[0].show();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        keyPressQuery: function (event) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (event.keyCode == 13) {\r\n                self.search();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        submitData: function (url) {\r\n            var self = EbayListingProductCategorySettingsChooserObj;\r\n\r\n            if (!self.validate()) {\r\n                return;\r\n            }\r\n\r\n            var categoryData = self.getInternalData();\r\n\r\n            self.postForm(url, {category_data: Object.toJSON(categoryData)});\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Specific.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.EbayListingProductCategorySettingsSpecific = Class.create();\r\n    EbayListingProductCategorySettingsSpecific.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (marketplaceId, categoryMode, categoryValue, uniqId) {\r\n            this.marketplaceId = marketplaceId;\r\n            this.categoryMode = categoryMode;\r\n            this.categoryValue = categoryValue;\r\n\r\n            this.maxSelectedSpecifics = 25;\r\n\r\n            this.valuesCounter = 0;\r\n            this.counter = 0;\r\n            this.uniqId = uniqId || '';\r\n\r\n            this.attributes = [];\r\n            this.attributeOptions = '';\r\n\r\n            this.dictionarySpecifics = [];\r\n            this.ebaySelectedSpecifics = [];\r\n            this.customSelectedSpecifics = [];\r\n\r\n            this.specificsJson = [];\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setAttributes: function (attributes) {\r\n            this.attributes = attributes;\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setDictionarySpecifics: function (specifics) {\r\n            this.dictionarySpecifics = specifics;\r\n            return this;\r\n        },\r\n\r\n        setEbaySelectedSpecifics: function (specifics) {\r\n            this.ebaySelectedSpecifics = specifics;\r\n            return this;\r\n        },\r\n\r\n        setCustomSelectedSpecifics: function (specifics) {\r\n            this.customSelectedSpecifics = specifics;\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getItemSpecifics: function () {\r\n            var self = this;\r\n\r\n            var parameters = $(self.uniqId + 'category_specific_form').serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getJsonSpecificsFromPost'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: parameters,\r\n                onSuccess: function (transport) {\r\n                    if (transport.responseText.length != 0) {\r\n                        self.specificsJson = transport.responseText.evalJSON();\r\n                    }\r\n                }\r\n            });\r\n\r\n            return self.specificsJson;\r\n        },\r\n\r\n        getInternalData: function () {\r\n            var self = this;\r\n\r\n            var internalData = $(self.uniqId + 'category_specific_form').serialize(true);\r\n            internalData['specifics'] = self.getItemSpecifics();\r\n\r\n            return internalData;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareAttributes: function () {\r\n            var cachedOptions = '';\r\n            this.attributes.each(function (v) {\r\n                cachedOptions += '<option value=\"' + v.code + '\">' + v.label + '</option>\\n';\r\n            });\r\n\r\n            this.attributeOptions = cachedOptions;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareBeforeRenderSpecifics: function () {\r\n            if (this.categoryMode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category::CATEGORY_MODE_EBAY')) {\r\n                $(this.uniqId + 'item_specifics_tbody').innerHTML = '';\r\n\r\n                if ($$('#' + this.uniqId + 'item_specifics_tbody .not-custom').length > 0) {\r\n                    $$('#' + this.uniqId + 'item_specifics_tbody .not-custom').invoke('show');\r\n                }\r\n            } else {\r\n                $$('#' + this.uniqId + 'item_specifics_tbody .not-custom').invoke('hide');\r\n            }\r\n\r\n            $(this.uniqId + 'add_custom_container').show();\r\n\r\n            this.prepareAttributes();\r\n            this.clearSpecifics();\r\n\r\n            if ((this.dictionarySpecifics.length == 0) &&\r\n                (this.customSelectedSpecifics.length == 0)) {\r\n                $(this.uniqId + 'item_specifics_tbody').hide();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        renderSpecifics: function () {\r\n            if (!this.prepareBeforeRenderSpecifics()) {\r\n                return;\r\n            }\r\n\r\n            this.renderDictionarySpecific();\r\n            this.renderCustomSelectedSpecifics();\r\n\r\n            $(this.uniqId + 'item_specifics_tbody').show();\r\n        },\r\n\r\n        renderDictionarySpecific: function () {\r\n            var self = this;\r\n\r\n            self.dictionarySpecifics.each(function (specific) {\r\n\r\n                var counter = self.counter;\r\n                var recommendedOptionsHtml = '';\r\n\r\n                self.addDictionarySpecificRow(specific);\r\n\r\n                if (typeof specific.min_values != 'undefined') {\r\n                    for (var i = 1; i < specific.min_values; i++) {\r\n                        self.addSpecificCustomValueRow(counter);\r\n                    }\r\n                }\r\n\r\n                for (var i = 0; i < specific.values.length; i++) {\r\n                    var recommended = specific.values[i];\r\n                    recommendedOptionsHtml += '<option value=\"%value%\">%label%</option>'\r\n                        .replace(/%value%/, base64_encode(recommended.value))\r\n                        .replace(/%label%/, recommended.value);\r\n                }\r\n\r\n                $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).insert(recommendedOptionsHtml);\r\n                $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).selectedIndex = -1;\r\n\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + counter).insert(self.attributeOptions);\r\n\r\n                var handlerObj = new AttributeCreator(self.uniqId + 'item_specifics_value_custom_attribute_' + counter);\r\n                handlerObj.setSelectObj($(self.uniqId + 'item_specifics_value_custom_attribute_' + counter));\r\n                handlerObj.injectAddOption();\r\n\r\n                var specificValueMode = $(self.uniqId + 'item_specifics_value_mode_' + counter);\r\n\r\n                if (specific.required) {\r\n                    if (specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]').length > 0) {\r\n                        specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]')[0].remove();\r\n                    }\r\n\r\n                    specificValueMode.select('option')[0].selected = 1;\r\n                }\r\n\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_TEXT')) {\r\n                    specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].remove();\r\n                }\r\n\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_ONE') ||\r\n                    specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE')) {\r\n                    specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE') + '\"]')[0].remove();\r\n                }\r\n\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE') ||\r\n                    specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).writeAttribute('multiple', 'true');\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).addClassName('select multiselect admin__control-multiselect');\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).removeClassName('admin__control-select');\r\n\r\n                    var tempOldName = $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).readAttribute('name');\r\n                    $(self.uniqId + 'item_specifics_value_ebay_recommended_' + counter).writeAttribute('name', tempOldName + '[]');\r\n                }\r\n\r\n                if (specific.values.length < 1) {\r\n                    if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_ONE_OR_TEXT') ||\r\n                        specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                        specificValueMode.select('option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].remove();\r\n                    }\r\n                }\r\n\r\n                self.chooseEbaySelectedSpecifics(specific, counter);\r\n\r\n                self.dictionarySpecificModeChange($(self.uniqId + 'item_specifics_value_mode_' + counter));\r\n\r\n                var length = $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr').length;\r\n\r\n                if (typeof specific.min_values != 'undefined' && typeof specific.max_values != 'undefined') {\r\n                    if (specific.max_values > length) {\r\n                        $(self.uniqId + 'add_item_specifics_custom_value_button_' + counter).show();\r\n                    } else {\r\n                        $(self.uniqId + 'add_item_specifics_custom_value_button_' + counter).hide();\r\n                    }\r\n\r\n                    if (length == 1 || specific.min_values >= length) {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('hide');\r\n                    } else {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('show');\r\n                    }\r\n\r\n                } else {\r\n                    if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE') ||\r\n                        specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                        $(self.uniqId + 'add_item_specifics_custom_value_button_' + counter).show();\r\n                    }\r\n\r\n                    if (length == 1) {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('hide');\r\n                    } else {\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' tr td.btn_value_remove').invoke('show');\r\n                    }\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        renderCustomSelectedSpecifics: function () {\r\n            var self = this;\r\n\r\n            this.customSelectedSpecifics.each(function (specific) {\r\n\r\n                var counter = self.counter;\r\n\r\n                self.addCustomSpecificRow();\r\n\r\n                $$('#' + self.uniqId + 'custom_item_specifics_value_mode_' + counter + ' option[value=\"' + specific.value_mode + '\"]')[0].selected = true;\r\n                self.customSelectedSpecificChange($(self.uniqId + 'custom_item_specifics_value_mode_' + counter));\r\n\r\n                if (specific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                    $(self.uniqId + 'custom_item_specifics_label_custom_value_' + counter).value = specific.attribute_title;\r\n\r\n                    if (typeof $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[0] == 'undefined') {\r\n                        self.addSpecificCustomValueRow(counter);\r\n                    }\r\n\r\n                    $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[0]\r\n                        .setValue(specific.value_custom_value[0]);\r\n                }\r\n\r\n                if (specific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                    if ($$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]')[0].selected = true;\r\n                    } else {\r\n                        $(self.uniqId + 'item_specifics_value_custom_attribute_' + counter).selectedIndex = -1;\r\n                    }\r\n                }\r\n\r\n                if (specific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_LABEL_ATTRIBUTE')) {\r\n                    $(self.uniqId + 'custom_item_specifics_label_custom_label_attribute_' + counter).value = specific.attribute_title;\r\n                    if ($$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + specific.value_custom_attribute + '\"]')[0].selected = true;\r\n                    } else {\r\n                        $(self.uniqId + 'item_specifics_value_custom_attribute_' + counter).selectedIndex = -1;\r\n                    }\r\n                }\r\n\r\n                self.customSelectedSpecificChange($(self.uniqId + 'custom_item_specifics_value_mode_' + counter));\r\n            });\r\n        },\r\n\r\n        renderAttributesWithEmptyOption: function (id, insertTo, value, notRequiried) {\r\n            var self = this;\r\n\r\n            var className = notRequiried ? '' : ' class=\"M2ePro-required-when-visible\"';\r\n            var txt = '<select name=\"' + id + '\" id=\"' + id + '\" ' + className + '>\\n';\r\n\r\n            txt += '<option class=\"empty\"></option>\\n';\r\n            txt += self.attributeOptions;\r\n\r\n            if ($(insertTo + '_note') != null && $$('#' + insertTo + '_note').length != 0) {\r\n                $(insertTo).innerHTML = txt + $(insertTo + '_note').innerHTML;\r\n            } else {\r\n                $(insertTo).innerHTML = txt;\r\n            }\r\n\r\n            self.checkAttributesSelect(id, value);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addDictionarySpecificRow: function (specific) {\r\n            var template = $(this.uniqId + 'specific_template').innerHTML;\r\n\r\n            template = template.replace(/%i%/g, this.counter);\r\n            template = template.replace(/%attribute_title%/g, specific.title);\r\n            template = template.replace(/%required%/g, specific.required ? '&nbsp;<span class=\"required\">*</span>' : '');\r\n            template = template.replace(/%relation_mode%/, M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::MODE_ITEM_SPECIFICS'));\r\n\r\n            if (typeof specific.min_values != 'undefined' && typeof specific.max_values != 'undefined') {\r\n                template = template.replace(/%min_values%/g, specific.min_values);\r\n                template = template.replace(/%max_values%/g, specific.max_values);\r\n            } else {\r\n                template = template.replace(/%min_values%/g, specific.required ? 1 : 0);\r\n                if (specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE') ||\r\n                    specific.type == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::RENDER_TYPE_SELECT_MULTIPLE_OR_TEXT')) {\r\n                    template = template.replace(/%max_values%/g, 30);\r\n                } else {\r\n                    template = template.replace(/%max_values%/g, 1);\r\n                }\r\n            }\r\n\r\n            $(this.uniqId + 'item_specifics_tbody').insert(template);\r\n\r\n            this.addSpecificCustomValueRow(this.counter);\r\n\r\n            ++this.counter;\r\n        },\r\n\r\n        addCustomSpecificRow: function () {\r\n            var template = $(this.uniqId + 'specific_template').innerHTML;\r\n\r\n            template = template.replace(/%i%/g, this.counter);\r\n            template = template.replace(/%attribute_title%%required%/g, '');\r\n            template = template.replace(/%relation_mode%/g, M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::MODE_CUSTOM_ITEM_SPECIFICS'));\r\n\r\n            template = template.replace(/%min_values%/g, 1);\r\n            template = template.replace(/%max_values%/g, 1);\r\n\r\n            $(this.uniqId + 'item_specifics_tbody').show();\r\n            $(this.uniqId + 'item_specifics_tbody').insert(template);\r\n\r\n            this.addSpecificCustomValueRow(this.counter);\r\n\r\n            var selectId = this.uniqId + 'item_specifics_value_custom_attribute_' + this.counter;\r\n            $(selectId).insert(this.attributeOptions);\r\n\r\n            var handlerObj = new AttributeCreator(selectId);\r\n            handlerObj.setSelectObj($(selectId));\r\n            handlerObj.injectAddOption();\r\n\r\n            $(selectId).show();\r\n\r\n            $(this.uniqId + 'item_specifics_value_mode_' + this.counter).hide();\r\n            $(this.uniqId + 'attribute_title_' + this.counter).hide();\r\n            $(this.uniqId + 'custom_item_specifics_value_mode_' + this.counter).show();\r\n            $(this.uniqId + 'custom_item_specific_remove_button_' + this.counter).show();\r\n            $(this.uniqId + 'specific_' + this.counter + '_row').removeClassName('not-custom');\r\n\r\n            this.checkSpecificsCounter($(this.uniqId + 'custom_item_specifics_value_mode_' + this.counter));\r\n\r\n            ++this.counter;\r\n        },\r\n\r\n        addSpecificCustomValueRow: function (generalCounter) {\r\n            var template = $(this.uniqId + 'specific_custom_value_template').innerHTML;\r\n            template = template.replace(/%i%/g, generalCounter);\r\n            template = template.replace(/%position%/g, this.valuesCounter);\r\n\r\n            $(this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter).insert(template);\r\n\r\n            ++this.valuesCounter;\r\n        },\r\n\r\n        addItemSpecificsCustomValueRow: function (button) {\r\n            var generalCounter = parseInt(button.getAttribute('data-counter'));\r\n            var tbody = $(this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter);\r\n\r\n            this.addSpecificCustomValueRow(generalCounter);\r\n\r\n            var valuesCounter = tbody.childElements().length;\r\n\r\n            if (parseInt(tbody.getAttribute('data-max_values')) > valuesCounter) {\r\n                button.show();\r\n            } else {\r\n                button.hide();\r\n            }\r\n\r\n            if (parseInt(tbody.getAttribute('data-min_values')) >= valuesCounter) {\r\n                $$('#' + this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter + ' tr td.btn_value_remove').invoke('hide');\r\n            } else {\r\n                $$('#' + this.uniqId + 'item_specifics_custom_value_tbody_' + generalCounter + ' tr td.btn_value_remove').invoke('show');\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        chooseEbaySelectedSpecifics: function (specific, counter) {\r\n            var self = this;\r\n\r\n            self.ebaySelectedSpecifics.each(function (selectedSpecific) {\r\n\r\n                if (selectedSpecific.attribute_title != specific.title || !selectedSpecific.value_data) {\r\n                    return;\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE')) {\r\n                    $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]')[0].selected = true;\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED')) {\r\n                    $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].selected = true;\r\n                    $$('#' + self.uniqId + 'item_specifics_value_ebay_recommended_' + counter + ' option').each(function (tempOption) {\r\n\r\n                        for (var i = 0; i < selectedSpecific.value_data.length; i++) {\r\n                            var tempSearchValue = base64_encode(selectedSpecific.value_data[i]);\r\n                            if (tempOption.value == tempSearchValue) {\r\n                                tempOption.selected = true;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                    $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE') + '\"]')[0].selected = true;\r\n\r\n                    var length = selectedSpecific.value_data.length;\r\n                    for (var i = 0; i < length; i++) {\r\n\r\n                        if (typeof $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[i] == 'undefined') {\r\n                            self.addSpecificCustomValueRow(counter);\r\n                        }\r\n\r\n                        $$('#' + self.uniqId + 'item_specifics_custom_value_tbody_' + counter + ' input.item-specific')[i]\r\n                            .setValue(selectedSpecific.value_data[i]);\r\n                    }\r\n                }\r\n\r\n                if (selectedSpecific.value_mode == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                    if ($$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + selectedSpecific.value_data + '\"]').length != 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE') + '\"]')[0].selected = true;\r\n                        $$('#' + self.uniqId + 'item_specifics_value_custom_attribute_' + counter + ' option[value=\"' + selectedSpecific.value_data + '\"]')[0].selected = true;\r\n                    } else if ($$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE') + '\"]')[0].selected = true;\r\n                    } else if ($$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]').length > 0) {\r\n                        $$('#' + self.uniqId + 'item_specifics_value_mode_' + counter + ' option[value=\"' + M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED') + '\"]')[0].selected = true;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        dictionarySpecificModeChange: function (select) {\r\n            var self = this;\r\n            var number = select.id.replace(self.uniqId + 'item_specifics_value_mode_', '');\r\n\r\n            $(self.uniqId + 'item_specifics_value_ebay_recommended_' + number,\r\n                self.uniqId + 'item_specifics_custom_value_' + number,\r\n                self.uniqId + 'item_specifics_value_custom_attribute_' + number,\r\n                self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number\r\n            ).invoke('hide');\r\n\r\n            $(self.uniqId + 'attribute_title_' + number).show();\r\n\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_EBAY_RECOMMENDED')) {\r\n                $(self.uniqId + 'item_specifics_value_ebay_recommended_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                $(self.uniqId + 'item_specifics_custom_value_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                $(self.uniqId + 'attribute_title_' + number).show();\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number).hide();\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + number).show();\r\n            }\r\n\r\n            this.checkSpecificsCounter(select);\r\n            select.up('td').next('td').select('.validation-advice').each(Element.hide);\r\n        },\r\n\r\n        customSelectedSpecificChange: function (select) {\r\n            var self = this;\r\n            var number = select.id.replace(self.uniqId + 'custom_item_specifics_value_mode_', '');\r\n\r\n            $(self.uniqId + 'item_specifics_custom_value_' + number,\r\n                self.uniqId + 'item_specifics_value_custom_attribute_' + number,\r\n                self.uniqId + 'item_specifics_value_ebay_recommended_' + number).invoke('hide');\r\n\r\n            $(self.uniqId + 'custom_item_specifics_label_custom_value_' + number,\r\n                self.uniqId + 'custom_item_specifics_label_custom_label_attribute_' + number,\r\n                self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number).invoke('hide');\r\n\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_VALUE')) {\r\n                $(self.uniqId + 'item_specifics_custom_value_' + number).show();\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_value_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_attribute_' + number).show();\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + number).show();\r\n            }\r\n            if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_CUSTOM_LABEL_ATTRIBUTE')) {\r\n                $(self.uniqId + 'custom_item_specifics_label_custom_label_attribute_' + number).show();\r\n                $(self.uniqId + 'item_specifics_value_custom_attribute_' + number).show();\r\n            }\r\n\r\n            this.checkSpecificsCounter(select);\r\n            select.up('td').next('td').select('.validation-advice').each(Element.hide);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            if ($$('.' + this.uniqId + 'not-none').length > this.maxSelectedSpecifics) {\r\n                $(this.uniqId + 'maximum_specifics_error').show();\r\n                return false;\r\n            }\r\n            var form = jQuery('#' + this.uniqId + 'category_specific_form');\r\n            this.initFormValidation(form);\r\n\r\n            return form.valid();\r\n        },\r\n\r\n        checkAttributesSelect: function (id, value) {\r\n            if ($(id)) {\r\n                if (typeof M2ePro.formData[id] != 'undefined') {\r\n                    $(id).value = M2ePro.formData[id];\r\n                }\r\n                if (value) {\r\n                    $(id).value = value;\r\n                }\r\n            }\r\n        },\r\n\r\n        checkSpecificsCounter: function (select) {\r\n            $(this.uniqId + 'maximum_specifics_error').hide();\r\n\r\n            if (select != null) {\r\n                if (select.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Category_Specific::VALUE_MODE_NONE')) {\r\n                    select.removeClassName(this.uniqId + 'not-none');\r\n                } else {\r\n                    select.addClassName(this.uniqId + 'not-none');\r\n                }\r\n            }\r\n\r\n            if ($$('.' + this.uniqId + 'not-none').length >= this.maxSelectedSpecifics) {\r\n                $(this.uniqId + 'add_custom_container').hide();\r\n            } else {\r\n                $(this.uniqId + 'add_custom_container').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reload: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getSpecificHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: self.marketplaceId,\r\n                    category_mode: self.categoryMode,\r\n                    category_value: self.categoryValue,\r\n                    unique_id: self.uniqId,\r\n                    attributes: self.attributes.join(','),\r\n                    internal_data: $(self.uniqId + 'category_specific_form').serialize(true)\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('category_specific_box' + self.uniqId).innerHTML = transport.responseText;\r\n                }\r\n            });\r\n        },\r\n\r\n        submitData: function (url) {\r\n            var self = this;\r\n\r\n            if (!self.validate()) {\r\n                return;\r\n            }\r\n\r\n            var specificData = self.getInternalData();\r\n\r\n            self.postForm(url, {specific_data: Object.toJSON(specificData)});\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearSpecifics: function () {\r\n            $$('#' + self.uniqId + 'item_specifics_tbody tr').each(Element.remove);\r\n        },\r\n\r\n        removeSpecific: function (button) {\r\n            $(button).up('tr').remove();\r\n            this.checkSpecificsCounter(null);\r\n        },\r\n\r\n        removeItemSpecificsCustomValue: function (button) {\r\n            var tbody = $(button).up('tbody'),\r\n                addBtn = $(button).up('table').next('a');\r\n\r\n            $(button).up('tr').remove();\r\n\r\n            var length = tbody.childElements().length;\r\n\r\n            if (parseInt(tbody.getAttribute('data-max_values')) > length) {\r\n                addBtn.show();\r\n            } else {\r\n                addBtn.hide();\r\n            }\r\n\r\n            if (length == 1 || parseInt(tbody.getAttribute('data-min_values')) >= length) {\r\n                var btnRemove = tbody.getElementsByClassName('btn_value_remove');\r\n                for (var i = 0; i < btnRemove.length; i++) {\r\n                    btnRemove[i].hide();\r\n                }\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Chooser/Tabs/Browse.js":"define([\r\n    'M2ePro/Common'\r\n\r\n], function () {\r\n    window.EbayListingProductCategorySettingsChooserTabsBrowse = Class.create();\r\n    EbayListingProductCategorySettingsChooserTabsBrowse.prototype = Object.extend(new Common(), {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            this.marketplaceId = null;\r\n            this.observers = {\r\n                \"leaf_selected\": [],\r\n                \"not_leaf_selected\": [],\r\n                \"any_selected\": []\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setMarketplaceId: function (marketplaceId) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n            self.marketplaceId = marketplaceId;\r\n        },\r\n\r\n        getMarketplaceId: function () {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            if (self.marketplaceId === null) {\r\n                self.alert('You must set Site');\r\n            }\r\n\r\n            return self.marketplaceId;\r\n        },\r\n\r\n        getCategoriesSelectElementId: function (categoryId) {\r\n            if (categoryId === null) categoryId = 0;\r\n            return 'category_chooser_select_' + categoryId;\r\n        },\r\n\r\n        getCategoryChildrenElementId: function (categoryId) {\r\n            if (categoryId === null) categoryId = 0;\r\n            return 'category_chooser_children_' + categoryId;\r\n        },\r\n\r\n        getSelectedCategories: function () {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            var categoryId = 0;\r\n            var selectedCategories = [];\r\n            var isLastCategory = false;\r\n\r\n            while (!isLastCategory) {\r\n                var categorySelect = $(self.getCategoriesSelectElementId(categoryId));\r\n                if (!categorySelect || categorySelect.selectedIndex == -1) {\r\n                    break;\r\n                }\r\n\r\n                categoryId = selectedCategories[selectedCategories.length]\r\n                    = categorySelect.options[categorySelect.selectedIndex].value;\r\n\r\n                if (categorySelect.options[categorySelect.selectedIndex].getAttribute('is_leaf') == 1) {\r\n                    isLastCategory = true;\r\n                }\r\n            }\r\n\r\n            return selectedCategories;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderTopLevelCategories: function (containerId) {\r\n            this.prepareDomStructure(null, $(containerId));\r\n            this.renderChildCategories(null);\r\n        },\r\n\r\n        renderChildCategories: function (parentCategoryId) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_category/getChildCategories'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    \"parent_category_id\": parentCategoryId,\r\n                    \"marketplace_id\": self.getMarketplaceId(),\r\n                    \"account_id\": EbayListingProductCategorySettingsChooserObj.getAccountId(),\r\n                    \"category_type\": $('category_type').value\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText.length <= 2) {\r\n                        self.simulate('leaf_selected', self.getSelectedCategories());\r\n                        return;\r\n                    }\r\n\r\n                    var categories = JSON.parse(transport.responseText);\r\n                    var optionsHtml = '';\r\n                    var arrowString = '';\r\n                    categories.each(function (category) {\r\n                        if (parseInt(category.is_leaf) == 0) {\r\n                            arrowString = ' > ';\r\n                        } else {\r\n                            arrowString = '';\r\n                        }\r\n\r\n                        optionsHtml += '<option is_leaf=\"' + category.is_leaf + '\" value=\"' + category.category_id + '\">' +\r\n                            category.title + arrowString +\r\n                            '</option>';\r\n                    });\r\n\r\n                    $(self.getCategoriesSelectElementId(parentCategoryId)).innerHTML = optionsHtml;\r\n                    $(self.getCategoriesSelectElementId(parentCategoryId)).style.display = 'inline-block';\r\n                    $('chooser_browser').scrollLeft = $('chooser_browser').scrollWidth;\r\n                }\r\n            });\r\n        },\r\n\r\n        onSelectCategory: function (select) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            var parentCategoryId = select.id.replace(self.getCategoriesSelectElementId(\"\"), \"\");\r\n            var categoryId = select.options[select.selectedIndex].value;\r\n            var is_leaf = select.options[select.selectedIndex].getAttribute('is_leaf');\r\n\r\n            var selectedCategories = self.getSelectedCategories();\r\n\r\n            var parentDiv = $(self.getCategoryChildrenElementId(parentCategoryId));\r\n            parentDiv.innerHTML = '';\r\n\r\n            self.simulate('any_selected', selectedCategories);\r\n\r\n            if (is_leaf == 1) {\r\n                self.simulate('leaf_selected', selectedCategories);\r\n                return;\r\n            }\r\n\r\n            self.simulate('not_leaf_selected', selectedCategories);\r\n\r\n            self.prepareDomStructure(categoryId, parentDiv);\r\n            self.renderChildCategories(categoryId);\r\n        },\r\n\r\n        prepareDomStructure: function (categoryId, parentDiv) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            var childrenSelect = document.createElement('select');\r\n            childrenSelect.id = self.getCategoriesSelectElementId(categoryId);\r\n            childrenSelect.style.minWidth = '200px';\r\n            childrenSelect.style.maxHeight = 'none';\r\n            childrenSelect.size = 10;\r\n            childrenSelect.className = 'multiselect admin__control-multiselect';\r\n            childrenSelect.onchange = function () {\r\n                EbayListingProductCategorySettingsChooserTabsBrowseObj.onSelectCategory(this);\r\n            };\r\n            childrenSelect.style.display = 'none';\r\n            parentDiv.appendChild(childrenSelect);\r\n\r\n            var childrenDiv = document.createElement('div');\r\n            childrenDiv.id = self.getCategoryChildrenElementId(categoryId);\r\n            childrenDiv.className = 'category-children-block';\r\n            parentDiv.appendChild(childrenDiv);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        observe: function (event, observer) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            if (typeof observer != 'function') {\r\n                self.alert('Observer must be a function!');\r\n                return;\r\n            }\r\n\r\n            if (typeof self.observers[event] == 'undefined') {\r\n                self.alert('Event does not supported!');\r\n                return;\r\n            }\r\n\r\n            self.observers[event][self.observers[event].length] = observer;\r\n        },\r\n\r\n        simulate: function (event, parameters) {\r\n            var self = EbayListingProductCategorySettingsChooserTabsBrowseObj;\r\n\r\n            parameters = parameters || null;\r\n\r\n            if (typeof self.observers[event] == 'undefined') {\r\n                self.alert('Event does not supported!');\r\n                return;\r\n            }\r\n\r\n            if (self.observers[event].length == 0) {\r\n                return;\r\n            }\r\n\r\n            self.observers[event].each(function (observer) {\r\n                if (parameters == null) {\r\n                    (observer)();\r\n                } else {\r\n                    (observer)(parameters);\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode/Category/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Ebay/Listing/Product/Category/Settings/Grid'\r\n], function (modal, MagentoMessageObj) {\r\n\r\n    window.EbayListingProductCategorySettingsModeCategoryGrid = Class.create(EbayListingProductCategorySettingsGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategories: function () {\r\n            var url = M2ePro.url.get(\r\n                'ebay_listing_product_category_settings/getChooserBlockHtml'\r\n            );\r\n\r\n            new Ajax.Request(url, {\r\n                method: 'get',\r\n                parameters: {\r\n                    ids: this.getSelectedProductsString()\r\n                },\r\n                onSuccess: function (transport) {\r\n                    this.openPopUp(M2ePro.translator.translate('Set eBay Categories'), transport.responseText);\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPrimaryCategories: function () {\r\n            this.editCategoriesByType(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN'),\r\n                true\r\n            )\r\n        },\r\n\r\n        editStorePrimaryCategories: function () {\r\n            this.editCategoriesByType(\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_STORE_MAIN'),\r\n                false\r\n            )\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (title, content) {\r\n            var self = this;\r\n\r\n            if (!$('m2epro-popup')) {\r\n                $('html-body').insert({bottom: '<div id=\"m2epro-popup\"></div>'});\r\n            }\r\n\r\n            $('m2epro-popup').update();\r\n            $('m2epro-popup').insert(content);\r\n\r\n            var popup = jQuery('#m2epro-popup');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                closed: function(){\r\n                    $('m2epro-popup').update();\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                        self.unselectAll();\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action primary',\r\n                    click: function () {\r\n                        if (!EbayListingProductCategorySettingsChooserObj.validate()) {\r\n                            return;\r\n                        }\r\n\r\n                        self.saveCategoriesData(EbayListingProductCategorySettingsChooserObj.getInternalData());\r\n                        popup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            MagentoMessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoModeCategoryValidate'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.validation == true) {\r\n                        setLocation(M2ePro.url.get('ebay_listing_product_category_settings'));\r\n                    } else {\r\n                        MagentoMessageObj.addErrorMessage(response.message);\r\n                    }\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode/Product/SuggestedSearch.js":"define([\n    'M2ePro/Common'\n], function () {\n\n    window.EbayListingProductCategorySettingsModeProductSuggestedSearch = Class.create(Common, {\n\n        // ---------------------------------------\n\n        searchResult: {\n            failed: 0,\n            succeeded: 0\n        },\n\n        // ---------------------------------------\n\n        initialize: function () {\n        },\n\n        // ---------------------------------------\n\n        resetSearchResult: function () {\n            this.searchResult = {\n                failed: 0,\n                succeeded: 0\n            };\n        },\n\n        // ---------------------------------------\n\n        search: function (products, onComplete) {\n            var parts = this.makeProductsParts(products);\n\n            ProgressBarObj.reset();\n            ProgressBarObj.setTitle('Getting Suggested Categories');\n            ProgressBarObj.setStatus('Getting Suggested Categories in process. Please wait...');\n            ProgressBarObj.show();\n\n            this.scrollPageToTop();\n\n            WrapperObj.lock();\n\n            this.resetSearchResult();\n            this.sendPartsProducts(parts, parts.length, onComplete);\n        },\n\n        makeProductsParts: function (products) {\n            var productsInPart = 5;\n            var productsArray = explode(',', products);\n            var parts = [];\n\n            if (productsArray.length < productsInPart) {\n                return parts[0] = productsArray;\n            }\n\n            var result = [];\n            for (var i = 0; i < productsArray.length; i++) {\n                if (result.length == 0 || result[result.length - 1].length == productsInPart) {\n                    result[result.length] = [];\n                }\n                result[result.length - 1][result[result.length - 1].length] = productsArray[i];\n            }\n\n            return result;\n        },\n\n        sendPartsProducts: function (parts, partsCount, onComplete) {\n            if (parts.length == 0) {\n                if (typeof onComplete == 'function') {\n                    onComplete(this.searchResult);\n                }\n\n                $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\n\n                this.resetSearchResult();\n                return;\n            }\n\n            var part = parts.splice(0, 1)[0];\n            var partString = implode(',', part);\n\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoGetSuggestedCategory'), {\n                method: 'get',\n                parameters: {\n                    products_ids: partString\n                },\n                onSuccess: function (transport) {\n\n                    var percents = (100 / partsCount) * (partsCount - parts.length);\n                    var response = transport.responseText.evalJSON();\n\n                    this.searchResult.failed += response['failed'];\n                    this.searchResult.succeeded += response['succeeded'];\n\n                    if (percents <= 0) {\n                        ProgressBarObj.setPercents(0, 0);\n                    } else if (percents >= 100) {\n                        ProgressBarObj.setPercents(100, 0);\n                        ProgressBarObj.setStatus('Suggested Categories has been received.');\n                        ProgressBarObj.hide();\n                        ProgressBarObj.reset();\n\n                        WrapperObj.unlock();\n                    } else {\n                        ProgressBarObj.setPercents(percents, 1);\n                    }\n\n                    setTimeout(function () {\n                        this.sendPartsProducts(parts, partsCount, onComplete);\n                    }.bind(this), 500);\n                }.bind(this)\n            });\n\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\n        }\n\n        // ---------------------------------------\n    });\n\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Mode/Product/Grid.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Ebay/Listing/Product/Category/Settings/Grid'\r\n], function (jQuery, modal, MagentoMessageObj) {\r\n\r\n    window.EbayListingProductCategorySettingsModeProductGrid = Class.create(EbayListingProductCategorySettingsGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        productIdCellIndex: 1,\r\n        productTitleCellIndex: 2,\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            $super();\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                getSuggestedCategoriesAction: function (id) {\r\n                    this.getSuggestedCategories(id);\r\n                }.bind(this),\r\n                resetCategoriesAction: function (id) {\r\n                    this.resetCategories(id);\r\n                }.bind(this),\r\n                removeItemAction: function (id) {\r\n                    this.removeItems(id);\r\n                }.bind(this)\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSuggestedCategories: function (id) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            self.selectedProductsIds = id ? [id] : self.getSelectedProductsArray();\r\n            self.unselectAll();\r\n\r\n            confirmAction = function() {\r\n                EbayListingProductCategorySettingsModeProductSuggestedSearchObj.search(\r\n                    self.selectedProductsIds.join(','), function (searchResult) {\r\n                        self.getGridObj().doFilter();\r\n                        self.selectedProductsIds = [];\r\n\r\n                        MagentoMessageObj.clear();\r\n\r\n                        if (searchResult.failed > 0) {\r\n                            MagentoMessageObj.addErrorMessage(\r\n                                M2ePro.translator.translate('eBay could not assign Categories for %product_title% Products.')\r\n                                    .replace('%product_title%', searchResult.failed)\r\n                            );\r\n                        } else if (searchResult.succeeded > 0) {\r\n                            MagentoMessageObj.addSuccessMessage(\r\n                                M2ePro.translator.translate('Suggested Categories were successfully Received for %product_title% Product(s).')\r\n                                    .replace('%product_title%', searchResult.succeeded)\r\n                            );\r\n                        }\r\n                    }\r\n                );\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        getSuggestedCategoriesForAll: function () {\r\n            var self = this,\r\n                confirmAction,\r\n                gridIds = self.getGridMassActionObj().getGridIds().split(',');\r\n\r\n            confirmAction = function() {\r\n                self.getGridMassActionObj().selectAll();\r\n                self.getSuggestedCategories();\r\n            };\r\n\r\n            if (gridIds.length > 100) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editPrimaryCategories: function () {\r\n            this.editCategoriesByType(M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Category::TYPE_EBAY_MAIN'))\r\n        },\r\n\r\n        editStorePrimaryCategories: function () {\r\n            this.editCategoriesByType(M2ePro.php.constant('Ess_M2ePro_Helper_Component_Ebay_Category::TYPE_STORE_MAIN'))\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editCategories: function (id) {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/getChooserBlockHtml'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    ids: this.selectedProductsIds.join(',')\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var title = M2ePro.translator.translate('Set eBay Category for Product(s)');\r\n\r\n                    if (this.selectedProductsIds.length == 1) {\r\n                        var productName = this.getProductNameByRowId(this.selectedProductsIds[0]);\r\n                        title += '&nbsp;\"' + productName + '\"';\r\n                    }\r\n\r\n                    this.showChooserPopup(title, transport.responseText);\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        resetCategories: function (id) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            confirmAction = function() {\r\n                self.selectedProductsIds = id ? [id] : self.getSelectedProductsArray();\r\n\r\n                new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoSuggestedReset'), {\r\n                    method: 'post',\r\n                    asynchronous: true,\r\n                    parameters: {\r\n                        products_ids: self.selectedProductsIds.join(',')\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        MagentoMessageObj.clear();\r\n\r\n                        self.getGridObj().doFilter();\r\n                        self.unselectAll();\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showChooserPopup: function (title, content) {\r\n            var self = this;\r\n\r\n            if (!$('m2epro-popup')) {\r\n                $('html-body').insert({bottom: '<div id=\"m2epro-popup\"></div>'});\r\n            }\r\n\r\n            $('m2epro-popup').update();\r\n            $('m2epro-popup').insert(content);\r\n\r\n            var popup = jQuery('#m2epro-popup');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                closed: function(){\r\n                    self.selectedProductsIds = [];\r\n\r\n                    return true;\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                        self.unselectAll();\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action primary',\r\n                    click: function () {\r\n                        if (!self.validate()) {\r\n                            return;\r\n                        }\r\n\r\n                        self.saveCategoriesData(EbayListingProductCategorySettingsChooserObj.getInternalData());\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        nextStep: function () {\r\n            var self = this;\r\n\r\n            MagentoMessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_category_settings/stepTwoModeProductValidate'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {},\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response['validation']) {\r\n                        return setLocation(M2ePro.url.get('ebay_listing_product_category_settings'));\r\n                    }\r\n\r\n                    if (response['message']) {\r\n                        return MagentoMessageObj.addErrorMessage(response['message']);\r\n                    }\r\n\r\n                    var popup = jQuery('#next_step_warning_popup_content');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Set eBay Category'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                this.closeModal();\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Continue'),\r\n                            class: 'action-primary action-accept forward',\r\n                            id: 'save_popup_button',\r\n                            click: function () {\r\n                                this.closeModal();\r\n                                setLocation(M2ePro.url.get('ebay_listing_product_category_settings'));\r\n                            }\r\n                        }]\r\n                    }, popup);\r\n\r\n                    popup.modal('openModal');\r\n\r\n                    // $('total_count').update(response['total_count']);\r\n                    // $('failed_count').update(response['failed_count']);\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        removeItems: function (id) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            confirmAction = function() {\r\n                self.selectedProductsIds = id ? [id] : self.getSelectedProductsArray();\r\n\r\n                var url = M2ePro.url.get('ebay_listing_product_category_settings/stepTwoDeleteProductsModeProduct');\r\n                new Ajax.Request(url, {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        products_ids: self.selectedProductsIds.join(',')\r\n                    },\r\n                    onSuccess: function () {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (id) {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                confirmAction();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function ($super, config) {\r\n            var action = '';\r\n\r\n            $$('select#' + this.gridId + '_massaction-select option').each(function (o) {\r\n                if (o.selected && o.value != '') {\r\n                    action = o.value;\r\n                }\r\n            });\r\n\r\n            $super(config);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function () {\r\n            if ($$('.main-store-empty-advice').length <= 0) {\r\n                return true;\r\n            }\r\n\r\n            $$('.main-store-empty-advice')[0].hide();\r\n\r\n            var primary = $('magento_block_ebay_listing_category_chooser_store_primary_not_selected') == null;\r\n            var secondary = $('magento_block_ebay_listing_category_chooser_store_secondary_not_selected') == null;\r\n\r\n            if (primary == false && secondary == true) {\r\n                $$('.main-store-empty-advice')[0].show();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Product/Category/Settings/Specific/Wrapper.js":"define([\n    'jquery',\n    'Magento_Ui/js/modal/modal',\n    'M2ePro/Common'\n], function (jQuery, modal) {\n\n    window.EbayListingProductCategorySettingsSpecificWrapper = Class.create(Common, {\n\n        // ---------------------------------------\n\n        initialize: function (currentCategory, wrapperObj) {\n            this.wrapperObj = wrapperObj;\n\n            this.setCurrentCategory(currentCategory);\n        },\n\n        // ---------------------------------------\n\n        refreshButtons: function () {\n            $$('button.specifics_buttons').invoke('hide');\n\n            if (this.getNextCategory()) {\n\n                $$('button.next_category_button').invoke('show');\n\n            } else {\n\n                $$('button.continue').invoke('show');\n\n            }\n        },\n\n        // ---------------------------------------\n\n        setCurrentCategory: function (category) {\n            $('categories_list').select('li').each(function (li) {\n                li.removeClassName('selected');\n            });\n\n            this.currentCategory = category;\n            $(category).addClassName('selected');\n\n            this.refreshButtons();\n        },\n\n        getCurrentCategory: function () {\n            return this.currentCategory;\n        },\n\n        getNextCategory: function () {\n            var nextLi = $(this.currentCategory).next('li');\n\n            if (!nextLi) {\n                return false;\n            }\n\n            return nextLi.id;\n        },\n\n        getPrevCategory: function () {\n            var prevLi = $(this.currentCategory).previous('li');\n\n            if (!prevLi) {\n                return false;\n            }\n\n            return prevLi.id;\n        },\n\n        // ---------------------------------------\n\n        renderPrevCategory: function () {\n            if (!this.getPrevCategory()) {\n                var url = M2ePro.url.get('ebay_listing_product_category_settings');\n                setLocation(url);\n                return;\n            }\n\n            this.getSpecificsData(this.getPrevCategory(), function (transport) {\n\n                var response = transport.responseText.evalJSON();\n\n                try {\n                    $('specifics_main_container').innerHTML = response.html;\n                    $('specifics_main_container').innerHTML.evalScripts();\n                } catch (e) {\n                }\n\n            });\n        },\n\n        renderNextCategory: function () {\n            if (!EbayListingProductCategorySettingsSpecificObj.validate()) {\n                return;\n            }\n\n            if (!!$('skip_optional_specifics').checked) {\n                this.lock();\n            }\n\n            if (!this.getNextCategory()) {\n                this.unlock();\n                return this.showPopup();\n            }\n\n            this.saveCategory(function () {\n                this.getSpecificsData(this.getNextCategory(), function (transport) {\n                    var response = transport.responseText.evalJSON();\n\n                    try {\n                        $('specifics_main_container').innerHTML = response.html;\n                        $('specifics_main_container').innerHTML.evalScripts();\n                    } catch (e) {\n                    }\n\n                    if (!response.hasRequiredSpecifics && !!$('skip_optional_specifics').checked) {\n                        this.renderNextCategory();\n                    } else {\n                        this.unlock();\n                    }\n\n                })\n            }.bind(this));\n        },\n\n        // ---------------------------------------\n\n        getSpecificsData: function (category, callback) {\n            var url = M2ePro.url.get('ebay_listing_product_category_settings/stepThreeGetCategorySpecifics');\n            new Ajax.Request(url, {\n                method: 'get',\n                parameters: {\n                    category: category\n                },\n                onSuccess: function (transport) {\n                    this.setCurrentCategory(category);\n                    callback && callback.call(this, transport);\n                }.bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        saveCategory: function (callback) {\n            if (!EbayListingProductCategorySettingsSpecificObj.validate()) {\n                return;\n            }\n\n            var url = M2ePro.url.get('ebay_listing_product_category_settings/stepThreeSaveCategorySpecificsToSession');\n            new Ajax.Request(url, {\n                method: 'post',\n                parameters: {\n                    category: this.getCurrentCategory(),\n                    data: Object.toJSON(EbayListingProductCategorySettingsSpecificObj.getInternalData())\n                },\n                onSuccess: function (transport) {\n                    callback.call(this);\n                }.bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        save: function () {\n            if (this.getNextCategory()) {\n                return;\n            }\n\n            this.saveCategory(function () {\n\n                var url = M2ePro.url.get('ebay_listing_product_category_settings/save');\n\n                new Ajax.Request(url, {\n                    method: 'post',\n                    onSuccess: function (transport) {\n                        setLocation(M2ePro.url.get('ebay_listing/review'))\n                    }\n                });\n            });\n        },\n\n        // ---------------------------------------\n\n        showPopup: function () {\n            var self = this;\n\n            this.popup = jQuery('#popup_content').modal({\n                title: M2ePro.translator.translate('Set Item Specifics'),\n                type: 'popup',\n                buttons: [{\n                    text: M2ePro.translator.translate('Cancel'),\n                    class: 'action-secondary action-dismiss',\n                    click: function (event) {\n                        this.closeModal(event, true);\n                    }\n                }, {\n                    text: M2ePro.translator.translate('Confirm'),\n                    class: 'action-primary action-accept forward',\n                    click: function () {\n                        self.save();\n                    }\n                }]\n            });\n\n            this.popup.modal('openModal');\n        },\n\n        // ---------------------------------------\n\n        lock: function () {\n            $(this.wrapperObj.wrapperId).visible() || this.wrapperObj.lock();\n\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\n            $(this.wrapperObj.wrapperId).update(\n                '<div style=\"height: 46%\"></div>' +\n                '<div>' + M2ePro.translator.translate('Loading. Please wait') + ' ...</div>'\n            );\n        },\n\n        unlock: function () {\n            this.wrapperObj.unlock();\n            $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Listing/Product/Add/Category/Summary/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingProductAddCategorySummaryGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeAction: this.remove.bind(this)\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        remove: function () {\r\n            var self = this;\r\n\r\n            Grid.prototype.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var url = M2ePro.url.get('ebay_listing_product_add/removeSessionProductsByCategory');\r\n                        new Ajax.Request(url, {\r\n                            parameters: {\r\n                                ids: self.getSelectedProductsString()\r\n                            },\r\n                            onSuccess: self.unselectAllAndReload.bind(self)\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Action.js":"define([\n    'M2ePro/Listing/View/Action'\n], function () {\n\n    window.EbayListingViewAction = Class.create(ListingViewAction, {\n\n        // ---------------------------------------\n\n        startActions: function($super,title,url,selectedProductsParts,requestParams)\n        {\n            if (typeof requestParams == 'undefined') {\n                requestParams = {};\n            }\n\n            if (typeof requestParams['is_realtime'] == 'undefined') {\n                requestParams['is_realtime'] = (this.gridHandler.getSelectedProductsArray().length <= 10);\n            }\n\n            $super(title,url,selectedProductsParts,requestParams);\n        },\n\n        stopAction: function()\n        {\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts(100);\n            if (selectedProductsParts.length == 0) {\n                return;\n            }\n\n            var requestParams = {'is_realtime': (this.gridHandler.getSelectedProductsArray().length <= 100)};\n\n            this.startActions(\n                M2ePro.translator.translate('stopping_selected_items_message'),\n                M2ePro.url.get('ebay_listing/runStopProducts'),\n                selectedProductsParts,\n                requestParams\n            );\n        },\n\n        stopAndRemoveAction: function()\n        {\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts(100);\n            if (selectedProductsParts.length == 0) {\n                return;\n            }\n\n            var requestParams = {'is_realtime': (this.gridHandler.getSelectedProductsArray().length <= 100)};\n\n            this.startActions(\n                M2ePro.translator.translate('stopping_and_removing_selected_items_message'),\n                M2ePro.url.get('ebay_listing/runStopAndRemoveProducts'),\n                selectedProductsParts,\n                requestParams\n            );\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Listing/View/Grid.js":"define([\n    'M2ePro/Listing/View/Grid',\n    'M2ePro/Ebay/Listing/VariationProductManage',\n    'M2ePro/Ebay/Listing/View/Action',\n    'M2ePro/Ebay/Listing/View/Ebay/Bids'\n], function () {\n\n    window.EbayListingViewGrid = Class.create(ListingViewGrid, {\n\n        // ---------------------------------------\n\n        selectedProductsIds: [],\n        selectedCategoriesData: {},\n\n        // ---------------------------------------\n\n        prepareActions: function($super)\n        {\n            this.actionHandler = new EbayListingViewAction(this);\n\n            this.actions = {\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\n            };\n\n            this.variationProductManageHandler = new EbayListingVariationProductManage(this);\n            this.listingProductBidsHandler = new EbayListingViewEbayBids(this);\n\n            this.actions = Object.extend(this.actions, {\n\n                editCategorySettingsAction: function(id) {\n                    this.editCategorySettings(id);\n                }.bind(this)\n\n            });\n\n        },\n\n        massActionSubmitClick: function($super)\n        {\n            if (this.getSelectedProductsString() == '' || this.getSelectedProductsArray().length == 0) {\n                this.alert(M2ePro.translator.translate('Please select the Products you want to perform the Action on.'));\n                return;\n            }\n            $super();\n        },\n\n        // ---------------------------------------\n\n        editCategorySettings: function(id)\n        {\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\n\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getCategoryChooserHtml'), {\n                method: 'post',\n                asynchronous: true,\n                parameters: {\n                    product_ids: this.selectedProductsIds.join(',')\n                },\n                onSuccess: function(transport) {\n\n                    this.unselectAll();\n\n                    var title = M2ePro.translator.translate('eBay Categories');\n\n                    if (this.selectedProductsIds.length == 1) {\n                        var productName = this.getProductNameByRowId(this.selectedProductsIds[0]);\n                        title += '&nbsp;' + M2ePro.translator.translate('of Product') + '&nbsp;\"' + productName + '\"';\n                    }\n\n                    this.openPopUp(title, transport.responseText);\n\n                    $('cancel_button').stopObserving('click').observe('click', function() {\n                        this.popUp.modal('closeModal');\n                    }.bind(this));\n\n                    $('done_button').stopObserving('click').observe('click', function() {\n                        if (!EbayListingProductCategorySettingsChooserObj.validate()) {\n                            return;\n                        }\n\n                        this.selectedCategoriesData = EbayListingProductCategorySettingsChooserObj.getInternalData();\n                        this.editSpecificSettings();\n                    }.bind(this));\n                }.bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        editSpecificSettings: function()\n        {\n            var typeEbayMain = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Category::TYPE_EBAY_MAIN');\n\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getCategorySpecificHtml'), {\n                method: 'post',\n                asynchronous: true,\n                parameters: {\n                    ids: this.selectedProductsIds.join(','),\n                    category_mode: EbayListingProductCategorySettingsChooserObj.getSelectedCategory(typeEbayMain)['mode'],\n                    category_value: EbayListingProductCategorySettingsChooserObj.getSelectedCategory(typeEbayMain)['value']\n                },\n                onSuccess: function(transport) {\n\n                    var title = M2ePro.translator.translate('Specifics');\n\n                    this.openPopUp(title, transport.responseText);\n\n                    $('cancel_button').stopObserving('click').observe('click', function() { this.popUp.modal('closeModal'); }.bind(this));\n                    $('done_button').stopObserving('click').observe('click', this.saveCategoryTemplate.bind(this));\n                }.bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        saveCategoryTemplate: function()\n        {\n            if (!EbayListingProductCategorySettingsSpecificObj.validate()) {\n                return;\n            }\n\n            var categoryTemplateData = {};\n            categoryTemplateData = Object.extend(categoryTemplateData, this.selectedCategoriesData);\n            categoryTemplateData = Object.extend(categoryTemplateData, EbayListingProductCategorySettingsSpecificObj.getInternalData());\n\n            new Ajax.Request(M2ePro.url.get('ebay_listing/saveCategoryTemplate'), {\n                method: 'post',\n                asynchronous: true,\n                parameters: {\n                    ids: this.selectedProductsIds.join(','),\n                    template_category_data: Object.toJSON(categoryTemplateData)\n                },\n                onSuccess: function(transport) {\n                    this.popUp.modal('closeModal');\n                    this.getGridObj().doFilter();\n                }.bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        getComponent: function()\n        {\n            return 'ebay';\n        },\n\n        // ---------------------------------------\n\n        openPopUp: function(title, content, params, popupId)\n        {\n            var self = this;\n            params = params || {};\n            popupId = popupId || 'modal_view_action_dialog';\n\n            var modalDialogMessage = $(popupId);\n\n            if (!modalDialogMessage) {\n                modalDialogMessage = new Element('div', {\n                    id: popupId\n                });\n            }\n\n            modalDialogMessage.innerHTML = '';\n\n            this.popUp = jQuery(modalDialogMessage).modal(Object.extend({\n                title: title,\n                type: 'slide',\n                buttons: [{\n                    text: M2ePro.translator.translate('Cancel'),\n                    attr: {id: 'cancel_button'},\n                    class: 'action-dismiss',\n                    click: function () {}\n                }, {\n                    text: M2ePro.translator.translate('Confirm'),\n                    attr: {id: 'done_button'},\n                    class: 'action-primary action-accept forward',\n                    click: function () {}\n                }],\n                closed: function() {\n                    self.selectedProductsIds = [];\n                    self.selectedCategoriesData = {};\n\n                    self.getGridObj().reload();\n\n                    return true;\n                }\n            }, params));\n\n            this.popUp.modal('openModal');\n\n            try {\n                modalDialogMessage.innerHTML = content;\n                modalDialogMessage.innerHTML.evalScripts();\n            } catch (ignored) {}\n        }\n\n        // ---------------------------------------\n    });\n\n});","Ess_M2ePro/js/Ebay/Listing/View/Ebay/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Ebay/Listing/View/Grid'\r\n], function (modal, MessageObj) {\r\n\r\n    window.EbayListingViewEbayGrid = Class.create(EbayListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function($super)\r\n        {\r\n            $super();\r\n\r\n            $(this.gridId+'_massaction-select').observe('change', function() {\r\n                if (!$('get-estimated-fee')) {\r\n                    return;\r\n                }\r\n\r\n                if (this.value == 'list') {\r\n                    $('get-estimated-fee').show();\r\n                } else {\r\n                    $('get-estimated-fee').hide();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 10;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function(rowId)\r\n        {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Product\\\\AbstractGrid::LISTING_PRODUCT_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('ebay_log_listing_product/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openFeePopUp: function(content, title)\r\n        {\r\n            var feePopup = $('fee_popup');\r\n\r\n            if (feePopup) {\r\n                feePopup.remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: '<div id=\"fee_popup\"></div>'});\r\n\r\n            $('fee_popup').update(content);\r\n\r\n            var popup = jQuery('#fee_popup');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Close'),\r\n                    class: 'action-secondary',\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        },\r\n\r\n        getEstimatedFees: function(listingProductId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getEstimatedFees'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    listing_product_id: listingProductId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.error) {\r\n                        self.alert('Unable to receive estimated fee.');\r\n                        return;\r\n                    }\r\n\r\n                    self.openFeePopUp(response.html, response.title);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openItemDuplicatePopUp: function(listingProductId)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_duplicate/getPopup'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    listing_product_id: listingProductId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.error) {\r\n                        self.alert(response.error);\r\n                        return;\r\n                    }\r\n\r\n                    var duplicatePopup = $('duplicate_popup');\r\n\r\n                    if (duplicatePopup) {\r\n                        duplicatePopup.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"duplicate_popup\"></div>'});\r\n\r\n                    $('duplicate_popup').update(response.html);\r\n\r\n                    var popup = jQuery('#duplicate_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Ebay Item Duplicate'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                popup.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, popup);\r\n\r\n                    popup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        closeItemDuplicatePopUp: function(reloadGrid)\r\n        {\r\n            reloadGrid = reloadGrid || false;\r\n            reloadGrid && this.getGridObj().reload();\r\n\r\n            jQuery('#duplicate_popup').modal('closeModal')\r\n        },\r\n\r\n        solveItemDuplicateAction: function(listingProductId, isNeedStop, isNeedList)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_product_duplicate/solve'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    listing_product_id:   listingProductId,\r\n                    stop_duplicated_item: Number(isNeedStop),\r\n                    list_current_item:    Number(isNeedList)\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.setContainer('#ebay_listing_item_duplicate_fieldset');\r\n                    MessageObj.clear();\r\n\r\n                    if (response.message) {\r\n                        MessageObj.addErrorMessage(response.message);\r\n                    }\r\n\r\n                    if (response.result) {\r\n                        self.closeItemDuplicatePopUp(true);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showMotorsNotificationPopUp: function(message)\r\n        {\r\n            var content = '<div style=\"padding: 10px 0;\">'+message+'</div>' +\r\n                          '<div style=\"float: right;\">' +\r\n                            '<button onclick=\"Windows.getFocusedWindow().close()\">' +\r\n                              '<span>OK</span>' +\r\n                            '</button>' +\r\n                          '</div> ';\r\n            var config = {\r\n                draggable: true,\r\n                resizable: true,\r\n                closable: true,\r\n                className: \"magento\",\r\n                windowClassName: \"popup-window\",\r\n                title: M2ePro.translator.translate('Compatibility Attribute'),\r\n                top: 250,\r\n                height: 85,\r\n                width: 420,\r\n                zIndex: 100,\r\n                recenterAuto: true,\r\n                hideEffect: Element.hide,\r\n                showEffect: Element.show\r\n            };\r\n\r\n            Dialog.info(content, config);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Ebay/Bids.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function(modal, MessageObj) {\r\n\r\n    window.EbayListingViewEbayBids = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (productId, title) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing/getListingProductBids'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_listing_product_bids');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_listing_product_bids\"></div>'});\r\n                    $('ebay_listing_product_bids').update(transport.responseText);\r\n\r\n                    self.listingProductBidsPopup = jQuery('#ebay_listing_product_bids');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.listingProductBidsPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.listingProductBidsPopup);\r\n\r\n                    self.listingProductBidsPopup.modal('openModal');\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Grid.js":"define([\r\n    'jquery',\r\n    'M2ePro/Ebay/Listing/View/Grid',\r\n    'M2ePro/Listing/Moving',\r\n    'Magento_Ui/js/modal/modal'\r\n], function (jQuery) {\r\n\r\n    window.EbayListingViewSettingsGrid = Class.create(EbayListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridId,listingId)\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-template-switcher', function(value, $element) {\r\n\r\n               var mode = base64_decode(value).evalJSON().mode;\r\n\r\n               return mode !== null;\r\n            }, M2ePro.translator.translate('This is a required field.'));\r\n\r\n            $super(gridId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function($super)\r\n        {\r\n            $super();\r\n\r\n            this.movingHandler = new ListingMoving(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                editPrimaryCategorySettingsAction: function(id) {\r\n                    this.editCategorySettings(id);\r\n                }.bind(this),\r\n                editStorePrimaryCategorySettingsAction: function(id) {\r\n                    this.editCategorySettings(id);\r\n                }.bind(this),\r\n\r\n                editPriceQuantityFormatSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SELLING_FORMAT')\r\n                    );\r\n                }.bind(this),\r\n                editDescriptionSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_DESCRIPTION')\r\n                    );\r\n                }.bind(this),\r\n                editSynchSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SYNCHRONIZATION')\r\n                    );\r\n                }.bind(this),\r\n                editPaymentSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_PAYMENT')\r\n                    );\r\n                }.bind(this),\r\n                editShippingSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SHIPPING')\r\n                    );\r\n                }.bind(this),\r\n                editReturnSettingsAction: function(id) {\r\n                    this.editSettings(id,\r\n                        M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_RETURN_POLICY')\r\n                    );\r\n                }.bind(this),\r\n\r\n                editMotorsAction: function(id) {\r\n                    this.openMotorsPopup(id);\r\n                }.bind(this),\r\n\r\n                movingAction: this.movingHandler.run.bind(this.movingHandler),\r\n\r\n                transferringAction: function(id) {\r\n                    this.transferring(id);\r\n                }.bind(this)\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editSettings: function(id, templateNick)\r\n        {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/editListingProductsPolicy'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    ids: this.selectedProductsIds.join(','),\r\n                    templateNick: templateNick\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var result = transport.responseText;\r\n\r\n                    if (+result === 0) {\r\n                        return;\r\n                    }\r\n\r\n                    this.unselectAll();\r\n\r\n                    var title = this.getPopUpTitle(templateNick, this.getSelectedProductsTitles());\r\n\r\n                    if (typeof this.popUp != 'undefined') {\r\n                        var $title = this.popUp.data('modal').modal.find('.modal-title');\r\n                        $title.text(title);\r\n                    }\r\n\r\n                    this.openPopUp(\r\n                        title,\r\n                        transport.responseText,\r\n                        {\r\n                            buttons: [{\r\n                                text: M2ePro.translator.translate('Cancel'),\r\n                                class: 'action-dismiss',\r\n                                click: function () {\r\n                                    this.closeModal();\r\n                                }\r\n                            }, {\r\n                                text: M2ePro.translator.translate('Save'),\r\n                                class: 'action-primary action-accept',\r\n                                click: function () {\r\n                                    var switcher = jQuery('.template-switcher');\r\n\r\n                                    if (!switcher.length ||\r\n                                        !jQuery.validator.validateElement(switcher)) {\r\n                                        return;\r\n                                    }\r\n\r\n                                    EbayListingTemplateSwitcherObj.saveSwitchers(function (params) {\r\n                                        EbayListingViewSettingsGridObj.saveSettings(params);\r\n                                    });\r\n                                }\r\n                            }],\r\n                            closed: function() {\r\n                                self.selectedProductsIds = [];\r\n                                self.selectedCategoriesData = {};\r\n\r\n                                return true;\r\n                            }\r\n\r\n                        },\r\n                        'modal_setting_policy_action_dialog'\r\n                    );\r\n\r\n                    this.insertHelpLink('modal_setting_policy_action_dialog');\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        openMotorsPopup: function(id)\r\n        {\r\n            EbayListingViewSettingsMotorsObj.savedNotes = {};\r\n\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n            EbayListingViewSettingsMotorsObj.openAddPopUp(this.selectedProductsIds);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveSettings: function(savedTemplates)\r\n        {\r\n            var requestParams = {};\r\n\r\n            // push information about saved templates into the request params\r\n            // ---------------------------------------\r\n            $H(savedTemplates).each(function(i) {\r\n                requestParams[i.key] = i.value;\r\n            });\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            requestParams['ids'] = this.selectedProductsIds.join(',');\r\n            // ---------------------------------------\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/saveListingProductsPolicy'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: requestParams,\r\n                onSuccess: function(transport) {\r\n                    this.popUp.modal('closeModal');\r\n                    this.getGridObj().doFilter();\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedProductsTitles: function()\r\n        {\r\n            if (this.selectedProductsIds.length > 3) {\r\n                return '';\r\n            }\r\n\r\n            var title = '';\r\n\r\n            // use the names of only first three products for pop up title\r\n            for (var i = 0; i < 3; i++) {\r\n                if (typeof this.selectedProductsIds[i] == 'undefined') {\r\n                    break;\r\n                }\r\n\r\n                if (title != '') {\r\n                    title += ', ';\r\n                }\r\n\r\n                title += this.getProductNameByRowId(this.selectedProductsIds[i]);\r\n            }\r\n\r\n            return title;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getPopUpTitle: function(templateNick, productTitles)\r\n        {\r\n            var title = '',\r\n                templatesNames = {};\r\n\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_RETURN_POLICY')\r\n            ] = M2ePro.translator.translate('Edit Return Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_PAYMENT')\r\n            ] = M2ePro.translator.translate('Edit Payment Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SHIPPING')\r\n            ] = M2ePro.translator.translate('Edit Shipping Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_DESCRIPTION')\r\n            ] = M2ePro.translator.translate('Edit Description Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SELLING_FORMAT')\r\n            ] = M2ePro.translator.translate('Edit Price, Quantity and Format Policy Setting');\r\n            templatesNames[\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Manager::TEMPLATE_SYNCHRONIZATION')\r\n            ] = M2ePro.translator.translate('Edit Synchronization Policy Setting');\r\n\r\n            if (templatesNames[templateNick]) {\r\n                title = templatesNames[templateNick];\r\n            }\r\n\r\n            var productTitlesArray = productTitles.split(',');\r\n            if (productTitlesArray.length > 1) {\r\n                productTitles = productTitlesArray.map(function(el) { return el.trim(); }).join('\", \"');\r\n            }\r\n\r\n            if (productTitles) {\r\n                title += ' ' + M2ePro.translator.translate('for') + ' \"' + productTitles + '\"';\r\n            }\r\n\r\n            return title;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        transferring: function(id)\r\n        {\r\n            this.selectedProductsIds = id ? [id] : this.getSelectedProductsArray();\r\n            if (this.selectedProductsIds.length) {\r\n                this.unselectAll();\r\n\r\n                var productName = this.selectedProductsIds.length == 1 ?\r\n                    this.getProductNameByRowId(this.selectedProductsIds[0]) : null;\r\n\r\n                EbayListingTransferringHandlerObj.loadActionHtml(this.selectedProductsIds, null, productName);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        },\r\n\r\n        insertHelpLink: function (popUpElementId)\r\n        {\r\n            var modalHeader = jQuery('#'+popUpElementId)\r\n                    .closest('.modal-inner-wrap')\r\n                    .find('h1.modal-title');\r\n\r\n            if (modalHeader.has('#popup_template_help_link')) {\r\n                modalHeader.find('#popup_template_help_link').remove();\r\n            }\r\n\r\n            var tips = jQuery('#popup_template_help_link');\r\n            modalHeader.append(tips);\r\n            tips.show();\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function(modal){\r\n\r\n    window.EbayListingViewSettingsMotors  = Class.create(Common, {\r\n\r\n        listingId: null,\r\n        motorsType: null,\r\n        saveAsGroupPopupHtml: '',\r\n        setNotePopupHtml: '',\r\n\r\n        selectedData: {\r\n            items: [],\r\n            filters: [],\r\n            groups: []\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (listingId, motorsType) {\r\n            this.listingId = listingId;\r\n            this.motorsType = motorsType;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openAddPopUp: function (listingProductsIds) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/addView'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_manage_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_manage_popup\"></div>'});\r\n                    $('ebay_settings_motors_manage_popup').update(transport.responseText);\r\n\r\n                    self.addPopUp = jQuery('#ebay_settings_motors_manage_popup');\r\n\r\n                    var instructions = $('add_custom_motors_record_instruction_container'),\r\n                        popupType = 'slide',\r\n                        closedAction = function () {\r\n                            EbayListingViewSettingsGridObj.unselectAllAndReload();\r\n\r\n                            self.selectedData = {\r\n                                items: [],\r\n                                filters: [],\r\n                                groups: []\r\n                            };\r\n                        },\r\n                        buttons = [];\r\n\r\n                    if (instructions) {\r\n                        popupType = 'popup';\r\n                        closedAction = '';\r\n                        buttons.push({\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                self.closeInstruction(listingProductsIds);\r\n                            }\r\n                        })\r\n                    }\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Add Compatible Vehicles'),\r\n                        type: popupType,\r\n                        buttons: buttons,\r\n                        closed: closedAction\r\n                    }, self.addPopUp);\r\n\r\n                    self.addPopUp.modal('openModal');\r\n\r\n                    self.addPopUp.listingProductsIds = listingProductsIds;\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        openViewItemPopup: function (entityId, grid) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/viewItem'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    entity_id: entityId,\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_view_item');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_view_item\"></div>'});\r\n                    $('ebay_settings_motors_view_item').update(transport.responseText);\r\n\r\n                    self.viewItemPopup = jQuery('#ebay_settings_motors_view_item');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('View Items'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewItemPopup.modal('closeModal')\r\n                            }\r\n                        }],\r\n                        closed: function () {\r\n                            grid.unselectAllAndReload();\r\n                        }\r\n                    }, self.viewItemPopup);\r\n\r\n                    self.viewItemPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openViewFilterPopup: function (entityId, grid) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/viewFilter'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    entity_id: entityId,\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_view_filter');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_view_filter\"></div>'});\r\n                    $('ebay_settings_motors_view_filter').update(transport.responseText);\r\n\r\n                    self.viewFilterPopup = jQuery('#ebay_settings_motors_view_filter');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('View Filters'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewFilterPopup.modal('closeModal')\r\n                            }\r\n                        }],\r\n                        closed: function () {\r\n                            grid.unselectAllAndReload();\r\n                        }\r\n                    }, self.viewFilterPopup);\r\n\r\n                    self.viewFilterPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openViewGroupPopup: function (entityId, grid) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/viewGroup'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    entity_id: entityId,\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_view_group');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_view_group\"></div>'});\r\n                    $('ebay_settings_motors_view_group').update(transport.responseText);\r\n\r\n                    self.viewGroupPopup = jQuery('#ebay_settings_motors_view_group');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('View Groups'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewGroupPopup.modal('closeModal')\r\n                            }\r\n                        }],\r\n                        closed: function () {\r\n                            grid.unselectAllAndReload();\r\n                        }\r\n                    }, self.viewGroupPopup);\r\n\r\n                    self.viewGroupPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateSelectedData: function () {\r\n            var self = this,\r\n                emptyText = $('motors_empty_text'),\r\n                addbtn = $('motors_add'),\r\n                overrideBtn = $('motors_override'),\r\n                dataEl = $('selected_motors_data');\r\n\r\n            addbtn.addClassName('disabled');\r\n            overrideBtn.addClassName('disabled');\r\n            emptyText.show();\r\n\r\n            dataEl.down('.items').hide();\r\n            if (self.selectedData.items.length > 0) {\r\n                emptyText.hide();\r\n                addbtn.removeClassName('disabled');\r\n                overrideBtn.removeClassName('disabled');\r\n\r\n                dataEl.down('.items').show();\r\n                dataEl.down('.items .count').innerHTML = self.selectedData.items.length;\r\n            }\r\n\r\n            dataEl.down('.filters').hide();\r\n            if (self.selectedData.filters.length > 0) {\r\n                emptyText.hide();\r\n                addbtn.removeClassName('disabled');\r\n                overrideBtn.removeClassName('disabled');\r\n\r\n                dataEl.down('.filters').show();\r\n                dataEl.down('.filters .count').innerHTML = self.selectedData.filters.length;\r\n            }\r\n\r\n            dataEl.down('.groups').hide();\r\n            if (self.selectedData.groups.length > 0) {\r\n                emptyText.hide();\r\n                addbtn.removeClassName('disabled');\r\n                overrideBtn.removeClassName('disabled');\r\n\r\n                dataEl.down('.groups').show();\r\n                dataEl.down('.groups .count').innerHTML = self.selectedData.groups.length;\r\n            }\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        viewSelectedItemPopup: function () {\r\n            var self = this;\r\n\r\n            var containerEl = $('selected_items_popup');\r\n\r\n            if (containerEl) {\r\n                containerEl.remove();\r\n            }\r\n\r\n            $('html-body').insert({\r\n                bottom: '<div id=\"selected_items_popup\"></div>'\r\n            });\r\n\r\n            self.viewSelectedItemsPopup = jQuery('#selected_items_popup');\r\n\r\n            modal({\r\n                title: M2ePro.translator.translate('Selected Items'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Close'),\r\n                    class: 'action-secondary',\r\n                    click: function () {\r\n                        self.viewSelectedItemsPopup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, self.viewSelectedItemsPopup);\r\n\r\n            self.viewSelectedItemsPopup.modal('openModal');\r\n\r\n            var table = new Element('table', {\r\n                cellspacing: '0',\r\n                cellpadding: '0',\r\n                class: 'data-grid data-grid-not-hovered'\r\n            });\r\n\r\n            table.update(\r\n                '<thead> ' +\r\n                    '<tr class=\"headings\">' +\r\n                        '<th class=\"data-grid-th\" style=\"width: 75px; font-weight: bold;\">' +\r\n                            M2ePro.translator.translate('Motor Item') +\r\n                        '</th>' +\r\n                        '<th class=\"data-grid-th\" style=\"font-weight: bold;\">' +\r\n                            M2ePro.translator.translate('Note') +\r\n                        '</th>' +\r\n                        '<th class=\"data-grid-th type-butt last\" style=\"width: 20px;\"></th>' +\r\n                    '</tr>' +\r\n                '</thead>' +\r\n                '<tbody></tbody>'\r\n            );\r\n\r\n            var tbody = table.down('tbody');\r\n\r\n            self.selectedData.items.each(function (item) {\r\n                var tr = new Element('tr'),\r\n                    tdItem = new Element('td', {\r\n                        style: 'text-align: center'\r\n                    }),\r\n                    tdNote = new Element('td', {}),\r\n                    tdRemove = new Element('td', {});\r\n\r\n                tdItem.innerHTML = item;\r\n                if (EbayListingViewSettingsMotorsAddItemGridObj.savedNotes[item]) {\r\n                    tdNote.innerHTML = EbayListingViewSettingsMotorsAddItemGridObj.savedNotes[item];\r\n                }\r\n\r\n                var removeLink = new Element('a', {\r\n                    title: M2ePro.translator.translate('Remove'),\r\n                    href: 'javascript:void(0)',\r\n                    class: 'ebay-listing-view-icon ebay-listing-view-remove'\r\n                });\r\n\r\n                removeLink.observe('click', function () {\r\n                    tr.remove();\r\n\r\n                    var index = self.selectedData.items.indexOf(item);\r\n                    self.selectedData.items.splice(index, 1);\r\n\r\n                    EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n                    if (self.selectedData.items.length == 0) {\r\n                        self.viewSelectedItemsPopup.modal('closeModal');\r\n                    }\r\n                }, self);\r\n\r\n                tdRemove.insert({bottom: removeLink});\r\n\r\n                tr.insert({bottom: tdItem});\r\n                tr.insert({bottom: tdNote});\r\n                tr.insert({bottom: tdRemove});\r\n\r\n                tbody.insert({bottom: tr});\r\n            });\r\n\r\n            var dialogContent = $('selected_items_popup');\r\n\r\n            dialogContent.insert({\r\n                bottom: new Element('div', {\r\n                    class: 'admin__data-grid-wrap admin__data-grid-wrap-static'\r\n                }).insert({bottom: table})\r\n            });\r\n        },\r\n\r\n        viewSelectedFilterPopup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/modelGetAll'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    model: 'Ebay_Motor_Filter',\r\n                    id_field: 'id',\r\n                    data_field: 'title'\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var filters = transport.responseText.evalJSON();\r\n\r\n                    var containerEl = $('selected_filters_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: '<div id=\"selected_filters_popup\"></div>'\r\n                    });\r\n\r\n                    self.viewSelectedFiltersPopup = jQuery('#selected_filters_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Selected Filters'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewSelectedFiltersPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.viewSelectedFiltersPopup);\r\n\r\n                    self.viewSelectedFiltersPopup.modal('openModal');\r\n\r\n                    var table = new Element('table', {\r\n                        cellspacing: '0',\r\n                        cellpadding: '0',\r\n                        class: 'data-grid data-grid-not-hovered'\r\n                    });\r\n\r\n                    table.update(\r\n                        '<thead> ' +\r\n                            '<tr class=\"headings\">' +\r\n                                '<th class=\"data-grid-th\" style=\"font-weight: bold;\">' +\r\n                                    M2ePro.translator.translate('Filter') +\r\n                                '</th>' +\r\n                                '<th class=\"data-grid-th type-butt last\" style=\"width: 20px;\"></th>' +\r\n                            '</tr>' +\r\n                        '</thead>' +\r\n                        '<tbody></tbody>'\r\n                    );\r\n\r\n                    var tbody = table.down('tbody');\r\n\r\n                    filters.each(function (filter) {\r\n                        if (self.selectedData.filters.indexOf(filter.id) == -1) {\r\n                            return;\r\n                        }\r\n\r\n                        var tr = new Element('tr'),\r\n                            tdTitle = new Element('td', {}),\r\n                            tdRemove = new Element('td', {});\r\n\r\n                        tdTitle.innerHTML = filter.title;\r\n\r\n                        var removeLink = new Element('a', {\r\n                            title: M2ePro.translator.translate('Remove'),\r\n                            href: 'javascript:void(0)',\r\n                            class: 'ebay-listing-view-icon ebay-listing-view-remove'\r\n                        });\r\n\r\n                        removeLink.observe('click', function () {\r\n                            tr.remove();\r\n\r\n                            var index = self.selectedData.filters.indexOf(filter.id);\r\n                            self.selectedData.filters.splice(index, 1);\r\n\r\n                            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n                            if (self.selectedData.filters.length == 0) {\r\n                                self.viewSelectedFiltersPopup.modal('closeModal');\r\n                            }\r\n                        }, self);\r\n\r\n                        tdRemove.insert({bottom: removeLink});\r\n\r\n                        tr.insert({bottom: tdTitle});\r\n                        tr.insert({bottom: tdRemove});\r\n\r\n                        tbody.insert({bottom: tr});\r\n                    });\r\n\r\n                    var dialogContent = $('selected_filters_popup');\r\n\r\n                    dialogContent.insert({\r\n                        bottom: new Element('div', {\r\n                            class: 'admin__data-grid-wrap admin__data-grid-wrap-static'\r\n                        }).insert({bottom: table})\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        viewSelectedGroupPopup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/modelGetAll'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    model: 'Ebay_Motor_Group',\r\n                    id_field: 'id',\r\n                    data_field: 'title'\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var groups = transport.responseText.evalJSON();\r\n\r\n                    var containerEl = $('selected_groups_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: '<div id=\"selected_groups_popup\"></div>'\r\n                    });\r\n\r\n                    self.viewSelectedGroupsPopup = jQuery('#selected_groups_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Selected Groups'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.viewSelectedGroupsPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.viewSelectedGroupsPopup);\r\n\r\n                    self.viewSelectedGroupsPopup.modal('openModal');\r\n\r\n                    var table = new Element('table', {\r\n                        cellspacing: '0',\r\n                        cellpadding: '0',\r\n                        class: 'data-grid data-grid-not-hovered'\r\n                    });\r\n\r\n                    table.update(\r\n                        '<thead> ' +\r\n                            '<tr class=\"headings\">' +\r\n                                '<th class=\"data-grid-th\" style=\"font-weight: bold;\">' +\r\n                                    M2ePro.translator.translate('Filter') +\r\n                                '</th>' +\r\n                                '<th class=\"data-grid-th type-butt last\" style=\"width: 20px;\"></th>' +\r\n                            '</tr>' +\r\n                        '</thead>' +\r\n                        '<tbody></tbody>'\r\n                    );\r\n\r\n                    var tbody = table.down('tbody');\r\n\r\n                    groups.each(function (group) {\r\n                        if (self.selectedData.groups.indexOf(group.id) == -1) {\r\n                            return;\r\n                        }\r\n\r\n                        var tr = new Element('tr'),\r\n                            tdTitle = new Element('td', {}),\r\n                            tdRemove = new Element('td', {});\r\n\r\n                        tdTitle.innerHTML = group.title;\r\n\r\n                        var removeLink = new Element('a', {\r\n                            title: M2ePro.translator.translate('Remove'),\r\n                            href: 'javascript:void(0)',\r\n                            class: 'ebay-listing-view-icon ebay-listing-view-remove'\r\n                        });\r\n\r\n                        removeLink.observe('click', function () {\r\n                            tr.remove();\r\n\r\n                            var index = self.selectedData.groups.indexOf(group.id);\r\n                            self.selectedData.groups.splice(index, 1);\r\n\r\n                            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n                            if (self.selectedData.groups.length == 0) {\r\n                                self.viewSelectedGroupsPopup.modal('closeModal');\r\n                            }\r\n                        }, self);\r\n\r\n                        tdRemove.insert({bottom: removeLink});\r\n\r\n                        tr.insert({bottom: tdTitle});\r\n                        tr.insert({bottom: tdRemove});\r\n\r\n                        tbody.insert({bottom: tr});\r\n                    });\r\n\r\n                    var dialogContent = $('selected_groups_popup');\r\n\r\n                    dialogContent.insert({\r\n                        bottom: new Element('div', {\r\n                            class: 'admin__data-grid-wrap admin__data-grid-wrap-static'\r\n                        }).insert({bottom: table})\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        updateMotorsData: function (override) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var items = {};\r\n                        self.selectedData.items.each(function (item) {\r\n                            items[item] = EbayListingViewSettingsMotorsAddItemGridObj.savedNotes[item];\r\n                        });\r\n\r\n                        new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/updateMotorsData'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                listing_id: self.listingId,\r\n                                'listing_products_ids[]': self.addPopUp.listingProductsIds,\r\n                                motors_type: self.motorsType,\r\n                                overwrite: override,\r\n                                items: Object.toQueryString(items),\r\n                                filters_ids: implode(',', self.selectedData.filters),\r\n                                groups_ids: implode(',', self.selectedData.groups)\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (transport.responseText == '0') {\r\n                                    self.addPopUp.modal('closeModal');\r\n                                }\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        openAddRecordPopup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getAddCustomItemForm'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    motors_type: self.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_custom_item_form');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_custom_item_form\"></div>'});\r\n                    $('ebay_settings_motors_custom_item_form').update(transport.responseText);\r\n\r\n                    self.addRecordPopUp = jQuery('#ebay_settings_motors_custom_item_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Add Custom Compatible Vehicle'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.addRecordPopUp.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!jQuery('#motors_custom_item').valid()) {\r\n                                    return;\r\n                                }\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveCustomItem'), {\r\n                                    method: 'post',\r\n                                    parameters: $$('#ebay_settings_motors_custom_item_form form').first().serialize(true),\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        var result = transport.responseText.evalJSON();\r\n\r\n                                        if (!result.result) {\r\n                                            return self.alert(result.message);\r\n                                        }\r\n\r\n                                        self.addRecordPopUp.modal('closeModal');\r\n                                        EbayListingViewSettingsMotorsAddItemGridObj.unselectAllAndReload();\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.addRecordPopUp);\r\n\r\n                    self.addRecordPopUp.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_custom_item');\r\n                }\r\n            });\r\n        },\r\n\r\n        removeCustomMotorsRecord: function (motorsType, keyId) {\r\n            var self = this;\r\n\r\n            var index = self.selectedData.items.indexOf('' + keyId);\r\n\r\n            if (index > -1) {\r\n                self.selectedData.items.splice(index, 1);\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeCustomItem'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    motors_type: motorsType,\r\n                    key_id: keyId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var result = transport.responseText.evalJSON();\r\n\r\n                    if (!result.result) {\r\n                        return alert(result.message);\r\n                    }\r\n\r\n                    self.updateSelectedData();\r\n                    EbayListingViewSettingsMotorsAddItemGridObj.unselectAllAndReload();\r\n                    EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        closeInstruction: function (listingProductsIds) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/closeInstruction'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n                    self.addPopUp.modal('closeModal');\r\n                    self.openAddPopUp(listingProductsIds);\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/Add/Group/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Grid'\r\n], function (modal) {\r\n\r\n    window.EbayListingViewSettingsMotorsAddGroupGrid = Class.create(Grid, {\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId) {\r\n            $super(gridId);\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                selectAction: this.selectGroups.bind(this),\r\n                removeGroupAction: this.removeGroup.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        selectGroups: function () {\r\n            var self = this,\r\n                groups = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            groups.each(function (group) {\r\n\r\n                for (var i = 0; i < EbayListingViewSettingsMotorsObj.selectedData.groups.length; i++) {\r\n                    if (EbayListingViewSettingsMotorsObj.selectedData.groups[i] == group) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                EbayListingViewSettingsMotorsObj.selectedData.groups.push(group);\r\n            });\r\n\r\n            self.unselectAll();\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        removeGroup: function () {\r\n            var self = this,\r\n                groups = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            groups.each(function (group) {\r\n                var index = EbayListingViewSettingsMotorsObj.selectedData.groups.indexOf(group);\r\n\r\n                if (index > -1) {\r\n                    EbayListingViewSettingsMotorsObj.selectedData.groups.splice(index, 1);\r\n                }\r\n            });\r\n\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeGroup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    groups_ids: self.getGridMassActionObj().checkedString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        viewGroupContentPopup: function (groupId, title) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getGroupContentView'), {\r\n                method: 'get',\r\n                parameters: {\r\n                    group_id: groupId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_group_content');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_group_content\"></div>'});\r\n                    $('ebay_settings_motors_group_content').insert({bottom: transport.responseText});\r\n\r\n                    self.goupContentPopup = jQuery('#ebay_settings_motors_group_content');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.goupContentPopup.modal('closeModal');\r\n                            }\r\n                        }],\r\n                        closed: function() {\r\n                            EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                        }\r\n                    }, self.goupContentPopup);\r\n\r\n                    self.goupContentPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        removeItemFromGroup: function (el, itemId, groupId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeItemFromGroup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    items_ids: itemId,\r\n                    group_id: groupId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        if ($(el).up('tbody').select('tr').length == 1) {\r\n                            var index = EbayListingViewSettingsMotorsObj.selectedData.groups.indexOf('' + groupId);\r\n\r\n                            if (index > -1) {\r\n                                EbayListingViewSettingsMotorsObj.selectedData.groups.splice(index, 1);\r\n                                EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n                            }\r\n\r\n                            self.goupContentPopup.modal('closeModal');\r\n                            return;\r\n                        }\r\n\r\n                        $(el).up('tr').remove();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        removeFilterFromGroup: function (el, filterId, groupId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeFilterFromGroup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: filterId,\r\n                    group_id: groupId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        if ($(el).up('tbody').select('tr').length == 1) {\r\n                            var index = EbayListingViewSettingsMotorsObj.selectedData.groups.indexOf('' + groupId);\r\n\r\n                            if (index > -1) {\r\n                                EbayListingViewSettingsMotorsObj.selectedData.groups.splice(index, 1);\r\n                                EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n                            }\r\n\r\n                            self.goupContentPopup.modal('closeModal');\r\n                            return;\r\n                        }\r\n\r\n                        $(el).up('tr').remove();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/Add/Filter/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Grid'\r\n], function (modal) {\r\n\r\n    window.EbayListingViewSettingsMotorsAddFilterGrid = Class.create(Grid, {\r\n\r\n        filtersConditions: {},\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId) {\r\n            $super(gridId);\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                selectAction: this.selectFilters.bind(this),\r\n                setNoteAction: this.setNote.bind(this),\r\n                resetNoteAction: this.resetNote.bind(this),\r\n                saveAsGroupAction: this.saveAsGroup.bind(this),\r\n                removeFilterAction: this.removeFilter.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        selectFilters: function () {\r\n            var self = this,\r\n                filters = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            filters.each(function (filter) {\r\n\r\n                for (var i = 0; i < EbayListingViewSettingsMotorsObj.selectedData.filters.length; i++) {\r\n                    if (EbayListingViewSettingsMotorsObj.selectedData.filters[i] == filter) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                EbayListingViewSettingsMotorsObj.selectedData.filters.push(filter);\r\n            });\r\n\r\n            self.unselectAll();\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        setNote: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getNoteForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_note_form');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_note_form\"></div>'});\r\n                    $('ebay_settings_motors_note_form').insert({bottom: transport.responseText});\r\n\r\n                    self.notePopup = jQuery('#ebay_settings_motors_note_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Set Note'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.notePopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_note')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_note').serialize(true);\r\n                                data['filters_ids'] = self.getGridMassActionObj().checkedString;\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/setNoteToFilters'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            self.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.notePopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.notePopup);\r\n\r\n                    self.notePopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_note');\r\n                }\r\n            });\r\n        },\r\n\r\n        resetNote: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/setNoteToFilters'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: self.getGridMassActionObj().checkedString,\r\n                    note: ''\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n\r\n                    self.notePopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        saveAsGroup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getSaveAsGroupForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_save_group');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_save_group\"></div>'});\r\n                    $('ebay_settings_motors_save_group').insert({bottom: transport.responseText});\r\n\r\n                    self.groupPopup = jQuery('#ebay_settings_motors_save_group');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save as Group'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.groupPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_group')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_group').serialize(true);\r\n                                data.items = self.getGridMassActionObj().checkedString;\r\n                                data.type = EbayListingViewSettingsMotorsObj.motorsType;\r\n                                data.mode = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Motor_Group::MODE_FILTER');\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveAsGroup'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            self.unselectAll();\r\n                                            $(self.getGridMassActionObj().select).value = '';\r\n\r\n                                            EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.groupPopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.groupPopup);\r\n\r\n                    self.groupPopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_group');\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        removeFilter: function () {\r\n            var self = this,\r\n                filters = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            filters.each(function (filter) {\r\n\r\n                var index = EbayListingViewSettingsMotorsObj.selectedData.filters.indexOf(filter);\r\n\r\n                if (index > -1) {\r\n                    EbayListingViewSettingsMotorsObj.selectedData.filters.splice(index, 1);\r\n                }\r\n            });\r\n\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeFilter'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: self.getGridMassActionObj().checkedString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                        EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        showFilterResult: function (filterId) {\r\n            jQuery('#ebayMotorAddTabs').tabs({\r\n                active: 0\r\n            });\r\n            EbayListingViewSettingsMotorsAddItemGridObj.showFilterResult(this.filtersConditions[filterId]);\r\n        },\r\n\r\n        //##################################\r\n\r\n        validatePopupForm: function (formId) {\r\n\r\n            return jQuery('#' + formId).valid();\r\n\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/Add/Item/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Grid'\r\n], function (modal) {\r\n\r\n    window.EbayListingViewSettingsMotorsAddItemGrid = Class.create(Grid, {\r\n\r\n        savedNotes: {},\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId) {\r\n            $super(gridId);\r\n\r\n            this.savedNotes = {};\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                selectAction: this.selectItems.bind(this),\r\n                setNoteAction: this.setNote.bind(this),\r\n                resetNoteAction: this.resetNote.bind(this),\r\n                saveAsGroupAction: this.saveAsGroup.bind(this)\r\n            };\r\n        },\r\n\r\n        afterInitPage: function () {\r\n            var self = this;\r\n\r\n            Grid.prototype.afterInitPage.call(this);\r\n\r\n            $(self.gridId).down('.data-grid-filters').on('change', function (e) {\r\n\r\n                self.checkFilterValues();\r\n\r\n            });\r\n\r\n            $(self.gridId).down('.data-grid-filters').on('keyup', function (e) {\r\n\r\n                self.checkFilterValues();\r\n\r\n            });\r\n\r\n            self.checkFilterValues();\r\n\r\n            $H(self.savedNotes).each(function (note) {\r\n\r\n                var noteEl = $('note_' + note.key);\r\n\r\n                if (noteEl && note.value != '') {\r\n                    noteEl.show();\r\n                    noteEl.down('.note-view').innerHTML = note.value;\r\n                }\r\n            });\r\n\r\n            var select = $(self.getGridMassActionObj().containerId + '-mass-select');\r\n            self.bindEventAtFirstPosition(select, 'change',  self.massactionOnChange.bind(self));\r\n        },\r\n\r\n        checkFilterValues: function () {\r\n            var self = this;\r\n\r\n            $('save_filter_btn').addClassName('disabled');\r\n\r\n            $(self.gridId).down('.data-grid-filters').select('select', 'input').each(function (el) {\r\n                if (el.name == 'massaction') {\r\n                    return;\r\n                }\r\n\r\n                if (el.value != '') {\r\n                    $('save_filter_btn').removeClassName('disabled');\r\n                    throw $break;\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        selectItems: function () {\r\n            var self = this,\r\n                items = self.getGridMassActionObj().checkedString.split(',');\r\n\r\n            items.each(function (item) {\r\n\r\n                for (var i = 0; i < EbayListingViewSettingsMotorsObj.selectedData.items.length; i++) {\r\n                    if (EbayListingViewSettingsMotorsObj.selectedData.items[i] == item) {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                EbayListingViewSettingsMotorsObj.selectedData.items.push(item);\r\n            });\r\n\r\n            self.unselectAll();\r\n            EbayListingViewSettingsMotorsObj.updateSelectedData();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        setNote: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getNoteForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_note_form');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_note_form\"></div>'});\r\n                    $('ebay_settings_motors_note_form').insert({bottom: transport.responseText});\r\n\r\n                    self.notePopup = jQuery('#ebay_settings_motors_note_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Set Note'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.notePopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_note')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var note = $('motors_note').down('[name=note]').value;\r\n\r\n                                note = note.trim();\r\n\r\n                                self.getGridMassActionObj().getCheckedValues().split(',').each(function (id) {\r\n\r\n                                    self.savedNotes[id] = note;\r\n\r\n                                    var noteEl = $('note_' + id);\r\n\r\n                                    if (noteEl) {\r\n                                        noteEl.hide();\r\n\r\n                                        if (note != '') {\r\n                                            noteEl.show();\r\n                                            noteEl.down('.note-view').innerHTML = note;\r\n                                        }\r\n                                    }\r\n                                });\r\n\r\n                                $(self.getGridMassActionObj().select).value = '';\r\n                                self.notePopup.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, self.notePopup);\r\n\r\n                    self.notePopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_note');\r\n                }\r\n            });\r\n        },\r\n\r\n        resetNote: function () {\r\n            var self = this;\r\n\r\n            self.getGridMassActionObj().getCheckedValues().split(',').each(function (id) {\r\n\r\n                self.savedNotes[id] = '';\r\n\r\n                var noteEl = $('note_' + id);\r\n\r\n                if (noteEl) {\r\n                    noteEl.hide();\r\n                    noteEl.down('.note-view').innerHTML = '';\r\n                }\r\n            });\r\n\r\n            $(self.getGridMassActionObj().select).value = '';\r\n            self.unselectAll();\r\n        },\r\n\r\n        //----------------------------------\r\n\r\n        saveAsGroup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getSaveAsGroupForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_save_group');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_save_group\"></div>'});\r\n                    $('ebay_settings_motors_save_group').insert({bottom: transport.responseText});\r\n\r\n                    self.groupPopup = jQuery('#ebay_settings_motors_save_group');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save as Group'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.groupPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_group')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_group').serialize(true);\r\n                                data.items = self.getGridMassActionObj().checkedString.split(',');\r\n                                data.type = EbayListingViewSettingsMotorsObj.motorsType;\r\n                                data.mode = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Motor_Group::MODE_ITEM');\r\n\r\n                                var items = {};\r\n                                data.items.each(function (item) {\r\n                                    items[item] = self.savedNotes[item];\r\n                                });\r\n\r\n                                data.items = Object.toQueryString(items);\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveAsGroup'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            self.unselectAll();\r\n                                            $(self.getGridMassActionObj().select).value = '';\r\n\r\n                                            EbayListingViewSettingsMotorsAddGroupGridObj.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.groupPopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.groupPopup);\r\n\r\n                    self.groupPopup.modal('openModal');\r\n\r\n                    self.initFormValidation('#motors_group');\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n        saveFilter: function () {\r\n            var self = this;\r\n\r\n            if ($('save_filter_btn').hasClassName('disabled')) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/getSaveFilterForm'), {\r\n                method: 'get',\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('ebay_settings_motors_save_filter');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: '<div id=\"ebay_settings_motors_save_filter\"></div>'});\r\n                    $('ebay_settings_motors_save_filter').insert({bottom: transport.responseText});\r\n\r\n                    self.filterPopup = jQuery('#ebay_settings_motors_save_filter');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save Filter'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            class: 'action-secondary',\r\n                            click: function () {\r\n                                self.filterPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary',\r\n                            click: function () {\r\n                                if (!self.validatePopupForm('motors_filter')) {\r\n                                    return;\r\n                                }\r\n\r\n                                var data = $('motors_filter').serialize(true);\r\n                                data.conditions = Form.serialize($(self.gridId).down('.data-grid-filters'));\r\n                                data.type = EbayListingViewSettingsMotorsObj.motorsType;\r\n\r\n                                new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/saveFilter'), {\r\n                                    method: 'post',\r\n                                    parameters: data,\r\n                                    onSuccess: function (transport) {\r\n\r\n                                        if (transport.responseText == '0') {\r\n                                            $(self.getGridMassActionObj().select).value = '';\r\n\r\n                                            EbayListingViewSettingsMotorsAddFilterGridObj.unselectAllAndReload();\r\n                                        }\r\n\r\n                                        self.filterPopup.modal('closeModal');\r\n                                    }\r\n                                });\r\n                            }\r\n                        }]\r\n                    }, self.filterPopup);\r\n\r\n                    self.filterPopup.modal('openModal');\r\n\r\n                    var conditionsEl = $('ebay_settings_motors_save_filter').down('.filter_conditions');\r\n                    var conditionsData = {};\r\n                    $(self.gridId).down('.data-grid-filters').select('select', 'input').each(function (el) {\r\n\r\n                        if (el.name == 'massaction') {\r\n                            return;\r\n                        }\r\n\r\n                        if (el.value != '') {\r\n                            var li = new Element('li'),\r\n                                valueText = '',\r\n                                valueName = el.name.capitalize().replace('_', ' ');\r\n\r\n                            if (el.name == 'product_type') {\r\n                                valueText = el[el.selectedIndex].text;\r\n                                valueName = M2ePro.translator.translate('Type');\r\n                            } else {\r\n                                valueText = el.value;\r\n                            }\r\n\r\n                            if (el.name == 'epid') {\r\n                                valueName = M2ePro.translator.translate('ePID');\r\n                            }\r\n\r\n                            if (el.name == 'ktype') {\r\n                                valueName = M2ePro.translator.translate('kType');\r\n                            }\r\n\r\n                            if (el.name == 'body_style') {\r\n                                valueName = M2ePro.translator.translate('Body Style');\r\n                            }\r\n\r\n                            if (el.name == 'year[from]') {\r\n                                valueName = M2ePro.translator.translate('Year From');\r\n                            }\r\n\r\n                            if (el.name == 'year[to]') {\r\n                                valueName = M2ePro.translator.translate('Year To');\r\n                            }\r\n\r\n                            li.update('<b>' + valueName + '</b>: ' + valueText);\r\n\r\n                            conditionsData[el.name] = el.value;\r\n\r\n                            conditionsEl.insert({bottom: li});\r\n                        }\r\n                    });\r\n\r\n                    self.initFormValidation('#motors_filter');\r\n                }\r\n            });\r\n        },\r\n\r\n        validatePopupForm: function (formId) {\r\n\r\n            return jQuery('#' + formId).valid();\r\n\r\n        },\r\n\r\n        //##################################\r\n\r\n        showFilterResult: function (comnditions) {\r\n            var self = this;\r\n\r\n            $(self.gridId).down('.data-grid-filters').select('input', 'select').each(function (el) {\r\n                el.value = '';\r\n            });\r\n\r\n            $H(comnditions).each(function (item) {\r\n                $(self.gridId).down('.data-grid-filters').select('[name^=' + item.key + ']').each(function (el) {\r\n                    if (item.key != 'year') {\r\n                        el.value = item.value;\r\n                        return null;\r\n                    }\r\n\r\n                    if (typeof item.value == 'string') {\r\n                        el.value = item.value;\r\n                        return null;\r\n                    }\r\n\r\n                    $(self.gridId).down('.data-grid-filters').down('[name=year[from]]').value = item.value.from;\r\n                    $(self.gridId).down('.data-grid-filters').down('[name=year[to]]').value = item.value.to;\r\n\r\n                });\r\n            });\r\n\r\n            self.getGridObj().doFilter();\r\n        },\r\n\r\n        //##################################\r\n\r\n        massactionOnChange: function(event)\r\n        {\r\n            if (event.target.value != 'selectAll'){\r\n                return true;\r\n            }\r\n\r\n            var gridIds = this.getGridMassActionObj().getGridIds().split(',');\r\n            if (gridIds.length < M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay\\\\Motors::MAX_ITEMS_COUNT_FOR_ATTRIBUTE')) {\r\n                return true;\r\n            }\r\n\r\n            this.alert(M2ePro.translator.translate('It is impossible to select all the items.'));\r\n\r\n            event.stopImmediatePropagation();\r\n            event.target.value = '';\r\n        }\r\n\r\n        //##################################\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/View/Group/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingViewSettingsMotorsViewGroupGrid = Class.create(Grid, {\r\n\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId, entityId) {\r\n            $super(gridId);\r\n\r\n            this.entityId = entityId;\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeGroupAction: this.removeGroup.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        removeGroup: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeGroupFromListingProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    groups_ids: self.getGridMassActionObj().checkedString,\r\n                    entity_id: self.entityId,\r\n                    motors_type: EbayListingViewSettingsMotorsObj.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/View/Filter/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingViewSettingsMotorsViewFilterGrid = Class.create(Grid, {\r\n\r\n        entityId: '',\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId, entityId) {\r\n            $super(gridId);\r\n\r\n            this.entityId = entityId;\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeFilterAction: this.removeFilter.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        removeFilter: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeFilterFromProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    filters_ids: self.getGridMassActionObj().checkedString,\r\n                    entity_id: self.entityId,\r\n                    motors_type: EbayListingViewSettingsMotorsObj.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/View/Settings/Motors/View/Item/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.EbayListingViewSettingsMotorsViewItemGrid = Class.create(Grid, {\r\n\r\n        entityId: '',\r\n        //----------------------------------\r\n\r\n        initialize: function ($super, gridId, entityId) {\r\n            $super(gridId);\r\n\r\n            this.entityId = entityId;\r\n        },\r\n\r\n        //##################################\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeItemAction: this.removeItem.bind(this)\r\n            };\r\n        },\r\n\r\n        //##################################\r\n\r\n        removeItem: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_listing_settings_motors/removeItemFromProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    items_ids: self.getGridMassActionObj().checkedString,\r\n                    entity_id: self.entityId,\r\n                    motors_type: EbayListingViewSettingsMotorsObj.motorsType\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == '0') {\r\n                        self.unselectAllAndReload();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        //##################################\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Ebay/Listing/Template/Switcher.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function(jQuery, modal) {\r\n\r\n    window.EbayListingTemplateSwitcher = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        storeId: null,\r\n        marketplaceId: null,\r\n        checkAttributesAvailability: false,\r\n        listingProductIds: '',\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() {\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-template-title', function(value, el) {\r\n\r\n                var mode = base64_decode(value).evalJSON().mode;\r\n\r\n                return mode !== null;\r\n            }, M2ePro.translator.translate('This is a required field.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-ebay-template-title', function(value, el) {\r\n\r\n                var templateNick = el.name.substr(0, el.name.indexOf('['));\r\n\r\n                return EbayListingTemplateSwitcherObj.isTemplateTitleUnique(templateNick, value);\r\n            }, M2ePro.translator.translate('Policy with the same Title already exists.'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSwitcherNickByElementId: function(id)\r\n        {\r\n            return id.replace('template_', '');\r\n        },\r\n\r\n        getSwitcherElementId: function(templateNick)\r\n        {\r\n            return 'template_' + templateNick;\r\n        },\r\n\r\n        getSwitcher: function(templateNick)\r\n        {\r\n            return $(this.getSwitcherElementId(templateNick));\r\n        },\r\n\r\n        getSwitcherValueId: function(templateNick)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var switcherValue = base64_decode(switcher.value).evalJSON();\r\n\r\n            return switcherValue.id;\r\n        },\r\n\r\n        getSwitcherValueMode: function(templateNick)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var switcherValue = base64_decode(switcher.value).evalJSON();\r\n\r\n            return switcherValue.mode;\r\n        },\r\n\r\n        isSwitcherValueModeEmpty: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) === null;\r\n        },\r\n\r\n        isSwitcherValueModeParent: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_PARENT');\r\n        },\r\n\r\n        isSwitcherValueModeCustom: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_CUSTOM');\r\n        },\r\n\r\n        isSwitcherValueModeTemplate: function(templateNick)\r\n        {\r\n            return this.getSwitcherValueMode(templateNick) == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_TEMPLATE');\r\n        },\r\n\r\n        isExistSynchronizationTab: function()\r\n        {\r\n            return typeof EbayTemplateSynchronizationHandlerObj != 'undefined';\r\n        },\r\n\r\n        isNeededSaveWatermarkImage: function(ajaxResponse)\r\n        {\r\n            var isDescriptionTemplate = false;\r\n\r\n            ajaxResponse.each(function(template) {\r\n                if (template.nick == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_DESCRIPTION')) {\r\n                    isDescriptionTemplate = true;\r\n                }\r\n            });\r\n\r\n            return isDescriptionTemplate && $('watermark_image').value != '';\r\n        },\r\n\r\n        getTemplateDataContainer: function(templateNick)\r\n        {\r\n            return $('template_' + templateNick + '_data_container');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        change: function()\r\n        {\r\n            var templateNick = EbayListingTemplateSwitcherObj.getSwitcherNickByElementId(this.id);\r\n            var templateMode = EbayListingTemplateSwitcherObj.getSwitcherValueMode(templateNick);\r\n\r\n            EbayListingTemplateSwitcherObj.clearMessages(templateNick);\r\n\r\n            switch (templateMode) {\r\n                case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_PARENT'):\r\n                    EbayListingTemplateSwitcherObj.clearContent(templateNick);\r\n                    break;\r\n\r\n                case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_CUSTOM'):\r\n                    EbayListingTemplateSwitcherObj.reloadContent(templateNick);\r\n                    break;\r\n\r\n                case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_TEMPLATE'):\r\n                    EbayListingTemplateSwitcherObj.clearContent(templateNick);\r\n                    EbayListingTemplateSwitcherObj.checkMessages(templateNick);\r\n                    break;\r\n            }\r\n\r\n            EbayListingTemplateSwitcherObj.hideEmptyOption(EbayListingTemplateSwitcherObj.getSwitcher(templateNick));\r\n\r\n            if (!EbayListingTemplateSwitcherObj.isSwitcherValueModeCustom(templateNick)) {\r\n                EbayListingTemplateSwitcherObj.updateButtonsVisibility(templateNick);\r\n                EbayListingTemplateSwitcherObj.updateEditVisibility(templateNick);\r\n                EbayListingTemplateSwitcherObj.updateTemplateLabelVisibility(templateNick);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearMessages: function(templateNick)\r\n        {\r\n            $('template_switcher_' + templateNick + '_messages').innerHTML = '';\r\n        },\r\n\r\n        checkMessages: function(templateNick)\r\n        {\r\n            if (!this.checkAttributesAvailability &&\r\n                templateNick != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SELLING_FORMAT') &&\r\n                templateNick != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SHIPPING')\r\n            ) {\r\n                return;\r\n            }\r\n\r\n            var // template ID\r\n                id = this.getSwitcherValueId(templateNick),\r\n            // template nick\r\n                nick = templateNick,\r\n            // template data (for custom settings only) and listing product ids (only when we edit product settings)\r\n                data = Form.serialize(this.getTemplateDataContainer(templateNick).id)\r\n                    + '&listing_product_ids=' + this.listingProductIds,\r\n            // store ID of the listing\r\n                storeId = this.storeId,\r\n            // marketplace ID of the listing\r\n                marketplaceId = this.marketplaceId,\r\n            // do we need to check attributes availability (only when we edit product settings)\r\n                checkAttributesAvailability = this.checkAttributesAvailability,\r\n            // container, where messages should be displayed\r\n                container = 'template_switcher_' + templateNick + '_messages',\r\n            // callback function, which should be called, when messages are displayed\r\n                callback = function() {\r\n                    var refresh = $(container).down('a.refresh-messages');\r\n                    if (refresh) {\r\n                        refresh.observe('click', function() {\r\n                            this.checkMessages(templateNick);\r\n                        }.bind(this))\r\n                    }\r\n                }.bind(this);\r\n\r\n            TemplateHandlerObj.checkMessages(\r\n                id,\r\n                nick,\r\n                data,\r\n                storeId,\r\n                marketplaceId,\r\n                checkAttributesAvailability,\r\n                container,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateEditVisibility: function(templateNick)\r\n        {\r\n            var tdEdit = $('template_' + templateNick + '_edit');\r\n\r\n            if (!tdEdit) {\r\n                return;\r\n            }\r\n\r\n            if (this.isSwitcherValueModeTemplate(templateNick)) {\r\n                tdEdit.show();\r\n            } else {\r\n                tdEdit.hide();\r\n            }\r\n        },\r\n\r\n        updateButtonsVisibility: function(templateNick)\r\n        {\r\n            var divButtonsContainer = $('template_' + templateNick + '_buttons_container');\r\n\r\n            if (!divButtonsContainer) {\r\n                return;\r\n            }\r\n\r\n            if (this.isSwitcherValueModeCustom(templateNick)) {\r\n                divButtonsContainer.show();\r\n            } else {\r\n                divButtonsContainer.hide();\r\n            }\r\n        },\r\n\r\n        updateTemplateLabelVisibility: function(templateNick)\r\n        {\r\n            var labelContainer = $('template_' + templateNick + '_nick_label');\r\n            var templateLabel = labelContainer.down('span.template');\r\n\r\n            labelContainer.hide();\r\n            templateLabel && templateLabel.hide();\r\n\r\n            if (this.isSwitcherValueModeTemplate(templateNick)) {\r\n                labelContainer.show();\r\n                templateLabel && templateLabel.show();\r\n            }\r\n\r\n            if (this.isSwitcherValueModeEmpty(templateNick)) {\r\n                labelContainer.hide();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        scrollToFirstFailedElement: function()\r\n        {\r\n            var errors = $$('label.mage-error');\r\n\r\n            // if (errors.length > 0) {\r\n            //     $('#ebayListingTemplateEditTabs').showTabContent(errors[0]);\r\n            // }\r\n\r\n            // errors[0].up('table').scrollIntoView();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveSwitchers: function(callback)\r\n        {\r\n            var validationResult = jQuery('#edit_form').valid();\r\n\r\n            if (EbayListingTemplateSwitcherObj.isExistSynchronizationTab()) {\r\n                EbayTemplateSynchronizationHandlerObj.checkVirtualTabValidation();\r\n            }\r\n\r\n            if (!validationResult) {\r\n                EbayListingTemplateSwitcherObj.scrollToFirstFailedElement();\r\n                return;\r\n            }\r\n\r\n            $('edit_form').request({\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {},\r\n                onSuccess: function(transport) {\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    response.each(function(template) {\r\n                        EbayListingTemplateSwitcherObj.afterCustomSaveAsTemplate(template.nick, template.id, template.title);\r\n                    });\r\n\r\n                    var params = {};\r\n\r\n                    $$('.template-switcher').each(function(switcher) {\r\n                        params[switcher.name] = switcher.value;\r\n                    });\r\n\r\n                    if ($('ebayListingTemplateEditTabs')) {\r\n                        params['tab'] = jQuery('#ebayListingTemplateEditTabs').data().tabs.active.find('a')[0].id.split('_').pop();\r\n                    }\r\n\r\n                    if (EbayListingTemplateSwitcherObj.isNeededSaveWatermarkImage(response)) {\r\n                        EbayTemplateDescriptionObj.saveWatermarkImage(callback, params);\r\n                    } else if (typeof callback == 'function') {\r\n                        callback(params);\r\n                    }\r\n\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isTemplateTitleUnique: function(templateNick, templateTitle)\r\n        {\r\n            var unique = true;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/isTitleUnique'), {\r\n                method: 'get',\r\n                asynchronous: false,\r\n                parameters: {\r\n                    nick: templateNick,\r\n                    title: templateTitle\r\n                },\r\n                onSuccess: function(transport) {\r\n                    unique = transport.responseText.evalJSON()['unique'];\r\n                }\r\n            });\r\n\r\n            return unique;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validateCustomTemplate: function(templateNick)\r\n        {\r\n            var validationResult = $('template_' + templateNick + '_data_container').select('select, input').collect(\r\n                function (el) {\r\n                    return jQuery('#edit_form').form().validate().element(el);\r\n                }\r\n            );\r\n\r\n            if (validationResult.indexOf(false) != -1) {\r\n                EbayListingTemplateSwitcherObj.scrollToFirstFailedElement();\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        customSaveAsTemplate: function(templateNick)\r\n        {\r\n            if (!this.validateCustomTemplate(templateNick)) {\r\n                return;\r\n            }\r\n\r\n            // jQuery('#edit_form').valid()\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/newTemplateHtml'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    nick: templateNick\r\n                },\r\n                onSuccess: (function(transport) {\r\n                    if ($('new_template_form_' + templateNick)) {\r\n                        $('new_template_form_' + templateNick).remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    var form = jQuery('#new_template_form_' + templateNick);\r\n\r\n                    form.form().validation();\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Save as New Policy'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                form.modal('closeModal');\r\n                                $('new_template_form_' + templateNick).remove()\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                if (!form.form().valid()) {\r\n                                    return false;\r\n                                }\r\n\r\n                                $$('input[name=\"' + templateNick + '[id]\"]')[0].value = '';\r\n                                $$('input[name=\"' + templateNick + '[is_custom_template]\"]')[0].value = 0;\r\n                                $$('input[name=\"' + templateNick + '[title]\"]')[0].value = $('template_title_' + templateNick).value;\r\n\r\n                                $('edit_form').request({\r\n                                    method: 'post',\r\n                                    asynchronous: true,\r\n                                    parameters: {\r\n                                        nick: templateNick\r\n                                    },\r\n                                    onSuccess: function(transport) {\r\n\r\n                                        var response = transport.responseText.evalJSON();\r\n\r\n                                        response.each(function(template) {\r\n                                            EbayListingTemplateSwitcherObj.addToSwitcher(template.nick, template.id, template.title);\r\n                                            EbayListingTemplateSwitcherObj.clearContent(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.updateButtonsVisibility(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.updateEditVisibility(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.updateTemplateLabelVisibility(template.nick);\r\n                                            EbayListingTemplateSwitcherObj.checkMessages(template.nick);\r\n                                        });\r\n                                    }.bind(this)\r\n                                });\r\n\r\n                                form.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, form);\r\n\r\n                    form.modal('openModal');\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        afterCustomSaveAsTemplate: function(templateNick, templateId, templateTitle)\r\n        {\r\n            $$('input[name=\"' + templateNick + '[id]\"]')[0].value = templateId;\r\n            $$('input[name=\"' + templateNick + '[title]\"]')[0].value = templateTitle;\r\n\r\n            var switcher = EbayListingTemplateSwitcherObj.getSwitcher(templateNick);\r\n\r\n            switcher.down('.template-switcher-custom-option').value = base64_encode(\r\n                Object.toJSON({\r\n                    mode: M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_CUSTOM'),\r\n                    nick: templateNick,\r\n                    id: templateId\r\n                })\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        editTemplate: function(templateNick)\r\n        {\r\n            var templateId = this.getSwitcherValueId(templateNick);\r\n\r\n            window.open(\r\n                M2ePro.url.get('ebay_template/edit', {id: templateId, nick: templateNick, close_on_save: 1}), '_blank'\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        customizeTemplate: function(templateNick)\r\n        {\r\n            this.clearMessages(templateNick);\r\n            this.reloadContent(templateNick, function()\r\n            {\r\n                $$('input[name=\"' + templateNick + '[id]\"]')[0].value = EbayListingTemplateSwitcherObj.getSwitcherValueId(templateNick);\r\n                $$('input[name=\"' + templateNick + '[is_custom_template]\"]')[0].value = 1;\r\n                $$('input[name=\"' + templateNick + '[title]\"]')[0].value += ' [' + M2ePro.translator.translate('Customized') + ']';\r\n            });\r\n            this.getSwitcher(templateNick).selectedIndex = 0;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearContent: function(templateNick)\r\n        {\r\n            this.getTemplateDataContainer(templateNick).innerHTML = '';\r\n            this.getTemplateDataContainer(templateNick).hide();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadContent: function(templateNick, callback)\r\n        {\r\n            var id = this.getSwitcherValueId(templateNick);\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template/getTemplateHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    id: id,\r\n                    nick: templateNick\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    BlockNoticeObj.initializedBlocks = [];\r\n\r\n                    self.getTemplateDataContainer(templateNick).replace(transport.responseText);\r\n                    self.getTemplateDataContainer(templateNick).show();\r\n\r\n                    self.updateButtonsVisibility(templateNick);\r\n                    self.updateEditVisibility(templateNick);\r\n                    self.updateTemplateLabelVisibility(templateNick);\r\n\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addToSwitcher: function(templateNick, templateId, templateTitle)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var optionGroup = this.getTemplatesGroup(templateNick);\r\n\r\n            var optionValue = {\r\n                mode: M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::MODE_TEMPLATE'),\r\n                nick: templateNick,\r\n                id: templateId\r\n            };\r\n            var option = document.createElement('option');\r\n\r\n            option.value = base64_encode(Object.toJSON(optionValue));\r\n            option.innerHTML = templateTitle;\r\n\r\n            $(optionGroup).appendChild(option);\r\n\r\n            switcher.up('td').show();\r\n            switcher.value = option.value;\r\n        },\r\n\r\n        getTemplatesGroup: function(templateNick)\r\n        {\r\n            var switcher = this.getSwitcher(templateNick);\r\n            var optionGroup = switcher.down('optgroup.templates-group');\r\n\r\n            if (typeof optionGroup != 'undefined') {\r\n                return optionGroup;\r\n            }\r\n\r\n            optionGroup = document.createElement('optgroup');\r\n            optionGroup.className = 'templates-group';\r\n            optionGroup.label = M2ePro.translator.translate('Policies');\r\n\r\n            switcher.appendChild(optionGroup);\r\n\r\n            return optionGroup;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});\r\n","Ess_M2ePro/js/Ebay/Listing/PickupStore/Grid.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Listing/View/Action'\r\n], function (jQuery, Modal, MessageObj) {\r\n\r\n    window.EbayListingPickupStoreGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        popup: null,\r\n        variationPopup: null,\r\n        logPopup: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        pickupStoreStepProducts: function(listingId, callback)\r\n        {\r\n            var self = this;\r\n            this.getGridMassActionObj().unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('*/productsStep'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.openPopUp(\r\n                        M2ePro.translator.translate('Assign Products to Stores'),\r\n                        transport.responseText\r\n                    );\r\n\r\n                    var closeBtn = $('assign_close_button');\r\n                    closeBtn.removeClassName('back');\r\n                    self.updateButtonText(closeBtn, 'Cancel');\r\n                    closeBtn.stopObserving().observe('click', function() {\r\n                        self.popup.modal('closeModal');\r\n                    });\r\n\r\n                    var continueBtn = $('assign_done_button');\r\n                    continueBtn.addClassName('forward');\r\n                    self.updateButtonText(continueBtn, 'Continue');\r\n                    continueBtn.stopObserving().observe('click', function() {\r\n                        var checkedIds = EbayListingPickupStoreStepProductsGridObj.getCheckedValues();\r\n                        if (checkedIds == '') {\r\n                            self.alert('Please select Items.');\r\n                            return;\r\n                        }\r\n\r\n                        self.pickupStoreStepStores(listingId);\r\n                    });\r\n\r\n                    callback && callback();\r\n                }\r\n            });\r\n        },\r\n\r\n        pickupStoreStepStores: function(listingId)\r\n        {\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('*/storesStep'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    self.openPopUp(\r\n                        M2ePro.translator.translate('Assign Products to Stores'),\r\n                        transport.responseText\r\n                    );\r\n\r\n                    var backBtn = $('assign_close_button');\r\n                    backBtn.addClassName('back');\r\n                    self.updateButtonText(backBtn, 'Back');\r\n                    backBtn.stopObserving().observe('click', function(e) {\r\n                        e.preventDefault();\r\n                        var checked = EbayListingPickupStoreStepProductsGridObj.getCheckedValues();\r\n                        self.pickupStoreStepProducts(listingId, function() {\r\n                            var gridMassAcction = EbayListingPickupStoreStepProductsGridObj.getGridMassActionObj();\r\n\r\n                            gridMassAcction.setCheckedValues(checked);\r\n                            gridMassAcction.checkCheckboxes();\r\n                        });\r\n                    });\r\n\r\n                    var completeBtn = $('assign_done_button');\r\n                    completeBtn.removeClassName('forward');\r\n                    self.updateButtonText(completeBtn, 'Complete');\r\n                    completeBtn.stopObserving().observe('click', function(e) {\r\n                        e.preventDefault();\r\n                        var productsIds = EbayListingPickupStoreStepProductsGridObj.getCheckedValues(),\r\n                            storesIds = EbayListingPickupStoreStepStoresGridObj.getCheckedValues();\r\n\r\n                        if (productsIds == '' || storesIds == '') {\r\n                            self.alert('Please select Stores.');\r\n                            return;\r\n                        }\r\n\r\n                        self.completeStep(productsIds, storesIds);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        completeStep: function (productsIds, storesIds)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('*/assign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds,\r\n                    stores_ids: storesIds\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.getGridMassActionObj().unselectAll();\r\n                    self.getGridObj().doFilter();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function(msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1)+'Message'](msg.text);\r\n                    });\r\n\r\n                    self.popup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(title, content)\r\n        {\r\n            var self = this;\r\n\r\n            var modalDialogMessage = $('pickup_store_popup');\r\n            if (!modalDialogMessage) {\r\n                modalDialogMessage = new Element('div', {\r\n                    id: 'pickup_store_popup'\r\n                });\r\n\r\n                this.popup = jQuery(modalDialogMessage).modal({\r\n                    title: title,\r\n                    type: 'slide',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        attr: {id: 'assign_close_button'},\r\n                        class: 'action-default action-dismiss',\r\n                        click: function () {}\r\n                    },{\r\n                        text: M2ePro.translator.translate('Continue'),\r\n                        attr: {id: 'assign_done_button'},\r\n                        class: 'action-primary action-accept forward',\r\n                        click: function () {}\r\n                    }],\r\n                    closed: function() {\r\n                        self.selectedProductsIds = [];\r\n                        self.selectedCategoriesData = {};\r\n                    }\r\n                });\r\n            }\r\n\r\n            this.popup.modal('openModal');\r\n\r\n            modalDialogMessage.innerHTML = '';\r\n            modalDialogMessage.insert(content);\r\n            modalDialogMessage.innerHTML.evalScripts();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openVariationPopUp: function(productId, title, pickupStoreId, filter)\r\n        {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n            M2ePro.customData.variationPopup = {\r\n                product_id: productId,\r\n                title: title,\r\n                pickup_store_id: pickupStoreId,\r\n                filter: filter\r\n            };\r\n\r\n            new Ajax.Request(M2ePro.url.get('variationProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId,\r\n                    pickup_store_id: pickupStoreId,\r\n                    filter: filter\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var modalDialogMessage = $('pickup_store_variation_product_popup');\r\n                    if (!modalDialogMessage) {\r\n                        modalDialogMessage = new Element('div', {\r\n                            id: 'pickup_store_variation_product_popup'\r\n                        });\r\n\r\n                        this.variationPopup = jQuery(modalDialogMessage).modal({\r\n                            title: title,\r\n                            type: 'slide',\r\n                            buttons: []\r\n                        });\r\n                    }\r\n\r\n                    this.variationPopup.modal('openModal');\r\n\r\n                    modalDialogMessage.innerHTML = '';\r\n                    modalDialogMessage.insert(transport.responseText);\r\n                    modalDialogMessage.innerHTML.evalScripts();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        viewItemHelp: function(rowId, data, hideViewLog)\r\n        {\r\n            $('grid_help_icon_open_'+rowId).hide();\r\n            $('grid_help_icon_close_'+rowId).show();\r\n\r\n            if ($('grid_help_content_'+rowId) != null) {\r\n                $('grid_help_content_'+rowId).show();\r\n                return;\r\n            }\r\n\r\n            var html = this.createHelpTitleHtml(rowId);\r\n\r\n            var synchNote = $('synch_template_list_rules_note_'+rowId);\r\n            if (synchNote) {\r\n                html += this.createSynchNoteHtml(synchNote.innerHTML)\r\n            }\r\n\r\n            data = eval(base64_decode(data));\r\n            for (var i=0;i<data.length;i++) {\r\n                html += this.createHelpActionHtml(data[i]);\r\n            }\r\n\r\n            if (!hideViewLog) {\r\n                html += this.createHelpViewAllLogHtml(rowId);\r\n            }\r\n\r\n            var rows = this.getGridObj().rows;\r\n            for(var i=0;i<rows.length;i++) {\r\n                var row = rows[i];\r\n                var cels = $(row).childElements();\r\n\r\n                var checkbox = $(cels[0]).childElements();\r\n                checkbox = checkbox[0];\r\n\r\n                if (checkbox.value == rowId) {\r\n                    row.insert({\r\n                        after: '<tr id=\"grid_help_content_'+rowId+'\"><td class=\"help_line\" colspan=\"'+($(row).childElements().length)+'\">'+html+'</td></tr>'\r\n                    });\r\n                } else {\r\n                    var lastCell = cels[cels.length-1],\r\n                        hiddenElement = $(lastCell).down('#product_row_order_'+rowId);\r\n\r\n                    if (hiddenElement && hiddenElement.value == rowId) {\r\n                        row.insert({\r\n                            after: '<tr id=\"grid_help_content_'+rowId+'\"><td class=\"help_line\" colspan=\"'+($(row).childElements().length)+'\">'+html+'</td></tr>'\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            var self = this;\r\n            $('hide_item_help_' + rowId).observe('click', function() {\r\n                self.hideItemHelp(rowId);\r\n            });\r\n        },\r\n\r\n        createHelpTitleHtml: function(rowId)\r\n        {\r\n            var closeHtml = '<a href=\"javascript:void(0);\" id=\"hide_item_help_' + rowId + '\" title=\"'+M2ePro.translator.translate('Close')+\r\n                            '\"><span class=\"hl_close icon-close\"></span></a>';\r\n            return '<div class=\"hl_header\"><span class=\"hl_title\">&nbsp;</span>'+closeHtml+'</div>';\r\n        },\r\n\r\n        createHelpViewAllLogHtml: function(rowId)\r\n        {\r\n            var id = $('product_row_order_'+rowId).getAttribute('listing-product-pickup-store-state');\r\n            return '<div class=\"hl_footer\">' +\r\n                '<a href=\"#\" onclick=\"EbayListingPickupStoreGridObj.getLogGrid('+id+');\">'+\r\n                M2ePro.translator.translate('View Full Product Log')+\r\n                '</a></div>';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogGrid: function(rowId)\r\n        {\r\n            new Ajax.Request(M2ePro.url.get('*/logGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    listing_product_pickup_store_state: rowId\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var modalDialogMessage = $('pickup_store_variation_log_popup');\r\n                    if (!modalDialogMessage) {\r\n                        modalDialogMessage = new Element('div', {\r\n                            id: 'pickup_store_variation_log_popup'\r\n                        });\r\n\r\n                        this.logPopup = jQuery(modalDialogMessage).modal({\r\n                            title: M2ePro.translator.translate('Log For SKU ' + rowId),\r\n                            type: 'slide',\r\n                            buttons: []\r\n                        });\r\n                    }\r\n\r\n                    modalDialogMessage.up('.modal-inner-wrap')\r\n                                      .down('.modal-title')\r\n                                      .innerHTML = M2ePro.translator.translate('Log For SKU ' + rowId);\r\n                    this.logPopup.modal('openModal');\r\n\r\n                    modalDialogMessage.innerHTML = '';\r\n                    modalDialogMessage.insert(transport.responseText);\r\n                    modalDialogMessage.innerHTML.evalScripts();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        updateButtonText: function(element, text)\r\n        {\r\n            jQuery(element).find('span').text(M2ePro.translator.translate(text));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            var self = this;\r\n\r\n            var actionHandler = new ListingViewAction(this);\r\n            actionHandler.setProgressBar('pickup_store_view_progress_bar');\r\n            actionHandler.setGridWrapper('pickup_store_view_content_container');\r\n            actionHandler.setErrorsSummaryContainer('pickup_store_container_errors_summary');\r\n\r\n            this.actions = {\r\n                unassignAction: function() {\r\n                    var selectedProductsParts = self.getSelectedItemsParts();\r\n                    if (selectedProductsParts.length == 0) {\r\n                        return;\r\n                    }\r\n\r\n                    actionHandler.startActions(\r\n                        M2ePro.translator.translate('Unassign Product(s) from Stores'),\r\n                        M2ePro.url.get('*/unassign'),\r\n                        selectedProductsParts\r\n                    );\r\n                }\r\n            };\r\n        },\r\n\r\n        getMaxProductsInPart: function ()\r\n        {\r\n            return 100;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/Shipping.js":"define([\n    'jquery',\n    'Magento_Ui/js/modal/modal',\n    'M2ePro/Common'\n], function (jQuery, modal) {\n    window.EbayTemplateShipping = Class.create(Common, {\n\n        // ---------------------------------------\n\n        shippingMethods: {},\n        missingAttributes: {},\n\n        discountProfiles: [],\n        shippingServices: [],\n        shippingLocations: [],\n\n        counter: {\n            local: 0,\n            international: 0,\n            total: 0\n        },\n\n        originCountry: null,\n\n        // ---------------------------------------\n\n        initialize: function()\n        {\n            jQuery.validator.addMethod('M2ePro-location-or-postal-required', function() {\n                return $('address_mode').value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::ADDRESS_MODE_NONE') ||\n                    $('postal_code_mode').value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::POSTAL_CODE_MODE_NONE');\n            }, M2ePro.translator.translate('Location or Zip/Postal Code should be specified.'));\n\n            jQuery.validator.addMethod('M2ePro-validate-international-ship-to-location', function(value, el) {\n                return $$('input[name=\"'+el.name+'\"]').any(function(o) {\n                    return o.checked;\n                });\n            }, M2ePro.translator.translate('Select one or more international ship-to Locations.'));\n\n            jQuery.validator.addMethod('M2ePro-required-if-calculated', function(value) {\n\n                if(EbayTemplateShippingObj.isLocalShippingModeCalculated() ||\n                    EbayTemplateShippingObj.isInternationalShippingModeCalculated()) {\n                    return value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::POSTAL_CODE_MODE_NONE');\n                }\n\n                return true;\n            }, M2ePro.translator.translate('This is a required field.'));\n\n            jQuery.validator.addMethod('M2ePro-validate-shipping-methods', function(value, el) {\n\n                var locationType = /local/.test(el.id) ? 'local' : 'international',\n                    shippingModeValue = $(locationType + '_shipping_mode').value;\n\n                shippingModeValue = parseInt(shippingModeValue);\n\n                if (shippingModeValue !== M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FLAT') &&\n                    shippingModeValue !== M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_CALCULATED')) {\n                    return true;\n                }\n\n                return EbayTemplateShippingObj.counter[locationType] != 0;\n            },  M2ePro.translator.translate('You should specify at least one Shipping Method.'));\n\n            jQuery.validator.addMethod('M2ePro-validate-shipping-service', function(value, el) {\n\n                var hidden = !$(el).visible();\n                var current = el;\n\n                while (!hidden) {\n                    el = $(el).up();\n                    hidden = !el.visible();\n                    if (el == document || el.hasClassName('entry-edit')) {\n                        break;\n                    }\n                }\n\n                if (hidden || current.up('table').id == 'shipping_international_table') {\n                    return true;\n                }\n\n                return value != '';\n            }, M2ePro.translator.translate('This is a required field.'));\n        },\n\n        initObservers: function()\n        {\n            jQuery('#country_mode')\n                .on('change', EbayTemplateShippingObj.countryModeChange)\n                .trigger('change');\n\n            jQuery('#postal_code_mode')\n                .on('change', EbayTemplateShippingObj.postalCodeModeChange)\n                .trigger('change');\n\n            jQuery('#address_mode')\n                .on('change', EbayTemplateShippingObj.addressModeChange)\n                .trigger('change');\n\n            jQuery('#local_shipping_mode')\n                .on('change', EbayTemplateShippingObj.localShippingModeChange)\n                .trigger('change');\n\n            if ($('local_shipping_rate_table_mode')) {\n                jQuery('#local_shipping_rate_table_mode')\n                    .on('change', EbayTemplateShippingObj.rateTableModeChange);\n            }\n\n            if ($('international_shipping_rate_table_mode')) {\n                jQuery('#international_shipping_rate_table_mode')\n                    .on('change', EbayTemplateShippingObj.rateTableModeChange);\n            }\n\n            EbayTemplateShippingObj.prepareMeasurementObservers('local');\n\n            jQuery('#dispatch_time')\n                .on('change', EbayTemplateShippingObj.dispatchTimeChange)\n                .trigger('change');\n\n            if ($('click_and_collect_mode')) {\n                jQuery('#click_and_collect_mode')\n                    .on('change', EbayTemplateShippingObj.clickAndCollectModeChange)\n                    .trigger('change');\n            }\n\n            if ($('cross_border_trade')) {\n                jQuery('#cross_border_trade')\n                    .on('change', EbayTemplateShippingObj.crossBorderTradeChange)\n                    .trigger('change');\n            }\n\n            jQuery('#international_shipping_mode')\n                .on('change', EbayTemplateShippingObj.internationalShippingModeChange)\n                .trigger('change');\n\n            jQuery('.shipping_excluded_location_region_link').each(function(){\n                jQuery(this).on('click', EbayTemplateShippingObj.checkExcludeLocationsRegionsSelection)\n                    .on('mouseover', function(event){ this.down('label').style.textDecoration = 'underline'; })\n                    .on('mouseout', function(event){ this.down('label').style.textDecoration = 'none'; });\n            });\n\n            jQuery('.shipping_excluded_location').each(function(){\n                jQuery(this).on('change', EbayTemplateShippingObj.selectExcludeLocation);\n            });\n\n            EbayTemplateShippingObj.renderShippingMethods(EbayTemplateShippingObj.shippingMethods);\n\n            EbayTemplateShippingObj.checkMessages('local');\n            EbayTemplateShippingObj.checkMessages('international');\n        },\n\n        // ---------------------------------------\n\n        countryModeChange : function()\n        {\n            var self = EbayTemplateShippingObj,\n                elem = $('country_mode');\n            if (elem.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::COUNTRY_MODE_CUSTOM_VALUE')) {\n\n                self.updateHiddenValue(elem, $('country_custom_value'));\n            }\n\n            if (elem.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::COUNTRY_MODE_CUSTOM_ATTRIBUTE')) {\n\n                self.updateHiddenValue(elem, $('country_custom_attribute'));\n            }\n        },\n\n        // ---------------------------------------\n\n        postalCodeModeChange: function()\n        {\n            var self = EbayTemplateShippingObj,\n                elem = $('postal_code_mode');\n\n            if (elem.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::POSTAL_CODE_MODE_CUSTOM_VALUE')) {\n                $('postal_code_custom_value_tr').show();\n            } else {\n                $('postal_code_custom_value_tr').hide();\n            }\n\n            if (elem.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::POSTAL_CODE_MODE_CUSTOM_ATTRIBUTE')) {\n\n                self.updateHiddenValue(elem, $('postal_code_custom_attribute'));\n            }\n        },\n\n        // ---------------------------------------\n\n        addressModeChange: function()\n        {\n            var self = EbayTemplateShippingObj,\n                elem = $('address_mode');\n\n            if (elem.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::ADDRESS_MODE_CUSTOM_VALUE')) {\n                $('address_custom_value_tr').show();\n            } else {\n                $('address_custom_value_tr').hide();\n            }\n\n            if (elem.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::ADDRESS_MODE_CUSTOM_ATTRIBUTE')) {\n\n                self.updateHiddenValue(elem, $('address_custom_attribute'));\n            }\n        },\n\n        // ---------------------------------------\n\n        dispatchTimeChange: function()\n        {\n            if (!$('click_and_collect_mode')) {\n                return;\n            }\n\n            if (this.value > 3 || (!EbayTemplateShippingObj.isLocalShippingModeFlat()\n                && !EbayTemplateShippingObj.isLocalShippingModeCalculated())\n            ) {\n                $('click_and_collect_mode_tr').hide();\n                $('click_and_collect_mode').selectedIndex = 1;\n                jQuery('#click_and_collect_mode').trigger('change');\n\n                return;\n            }\n\n            $('click_and_collect_mode_tr').show();\n            jQuery('#click_and_collect_mode').trigger('change');\n        },\n\n        // ---------------------------------------\n\n        localShippingModeChange: function()\n        {\n            // ---------------------------------------\n            $('magento_block_ebay_template_shipping_form_data_international-wrapper').hide();\n            $('local_shipping_methods_tr').hide();\n            $('magento_block_ebay_template_shipping_form_data_excluded_locations-wrapper').show();\n            // ---------------------------------------\n\n            // clear selected shipping methods\n            // ---------------------------------------\n            $$('#shipping_local_tbody .icon-btn').each(function(el) {\n                EbayTemplateShippingObj.removeRow.call(el, 'local');\n            });\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat()\n                || EbayTemplateShippingObj.isLocalShippingModeCalculated()\n            ) {\n                $$('.local-shipping-tr').invoke('show');\n                jQuery('#dispatch_time').trigger('change');\n\n                $('domestic_shipping_fieldset-wrapper').setStyle({\n                    borderBottom: null\n                });\n            } else {\n                $$('.local-shipping-tr').invoke('hide');\n                $('domestic_shipping_fieldset-wrapper').setStyle({\n                    borderBottom: '0px'\n                });\n\n                if ($('click_and_collect_mode')) {\n                    $('click_and_collect_mode').selectedIndex = 1;\n                    jQuery('#click_and_collect_mode').trigger('change');\n                }\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            EbayTemplateShippingObj.updateMeasurementVisibility();\n            EbayTemplateShippingObj.updateCashOnDeliveryCostVisibility();\n            EbayTemplateShippingObj.updateCrossBorderTradeVisibility();\n            EbayTemplateShippingObj.updateRateTableVisibility('local');\n            EbayTemplateShippingObj.updateLocalHandlingCostVisibility();\n            EbayTemplateShippingObj.renderDiscountProfiles('local');\n            EbayTemplateShippingObj.clearMessages('local');\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat()) {\n                $('magento_block_ebay_template_shipping_form_data_international-wrapper').show();\n                $('local_shipping_methods_tr').show();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeCalculated()) {\n                $('magento_block_ebay_template_shipping_form_data_international-wrapper').show();\n                $('local_shipping_methods_tr').show();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeFreight()) {\n                $('international_shipping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_NO_INTERNATIONAL');\n                jQuery('#international_shipping_mode').trigger('change');\n\n                $('magento_block_ebay_template_shipping_form_data_excluded_locations-wrapper').hide();\n                EbayTemplateShippingObj.resetExcludeLocationsList();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeLocal()) {\n                $('international_shipping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_NO_INTERNATIONAL');\n                jQuery('#international_shipping_mode').trigger('change');\n\n                $('magento_block_ebay_template_shipping_form_data_excluded_locations-wrapper').hide();\n                EbayTemplateShippingObj.resetExcludeLocationsList();\n            }\n            // ---------------------------------------\n        },\n\n        isLocalShippingModeFlat: function()\n        {\n            return $('local_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FLAT');\n        },\n\n        isLocalShippingModeCalculated: function()\n        {\n            return $('local_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_CALCULATED');\n        },\n\n        isLocalShippingModeFreight: function()\n        {\n            return $('local_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FREIGHT');\n        },\n\n        isLocalShippingModeLocal: function()\n        {\n            return $('local_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_LOCAL');\n        },\n\n        // ---------------------------------------\n\n        hasSurcharge: function(locationType)\n        {\n            var marketplaceId = $$('[name=\"shipping[marketplace_id]\"]')[0];\n            return locationType == 'local' && marketplaceId  && ['1', '9'].indexOf(marketplaceId.value) != -1;\n        },\n\n        // ---------------------------------------\n\n        internationalShippingModeChange: function()\n        {\n            // clear selected shipping methods\n            // ---------------------------------------\n            $$('#shipping_international_tbody .icon-btn').each(function(el) {\n                EbayTemplateShippingObj.removeRow.call(el, 'international');\n            });\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isInternationalShippingModeFlat()\n                || EbayTemplateShippingObj.isInternationalShippingModeCalculated()\n            ) {\n                $('add_international_shipping_method_button').show();\n                $('shipping_international_table').hide();\n                $('international_shipping_methods_tr').show();\n                $$('.international-shipping-tr').invoke('show');\n            } else {\n                $('international_shipping_methods_tr').hide();\n                $$('.international-shipping-tr').invoke('hide');\n                EbayTemplateShippingObj.deleteExcludedLocation('international', 'type', 'excluded_locations_hidden');\n                EbayTemplateShippingObj.updateExcludedLocationsTitles('excluded_locations_titles');\n\n                if ($('international_shipping_rate_table_mode')) {\n                    $('international_shipping_rate_table_mode').selectedIndex = 0;\n                    jQuery('#international_shipping_rate_table_mode').trigger('change');\n                }\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            EbayTemplateShippingObj.updateMeasurementVisibility();\n            EbayTemplateShippingObj.renderDiscountProfiles('international');\n            EbayTemplateShippingObj.updateRateTableVisibility('international');\n            EbayTemplateShippingObj.updateInternationalHandlingCostVisibility();\n            EbayTemplateShippingObj.clearMessages('international');\n            // ---------------------------------------\n        },\n\n        isInternationalShippingModeFlat: function()\n        {\n            return $('international_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FLAT');\n        },\n\n        isInternationalShippingModeCalculated: function()\n        {\n            return $('international_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_CALCULATED');\n        },\n\n        isInternationalShippingModeNoInternational: function()\n        {\n            return $('international_shipping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_NO_INTERNATIONAL');\n        },\n\n        getCalculatedLocationType: function()\n        {\n            if (EbayTemplateShippingObj.isLocalShippingModeCalculated()) {\n                return 'local';\n            }\n\n            if (EbayTemplateShippingObj.isInternationalShippingModeCalculated()) {\n                return 'international';\n            }\n\n            return null;\n        },\n\n        isShippingModeCalculated: function(locationType)\n        {\n            if (locationType == 'local') {\n                return EbayTemplateShippingObj.isLocalShippingModeCalculated();\n            }\n\n            if (locationType == 'international') {\n                return EbayTemplateShippingObj.isInternationalShippingModeCalculated();\n            }\n\n            return false;\n        },\n\n        // ---------------------------------------\n\n        isClickAndCollectEnabled: function()\n        {\n            if (!$('click_and_collect_mode')) {\n                return false;\n            }\n\n            return $('click_and_collect_mode').value == 1;\n        },\n\n        // ---------------------------------------\n\n        crossBorderTradeChange: function()\n        {\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::CROSS_BORDER_TRADE_NONE')) {\n                $('international_shipping_none').show();\n            } else {\n                $('international_shipping_none').hide();\n                if (EbayTemplateShippingObj.isInternationalShippingModeNoInternational()) {\n                    $('international_shipping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FLAT');\n                    jQuery('#international_shipping_mode').trigger('change');\n                }\n            }\n        },\n\n        // ---------------------------------------\n\n        updateCrossBorderTradeVisibility: function()\n        {\n            if(!$('magento_block_ebay_template_shipping_form_data_cross_border_trade-wrapper')) {\n                return;\n            }\n\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat()\n                || EbayTemplateShippingObj.isLocalShippingModeCalculated()\n            ) {\n                $('magento_block_ebay_template_shipping_form_data_cross_border_trade-wrapper').show();\n            } else {\n                $('magento_block_ebay_template_shipping_form_data_cross_border_trade-wrapper').hide();\n                $('cross_border_trade').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::CROSS_BORDER_TRADE_NONE');\n            }\n        },\n\n        // ---------------------------------------\n\n        updateRateTableVisibility: function(locationType)\n        {\n            var shippingMode = $(locationType + '_shipping_mode').value;\n\n            if (!$(locationType+'_shipping_rate_table_mode_tr')) {\n                return;\n            }\n\n            if (shippingMode != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FLAT')) {\n                $(locationType+'_shipping_rate_table_mode_tr').hide();\n                $(locationType+'_shipping_rate_table_mode').value = 0;\n            } else {\n                $(locationType+'_shipping_rate_table_mode_tr').show();\n            }\n        },\n\n        isRateTableEnabled: function()\n        {\n            var local = $('local_shipping_rate_table_mode'),\n                international = $('international_shipping_rate_table_mode');\n\n            if (!local && !international) {\n                return false;\n            }\n\n            return (local && local.value != 0) ||\n                (international && international.value != 0);\n        },\n\n        rateTableModeChange: function()\n        {\n            var absoluteHide = !!(!EbayTemplateShippingObj.isLocalShippingModeFlat() ||\n            EbayTemplateShippingObj.isRateTableEnabled());\n            $$('[id^=\"shipping_variant_cost_surcharge_\"]').each(function(surchargeRow) {\n                var row = surchargeRow.previous('tr');\n\n                // for template without data\n                if (!row) {\n                    return;\n                }\n\n                var inputCostSurchargeCV = surchargeRow.select('.shipping-cost-surcharge')[0];\n                var inputCostSurchargeCA = surchargeRow.select('.shipping-cost-surcharge-ca')[0];\n\n                inputCostSurchargeCV.hide();\n                inputCostSurchargeCA.hide();\n\n                if (absoluteHide || !(/(FedEx|UPS)/.test(row.select('.shipping-service')[0].value)) ||\n                    row.select('.cost-mode')[0].value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_FREE')) {\n                    surchargeRow.hide();\n                } else {\n                    surchargeRow.show();\n\n                    if (row.select('.cost-mode')[0].value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CUSTOM_VALUE')) {\n                        inputCostSurchargeCV.show();\n                        inputCostSurchargeCV.disabled = false;\n                    } else if (row.select('.cost-mode')[0].value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CUSTOM_ATTRIBUTE')) {\n                        inputCostSurchargeCA.show();\n                    }\n                }\n            });\n\n            EbayTemplateShippingObj.updatePackageBlockState();\n        },\n\n        // ---------------------------------------\n\n        clickAndCollectModeChange: function()\n        {\n            EbayTemplateShippingObj.updatePackageBlockState();\n        },\n\n        // ---------------------------------------\n\n        updateLocalHandlingCostVisibility: function()\n        {\n            if (!$('local_handling_cost_cv_tr')) {\n                return;\n            }\n\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat()) {\n                $('local_handling_cost_cv_tr').hide();\n                $('local_handling_cost').value = '';\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeCalculated()) {\n                $('local_handling_cost_cv_tr').show();\n            }\n            // ---------------------------------------\n        },\n\n        updateInternationalHandlingCostVisibility: function()\n        {\n            if (!$('international_handling_cost_cv_tr')) {\n                return;\n            }\n\n            if (EbayTemplateShippingObj.isInternationalShippingModeCalculated()) {\n                $('international_handling_cost_cv_tr').show();\n            } else {\n                $('international_handling_cost_cv_tr').hide();\n                $('international_handling_cost').value = '';\n            }\n        },\n\n        // ---------------------------------------\n\n        updateDiscountProfiles: function(accountId)\n        {\n            new Ajax.Request(M2ePro.url.get('ebay_template_shipping/updateDiscountProfiles'), {\n                method: 'get',\n                parameters: {\n                    'account_id': accountId\n                },\n                onSuccess: function(transport) {\n                    EbayTemplateShippingObj.discountProfiles[accountId]['profiles'] = transport.responseText.evalJSON(true);\n                    EbayTemplateShippingObj.renderDiscountProfiles('local', accountId);\n                    EbayTemplateShippingObj.renderDiscountProfiles('international', accountId);\n                }\n            });\n        },\n\n        renderDiscountProfiles: function(locationType, renderAccountId)\n        {\n            if (typeof renderAccountId == 'undefined') {\n                $$('.' + locationType + '-discount-profile-account-tr').each(function(account) {\n                    var accountId = account.readAttribute('account_id');\n\n                    if ($(locationType + '_shipping_discount_profile_id_' + accountId)) {\n                        var value = EbayTemplateShippingObj.discountProfiles[accountId]['selected'][locationType];\n\n                        var html = EbayTemplateShippingObj.getDiscountProfilesHtml(locationType, accountId);\n                        $(locationType + '_shipping_discount_profile_id_' + accountId).update(html);\n\n                        if (value && EbayTemplateShippingObj.discountProfiles[accountId]['profiles'].length > 0) {\n                            var select = $(locationType + '_shipping_discount_profile_id_' + accountId);\n\n                            for (var i = 0; i < select.length; i++) {\n                                if (select[i].value == value) {\n                                    select.value = value;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                });\n            } else {\n                if ($(locationType + '_shipping_discount_profile_id_' + renderAccountId)) {\n                    var value = EbayTemplateShippingObj.discountProfiles[renderAccountId]['selected'][locationType];\n                    var html = EbayTemplateShippingObj.getDiscountProfilesHtml(locationType, renderAccountId);\n\n                    $(locationType + '_shipping_discount_profile_id_' + renderAccountId).update(html);\n\n                    if (value && EbayTemplateShippingObj.discountProfiles[renderAccountId]['profiles'].length > 0) {\n                        $(locationType + '_shipping_discount_profile_id_' + renderAccountId).value = value;\n                    }\n                }\n            }\n\n        },\n\n        getDiscountProfilesHtml: function(locationType, accountId)\n        {\n            var shippingModeSelect = $(locationType + '_shipping_mode');\n            var desiredProfileType = null;\n            var html = '<option value=\"\">'+M2ePro.translator.translate('None')+'</option>';\n\n            switch (parseInt(shippingModeSelect.value)) {\n                case M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_FLAT'):\n                    desiredProfileType = 'flat_shipping';\n                    break;\n                case M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping::SHIPPING_TYPE_CALCULATED'):\n                    desiredProfileType = 'calculated_shipping';\n                    break;\n            }\n\n            if (desiredProfileType === null) {\n                return html;\n            }\n\n            EbayTemplateShippingObj.discountProfiles[accountId]['profiles'].each(function(profile) {\n                if (profile.type != desiredProfileType) {\n                    return;\n                }\n\n                html += '<option value=\"'+profile.profile_id+'\">'+profile.profile_name+'</option>';\n            });\n\n            return html;\n        },\n\n        // ---------------------------------------\n\n        updateCashOnDeliveryCostVisibility: function()\n        {\n            if (!$('cash_on_delivery_cost_cv_tr')) {\n                return;\n            }\n\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat()\n                || EbayTemplateShippingObj.isLocalShippingModeCalculated()\n            ) {\n                $('cash_on_delivery_cost_cv_tr').show();\n            } else {\n                $('cash_on_delivery_cost_cv_tr').hide();\n                $('cash_on_delivery_cost').value = '';\n            }\n        },\n\n        // ---------------------------------------\n\n        packageSizeChange: function()\n        {\n            var self = EbayTemplateShippingObj;\n\n            var packageSizeMode = this.value;\n\n            $('package_size_mode').value = packageSizeMode;\n            $('package_size_attribute').value = '';\n\n            if (packageSizeMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Calculated::PACKAGE_SIZE_CUSTOM_VALUE')) {\n                self.updateHiddenValue(this, $('package_size_value'));\n\n                var showDimension = parseInt(this.options[this.selectedIndex].getAttribute('dimensions_supported'));\n                self.updateDimensionVisibility(showDimension);\n            } else if (packageSizeMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Calculated::PACKAGE_SIZE_CUSTOM_ATTRIBUTE')) {\n                self.updateHiddenValue(this, $('package_size_attribute'));\n                self.updateDimensionVisibility(true);\n            }\n        },\n\n        // ---------------------------------------\n\n        updateDimensionVisibility: function(showDimension)\n        {\n            if (showDimension) {\n                $('dimensions_tr').show();\n                jQuery('#dimension_mode').trigger('change');\n            } else {\n                $('dimensions_tr').hide();\n                $('dimension_mode').value = 0;\n                jQuery('#dimension_mode').trigger('change');\n            }\n        },\n\n        // ---------------------------------------\n\n        dimensionModeChange: function()\n        {\n            $$('.dimensions_ca_tr, .dimensions_cv_tr').invoke('hide');\n\n            if (this.value != 0) {\n                $$(this.value == 1 ? '.dimensions_cv_tr' : '.dimensions_ca_tr').invoke('show');\n            }\n        },\n\n        // ---------------------------------------\n\n        weightChange: function()\n        {\n            var measurementNoteElement = this.up().next('.note');\n\n            $('weight_cv').hide();\n            measurementNoteElement.hide();\n\n            var weightMode = this.value;\n\n            $('weight_mode').value = weightMode;\n            $('weight_attribute').value = '';\n\n            if (weightMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Calculated::WEIGHT_CUSTOM_VALUE')) {\n                $('weight_cv').show();\n            } else if (weightMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Calculated::WEIGHT_CUSTOM_ATTRIBUTE')) {\n                EbayTemplateShippingObj.updateHiddenValue(this, $('weight_attribute'));\n                measurementNoteElement.show();\n            }\n        },\n\n        // ---------------------------------------\n\n        isMeasurementSystemEnglish: function()\n        {\n            return $('measurement_system').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Calculated::MEASUREMENT_SYSTEM_ENGLISH');\n        },\n\n        measurementSystemChange: function()\n        {\n            $$('.measurement-system-english, .measurement-system-metric').invoke('hide');\n\n            if (EbayTemplateShippingObj.isMeasurementSystemEnglish()) {\n                $$('.measurement-system-english').invoke('show');\n            } else {\n                $$('.measurement-system-metric').invoke('show');\n            }\n        },\n\n        // ---------------------------------------\n\n        updateMeasurementVisibility: function()\n        {\n            if (EbayTemplateShippingObj.isLocalShippingModeCalculated()) {\n                EbayTemplateShippingObj.showMeasurementOptions('local', 'calculated');\n                EbayTemplateShippingObj.updatePackageBlockState();\n                return;\n            }\n\n            if (EbayTemplateShippingObj.isInternationalShippingModeCalculated()) {\n                EbayTemplateShippingObj.showMeasurementOptions('international', 'calculated');\n                EbayTemplateShippingObj.updatePackageBlockState();\n                return;\n            }\n\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat()\n                && EbayTemplateShippingObj.isRateTableEnabled()\n            ) {\n                EbayTemplateShippingObj.showMeasurementOptions('local', 'flat');\n            }\n\n            EbayTemplateShippingObj.updatePackageBlockState();\n        },\n\n        showMeasurementOptions: function(locationType, shippingMode)\n        {\n            $$('#block_shipping_template_calculated_options tr').each(function(element) {\n                if (element.hasClassName('visible-for-'+shippingMode+'-by-default')) {\n                    element.show();\n                } else {\n                    element.hide();\n                }\n            });\n\n            EbayTemplateShippingObj.prepareMeasurementObservers(shippingMode);\n        },\n\n        prepareMeasurementObservers: function(shippingMode)\n        {\n            jQuery('#measurement_system')\n                .on('change', EbayTemplateShippingObj.measurementSystemChange)\n                .trigger('change');\n\n            if (shippingMode == 'calculated') {\n                jQuery('#package_size')\n                    .on('change', EbayTemplateShippingObj.packageSizeChange)\n                    .trigger('change');\n            }\n\n            if ($('dimension_mode')) {\n                jQuery('#dimension_mode')\n                    .on('change', EbayTemplateShippingObj.dimensionModeChange)\n                    .trigger('change');\n            }\n\n            jQuery('#weight')\n                .on('change', EbayTemplateShippingObj.weightChange)\n                .trigger('change');\n        },\n\n        // ---------------------------------------\n\n        serviceChange: function()\n        {\n            var row = $(this).up('tr');\n\n            if (this.up('table').id != 'shipping_international_table') {\n                this.down(0).hide();\n            }\n\n            if (this.value === '') {\n                row.select('.cost-mode')[0].hide();\n                row.select('.shipping-cost-cv')[0].hide();\n                row.select('.shipping-cost-ca')[0].hide();\n                row.select('.shipping-cost-additional')[0].hide();\n                row.select('.shipping-cost-additional-ca')[0].hide();\n            } else {\n                row.select('.cost-mode')[0].show();\n                jQuery(row.select('.cost-mode')[0]).trigger('change');\n            }\n        },\n\n        // ---------------------------------------\n\n        serviceCostModeChange: function()\n        {\n            var row = $(this).up('tr');\n\n            // ---------------------------------------\n            var surchargeRow = $('shipping_variant_cost_surcharge_' + this.name.match(/\\d+/) + '_tr');\n\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat() && surchargeRow) {\n                var inputCostSurchargeCV = surchargeRow.select('.shipping-cost-surcharge')[0];\n                var inputCostSurchargeCA = surchargeRow.select('.shipping-cost-surcharge-ca')[0];\n\n                if (!EbayTemplateShippingObj.isRateTableEnabled() &&\n                    /(FedEx|UPS)/.test(row.select('.shipping-service')[0].value)) {\n                    surchargeRow.show();\n                } else {\n                    surchargeRow.hide();\n                }\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            var inputCostCV = row.select('.shipping-cost-cv')[0];\n            var inputCostCA = row.select('.shipping-cost-ca')[0];\n            var inputCostAddCV = row.select('.shipping-cost-additional')[0];\n            var inputCostAddCA = row.select('.shipping-cost-additional-ca')[0];\n            var inputPriority = row.select('.shipping-priority')[0];\n            // ---------------------------------------\n\n            // ---------------------------------------\n            [inputCostCV, inputCostCA, inputCostAddCV, inputCostAddCA].invoke('hide');\n            if (surchargeRow) {\n                inputCostSurchargeCV.hide();\n                inputCostSurchargeCA.hide();\n            }\n\n            inputPriority.show();\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CUSTOM_VALUE')) {\n                inputCostCV.show();\n                inputCostCV.disabled = false;\n\n                inputCostAddCV.show();\n                inputCostAddCV.disabled = false;\n\n                if (surchargeRow && !EbayTemplateShippingObj.isRateTableEnabled()) {\n                    inputCostSurchargeCV.show();\n                    inputCostSurchargeCV.disabled = false;\n                }\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CUSTOM_ATTRIBUTE')) {\n                inputCostCA.show();\n                inputCostAddCA.show();\n                surchargeRow && !EbayTemplateShippingObj.isRateTableEnabled() && inputCostSurchargeCA.show();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_FREE')) {\n\n                var isLocalMethod = /local/.test(row.id);\n\n                if (isLocalMethod && EbayTemplateShippingObj.isLocalShippingModeCalculated()) {\n                    inputPriority.value = 0;\n                    inputCostCV.value = 0;\n                    inputCostAddCV.value = 0;\n\n                    [inputPriority, inputCostCV, inputCostAddCV].invoke('hide');\n\n                } else {\n                    inputCostCV.show();\n                    inputCostCV.value = 0;\n                    inputCostCV.disabled = true;\n\n                    inputCostAddCV.show();\n                    inputCostAddCV.value = 0;\n                    inputCostAddCV.disabled = true;\n                }\n\n                if (surchargeRow) {\n                    inputCostSurchargeCV.hide();\n                    inputCostSurchargeCA.hide();\n\n                    surchargeRow.hide();\n                }\n            }\n            // ---------------------------------------\n        },\n\n        // ---------------------------------------\n\n        shippingLocationChange: function()\n        {\n            var i = this.name.match(/\\d+/);\n            var current = this;\n\n            if (this.value != 'Worldwide') {\n                return;\n            }\n\n            $$('input[name=\"shipping[shippingLocation][' + i + '][]\"]').each(function(item) {\n                if (current.checked && item != current) {\n                    item.checked = false;\n                    item.disabled = true;\n                } else {\n                    item.disabled = false;\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        addRow: function(type) // local|international\n        {\n            $('shipping_'+type+'_table').show();\n            $('add_'+type+'_shipping_method_button').hide();\n\n            var id = 'shipping_' + type + '_tbody';\n            var i = EbayTemplateShippingObj.counter.total;\n\n            // ---------------------------------------\n            var tpl = $$('#block_listing_template_shipping_table_row_template_table tbody')[0].innerHTML;\n            tpl = tpl.replace(/%i%/g, i);\n            tpl = tpl.replace(/%type%/g, type);\n            $(id).insert(tpl);\n            // ---------------------------------------\n\n            // ---------------------------------------\n            var row = $('shipping_variant_' + type + '_' + i + '_tr');\n            // ---------------------------------------\n\n            // ---------------------------------------\n            AttributeObj.renderAttributesWithEmptyOption('shipping[shipping_cost_attribute][' + i + ']', row.down('.shipping-cost-ca'));\n            var handlerObj = new AttributeCreator('shipping[shipping_cost_attribute][' + i + ']');\n            handlerObj.setSelectObj($('shipping[shipping_cost_attribute][' + i + ']'));\n            handlerObj.injectAddOption();\n            AttributeObj.renderAttributesWithEmptyOption('shipping[shipping_cost_additional_attribute][' + i + ']', row.down('.shipping-cost-additional-ca'));\n            var handlerObj = new AttributeCreator('shipping[shipping_cost_additional_attribute][' + i + ']');\n            handlerObj.setSelectObj($('shipping[shipping_cost_additional_attribute][' + i + ']'));\n            handlerObj.injectAddOption();\n            // ---------------------------------------\n\n            // ---------------------------------------\n            EbayTemplateShippingObj.renderServices(row.select('.shipping-service')[0], type);\n            EbayTemplateShippingObj.initRow(row);\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (type == 'international') {\n                tpl = $$('#block_shipping_table_locations_row_template_table tbody')[0].innerHTML;\n                tpl = tpl.replace(/%i%/g, i);\n                $(id).insert(tpl);\n                EbayTemplateShippingObj.renderShipToLocationCheckboxes(i);\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isLocalShippingModeFlat() &&\n                EbayTemplateShippingObj.hasSurcharge(type)) {\n\n                tpl = $$('#block_shipping_table_cost_surcharge_row_template_table tbody')[0].innerHTML;\n                tpl = tpl.replace(/%i%/g, i);\n                $(id).insert(tpl);\n\n                AttributeObj.renderAttributesWithEmptyOption(\n                    'shipping[shipping_cost_surcharge_attribute][' + i + ']',\n                    $('shipping_variant_cost_surcharge_' + i + '_tr').down('.shipping-cost-surcharge-ca'));\n                $('shipping[shipping_cost_surcharge_attribute][' + i + ']').insert({\n                    top: new Element('option', {selected: true}).update(M2ePro.translator.translate('None'))\n                });\n                var handlerObj = new AttributeCreator('shipping[shipping_cost_surcharge_attribute][' + i + ']');\n                handlerObj.setSelectObj($('shipping[shipping_cost_surcharge_attribute][' + i + ']'));\n                handlerObj.injectAddOption();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            EbayTemplateShippingObj.counter[type]++;\n            EbayTemplateShippingObj.counter.total++;\n            // ---------------------------------------\n\n            // ---------------------------------------\n            if (type == 'local' && EbayTemplateShippingObj.counter[type] >= 4) {\n                $(id).up('table').select('tfoot')[0].hide();\n            }\n            if (type == 'international' && EbayTemplateShippingObj.counter[type] >= 5) {\n                $(id).up('table').select('tfoot')[0].hide();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            var isAttributeMode = function(element) {\n                return element.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Shipping::COUNTRY_MODE_CUSTOM_ATTRIBUTE');\n            };\n\n            row.down('[name^=\"shipping[shipping_cost_attribute]\"]').observe('change', function(event) {\n                var element = event.target.up('tr').down('[name^=\"shipping[cost_mode]\"]');\n\n                if (!isAttributeMode(element)) {\n                    return;\n                }\n\n                EbayTemplateShippingObj.checkMessages(type);\n            });\n\n            row.down('[name^=\"shipping[shipping_cost_additional_attribute]\"]').observe('change', function(event) {\n                var element = event.target.up('tr').down('[name^=\"shipping[cost_mode]\"]');\n\n                if (!isAttributeMode(element)) {\n                    return;\n                }\n\n                EbayTemplateShippingObj.checkMessages(type);\n            });\n\n            if (type == 'local') {\n\n                var next = row.next(\"[id^='shipping_variant_cost_surcharge']\");\n\n                if (next) {\n                    next.down('[name^=\"shipping[shipping_cost_surcharge_attribute]\"]').observe('change', function(event) {\n                        var element = row.down('[name^=\"shipping[cost_mode]\"]');\n\n                        if (!isAttributeMode(element)) {\n                            return;\n                        }\n\n                        EbayTemplateShippingObj.checkMessages(type);\n                    });\n                }\n            }\n            // ---------------------------------------\n\n            return row;\n        },\n\n        // ---------------------------------------\n\n        initRow: function(row)\n        {\n            var locationType = /local/.test(row.id) ? 'local' : 'international';\n\n            // ---------------------------------------\n            if (EbayTemplateShippingObj.isShippingModeCalculated(locationType)) {\n                row.select('.cost-mode')[0].value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CALCULATED');\n                row.select('.shipping-mode-option-notcalc').invoke('remove');\n\n                if (locationType == 'international' || $$('#shipping_local_tbody .cost-mode').length > 1) {\n                    // only one calculated shipping method can have free mode\n                    row.select('.shipping-mode-option-free').invoke('remove');\n                }\n            } else {\n                row.select('.cost-mode')[0].value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_FREE');\n                row.select('.shipping-mode-option-calc')[0].remove();\n            }\n            // ---------------------------------------\n\n            // ---------------------------------------\n            EbayTemplateShippingObj.renderServices(row.select('.shipping-service')[0], locationType);\n            // ---------------------------------------\n\n            // ---------------------------------------\n            jQuery(row.select('.cost-mode')[0]).trigger('change');\n            jQuery(row.select('.shipping-service')[0]).trigger('change');\n            // ---------------------------------------\n        },\n\n        // ---------------------------------------\n\n        renderServices: function(el, locationType)\n        {\n            var html = '';\n            var isCalculated = EbayTemplateShippingObj.isShippingModeCalculated(locationType);\n            var selectedPackage = $('package_size_value').value;\n            var categoryMethods = '';\n\n            // not selected international shipping service\n            if (locationType == 'international') {\n                html += '<option value=\"\">--</option>';\n            } else {\n                html += '<option value=\"\">'+ M2ePro.translator.translate('Select Shipping Service') +'</option>';\n            }\n\n            if (Object.isArray(EbayTemplateShippingObj.shippingServices) && EbayTemplateShippingObj.shippingServices.length == 0) {\n                $(el).update(html);\n                return;\n            }\n\n            $H(EbayTemplateShippingObj.shippingServices).each(function(category) {\n\n                categoryMethods = '';\n                category.value.methods.each(function(service) {\n                    var isServiceOfSelectedDestination = (locationType == 'local' && service.is_international == 0) || (locationType == 'international' && service.is_international == 1);\n                    var isServiceOfSelectedType = (isCalculated && service.is_calculated == 1) || (! isCalculated && service.is_flat == 1);\n\n                    if (!isServiceOfSelectedDestination || !isServiceOfSelectedType) {\n                        return;\n                    }\n\n                    if (isCalculated) {\n                        if (service.data.ShippingPackage.indexOf(selectedPackage) != -1) {\n                            categoryMethods += '<option value=\"' + service.ebay_id + '\">' + service.title + '</option>';\n                        }\n\n                        return;\n                    }\n\n                    categoryMethods += '<option value=\"' + service.ebay_id + '\">' + service.title + '</option>';\n                });\n\n                if (categoryMethods != '') {\n                    noCategoryTitle = category[0] == '';\n                    if (noCategoryTitle) {\n                        html += categoryMethods;\n                    } else {\n                        if (locationType == 'local') {\n                            html += '<optgroup ebay_id=\"'+category.key+'\" label=\"' + category.value.title + '\">' + categoryMethods + '</optgroup>';\n                        } else {\n                            html += '<optgroup label=\"' + category.value.title + '\">' + categoryMethods + '</optgroup>';\n                        }\n\n                    }\n                }\n            });\n\n            $(el).update(html);\n        },\n\n        // ---------------------------------------\n\n        renderShipToLocationCheckboxes: function(i)\n        {\n            var html = '';\n\n            // ---------------------------------------\n            EbayTemplateShippingObj.shippingLocations.each(function(location) {\n                if (location.ebay_id == 'Worldwide') {\n                    html += '<div style=\"margin-bottom: 10px;\">' +\n                        '<input' +\n                        ' id=\"shipping_shippingLocation_' + location.ebay_id + '_' + i + '\"' +\n                        ' type=\"checkbox\"' +\n                        ' name=\"shipping[shippingLocation][' + i + '][]\" value=\"' + location.ebay_id + '\"' +\n                        ' onclick=\"EbayTemplateShippingObj.shippingLocationChange.call(this);\"' +\n                        ' class=\"shipping-location M2ePro-validate-international-ship-to-location admin__control-checkbox\"' +\n                        '/>' +\n                        '<label ' +\n                        'for=\"shipping_shippingLocation_'+ location.ebay_id + '_' + i + '\"' +\n                        'class=\"admin__field-label\"' +\n                        '>' +\n                        '<span><b>' + location.title + '</b></span>' +\n                        '</label>' +\n                        '</div>';\n                } else {\n                    html +=\n                        '<input' +\n                        ' id=\"shipping_shippingLocation_' + location.ebay_id + '_' + i + '\"' +\n                        ' type=\"checkbox\"' +\n                        ' name=\"shipping[shippingLocation][' + i + '][]\" value=\"' + location.ebay_id + '\"' +\n                        ' onclick=\"EbayTemplateShippingObj.shippingLocationChange.call(this);\"' +\n                        ' class=\"admin__control-checkbox\"' +\n                        '/>' +\n                        '<label style=\"width: 142px; text-align: left; margin-bottom: 5px;\" ' +\n                        'class=\"nobr admin__field-label\"' +\n                        'for=\"shipping_shippingLocation_'+ location.ebay_id + '_' + i + '\"' +\n                        '>' +\n                        '<span>' + location.title + '</span>' +\n                        '</label>';\n                }\n            });\n            // ---------------------------------------\n\n            // ---------------------------------------\n            $$('#shipping_variant_locations_' + i + '_tr td')[0].innerHTML = '<div style=\"margin: 5px 10px\">' + html + '</div>';\n            $$('#shipping_variant_locations_' + i + '_tr td')[0].innerHTML += '<div style=\"clear: both; margin-bottom: 10px;\" />';\n            // ---------------------------------------\n\n            if (!EbayTemplateShippingObj.shippingMethods[i]) {\n                return;\n            }\n\n            // ---------------------------------------\n            var locations = [];\n            EbayTemplateShippingObj.shippingMethods[i].locations.each(function(item) {\n                locations.push(item);\n            });\n            // ---------------------------------------\n\n            // ---------------------------------------\n            $$('input[name=\"shipping[shippingLocation][' + i + '][]\"]').each(function(el) {\n                if (locations.indexOf(el.value) != -1) {\n                    el.checked = true;\n                }\n                jQuery(el).trigger('change');\n            });\n            // ---------------------------------------\n\n            $$('input[value=\"Worldwide\"]').each(function(element) {\n                EbayTemplateShippingObj.shippingLocationChange.call(element);\n            });\n        },\n\n        // ---------------------------------------\n\n        removeRow: function(locationType)\n        {\n            var table = $(this).up('table');\n\n            if (locationType == 'international') {\n                $(this).up('tr').next().remove();\n            }\n\n            if (EbayTemplateShippingObj.hasSurcharge(locationType)) {\n                var i = $(this).up('tr').id.match(/\\d+/);\n                var next = $(this).up('tr').next('[id=shipping_variant_cost_surcharge_' + i + '_tr]');\n                next && next.remove();\n            }\n\n            $(this).up('tr').remove();\n\n            EbayTemplateShippingObj.counter[locationType]--;\n\n            if (EbayTemplateShippingObj.counter[locationType] == 0) {\n                $('shipping_'+locationType+'_table').hide();\n                $('add_'+locationType+'_shipping_method_button').show();\n            }\n\n            if (locationType == 'local' && EbayTemplateShippingObj.counter[locationType] < 4) {\n                table.select('tfoot')[0].show();\n            }\n            if (locationType == 'international' && EbayTemplateShippingObj.counter[locationType] < 5) {\n                table.select('tfoot')[0].show();\n            }\n\n            EbayTemplateShippingObj.updateMeasurementVisibility();\n        },\n\n        // ---------------------------------------\n\n        hasMissingServiceAttribute: function(code, position)\n        {\n            if (typeof EbayTemplateShippingObj.missingAttributes['services'][position] == 'undefined') {\n                return false;\n            }\n\n            if (typeof EbayTemplateShippingObj.missingAttributes['services'][position][code] == 'undefined') {\n                return false;\n            }\n\n            return true;\n        },\n\n        addMissingServiceAttributeOption: function(select, code, position, value)\n        {\n            var option = document.createElement('option');\n\n            option.value = value;\n            option.innerHTML = EbayTemplateShippingObj.missingAttributes['services'][position][code];\n\n            var first = select.down('.empty').next();\n\n            first.insert({ before: option });\n        },\n\n        renderShippingMethods: function(shippingMethods)\n        {\n            if (shippingMethods.length > 0) {\n                $('shipping_local_table').show();\n                $('add_local_shipping_method_button').hide();\n            } else {\n                $('shipping_local_table').hide();\n                $('add_local_shipping_method_button').show();\n            }\n\n            shippingMethods.each(function(service, i) {\n\n                var type = service.shipping_type == 1 ? 'international' : 'local';\n                var row = EbayTemplateShippingObj.addRow(type);\n                var surchargeRow = $('shipping_variant_cost_surcharge_' + i + '_tr');\n\n                row.down('.shipping-service').value = service.shipping_value;\n                row.down('.cost-mode').value = service.cost_mode;\n\n                if (service.cost_mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CUSTOM_VALUE')) {\n                    row.down('.shipping-cost-cv').value = service.cost_value;\n                    row.down('.shipping-cost-additional').value = service.cost_additional_value;\n\n                    if (surchargeRow) {\n                        surchargeRow.down('.shipping-cost-surcharge').value = service.cost_surcharge_value;\n                    }\n\n                } else if (service.cost_mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\Shipping\\\\Service::COST_MODE_CUSTOM_ATTRIBUTE')) {\n                    if (EbayTemplateShippingObj.hasMissingServiceAttribute('cost_value', i)) {\n                        EbayTemplateShippingObj.addMissingServiceAttributeOption(\n                            row.down('.shipping-cost-ca select'), 'cost_value', i, service.cost_value\n                        );\n                    }\n\n                    if (EbayTemplateShippingObj.hasMissingServiceAttribute('cost_additional_value', i)) {\n                        EbayTemplateShippingObj.addMissingServiceAttributeOption(\n                            row.down('.shipping-cost-additional-ca select'), 'cost_additional_value', i, service.cost_additional_value\n                        );\n                    }\n\n                    row.down('.shipping-cost-ca select').value = service.cost_value;\n                    row.down('.shipping-cost-additional-ca select').value = service.cost_additional_value;\n\n                    if (surchargeRow) {\n                        surchargeRow.down('.shipping-cost-surcharge-ca select').value = service.cost_surcharge_value;\n                    }\n\n                }\n\n                row.down('.shipping-priority').value = service.priority;\n                jQuery(row.down('.cost-mode')).trigger('change');\n                jQuery(row.down('.shipping-service')).trigger('change');\n            });\n        },\n\n        replaceSelectWithInputHidden: function(select)\n        {\n            var td = select.up('td');\n            var label = select.options[select.selectedIndex].innerHTML;\n            var input = '<input type=\"hidden\" ' +\n                'name=\"' + select.name + '\" ' +\n                'id=\"' + select.id + '\" ' +\n                'value=\"' + select.value + '\" ' +\n                'class=\"' + select.className + '\" />';\n\n            $(select).replace('');\n            $(td).insert('<span>' + label + input + '</span>');\n\n            if (td.down('.cost-mode')) {\n                td.down('.cost-mode').observe('change', EbayTemplateShippingObj.serviceCostModeChange);\n            }\n        },\n\n        // ---------------------------------------\n\n        initExcludeListPopup: function()\n        {\n            var element = jQuery('#magento_block_ebay_template_shipping_form_data_exclude_locations_popup');\n\n            modal({\n                title: M2ePro.translator.translate('Excluded Shipping Locations'),\n                type: 'slide',\n                buttons: [{\n                    text: M2ePro.translator.translate('Cancel'),\n                    click: function () {\n                        element.modal('closeModal');\n                    }\n                },{\n                    text: M2ePro.translator.translate('Save'),\n                    class: 'action-primary',\n                    id: 'save_popup_button',\n                    click: function () {\n                        EbayTemplateShippingObj.saveExcludeLocationsList();\n                        element.modal('closeModal');\n                    }\n                }]\n            }, element);\n        },\n\n        showExcludeListPopup: function()\n        {\n            var self = EbayTemplateShippingObj;\n\n            self.updatePopupData();\n            self.checkExcludeLocationSelection();\n\n            self.afterInitPopupActions();\n\n            jQuery('#magento_block_ebay_template_shipping_form_data_exclude_locations_popup').modal('openModal');\n        },\n\n        // ---------------------------------------\n\n        updatePopupData: function()\n        {\n            $('excluded_locations_popup_hidden').value = $('excluded_locations_hidden').value;\n            EbayTemplateShippingObj.updateExcludedLocationsTitles();\n        },\n\n        checkExcludeLocationSelection: function()\n        {\n            var self = EbayTemplateShippingObj,\n                excludedLocations = $('excluded_locations_popup_hidden').value.evalJSON();\n\n            $$('.shipping_excluded_location').each(function(el) { el.checked = 0; });\n\n            $$('.shipping_excluded_location').each(function(el) {\n\n                for (var i = 0; i < excludedLocations.length; i++) {\n                    if (excludedLocations[i]['code'] == el.value) {\n                        el.checked = 1;\n                        el.hasClassName('shipping_excluded_region') && self.selectExcludedLocationAllRegion(el.value, 1);\n                    }\n                }\n            });\n\n            EbayTemplateShippingObj.updateExcludedLocationsSelectedRegions();\n        },\n\n        selectExcludedLocationAllRegion: function(regionCode, checkBoxState)\n        {\n            $$('div[id=\"shipping_excluded_location_international_region_' + regionCode + '\"] .shipping_excluded_location').each(function(el) {\n                el.checked = checkBoxState;\n            });\n        },\n\n        afterInitPopupActions: function()\n        {\n            var firstNavigationLink = $$('.shipping_excluded_location_region_link').shift();\n            firstNavigationLink && jQuery(firstNavigationLink).trigger('click');\n\n            EbayTemplateShippingObj.isInternationalShippingModeNoInternational()\n                ? $('exclude_locations_popup_international').hide()\n                : $('exclude_locations_popup_international').show();\n\n            EbayTemplateShippingObj.updatePopupSizes();\n        },\n\n        updatePopupSizes: function()\n        {\n            var popupHeight = '445px',\n                popupGeneralContentMinHeight = '380px';\n\n            if (EbayTemplateShippingObj.isInternationalShippingModeNoInternational()) {\n                popupHeight = '280px';\n                popupGeneralContentMinHeight = '200px';\n            }\n\n            $('excluded_locations_popup_content_general').setStyle({ 'min-height': popupGeneralContentMinHeight });\n\n            if ($('exclude_locations_international_regions')) {\n                var standartRegionHeight = $('exclude_locations_international_regions').getHeight();\n                $('exclude_locations_international_locations').setStyle({ 'height': standartRegionHeight + 'px' });\n            }\n        },\n\n        // ---------------------------------------\n\n        saveExcludeLocationsList: function()\n        {\n            var title          = $('excluded_locations_popup_titles').innerHTML,\n                titleContainer = $('excluded_locations_titles');\n\n            title == M2ePro.translator.translate('None')\n                ? titleContainer.innerHTML = M2ePro.translator.translate('No Locations are currently excluded.')\n                : titleContainer.innerHTML = title;\n\n            $('excluded_locations_hidden').value = $('excluded_locations_popup_hidden').value;\n        },\n\n        resetExcludeLocationsList: function(window)\n        {\n            window = window || 'general';\n\n            if (window == 'general') {\n                $('excluded_locations_hidden').value = '[]';\n                $('excluded_locations_titles').innerHTML = M2ePro.translator.translate('No Locations are currently excluded.');\n                return;\n            }\n\n            $('excluded_locations_popup_hidden').value = '[]';\n            EbayTemplateShippingObj.updateExcludedLocationsTitles();\n            EbayTemplateShippingObj.checkExcludeLocationSelection();\n        },\n\n        // ---------------------------------------\n\n        selectExcludeLocation: function()\n        {\n            EbayTemplateShippingObj.updateExcludedLocationsHiddenInput(this);\n            EbayTemplateShippingObj.updateExcludedLocationsTitles();\n            EbayTemplateShippingObj.updateExcludedLocationsSelectedRegions();\n        },\n\n        updateExcludedLocationsHiddenInput: function(element)\n        {\n            var self = EbayTemplateShippingObj,\n                asia = $('shipping_excluded_location_international_Asia');\n\n            if (element.hasClassName('shipping_excluded_region')) {\n\n                element.checked\n                    ? self.processRegionWasSelected(element) : self.processRegionWasDeselected(element);\n\n                self.processRelatedRegions(element);\n\n            } else {\n\n                element.checked\n                    ? self.processOneLocationWasSelected(element) : self.processOneLocationWasDeselected(element);\n\n                if (self.isChildAsiaRegion(element.getAttribute('region'))) {\n                    self.processAsiaChildRegion(element);\n                }\n            }\n\n            if (self.isAllLocationsOfAsiaAreSelected() && !asia.checked) {\n                asia.checked = 1;\n                self.processRegionWasSelected($(asia));\n            }\n        },\n\n        // ---------------------------------------\n\n        processRegionWasSelected: function(regionCheckBox)\n        {\n            var self = EbayTemplateShippingObj,\n\n                code   = regionCheckBox.value,\n                title  = regionCheckBox.next().innerHTML,\n                region = regionCheckBox.getAttribute('region'),\n                type   = regionCheckBox.getAttribute('location_type');\n\n            self.selectExcludedLocationAllRegion(code, 1);\n            self.deleteExcludedLocation(code, 'region');\n            self.addExcludedLocation(code, title, region, type);\n        },\n\n        processRegionWasDeselected: function(regionCheckBox)\n        {\n            var self = EbayTemplateShippingObj,\n                code = regionCheckBox.value;\n\n            self.selectExcludedLocationAllRegion(code, 0);\n            self.deleteExcludedLocation(code);\n        },\n\n        processRelatedRegions: function(regionCheckBox)\n        {\n            var self = EbayTemplateShippingObj;\n\n            if (self.isAsiaRegion(regionCheckBox.value)) {\n                self.processAsiaRegion(regionCheckBox);\n            }\n\n            if (self.isChildAsiaRegion(regionCheckBox.value)) {\n                self.processAsiaChildRegion(regionCheckBox);\n            }\n        },\n\n        processAsiaRegion: function(regionCheckBox)\n        {\n            var self = EbayTemplateShippingObj;\n\n            var middleEast = $('shipping_excluded_location_international_Middle East'),\n                southeastAsia = $('shipping_excluded_location_international_Southeast Asia');\n\n            if (regionCheckBox.checked) {\n\n                if (!middleEast.checked) {\n                    middleEast.checked = 1;\n                    self.processRegionWasSelected(middleEast);\n                }\n\n                if (!southeastAsia.checked) {\n                    southeastAsia.checked = 1;\n                    self.processRegionWasSelected(southeastAsia);\n                }\n\n                return;\n            }\n\n            middleEast.checked = 0;\n            southeastAsia.checked = 0;\n\n            self.processRegionWasDeselected(middleEast);\n            self.processRegionWasDeselected(southeastAsia);\n        },\n\n        processAsiaChildRegion: function(regionCheckBox)\n        {\n            var self = EbayTemplateShippingObj,\n                asia = $('shipping_excluded_location_international_Asia');\n\n            if (!regionCheckBox.checked && asia.checked) {\n\n                var code = asia.value;\n\n                asia.checked = 0;\n                self.deleteExcludedLocation(code, 'code');\n\n                $$('div[id=\"shipping_excluded_location_international_region_' + code + '\"] .shipping_excluded_location').each(function(el) {\n                    el.checked = 1;\n                    self.addExcludedLocation(el.value, el.next().innerHTML, el.getAttribute('region'), el.getAttribute('type'));\n                });\n            }\n        },\n\n        processOneLocationWasSelected: function(locationCheckBox)\n        {\n            var self = EbayTemplateShippingObj,\n\n                code   = locationCheckBox.value,\n                title  = locationCheckBox.next().innerHTML,\n                region = locationCheckBox.getAttribute('region'),\n                type   = locationCheckBox.getAttribute('location_type');\n\n            self.addExcludedLocation(code, title, region, type);\n\n            if (!self.isAllLocationsOfRegionAreSelected(region)) {\n                return;\n            }\n\n            if (self.isAsiaRegion(region) && !self.isAllLocationsOfAsiaAreSelected()) {\n                return;\n            }\n\n            var regionTitle = $('shipping_excluded_location_international_' + region).next('label').innerHTML;\n\n            $('shipping_excluded_location_international_' + region).checked = 1;\n            self.deleteExcludedLocation(region, 'region');\n            self.addExcludedLocation(region, regionTitle, null, type);\n        },\n\n        processOneLocationWasDeselected: function(locationCheckBox)\n        {\n            var self = EbayTemplateShippingObj,\n\n                code   = locationCheckBox.value,\n                region = locationCheckBox.getAttribute('region'),\n                type   = locationCheckBox.getAttribute('location_type');\n\n            self.deleteExcludedLocation(code);\n\n            if (region == null) {\n                return;\n            }\n\n            self.deleteExcludedLocation(region);\n            self.deleteExcludedLocation(region, 'region');\n\n            $('shipping_excluded_location_international_' + region).checked = 0;\n\n            var result = self.getLocationsByRegion(region);\n            result['locations'].each(function(el) {\n                self.addExcludedLocation(el.value, el.next().innerHTML, region, type);\n            });\n        },\n\n        // ---------------------------------------\n\n        updateExcludedLocationsTitles: function(sourse)\n        {\n            sourse = sourse || 'excluded_locations_popup_titles';\n\n            var excludedLocations = $(sourse.replace('titles','hidden')).value.evalJSON(),\n                title = sourse == 'excluded_locations_popup_titles'\n                    ? M2ePro.translator.translate('None')\n                    : M2ePro.translator.translate('No Locations are currently excluded.');\n\n            if (excludedLocations.length) {\n\n                title = [];\n\n                excludedLocations.each(function(location) {\n                    var currentTitle = EbayTemplateShippingObj.isRootLocation(location)\n                        ? '<b>' + location['title'] + '</b>' : location['title'];\n                    title.push(currentTitle);\n                });\n\n                title = title.join(', ');\n            }\n\n            $('excluded_locations_reset_link').show();\n            if (sourse == 'excluded_locations_popup_titles' && title == M2ePro.translator.translate('None')) {\n                $('excluded_locations_reset_link').hide()\n            }\n\n            $(sourse).innerHTML = title;\n        },\n\n        updateExcludedLocationsSelectedRegions: function()\n        {\n            $$('.shipping_excluded_location_region_link').each(function(el) {\n\n                var locations = EbayTemplateShippingObj.getLocationsByRegion(el.getAttribute('region'));\n\n                el.removeClassName('have_selected_locations');\n//            if (locations['total'] != locations['selected'] && locations['selected'] > 0) {\n                if (locations['selected'] > 0 && !el.children[0].checked) {\n                    el.addClassName('have_selected_locations');\n                    el.down('span', 1).innerHTML = '(' + locations['selected'] + ' ' + M2ePro.translator.translate('selected') + ')';\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        getLocationsByRegion: function(regionCode)\n        {\n            if (regionCode == null) {\n                return false;\n            }\n\n            var totalCount    = 0,\n                selectedLocations = [];\n\n            $$('div[id=\"shipping_excluded_location_international_region_' + regionCode + '\"] .shipping_excluded_location').each(function(el) {\n                totalCount ++;\n                el.checked && selectedLocations.push(el);\n            });\n\n            return {total: totalCount, selected: selectedLocations.length, locations: selectedLocations};\n        },\n\n        isAllLocationsOfRegionAreSelected: function(regionCode)\n        {\n            var locations = EbayTemplateShippingObj.getLocationsByRegion(regionCode);\n\n            if (!locations) {\n                return false;\n            }\n\n            return locations['total'] == locations['selected'];\n        },\n\n        isAllLocationsOfAsiaAreSelected: function()\n        {\n            var asiaLocations = EbayTemplateShippingObj.getLocationsByRegion('Asia'),\n                eastLocations = EbayTemplateShippingObj.getLocationsByRegion('Middle East'),\n                southLocations = EbayTemplateShippingObj.getLocationsByRegion('Southeast Asia');\n\n            if (!asiaLocations || !eastLocations || !southLocations) {\n                return false;\n            }\n\n            return asiaLocations['total'] == asiaLocations['selected'] &&\n                eastLocations['total'] == eastLocations['selected'] &&\n                southLocations['total'] == southLocations['selected'];\n        },\n\n        isRootLocation: function(location)\n        {\n            return !!(location['region'] == null);\n        },\n\n        isAsiaRegion: function(location)\n        {\n            return location == 'Asia';\n        },\n\n        isChildAsiaRegion: function(location)\n        {\n            return location == 'Middle East' || location == 'Southeast Asia';\n        },\n\n        // ---------------------------------------\n\n        addExcludedLocation: function(code, title, region, type, sourse)\n        {\n            sourse = sourse || 'excluded_locations_popup_hidden';\n\n            var excludedLocations = $(sourse).value.evalJSON();\n            var item = {\n                code: code,\n                title: title,\n                region: region,\n                type: type\n            };\n\n            excludedLocations.push(item);\n            $(sourse).value = Object.toJSON(excludedLocations);\n        },\n\n        deleteExcludedLocation: function(code, key, sourse)\n        {\n            key = key || 'code';\n            sourse = sourse || 'excluded_locations_popup_hidden';\n\n            var excludedLocations  = $(sourse).value.evalJSON(),\n                resultAfterDelete  = [];\n\n            for (var i = 0; i < excludedLocations.length; i++) {\n                if (excludedLocations[i][key] != code) {\n                    resultAfterDelete.push(excludedLocations[i]);\n                }\n            }\n            $(sourse).value = Object.toJSON(resultAfterDelete);\n        },\n\n        // ---------------------------------------\n\n        checkExcludeLocationsRegionsSelection: function()\n        {\n            $$('.shipping_excluded_location_region').invoke('hide');\n            $$('.shipping_excluded_location_region_link').invoke('removeClassName','selected_region');\n\n            $('shipping_excluded_location_international_region_' + this.getAttribute('region')).show();\n            this.addClassName('selected_region');\n        },\n\n        // ---------------------------------------\n\n        updatePackageBlockState: function()\n        {\n            if (this.isLocalShippingModeCalculated() || this.isInternationalShippingModeCalculated()) {\n                this.setCalculatedPackageBlockState();\n                return;\n            }\n\n            if (this.isClickAndCollectEnabled() &&\n                (this.isLocalShippingModeFlat() || this.isLocalShippingModeCalculated()) &&\n                $('dispatch_time').value <= 3\n            ) {\n                this.setClickAndCollectPackageBlockState();\n                return;\n            }\n\n            if (this.isRateTableEnabled()) {\n                this.setRateTablePackageBlockState();\n                return;\n            }\n\n            this.setNonePackageBlockState();\n        },\n\n        setCalculatedPackageBlockState: function()\n        {\n            $('magento_block_ebay_template_shipping_form_data_calculated-wrapper').show();\n\n            var dimensionsTr = $('dimensions_tr');\n            var dimensionSelect = $('dimension_mode');\n            if (dimensionsTr) {\n                dimensionsTr.show();\n                jQuery(dimensionSelect).trigger('change');\n            }\n\n            var packageSizeTr = $('package_size_tr');\n            var packageSizeSelect = $('package_size');\n            if (packageSizeTr) {\n                packageSizeTr.show();\n                jQuery(packageSizeSelect).trigger('change');\n            }\n\n            var weightTr = $('weight_tr');\n            var weightSelect = $('weight');\n            if (weightTr) {\n                if ($('weight').selectedIndex == 0) {\n                    $('weight').selectedIndex = 1;\n                }\n\n                weightTr.show();\n                $('weight_mode_none').hide();\n                jQuery(weightSelect).trigger('change');\n            }\n        },\n\n        setRateTablePackageBlockState: function()\n        {\n            $('magento_block_ebay_template_shipping_form_data_calculated-wrapper').show();\n\n            var dimensionsTr = $('dimensions_tr');\n            var dimensionSelect = $('dimension_mode');\n            if (dimensionsTr) {\n                dimensionsTr.hide();\n                dimensionSelect.selectedIndex = 0;\n                jQuery(dimensionSelect).trigger('change');\n            }\n\n            var packageSizeTr = $('package_size_tr');\n            var packageSizeSelect = $('package_size');\n            if (packageSizeTr) {\n                packageSizeTr.hide();\n                packageSizeSelect.selectedIndex = 0;\n                jQuery(packageSizeSelect).trigger('change');\n            }\n\n            var weightTr = $('weight_tr');\n            var weightSelect = $('weight');\n            if (weightTr) {\n                weightTr.show();\n                $('weight_mode_none').show();\n                jQuery(weightSelect).trigger('change');\n            }\n        },\n\n        setClickAndCollectPackageBlockState: function()\n        {\n            $('magento_block_ebay_template_shipping_form_data_calculated-wrapper').show();\n\n            var dimensionsTr = $('dimensions_tr');\n            var dimensionSelect = $('dimension_mode');\n            if (dimensionsTr) {\n                dimensionsTr.show();\n                jQuery(dimensionSelect).trigger('change');\n            }\n\n            var packageSizeTr = $('package_size_tr');\n            var packageSizeSelect = $('package_size');\n            if (packageSizeTr) {\n                packageSizeTr.hide();\n                packageSizeSelect.selectedIndex = 0;\n                jQuery(packageSizeSelect).trigger('change');\n            }\n\n            var weightTr = $('weight_tr');\n            var weightSelect = $('weight');\n            if (weightTr) {\n                weightTr.show();\n                $('weight_mode_none').show();\n                jQuery(weightSelect).trigger('change');\n            }\n        },\n\n        setNonePackageBlockState: function()\n        {\n            $('magento_block_ebay_template_shipping_form_data_calculated-wrapper').hide();\n\n            var dimensionsTr = $('dimensions_tr');\n            var dimensionSelect = $('dimension_mode');\n            if (dimensionsTr) {\n                dimensionSelect.selectedIndex = 0;\n                jQuery(dimensionSelect).trigger('change');\n            }\n\n            var weightTr = $('weight_tr');\n            var weightSelect = $('weight');\n            if (weightTr) {\n                weightSelect.selectedIndex = 0;\n                jQuery(weightSelect).trigger('change');\n            }\n        },\n\n        // ---------------------------------------\n\n        checkMessages: function(type)\n        {\n            if (typeof EbayListingTemplateSwitcherObj == 'undefined') {\n                // not inside template switcher\n                return;\n            }\n\n            var container, excludeTable, data, formElements = Form.getElements('template_shipping_data_container');\n\n            if (type == 'local') {\n                container = 'shipping_local_table_messages';\n                excludeTable = $('shipping_international_table');\n\n                formElements = formElements.map(function (element) {\n\n                    if (element.up('table') == excludeTable) {\n                        return false;\n                    }\n\n                    return element;\n                }).filter(function(el) { return el; });\n\n                data = Form.serializeElements(formElements);\n\n            } else if (type == 'international') {\n                container = 'shipping_international_table_messages';\n                excludeTable = $('shipping_local_table');\n\n                formElements = formElements.map(function (element) {\n\n                    if (element.up('table') == excludeTable) {\n                        return false;\n                    }\n\n                    return element;\n                }).filter(function(el) { return el; });\n\n                data = Form.serializeElements(formElements);\n\n            } else {\n                return;\n            }\n\n            var id = '',\n                nick = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SHIPPING'),\n                storeId = EbayListingTemplateSwitcherObj.storeId,\n                marketplaceId = EbayListingTemplateSwitcherObj.marketplaceId,\n                checkAttributesAvailability = false,\n                callback = function() {\n                    var refresh = $(container).down('a.refresh-messages');\n                    if (refresh) {\n                        refresh.observe('click', function() {\n                            this.checkMessages();\n                        }.bind(this))\n                    }\n                }.bind(this);\n\n            TemplateHandlerObj.checkMessages(\n                id,\n                nick,\n                data,\n                storeId,\n                marketplaceId,\n                checkAttributesAvailability,\n                container,\n                callback\n            );\n        },\n\n        clearMessages: function(type)\n        {\n            if (typeof EbayListingTemplateSwitcherObj == 'undefined') {\n                // not inside template switcher\n                return;\n            }\n\n            var container = type == 'local' ? 'shipping_local_table_messages' : 'shipping_international_table_messages';\n            $(container).innerHTML = '';\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Template/ReturnPolicy.js":"define([\n    'knockout',\n    'jquery',\n    'M2ePro/Common'\n], function (ko, jquery) {\n    window.EbayTemplateReturnPolicy = Class.create(Common, {\n\n        // ---------------------------------------\n\n        initialize: function() {},\n\n        // ---------------------------------------\n\n        initObservers: function() {\n            jquery('#return_accepted').off('change');\n            jquery('#return_accepted').on('change', this.acceptedChange).change();\n        },\n\n        // ---------------------------------------\n\n        acceptedChange: function()\n        {\n            var columns = [\n                'return_option',\n                'return_within',\n                'return_shipping_cost',\n                'return_restocking_fee'\n            ];\n\n            if (this.value == 'ReturnsAccepted') {\n                columns.forEach(function(value) {\n                    var el = $$('.field-'+value).first();\n                    el && el[$(value).options.length ? 'show' : 'hide']();\n                });\n                $$('.field-return_description').invoke('show');\n\n                if ($$('.field-return_holiday_mode').length) {\n                    $$('.field-return_holiday_mode').invoke('show');\n                }\n            } else {\n                columns.forEach(function(value) {\n                    var el = $$('.field-'+value).first();\n                    el && el.hide();\n                });\n\n                $$('.field-return_description').invoke('hide');\n                $$('.field-return_holiday').invoke('hide');\n\n                //$('return_holiday_mode').selectedIndex = 0;\n                //jquery('#return_holiday_mode').trigger('change');\n                $$('.field-return_holiday_mode').invoke('hide');\n            }\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Template/Synchronization.js":"define([\r\n    'M2ePro/Common',\r\n    'Magento_Ui/js/modal/confirm'\r\n], function () {\r\n\r\n    window.EbayTemplateSynchronization = Class.create(Common, {\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            var self = this;\r\n            jQuery.validator.addMethod('M2ePro-validate-qty', function(value, el) {\r\n\r\n                if (self.isElementHiddenFromPage(el)) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.match(/[^\\d]+/g) || value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Wrong value. Only integer numbers.'));\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-conditions-between', function(value, el) {\r\n\r\n                var minValue = $(el.id.replace('_max','')).value;\r\n\r\n                if (!el.up('.admin__field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                return parseInt(value) > parseInt(minValue);\r\n            }, M2ePro.translator.translate('Must be greater than \"Min\".'));\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-product-status', function(value, el) {\r\n\r\n                if (EbayTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('stop_status_disabled').value == 1 && $('relist_status_enabled').value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-stock-availability', function(value, el) {\r\n\r\n                if (EbayTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('stop_out_off_stock').value == 1 && $('relist_is_in_stock').value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            },  M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-item-qty', function(value, el) {\r\n\r\n                if (EbayTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                var stopMaxQty = 0,\r\n                    relistMinQty = 0;\r\n\r\n                var qtyType = el.getAttribute('qty_type');\r\n\r\n                switch (parseInt($('stop_qty_' + qtyType).value)) {\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::STOP_QTY_NONE'):\r\n                        return true;\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::STOP_QTY_LESS'):\r\n                        stopMaxQty = parseInt($('stop_qty_' + qtyType + '_value').value);\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::STOP_QTY_BETWEEN'):\r\n                        stopMaxQty = parseInt($('stop_qty_' + qtyType + '_value_max').value);\r\n                        break;\r\n                }\r\n\r\n                switch (parseInt($('relist_qty_' + qtyType).value)) {\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_QTY_NONE'):\r\n                        return false;\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_QTY_MORE'):\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_QTY_BETWEEN'):\r\n                        relistMinQty = parseInt($('relist_qty_' + qtyType + '_value').value);\r\n                        break;\r\n                }\r\n\r\n                if (relistMinQty <= stopMaxQty) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-interval-date', function(value, el) {\r\n\r\n                if (!el.up('tr').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                return el.value.match('^[0-9]{4}-[0-9]{2}-[0-9]{1,2}$');\r\n            }, M2ePro.translator.translate('Wrong value.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-week-days', function(value, el) {\r\n\r\n                var countOfCheckedDays = 0;\r\n\r\n                if (!EbayTemplateSynchronizationObj.isScheduleModeEnabled()) {\r\n                    return true;\r\n                }\r\n\r\n                $$('.schedule_week_day_mode').each(function(el) {\r\n                    el.checked && countOfCheckedDays++;\r\n                });\r\n\r\n                return countOfCheckedDays > 0;\r\n            }, M2ePro.translator.translate('You need to choose at set at least one time for the schedule to run.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-selected-schedule-time', function(value, el) {\r\n\r\n                var countUnselectedControls = 0;\r\n\r\n                if (!EbayTemplateSynchronizationObj.isScheduleModeEnabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if (!el.up('tr').select('.schedule_week_day_mode').shift().checked) {\r\n                    return true;\r\n                }\r\n\r\n                el.up('td').select('select').each(function(el) {\r\n                    el.value == '' && countUnselectedControls++;\r\n                });\r\n\r\n                return countUnselectedControls == 0;\r\n            }, M2ePro.translator.translate('You should specify time.'));\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-wrong-interval-date', function(value, el) {\r\n\r\n                if (!el.up('tr').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                var fromDate = new Date($('schedule_interval_date_from').value),\r\n                    toDate   = new Date(value);\r\n\r\n                return (toDate - fromDate) >= 0;\r\n            }, M2ePro.translator.translate('Must be greater than \"Active From\" Date.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-schedule-wrong-interval-time', function(value, el) {\r\n\r\n                if (!EbayTemplateSynchronizationObj.isScheduleModeEnabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if (!el.up('tr').select('.schedule_week_day_mode').shift().checked) {\r\n                    return true;\r\n                }\r\n\r\n                var now      = new Date(),\r\n                    fromTime = new Date(now.toDateString() + ' ' + $(el.id.replace('validator_to','from')).value),\r\n                    toTime   = new Date(now.toDateString() + ' ' + $(el.id.replace('validator_to','to')).value);\r\n\r\n                return (toTime - fromTime) > 0;\r\n            }, M2ePro.translator.translate('Must be greater than \"From Time\".'));\r\n            // ---------------------------------------\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            //list\r\n            $('list_mode').observe('change', EbayTemplateSynchronizationObj.listMode_change).simulate('change');\r\n            $('list_qty_magento').observe('change', EbayTemplateSynchronizationObj.listQty_change).simulate('change');\r\n            $('list_qty_calculated').observe('change', EbayTemplateSynchronizationObj.listQty_change).simulate('change');\r\n            $('list_advanced_rules_mode').observe('change', EbayTemplateSynchronizationObj.listAdvancedRules_change).simulate('change');\r\n\r\n            //relist\r\n            $('relist_mode').observe('change', EbayTemplateSynchronizationObj.relistMode_change).simulate('change');\r\n            $('relist_qty_magento').observe('change', EbayTemplateSynchronizationObj.relistQty_change).simulate('change');\r\n            $('relist_qty_calculated').observe('change', EbayTemplateSynchronizationObj.relistQty_change).simulate('change');\r\n            $('relist_advanced_rules_mode').observe('change', EbayTemplateSynchronizationObj.relistAdvancedRules_change).simulate('change');\r\n\r\n            //revise\r\n            $('revise_update_qty').observe('change', EbayTemplateSynchronizationObj.reviseQty_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_qty_max_applied_value_mode').observe('change', EbayTemplateSynchronizationObj.reviseQtyMaxAppliedValueMode_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_price').observe('change', EbayTemplateSynchronizationObj.revisePrice_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_price_max_allowed_deviation_mode').observe('change', EbayTemplateSynchronizationObj.revisePriceMaxAllowedDeviationMode_change)\r\n                .simulate('change');\r\n\r\n            //stop\r\n            $('stop_qty_magento').observe('change', EbayTemplateSynchronizationObj.stopQty_change).simulate('change');\r\n            $('stop_qty_calculated').observe('change', EbayTemplateSynchronizationObj.stopQty_change).simulate('change');\r\n            $('stop_advanced_rules_mode').observe('change', EbayTemplateSynchronizationObj.stopAdvancedRules_change).simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isRelistModeDisabled: function()\r\n        {\r\n            return $('relist_mode').value == 0;\r\n        },\r\n\r\n        isScheduleModeEnabled: function()\r\n        {\r\n            return $('schedule_mode').value == 1;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        listMode_change: function()\r\n        {\r\n            var rulesContainer         = $('magento_block_ebay_template_synchronization_form_data_list_rules'),\r\n                advancedRulesContainer = $('magento_block_ebay_template_synchronization_list_advanced_filters');\r\n\r\n            rulesContainer.hide();\r\n            advancedRulesContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::LIST_MODE_YES')) {\r\n                rulesContainer.show();\r\n                advancedRulesContainer.show();\r\n            }\r\n        },\r\n\r\n        listQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('list_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('list_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::LIST_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::LIST_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::LIST_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        listAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('list_advanced_rules_filters_container'),\r\n                warningContainer = $('list_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reviseQty_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::REVISE_UPDATE_QTY_YES')) {\r\n                $('revise_update_qty_max_applied_value_mode_tr').show();\r\n                $('revise_update_qty_max_applied_value_line_tr').show();\r\n                $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n            } else {\r\n                $('revise_update_qty_max_applied_value_mode_tr').hide();\r\n                $('revise_update_qty_max_applied_value_line_tr').hide();\r\n                $('revise_update_qty_max_applied_value_tr').hide();\r\n                $('revise_update_qty_max_applied_value_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::REVISE_MAX_AFFECTED_QTY_MODE_OFF');\r\n            }\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueMode_change: function(event)\r\n        {\r\n            var self = EbayTemplateSynchronizationObj;\r\n\r\n            $('revise_update_qty_max_applied_value_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::REVISE_MAX_AFFECTED_QTY_MODE_ON')) {\r\n                $('revise_update_qty_max_applied_value_tr').show();\r\n            } else if(!event.cancelable) {\r\n                self.openReviseMaxAppliedQtyDisableConfirmationPopUp();\r\n            }\r\n        },\r\n\r\n        openReviseMaxAppliedQtyDisableConfirmationPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            var element = jQuery('#revise_qty_max_applied_value_confirmation_popup_template').clone();\r\n\r\n            element.confirm({\r\n                title: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: self.reviseQtyMaxAppliedValueDisableConfirm,\r\n                    cancel: self.reviseQtyMaxAppliedValueDisableCancel\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }]\r\n            });\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueDisableCancel: function()\r\n        {\r\n            $('revise_update_qty_max_applied_value_mode').selectedIndex = 1;\r\n            $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueDisableConfirm: function()\r\n        {\r\n            $('revise_update_qty_max_applied_value_mode').selectedIndex = 0;\r\n            $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        revisePrice_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::REVISE_UPDATE_PRICE_YES')) {\r\n                $('revise_update_price_max_allowed_deviation_mode_tr').show();\r\n                $('revise_update_price_max_allowed_deviation_tr').show();\r\n                $('revise_update_price_line').show();\r\n                $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n            } else {\r\n                $('revise_update_price_max_allowed_deviation_mode_tr').hide();\r\n                $('revise_update_price_max_allowed_deviation_tr').hide();\r\n                $('revise_update_price_line').hide();\r\n                $('revise_update_price_max_allowed_deviation_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::REVISE_MAX_ALLOWED_PRICE_DEVIATION_MODE_OFF');\r\n            }\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationMode_change: function(event)\r\n        {\r\n            var self = EbayTemplateSynchronizationObj;\r\n\r\n            $('revise_update_price_max_allowed_deviation_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::REVISE_MAX_ALLOWED_PRICE_DEVIATION_MODE_ON')) {\r\n                $('revise_update_price_max_allowed_deviation_tr').show();\r\n            } else if (!event.cancelable) {\r\n                self.openReviseMaxAllowedDeviationPriceDisableConfirmationPopUp();\r\n            }\r\n        },\r\n\r\n        openReviseMaxAllowedDeviationPriceDisableConfirmationPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            var element = jQuery('#revise_price_max_max_allowed_deviation_confirmation_popup_template').clone();\r\n\r\n            element.confirm({\r\n                title: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: self.revisePriceMaxAllowedDeviationDisableConfirm,\r\n                    cancel: self.revisePriceMaxAllowedDeviationDisableCancel\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }]\r\n            });\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationDisableCancel: function()\r\n        {\r\n            $('revise_update_price_max_allowed_deviation_mode').selectedIndex = 1;\r\n            $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationDisableConfirm: function()\r\n        {\r\n            $('revise_update_price_max_allowed_deviation_mode').selectedIndex = 0;\r\n            $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        relistMode_change: function()\r\n        {\r\n            var rulesContainer         = $('magento_block_ebay_template_synchronization_form_data_relist_rules'),\r\n                advancedRulesContainer = $('magento_block_ebay_template_synchronization_relist_advanced_filters'),\r\n                userLockContainer      = $('relist_filter_user_lock_tr_container'),\r\n                sendDataContainer      = $('relist_send_data_tr_container');\r\n\r\n            userLockContainer.hide();\r\n            sendDataContainer.hide();\r\n            rulesContainer.hide();\r\n            advancedRulesContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_MODE_YES')) {\r\n                userLockContainer.show();\r\n                sendDataContainer.show();\r\n                rulesContainer.show();\r\n                advancedRulesContainer.show();\r\n            }\r\n        },\r\n\r\n        relistQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('relist_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('relist_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::RELIST_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        relistAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('relist_advanced_rules_filters_container'),\r\n                warningContainer = $('relist_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        stopQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('stop_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('stop_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::STOP_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::STOP_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Synchronization::STOP_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        stopAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('stop_advanced_rules_filters_container'),\r\n                warningContainer = $('stop_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        scheduleModeChange: function()\r\n        {\r\n            $('schedule_interval_mode_tr','schedule_interval_value_tr',\r\n                'magento_block_ebay_template_synchronization_form_data_schedule_week').invoke('hide');\r\n\r\n            if (this.value == 1) {\r\n                $('schedule_interval_mode_tr','magento_block_ebay_template_synchronization_form_data_schedule_week').invoke('show');\r\n                $('schedule_interval_mode').simulate('change');\r\n            }\r\n        },\r\n\r\n        scheduleIntervalModeChange: function()\r\n        {\r\n            var valueTr = $('schedule_interval_value_tr');\r\n\r\n            valueTr.hide();\r\n            if (EbayTemplateSynchronizationObj.isScheduleModeEnabled() && this.value == 1) {\r\n                valueTr.show();\r\n            }\r\n        },\r\n\r\n        scheduleDayModeChange: function()\r\n        {\r\n            var containerFrom = $(this.id.replace('mode','') + 'container_from'),\r\n                containerTo   = $(this.id.replace('mode','') + 'container_to');\r\n\r\n            containerFrom.hide();\r\n            containerTo.hide();\r\n\r\n            if (this.checked) {\r\n                containerFrom.show();\r\n                containerTo.show();\r\n            }\r\n        },\r\n\r\n        scheduleTimeSelectChange: function()\r\n        {\r\n            var inputId = this.id.match('(.)*(?=_)')[0];\r\n\r\n            var hours   = $(inputId + '_hours').value,\r\n                minutes = $(inputId + '_minutes').value,\r\n                ampm    = $(inputId + '_ampm').value;\r\n\r\n            $(inputId).value =  hours + ':' + minutes + ' ' + ampm;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/SellingFormat.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common'\r\n], function (modal) {\r\n\r\n    window.EbayTemplateSellingFormat = Class.create(Common, {\r\n\r\n        charityIndex: 0,\r\n        charityTpl: '',\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ()\r\n        {\r\n            var self = this;\r\n            jQuery.validator.addMethod('M2ePro-validate-price-coefficient', function (value, el) {\r\n\r\n                var tempEl = el;\r\n\r\n                if (self.isElementHiddenFromPage(el)) {\r\n                    return true;\r\n                }\r\n\r\n                var coefficient = el.up().next().down('input');\r\n\r\n                coefficient.removeClassName('price_unvalidated');\r\n\r\n                if (!coefficient.up('div').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (coefficient.value == '') {\r\n                    return false;\r\n                }\r\n\r\n                var floatValidator = Validation.get('M2ePro-validation-float');\r\n                if (floatValidator.test($F(coefficient), coefficient) && parseFloat(coefficient.value) <= 0) {\r\n                    coefficient.addClassName('price_unvalidated');\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Price Change is not valid.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-qty', function (value, el) {\r\n\r\n                if (self.isElementHiddenFromPage(el)) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.match(/[^\\d]+/g) || value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Wrong value. Only integer numbers.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-vat', function (value) {\r\n\r\n                if (!value) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.length > 6) {\r\n                    return false;\r\n                }\r\n\r\n                if (value < 0) {\r\n                    return false;\r\n                }\r\n\r\n                value = Math.ceil(value);\r\n\r\n                return value >= 0 && value <= 30;\r\n            }, M2ePro.translator.translate('wrong_value_more_than_30'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validation-charity-percentage', function (value, element) {\r\n\r\n                if (value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Please select a percentage of donation'));\r\n\r\n            if ($('charity_row_template')) {\r\n                this.charityTpl = $('charity_row_template').down('tbody').innerHTML;\r\n                $('charity_row_template').remove();\r\n            }\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('listing_type')\r\n                .observe('change', EbayTemplateSellingFormatObj.listing_type_change)\r\n                .simulate('change');\r\n\r\n            $('duration_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.duration_mode_change)\r\n                .simulate('change');\r\n\r\n            $('duration_attribute')\r\n                .observe('change', EbayTemplateSellingFormatObj.duration_attribute_change)\r\n                .simulate('change');\r\n\r\n            $('qty_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.qty_mode_change)\r\n                .simulate('change');\r\n\r\n            $('qty_modification_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.qtyPostedMode_change)\r\n                .simulate('change');\r\n\r\n            if ($('tax_category_mode')) {\r\n                $('tax_category_mode')\r\n                    .observe('change', EbayTemplateSellingFormatObj.taxCategoryChange)\r\n                    .simulate('change');\r\n            }\r\n\r\n            $('fixed_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.fixed_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('start_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.start_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('reserve_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.reserve_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('buyitnow_price_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.buyitnow_price_mode_change)\r\n                .simulate('change');\r\n\r\n            $('price_discount_stp_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.price_discount_stp_mode_change)\r\n                .simulate('change');\r\n\r\n            $('price_discount_map_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.price_discount_map_mode_change)\r\n                .simulate('change');\r\n\r\n            $$('.price_coefficient_mode').each(function(element){\r\n                element.observe('change', EbayTemplateSellingFormatObj.price_coefficient_mode_change)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $('best_offer_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.best_offer_mode_change)\r\n                .simulate('change');\r\n\r\n            $('best_offer_accept_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.best_offer_accept_mode_change)\r\n                .simulate('change');\r\n\r\n            $('best_offer_reject_mode')\r\n                .observe('change', EbayTemplateSellingFormatObj.best_offer_reject_mode_change)\r\n                .simulate('change');\r\n\r\n            EbayTemplateSellingFormatObj.checkPriceMessages();\r\n            $(\r\n                'fixed_price_mode',\r\n                'start_price_mode',\r\n                'reserve_price_mode',\r\n                'buyitnow_price_mode',\r\n                'price_discount_stp_mode',\r\n                'price_discount_map_mode'\r\n            )\r\n                .invoke('observe', 'change', function() {\r\n                    EbayTemplateSellingFormatObj.checkPriceMessages();\r\n                }\r\n            );\r\n\r\n            EbayTemplateSellingFormatObj.checkBestOfferMessages();\r\n            $(\r\n                'best_offer_accept_mode',\r\n                'best_offer_reject_mode'\r\n            )\r\n                .invoke('observe', 'change', function () {\r\n                    EbayTemplateSellingFormatObj.checkBestOfferMessages();\r\n                }\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isStpAvailable: function () {\r\n            return M2ePro.formData.isStpEnabled;\r\n        },\r\n\r\n        isMapAvailable: function () {\r\n            return M2ePro.formData.isMapEnabled;\r\n        },\r\n\r\n        isStpAdvancedAvailable: function () {\r\n            return M2ePro.formData.isStpAdvancedEnabled;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        listing_type_change: function (event) {\r\n            var self = EbayTemplateSellingFormatObj,\r\n\r\n                bestOfferBlock = $('magento_block_ebay_template_selling_format_edit_form_best_offer-wrapper'),\r\n                bestOfferMode = $('best_offer_mode'),\r\n                attributeElement = $('listing_type_attribute');\r\n\r\n            $('fixed_price_tr', 'start_price_tr', 'reserve_price_tr', 'buyitnow_price_tr').invoke('show');\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_FIXED')) {\r\n                $('start_price_tr', 'reserve_price_tr', 'buyitnow_price_tr').invoke('hide');\r\n                $$('#variation_price_tr .value').invoke('show');\r\n            }\r\n\r\n            attributeElement.innerHTML = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n\r\n            bestOfferBlock.show();\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                $('fixed_price_tr').hide();\r\n                bestOfferBlock.hide();\r\n                bestOfferMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_MODE_NO');\r\n                bestOfferMode.simulate('change');\r\n            }\r\n\r\n            self.updateQtyMode();\r\n            self.updateQtyPercentage();\r\n            self.updateIgnoreVariations();\r\n            self.updateListingDuration();\r\n            self.updateFixedPrice();\r\n            self.updatePriceDiscountStpVisibility();\r\n            self.updatePriceDiscountMapVisibility();\r\n            self.updateVariationPriceTrVisibility();\r\n        },\r\n\r\n        duration_mode_change: function () {\r\n            var outOfStockControlTr = $('out_of_stock_control_tr'),\r\n                outOfStockControlMode = $('out_of_stock_control_mode');\r\n\r\n            outOfStockControlTr.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay::LISTING_DURATION_GTC')) {\r\n                outOfStockControlTr.show();\r\n                outOfStockControlMode.value = M2ePro.formData.outOfStockControl;\r\n            } else {\r\n                outOfStockControlMode.value = 0;\r\n            }\r\n        },\r\n\r\n        duration_attribute_change: function () {\r\n            EbayTemplateSellingFormatObj.updateHiddenValue(this, $('listing_duration_attribute_value'));\r\n        },\r\n\r\n        updateQtyMode: function () {\r\n            var qtyMode = $('qty_mode'),\r\n                qtyModeTr = $('qty_mode_tr');\r\n\r\n            qtyModeTr.show();\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                qtyMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_SINGLE');\r\n                qtyMode.simulate('change');\r\n                qtyModeTr.hide();\r\n            }\r\n        },\r\n\r\n        updateQtyPercentage: function () {\r\n            var qtyPercentageTr = $('qty_percentage_tr');\r\n\r\n            qtyPercentageTr.hide();\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                return;\r\n            }\r\n\r\n            var qtyMode = $('qty_mode').value;\r\n\r\n            if (qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_SINGLE') ||\r\n                qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_NUMBER')) {\r\n                return;\r\n            }\r\n\r\n            qtyPercentageTr.show();\r\n        },\r\n\r\n        updateIgnoreVariations: function () {\r\n            var ignoreVariationsValueTr = $('ignore_variations_value_tr'),\r\n                ignoreVariationsValue = $('ignore_variations_value');\r\n\r\n            ignoreVariationsValueTr.hide();\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                ignoreVariationsValue.value = 0;\r\n            } else {\r\n                ignoreVariationsValueTr.show();\r\n            }\r\n        },\r\n\r\n        updateListingDuration: function () {\r\n            var durationMode = $('duration_mode_container'),\r\n                durationModeValue = $('duration_mode'),\r\n                durationAttribute = $('duration_attribute_container'),\r\n                durationAttributeNote = $('duration_attribute_note');\r\n\r\n            var outOfStockControlTr = $('out_of_stock_control_tr'),\r\n                outOfStockControlMode = $('out_of_stock_control_mode');\r\n\r\n            $('durationId1', 'durationId30', 'durationId100').invoke('show');\r\n\r\n            durationMode.show();\r\n            durationAttribute.hide();\r\n            durationAttributeNote.hide();\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_FIXED')) {\r\n\r\n                durationModeValue.value = 3;\r\n\r\n                $('durationId1').hide();\r\n                if (M2ePro.formData.duration_mode && M2ePro.formData.duration_mode != 1) {\r\n                    durationModeValue.value = M2ePro.formData.duration_mode;\r\n                }\r\n\r\n                durationModeValue.simulate('change');\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n\r\n                durationModeValue.value = 3;\r\n\r\n                $('durationId30', 'durationId100').invoke('hide');\r\n                if (M2ePro.formData.duration_mode && M2ePro.formData.duration_mode != 30 && M2ePro.formData.duration_mode != 100) {\r\n                    durationModeValue.value = M2ePro.formData.duration_mode;\r\n                }\r\n\r\n                outOfStockControlTr.hide();\r\n                outOfStockControlMode.value = 0;\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_ATTRIBUTE')) {\r\n                durationMode.hide();\r\n                durationAttribute.show();\r\n                durationAttributeNote.show();\r\n                outOfStockControlTr.hide();\r\n                outOfStockControlMode.value = 0;\r\n            }\r\n        },\r\n\r\n        updateVariationPriceTrVisibility: function () {\r\n            var removeBottomBorderTds = $$('#fixed_price_tr td.remove_bottom_border'),\r\n                addRowspanTds = $$('#fixed_price_tr td.add_rowspan'),\r\n                priceModeSelect = $('fixed_price_mode'),\r\n                variationPriceTr = $('variation_price_tr');\r\n\r\n            variationPriceTr.hide();\r\n            removeBottomBorderTds.invoke('removeClassName', 'bottom_border_disabled');\r\n            addRowspanTds.invoke('removeAttribute', 'rowspan');\r\n\r\n            if ($('listing_type').value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                variationPriceTr.show();\r\n                addRowspanTds.invoke('setAttribute', 'rowspan', '2');\r\n                if (priceModeSelect.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                    removeBottomBorderTds.invoke('addClassName', 'bottom_border_disabled');\r\n                }\r\n            }\r\n        },\r\n\r\n        updateFixedPrice: function () {\r\n            var priceLabel = $('fixed_price_label'),\r\n                bestOfferAcceptPercentageOption = $('best_offer_accept_percentage_option'),\r\n                bestOfferRejectPercentageOption = $('best_offer_reject_percentage_option');\r\n\r\n            priceLabel.innerHTML = M2ePro.translator.translate('Fixed Price') + ': ';\r\n            bestOfferAcceptPercentageOption.innerHTML = M2ePro.translator.translate('% of Fixed Price');\r\n            bestOfferRejectPercentageOption.innerHTML = M2ePro.translator.translate('% of Fixed Price');\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_FIXED')) {\r\n                priceLabel.innerHTML = M2ePro.translator.translate('Price') + ': ';\r\n                bestOfferAcceptPercentageOption.innerHTML = M2ePro.translator.translate('% of Price');\r\n                bestOfferRejectPercentageOption.innerHTML = M2ePro.translator.translate('% of Price');\r\n            }\r\n        },\r\n\r\n        updatePriceDiscountStpVisibility: function () {\r\n            var priceDiscTrStp = $('price_discount_stp_tr'),\r\n                priceDiscStpMode = $('price_discount_stp_mode');\r\n\r\n            priceDiscTrStp.hide();\r\n            if (EbayTemplateSellingFormatObj.isStpAvailable()) {\r\n                priceDiscTrStp.show();\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                priceDiscTrStp.hide();\r\n                priceDiscStpMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE');\r\n                priceDiscStpMode.simulate('change');\r\n            }\r\n        },\r\n\r\n        updatePriceDiscountMapVisibility: function () {\r\n            var priceDiscTrMap = $('price_discount_map_tr'),\r\n                priceDiscMapMode = $('price_discount_map_mode');\r\n\r\n            priceDiscTrMap.hide();\r\n            if (EbayTemplateSellingFormatObj.isMapAvailable()) {\r\n                priceDiscTrMap.show();\r\n            }\r\n\r\n            if ($('listing_type').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                priceDiscTrMap.hide();\r\n                priceDiscMapMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE');\r\n                priceDiscMapMode.simulate('change');\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        qty_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n\r\n                customValueTr = $('qty_mode_cv_tr'),\r\n                attributeElement = $('qty_custom_attribute'),\r\n\r\n                maxPostedValueTr = $('qty_modification_mode_tr'),\r\n                maxPostedValueMode = $('qty_modification_mode');\r\n\r\n            customValueTr.hide();\r\n            attributeElement.value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_NUMBER')) {\r\n                customValueTr.show();\r\n            } else if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n\r\n            maxPostedValueTr.hide();\r\n            maxPostedValueMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::QTY_MODIFICATION_MODE_OFF');\r\n\r\n            if (self.isMaxPostedQtyAvailable(this.value)) {\r\n\r\n                maxPostedValueTr.show();\r\n                maxPostedValueMode.value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::QTY_MODIFICATION_MODE_ON');\r\n\r\n                if (self.isMaxPostedQtyAvailable(M2ePro.formData.qty_mode)) {\r\n                    maxPostedValueMode.value = M2ePro.formData.qty_modification_mode;\r\n                }\r\n            }\r\n\r\n            maxPostedValueMode.simulate('change');\r\n\r\n            self.updateQtyPercentage();\r\n        },\r\n\r\n        isMaxPostedQtyAvailable: function (qtyMode) {\r\n            return qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_PRODUCT') ||\r\n                qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_ATTRIBUTE') ||\r\n                qtyMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::QTY_MODE_PRODUCT_FIXED');\r\n        },\r\n\r\n        qtyPostedMode_change: function () {\r\n            var minPosterValueTr = $('qty_min_posted_value_tr'),\r\n                maxPosterValueTr = $('qty_max_posted_value_tr');\r\n\r\n            minPosterValueTr.hide();\r\n            maxPosterValueTr.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::QTY_MODIFICATION_MODE_ON')) {\r\n                minPosterValueTr.show();\r\n                maxPosterValueTr.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        taxCategoryChange: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                valueEl = $('tax_category_value'),\r\n                attributeEl = $('tax_category_attribute');\r\n\r\n            valueEl.value = '';\r\n            attributeEl.value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::TAX_CATEGORY_MODE_VALUE')) {\r\n                self.updateHiddenValue(this, valueEl);\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::TAX_CATEGORY_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, attributeEl);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        fixed_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                listingType = $('listing_type'),\r\n                currencyTd = $('fixed_price_currency_td'),\r\n                attributeElement = $('fixed_price_custom_attribute'),\r\n                priceChangeTd = $('fixed_price_change_td'),\r\n                priceChangeTds = $$('#fixed_price_tr td.remove_bottom_border'),\r\n                variationPriceSelect = $$('#variation_price_tr .value');\r\n\r\n            variationPriceSelect.invoke('hide');\r\n            priceChangeTds.invoke('removeClassName', 'bottom_border_disabled');\r\n            priceChangeTd.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                priceChangeTd.show();\r\n                currencyTd && currencyTd.show();\r\n                variationPriceSelect.invoke('show');\r\n                if (listingType.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::LISTING_TYPE_AUCTION')) {\r\n                    priceChangeTds.invoke('addClassName', 'bottom_border_disabled');\r\n                }\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        start_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                attributeElement = $('start_price_custom_attribute');\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        reserve_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                attributeElement = $('reserve_price_custom_attribute'),\r\n                priceChangeTd = $('reserve_price_change_td'),\r\n                currencyTd = $('reserve_price_currency_td');\r\n\r\n            priceChangeTd.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                priceChangeTd.show();\r\n                currencyTd && currencyTd.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        buyitnow_price_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                attributeElement = $('buyitnow_price_custom_attribute'),\r\n                priceChangeTd = $('buyitnow_price_change_td'),\r\n                currencyTd = $('buyitnow_price_currency_td');\r\n\r\n            priceChangeTd.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                priceChangeTd.show();\r\n                currencyTd && currencyTd.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        price_coefficient_mode_change: function () {\r\n            var coefficientInputDiv = $(this.id.replace('mode', '') + 'input_div'),\r\n                signSpan = $(this.id.replace('mode', '') + 'sign_span'),\r\n                percentSpan = $(this.id.replace('mode', '') + 'percent_span'),\r\n                examplesContainer = $(this.id.replace('coefficient_mode', '') + 'example_container');\r\n\r\n            // ---------------------------------------\r\n\r\n            coefficientInputDiv.show();\r\n            examplesContainer.show();\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_NONE')) {\r\n                coefficientInputDiv.hide();\r\n                examplesContainer.hide();\r\n            }\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            signSpan.innerHTML = '';\r\n            percentSpan.innerHTML = '';\r\n            $$('.' + this.id.replace('coefficient_mode', '') + 'example').invoke('hide');\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_ABSOLUTE_INCREASE')) {\r\n                signSpan.innerHTML = '+';\r\n\r\n                if (typeof M2ePro.formData.currency != 'undefined') {\r\n                    percentSpan.innerHTML = M2ePro.formData.currency;\r\n                }\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_absolute_increase').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_ABSOLUTE_DECREASE')) {\r\n                signSpan.innerHTML = '-';\r\n\r\n                if (typeof M2ePro.formData.currency != 'undefined') {\r\n                    percentSpan.innerHTML = M2ePro.formData.currency;\r\n                }\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_absolute_decrease').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_PERCENTAGE_INCREASE')) {\r\n                signSpan.innerHTML = '+';\r\n                percentSpan.innerHTML = '%';\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_percentage_increase').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::PRICE_COEFFICIENT_PERCENTAGE_DECREASE')) {\r\n                signSpan.innerHTML = '-';\r\n                percentSpan.innerHTML = '%';\r\n\r\n                $(this.id.replace('coefficient_mode', '') + 'example_percentage_decrease').show();\r\n            }\r\n            // ---------------------------------------\r\n        },\r\n\r\n        price_discount_stp_mode_change: function () {\r\n            var attributeElement = $('price_discount_stp_attribute'),\r\n                priceDiscountStpTds = $$('#price_discount_stp_tr td.remove_bottom_border'),\r\n                priceDiscountStpReasonTr = $('price_discount_stp_reason_tr'),\r\n                currencyTd = $('price_discount_stp_currency_td');\r\n\r\n            priceDiscountStpReasonTr.hide();\r\n            currencyTd && currencyTd.hide();\r\n            priceDiscountStpTds.invoke('removeClassName', 'bottom_border_disabled');\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                currencyTd && currencyTd.show();\r\n\r\n                if (EbayTemplateSellingFormatObj.isStpAdvancedAvailable()) {\r\n                    priceDiscountStpReasonTr.show();\r\n                    priceDiscountStpTds.invoke('addClassName', 'bottom_border_disabled');\r\n                }\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                EbayTemplateSellingFormatObj.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        price_discount_map_mode_change: function () {\r\n            var attributeElement = $('price_discount_map_attribute'),\r\n                priceDiscountMapExposureTr = $('price_discount_map_exposure_tr'),\r\n                currencyTd = $('price_discount_map_currency_td');\r\n\r\n            priceDiscountMapExposureTr.hide();\r\n            currencyTd && currencyTd.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_NONE')) {\r\n                currencyTd && currencyTd.show();\r\n\r\n                if (EbayTemplateSellingFormatObj.isMapAvailable()) {\r\n                    priceDiscountMapExposureTr.show();\r\n                }\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Template\\\\SellingFormat::PRICE_MODE_ATTRIBUTE')) {\r\n                EbayTemplateSellingFormatObj.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        best_offer_mode_change: function () {\r\n            var bestOfferRespondTable = $$('.best_offer_respond_table_container');\r\n\r\n            bestOfferRespondTable.invoke('hide');\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_MODE_YES')) {\r\n                bestOfferRespondTable.invoke('show');\r\n                $('best_offer_reject_mode', 'best_offer_accept_mode').invoke('simulate', 'change');\r\n            } else {\r\n                $('template_selling_format_messages_best_offer').innerHTML = '';\r\n            }\r\n        },\r\n\r\n        best_offer_accept_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n\r\n                bestOfferAcceptValueTr = $('best_offer_accept_value_tr'),\r\n                attributeElement = $('best_offer_accept_custom_attribute');\r\n\r\n            bestOfferAcceptValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_ACCEPT_MODE_PERCENTAGE')) {\r\n                bestOfferAcceptValueTr.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_ACCEPT_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        best_offer_reject_mode_change: function () {\r\n            var self = EbayTemplateSellingFormatObj,\r\n                bestOfferRejectValueTr = $('best_offer_reject_value_tr'),\r\n                attributeElement = $('best_offer_reject_custom_attribute');\r\n\r\n            bestOfferRejectValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_REJECT_MODE_PERCENTAGE')) {\r\n                bestOfferRejectValueTr.show();\r\n            }\r\n\r\n            attributeElement.value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Ebay\\\\Template\\\\SellingFormat::BEST_OFFER_REJECT_MODE_ATTRIBUTE')) {\r\n                self.selectMagentoAttribute(this, attributeElement);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selectMagentoAttribute: function (elementSelect, elementAttribute) {\r\n            var attributeCode = elementSelect.options[elementSelect.selectedIndex].getAttribute('attribute_code');\r\n            elementAttribute.value = attributeCode;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        checkBestOfferMessages: function ()\r\n        {\r\n            var formElements = $(\r\n                \"best_offer_mode\",\r\n                \"best_offer_accept_mode\",\r\n                \"best_offer_accept_custom_attribute\",\r\n                \"best_offer_reject_mode\",\r\n                \"best_offer_reject_custom_attribute\"\r\n            );\r\n\r\n            var isVisible = $$('.best_offer_respond_table_container').first().visible();\r\n            if (!isVisible) {\r\n                return false;\r\n            }\r\n\r\n            this.checkMessages(Form.serializeElements(formElements), 'template_selling_format_messages_best_offer')\r\n        },\r\n\r\n        checkPriceMessages: function ()\r\n        {\r\n\r\n            var formElements = Form.getElements('template_selling_format_data_container'),\r\n                excludedElements = $(\r\n                    \"best_offer_mode\",\r\n                    \"best_offer_accept_mode\",\r\n                    \"best_offer_accept_custom_attribute\",\r\n                    \"best_offer_reject_mode\",\r\n                    \"best_offer_reject_custom_attribute\"\r\n                );\r\n\r\n            formElements = formElements.filter(function (element) {\r\n                return excludedElements.indexOf(element) < 0;\r\n            });\r\n\r\n            if (formElements.length === 0) {\r\n                return false;\r\n            }\r\n\r\n            this.checkMessages(Form.serializeElements(formElements), 'template_selling_format_messages');\r\n        },\r\n\r\n        checkMessages: function (data, container)\r\n        {\r\n            if (typeof EbayListingTemplateSwitcherObj == 'undefined') {\r\n                // not inside template switcher\r\n                return;\r\n            }\r\n\r\n            var id = '',\r\n                nick = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Manager::TEMPLATE_SELLING_FORMAT'),\r\n                storeId = EbayListingTemplateSwitcherObj.storeId,\r\n                marketplaceId = EbayListingTemplateSwitcherObj.marketplaceId,\r\n                checkAttributesAvailability = EbayListingTemplateSwitcherObj.checkAttributesAvailability,\r\n                callback = function () {\r\n                    var refresh = $(container).down('a.refresh-messages');\r\n                    if (refresh) {\r\n                        refresh.observe('click', function () {\r\n                            this.checkMessages(data, container);\r\n                        }.bind(this))\r\n                    }\r\n                }.bind(this);\r\n\r\n            TemplateHandlerObj.checkMessages(\r\n                id,\r\n                nick,\r\n                data,\r\n                storeId,\r\n                marketplaceId,\r\n                checkAttributesAvailability,\r\n                container,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // eBay Charity\r\n        // ---------------------------------------\r\n\r\n        renderCharities: function (data) {\r\n            var self = this;\r\n\r\n            $H(data).each(function (charity) {\r\n                self.addCharityRow(charity.value);\r\n            });\r\n        },\r\n\r\n        addCharityRow: function (charityData) {\r\n            var self = this;\r\n\r\n            $('charity_not_set_table').hide();\r\n            $('charity_table').show();\r\n\r\n            charityData = charityData || {};\r\n            this.charityIndex++;\r\n\r\n            var tpl = this.charityTpl;\r\n            tpl = tpl.replace(/%i%/g, this.charityIndex);\r\n            $('charity_table_tbody').insert(tpl);\r\n\r\n            var row = $('charity_row_' + this.charityIndex + '_tr');\r\n            row.show();\r\n\r\n            var marketplaceEl = row.down('.charity-marketplace_id');\r\n\r\n            if ($('charity_table_tbody').select('tr').length === (marketplaceEl.select('option').length - 1)) {\r\n                $$('.add_charity_button').each(function(el) {\r\n                    el.hide();\r\n                });\r\n            }\r\n\r\n            if (charityData.marketplace_id) {\r\n                marketplaceEl.value = charityData.marketplace_id;\r\n                self.charityMarketplaceChange.call(self, marketplaceEl, charityData);\r\n            } else {\r\n                self.hideSelectedMarketplaceOptions();\r\n            }\r\n        },\r\n\r\n        removeCharityRow: function (el) {\r\n            el.up('.charity-row').remove();\r\n\r\n            if ($('charity_table_tbody').select('tr').length == 0) {\r\n                $('charity_not_set_table').show();\r\n                $('charity_table').hide();\r\n            }\r\n\r\n            $$('.add_charity_button').each(function(el){\r\n                el.show();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        charityMarketplaceChange: function(marketplaceEl, charityData) {\r\n            var self = this,\r\n                organizationEl = marketplaceEl.up('.charity-row').down('.charity-organization'),\r\n                percentageEl = organizationEl.up('.charity-row').down('.charity-percentage');\r\n\r\n            charityData = charityData || {};\r\n\r\n            self.hideSelectedMarketplaceOptions();\r\n\r\n            percentageEl.value = '';\r\n\r\n            if (marketplaceEl.value == '') {\r\n                organizationEl.value = '';\r\n                organizationEl.simulate('change');\r\n                organizationEl.disable().hide();\r\n\r\n                return;\r\n            }\r\n            organizationEl.update().enable().show();\r\n\r\n            var option = new Element('option', {\r\n                class: 'empty',\r\n                value: ''\r\n            });\r\n            organizationEl.insert({bottom: option});\r\n\r\n            option = new Element('option', {\r\n                class: 'searchNewCharity',\r\n                value: ''\r\n            });\r\n            option.innerHTML = M2ePro.translator.translate('Search for Charity Organization');\r\n            organizationEl.insert({bottom: option});\r\n\r\n            if (charityData.organization_id && charityData.organization_custom == 0) {\r\n\r\n                charityData.organization_custom = 1;\r\n\r\n                self.charityDictionary[marketplaceEl.value].charities.each(function (charity) {\r\n                    if (charityData.organization_id == charity.id) {\r\n                        charityData.organization_custom = 0;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (charityData.organization_custom) {\r\n                var customOptgroup = new Element('optgroup', {\r\n                    label: 'Custom',\r\n                    class: 'customCharity'\r\n                }).insert({\r\n                    bottom: new Element('option', {\r\n                        value: charityData.organization_id,\r\n                        class: 'newCharity'\r\n                    }).update(charityData.organization_name)\r\n                });\r\n\r\n                organizationEl.insert(customOptgroup);\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = charityData.organization_custom;\r\n            }\r\n\r\n            if (self.charityDictionary[marketplaceEl.value].charities.length > 0) {\r\n                var optgroup = new Element('optgroup', {\r\n                    label: 'Featured',\r\n                    class: 'featuredCharity'\r\n                });\r\n\r\n                self.charityDictionary[marketplaceEl.value].charities.each(function (charity) {\r\n                    var option = new Element('option', {\r\n                        value: charity.id\r\n                    });\r\n\r\n                    option.innerHTML = charity.name;\r\n                    optgroup.insert(option);\r\n                });\r\n                organizationEl.insert(optgroup);\r\n            }\r\n\r\n            if (charityData.organization_id) {\r\n                organizationEl.value = charityData.organization_id;\r\n                self.charityOrganizationChange.call(self, organizationEl, charityData);\r\n            }\r\n        },\r\n\r\n        charityOrganizationChange: function (organizationEl, charityData) {\r\n            var self = this,\r\n                percentageEl = organizationEl.up('.charity-row').down('.charity-percentage'),\r\n                marketplaceEl = organizationEl.up('.charity-row').down('.charity-marketplace_id');\r\n\r\n            if (organizationEl[organizationEl.selectedIndex].hasClassName('searchNewCharity')) {\r\n                self.openPopUpCharity(organizationEl, marketplaceEl.value);\r\n\r\n                if (typeof self.charitySelectedHistory != 'undefined') {\r\n                    organizationEl.selectedIndex = self.charitySelectedHistory;\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            var optgroup = organizationEl[organizationEl.selectedIndex].up('optgroup')\r\n\r\n            if (optgroup && optgroup.hasClassName('customCharity')) {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 1;\r\n            } else {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 0;\r\n            }\r\n\r\n            self.charitySelectedHistory = organizationEl.selectedIndex;\r\n\r\n            organizationEl.up('.charity-row').select('input.organization_name')[0].value = organizationEl[organizationEl.selectedIndex].innerHTML;\r\n\r\n            charityData = charityData || {};\r\n\r\n            if (organizationEl.value == '') {\r\n                percentageEl.value = '';\r\n                percentageEl.simulate('change');\r\n                percentageEl.disable().hide();\r\n\r\n                return;\r\n            }\r\n            percentageEl.update().enable().show();\r\n\r\n            var option = new Element('option', {\r\n                class: 'empty',\r\n                value: ''\r\n            });\r\n            percentageEl.insert({bottom: option});\r\n\r\n            if (marketplaceEl.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Ebay::MARKETPLACE_MOTORS')) {\r\n                option = new Element('option', {\r\n                    value: 1\r\n                });\r\n                option.innerHTML = '1%';\r\n                percentageEl.insert({bottom: option});\r\n                option = new Element('option', {\r\n                    value: 5\r\n                });\r\n                option.innerHTML = '5%';\r\n                percentageEl.insert({bottom: option});\r\n            }\r\n\r\n            for (var i = 2; i < 21; i++) {\r\n                option = new Element('option', {\r\n                    value: i*5\r\n                });\r\n                option.innerHTML = i*5+'%';\r\n                percentageEl.insert({bottom: option});\r\n            }\r\n\r\n            if (charityData.percentage) {\r\n                percentageEl.value = charityData.percentage;\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        charityOrganizationCustomModeChange: function (organizationEl, charityData) {\r\n            var self = this,\r\n                percentageEl = organizationEl.up('.charity-row').down('.charity-percentage'),\r\n                marketplaceEl = organizationEl.up('.charity-row').down('.charity-marketplace_id');\r\n\r\n            if (organizationEl[organizationEl.selectedIndex].hasClassName('searchNewCharity')) {\r\n                self.openPopUpCharity(organizationEl, marketplaceEl.value);\r\n\r\n                if (typeof self.charitySelectedHistory != 'undefined') {\r\n                    organizationEl.selectedIndex = self.charitySelectedHistory;\r\n                }\r\n\r\n                return;\r\n            }\r\n\r\n            var optgroup = organizationEl[organizationEl.selectedIndex].up('optgroup')\r\n\r\n            if (optgroup && optgroup.hasClassName('customCharity')) {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 1;\r\n            } else {\r\n                organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 0;\r\n            }\r\n\r\n            self.charitySelectedHistory = organizationEl.selectedIndex;\r\n\r\n            organizationEl.up('.charity-row').select('input.organization_name')[0].value = organizationEl[organizationEl.selectedIndex].innerHTML;\r\n\r\n            if (organizationEl.value == '') {\r\n                $('charity_percentage').hide();\r\n            } else {\r\n                $('charity_percentage').show();\r\n            }\r\n            percentageEl.value = '';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        hideSelectedMarketplaceOptions: function()\r\n        {\r\n            var charityTBody =  $('charity_table_tbody');\r\n\r\n            charityTBody.select('select.charity-marketplace_id option').each(function(option){\r\n                option.show();\r\n            });\r\n\r\n            charityTBody.select('select.charity-marketplace_id').each(function(select){\r\n                charityTBody.select('select.charity-marketplace_id option[value=\"' + select.value + '\"]').each(function(option){\r\n                    option.hide();\r\n                });\r\n\r\n                select[select.selectedIndex].show();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUpCharity: function (organizationEl, marketplaceId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template_sellingFormat/getSearchCharityPopUpHtml'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    marketplace_id: marketplaceId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var container = $('charitySearch_pop_up_content');\r\n\r\n                    if (container) {\r\n                        container.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({\r\n                        bottom: transport.responseText\r\n                    });\r\n\r\n                    self.charitySearchPopup = jQuery('#charitySearch_pop_up_content');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Search For Charities'),\r\n                        type: 'slide',\r\n                        buttons: []\r\n                    }, self.charitySearchPopup);\r\n\r\n                    self.charitySearchPopup.modal('openModal');\r\n\r\n                    self.charitySearchPopup.organizationEl = organizationEl;\r\n\r\n                    $('query').observe('keypress', function (event) {\r\n                        event.keyCode == Event.KEY_RETURN && self.searchCharity();\r\n                    });\r\n\r\n                    $('searchCharity_reset').observe('click', function (event) {\r\n                        $('query').value = '';\r\n                        $('selectCharitySearch').selectedIndex = '';\r\n                        $('searchCharity_grid').hide();\r\n                        $('searchCharity_warning_block').hide();\r\n                    })\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        searchCharity: function () {\r\n            var query = $('query').value;\r\n            var destination = $('selectCharitySearch').value;\r\n            var marketplaceId = $('charitySearch_marketplace_id').value;\r\n\r\n            if (query == '') {\r\n                $('query').focus();\r\n                this.alert(M2ePro.translator.translate('Please, enter the organization name or ID.'));\r\n                return;\r\n            }\r\n\r\n            $('searchCharity_grid').hide();\r\n            $('searchCharity_error_block').hide();\r\n            $('searchCharity_warning_block').hide();\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template_sellingFormat/searchCharity'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    query: query,\r\n                    destination: destination,\r\n                    marketplace_id: marketplaceId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    transport = transport.responseText.evalJSON();\r\n\r\n                    if (transport.result == 'success') {\r\n                        $('searchCharity_grid')\r\n                            .update(transport.html)\r\n                            .show();\r\n\r\n                        if (transport.count) {\r\n                            $('searchCharity_warning_block').show();\r\n                        }\r\n                    } else {\r\n                        $('searchCharity_error_block').update(transport.html);\r\n                        $('searchCharity_error_block').show();\r\n                    }\r\n                }\r\n            })\r\n        },\r\n\r\n        selectNewCharity: function (id, name) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var customCharities = self.charitySearchPopup.organizationEl.select('option.newCharity');\r\n\r\n                        if (customCharities.length > 0) {\r\n                            customCharities[0].update(name);\r\n                            customCharities[0].value = id;\r\n                        } else {\r\n                            var optgroups = self.charitySearchPopup.organizationEl.select('optgroup.customCharity');\r\n\r\n                            if (optgroups.length > 0) {\r\n                                optgroups[0].insert({\r\n                                    bottom: new Element('option', {\r\n                                        value: id,\r\n                                        class: 'newCharity'\r\n                                    }).update(name)\r\n                                });\r\n                            } else {\r\n                                var optgroup = new Element('optgroup', {\r\n                                    label: 'Custom',\r\n                                    class: 'customCharity'\r\n                                }).insert({\r\n                                    bottom: new Element('option', {\r\n                                        value: id,\r\n                                        class: 'newCharity'\r\n                                    }).update(name)\r\n                                });\r\n\r\n                                var featuresGroups = self.charitySearchPopup.organizationEl.select('optgroup.featuredCharity');\r\n                                if (featuresGroups.length > 0) {\r\n                                    featuresGroups[0].insert({\r\n                                        before: optgroup\r\n                                    });\r\n                                } else {\r\n                                    self.charitySearchPopup.organizationEl.insert(optgroup);\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        self.charitySearchPopup.organizationEl.value = id;\r\n                        self.charitySearchPopup.organizationEl.up('.charity-row').select('input.organization_custom')[0].value = 1;\r\n                        self.charitySearchPopup.organizationEl.simulate('change');\r\n                        self.charitySearchPopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/Description.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Common',\r\n    'mage/adminhtml/wysiwyg/tiny_mce/setup'\r\n], function () {\r\n\r\n    window.EbayTemplateDescription = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-description-template', function(value, el) {\r\n\r\n                if ($('description_mode').value != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::DESCRIPTION_MODE_CUSTOM')) {\r\n                    return true;\r\n                }\r\n\r\n                return Validation.get('required-entry').test(value,el);\r\n            }, M2ePro.translator.translate('This is a required field.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-condition-note-length', function(value) {\r\n\r\n                if ($('condition_note_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_NOTE_MODE_NONE')) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length <= 1000;\r\n            }, M2ePro.translator.translate('Seller Notes must be less then 1000 symbols.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-magento-product-id', function(value) {\r\n\r\n                var isValidMagentoProductId = false;\r\n\r\n                new Ajax.Request(M2ePro.url.get('ebay_template_description/checkMagentoProductId'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        product_id: value\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        var response = transport.responseText.evalJSON();\r\n                        isValidMagentoProductId = response.result;\r\n                    }\r\n                });\r\n\r\n                return isValidMagentoProductId;\r\n            }, M2ePro.translator.translate('Please enter a valid Magento product ID.'));\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('title_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.title_mode_change)\r\n                .simulate('change');\r\n\r\n            $('subtitle_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.subtitle_mode_change)\r\n                .simulate('change');\r\n\r\n            $('item_condition')\r\n                .observe('change', EbayTemplateDescriptionObj.item_condition_change)\r\n                .simulate('change');\r\n\r\n            $('condition_note_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.condition_note_mode_change)\r\n                .simulate('change');\r\n\r\n            $('watermark_scale')\r\n                .observe('change', EbayTemplateDescriptionObj.watermark_scale_mode_change)\r\n                .simulate('change');\r\n\r\n            $('watermark_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.watermark_mode_change)\r\n                .simulate('change');\r\n\r\n            $('description_mode')\r\n                .observe('change', EbayTemplateDescriptionObj.description_mode_change)\r\n                .simulate('change');\r\n\r\n            $('description_template_show_hide_wysiwyg')\r\n                .observe('click', wysiwygdescription_template.toggle.bind(wysiwygdescription_template))\r\n                .observe('click', EbayTemplateDescriptionObj.showHideWYSIWYG);\r\n\r\n            $('image_main')\r\n                .observe('change', EbayTemplateDescriptionObj.image_main_change)\r\n                .simulate('change');\r\n\r\n            $('gallery_images')\r\n                .observe('change', EbayTemplateDescriptionObj.gallery_images_change)\r\n                .simulate('change');\r\n\r\n            $('variation_images')\r\n                .observe('change', EbayTemplateDescriptionObj.variation_images_change)\r\n                .simulate('change');\r\n\r\n            $('product_details_ean',\r\n                'product_details_upc',\r\n                'product_details_epid',\r\n                'product_details_isbn'\r\n            ).each(function(element) {\r\n                element.observe('change', EbayTemplateDescriptionObj.product_details_specification_visibility_change)\r\n                    .simulate('change');\r\n            });\r\n\r\n            $('product_details_brand')\r\n                .observe('change', EbayTemplateDescriptionObj.product_details_brand_change)\r\n                .simulate('change');\r\n\r\n            $('product_details_mpn')\r\n                .observe('change', EbayTemplateDescriptionObj.product_details_mpn_change);\r\n\r\n            $('custom_inserts_open_popup')\r\n                .observe('click', EbayTemplateDescriptionObj.customInsertsOpenPopup);\r\n\r\n            this.initCustomInsertsPopup();\r\n            this.initPreviewPopup();\r\n        },\r\n\r\n        initWYSIWYG: function ()\r\n        {\r\n            tinymce.dom.Event._pageInit();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function(headId, chapter_when_duplicate_text, templateNick)\r\n        {\r\n            var watermarkImageContainer = $('watermark_uploaded_image_container');\r\n\r\n            if (watermarkImageContainer) {\r\n                watermarkImageContainer.remove();\r\n                $('watermark_image').addClassName('M2ePro-required-when-visible');\r\n                $('watermark_image_container').addClassName('_required');\r\n            }\r\n\r\n            EbayTemplateEditObj.duplicateClick(headId, chapter_when_duplicate_text, templateNick);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        title_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n            self.setTextVisibilityMode(this, 'custom_title_tr');\r\n        },\r\n\r\n        subtitle_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n            self.setTextVisibilityMode(this, 'custom_subtitle_tr');\r\n        },\r\n\r\n        description_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            var viewEditCustomDescription = $('view_edit_custom_description');\r\n\r\n            if (viewEditCustomDescription) {\r\n                viewEditCustomDescription.hide();\r\n            }\r\n\r\n            $$('.c-custom_description_tr').invoke('hide');\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::DESCRIPTION_MODE_CUSTOM')) {\r\n                if (viewEditCustomDescription) {\r\n                    viewEditCustomDescription.show();\r\n                    $$('.c-custom_description_tr').invoke('hide');\r\n                    return;\r\n                }\r\n\r\n                if (typeof wysiwygdescription_template !== 'undefined' && $('description_editor_type').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_SIMPLE')) {\r\n                    wysiwygdescription_template.turnOff();\r\n                }\r\n\r\n                $$('.c-custom_description_tr').invoke('show');\r\n            } else {\r\n                if (viewEditCustomDescription) {\r\n                    viewEditCustomDescription.remove();\r\n                }\r\n            }\r\n        },\r\n\r\n        view_edit_custom_change: function()\r\n        {\r\n            if (typeof wysiwygdescription_template !== 'undefined' && $('description_editor_type').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_SIMPLE')) {\r\n                wysiwygdescription_template.turnOff();\r\n            }\r\n\r\n            $$('.c-custom_description_tr').invoke('show');\r\n            $('view_edit_custom_description').hide();\r\n        },\r\n\r\n        item_condition_change: function()\r\n        {\r\n            $('condition_note_tr').show();\r\n            $('condition_note_mode').simulate('change');\r\n\r\n            var self = EbayTemplateDescriptionObj,\r\n                isConditionNoteNeeded = true,\r\n\r\n                conditionValue = $('condition_value'),\r\n                conditionAttribute = $('condition_attribute');\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_MODE_NONE')) {\r\n                isConditionNoteNeeded = false;\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_MODE_EBAY')) {\r\n                self.updateHiddenValue(this, conditionValue);\r\n                conditionAttribute.value = '';\r\n                isConditionNoteNeeded = conditionValue.value != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_EBAY_NEW');\r\n            } else {\r\n                self.updateHiddenValue(this, conditionAttribute);\r\n                conditionValue.value = '';\r\n            }\r\n\r\n            if (!isConditionNoteNeeded) {\r\n\r\n                $('condition_note_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_NOTE_MODE_NONE');\r\n                $('condition_note_mode').simulate('change');\r\n\r\n                $('condition_note_tr').hide();\r\n                $('custom_condition_note_tr').hide();\r\n            }\r\n        },\r\n\r\n        condition_note_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::CONDITION_NOTE_MODE_NONE')) {\r\n                $('condition_note_template').update('');\r\n            }\r\n\r\n            self.setTextVisibilityMode(this, 'custom_condition_note_tr');\r\n            self.setTextVisibilityMode(this, 'custom_condition_note_attributes_tr');\r\n        },\r\n\r\n        watermark_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n            self.setTextVisibilityMode(this, 'watermark_image_container');\r\n            if ($('watermark_uploaded_image_container')) {\r\n                self.setTextVisibilityMode(this, 'watermark_uploaded_image_container');\r\n            }\r\n\r\n            if ($('watermark_scale').value != M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::WATERMARK_SCALE_MODE_STRETCH')) {\r\n                self.setTextVisibilityMode(this, 'watermark_position_container');\r\n            }\r\n\r\n            self.setTextVisibilityMode(this, 'watermark_scale_container');\r\n            self.setTextVisibilityMode(this, 'watermark_transparent_container');\r\n        },\r\n\r\n        watermark_scale_mode_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('watermark_position_container').show();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::WATERMARK_SCALE_MODE_STRETCH')) {\r\n                $('watermark_position_container').hide();\r\n            }\r\n        },\r\n\r\n        setTextVisibilityMode: function(obj, elementName)\r\n        {\r\n            var elementObj = $(elementName);\r\n\r\n            if (!elementObj) {\r\n                return;\r\n            }\r\n\r\n            elementObj.hide();\r\n\r\n            if (obj.value == 1) {\r\n                elementObj.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        image_main_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('gallery_images_mode_tr', 'variation_images_mode_tr', 'use_supersize_images_tr',\r\n              'default_image_url_tr', 'watermark_block').invoke('show');\r\n\r\n            if ($$('#variation_configurable_images option').length > 1) {\r\n                $('variation_configurable_images_container').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::IMAGE_MAIN_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('image_main_attribute'));\r\n            } else {\r\n                $('image_main_attribute').value = '';\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::IMAGE_MAIN_MODE_NONE')) {\r\n                $('gallery_images_mode_tr', 'variation_images_mode_tr', 'variation_configurable_images_container',\r\n                  'use_supersize_images_tr', 'default_image_url_tr').invoke('hide');\r\n\r\n                $('use_supersize_images').value = 0;\r\n\r\n                $('gallery_images').value = 0;\r\n                $('gallery_images').simulate('change');\r\n\r\n                $('variation_configurable_images').value = '';\r\n\r\n                $('variation_images').value = 1;\r\n                $('variation_images_limit').value = 1;\r\n                $('variation_images').simulate('change');\r\n\r\n                $('default_image_url').value = '';\r\n\r\n                $('watermark_block').hide();\r\n\r\n                var watermarkMode = $('watermark_mode');\r\n\r\n                if (watermarkMode.selectedIndex != 0) {\r\n                    watermarkMode.selectedIndex = 0;\r\n                    watermarkMode.simulate('change');\r\n                }\r\n            }\r\n        },\r\n\r\n        gallery_images_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('gallery_images_limit').value = '';\r\n            $('gallery_images_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::GALLERY_IMAGES_MODE_PRODUCT')) {\r\n                self.updateHiddenValue(this, $('gallery_images_limit'));\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::GALLERY_IMAGES_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gallery_images_attribute'));\r\n            }\r\n        },\r\n\r\n        variation_images_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            $('variation_images_limit').value = '';\r\n            $('variation_images_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::VARIATION_IMAGES_MODE_PRODUCT')) {\r\n                self.updateHiddenValue(this, $('variation_images_limit'));\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::VARIATION_IMAGES_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('variation_images_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        image_width_mode_change: function()\r\n        {\r\n            $('image_width_span')[this.value == 1 ? 'show' : 'hide']();\r\n        },\r\n\r\n        image_height_mode_change: function()\r\n        {\r\n            $('image_height_span')[this.value == 1 ? 'show' : 'hide']();\r\n        },\r\n\r\n        image_margin_mode_change: function()\r\n        {\r\n            $('image_margin_span')[this.value == 1 ? 'show' : 'hide']();\r\n        },\r\n\r\n        select_attributes_image_change: function()\r\n        {\r\n            $$('.all-products-images').invoke(this.value == 'media_gallery' ? 'show' : 'hide');\r\n            $$('.all-products-image').invoke(this.value == 'image' ? 'show' : 'hide');\r\n            if (this.value == 'image') {\r\n                $('display_products_images').value = 'custom_settings';\r\n            }\r\n            $('display_products_images').simulate('change');\r\n        },\r\n\r\n        display_products_images_change: function()\r\n        {\r\n            $$('.products-images-custom-settings').invoke('hide');\r\n            $$('.products-images-gallery-view').invoke('hide');\r\n\r\n            if (this.value == 'gallery_view') {\r\n                $$('.products-images-gallery-view').invoke('show');\r\n            } else {\r\n                $$('.products-images-custom-settings').invoke('show');\r\n            }\r\n\r\n            jQuery('.products-images-mode-change-label').each(function (index, elem) {\r\n                jQuery(elem).find('.label span').text(jQuery(elem).find('.' + this.value).text());\r\n            }.bind(this));\r\n        },\r\n\r\n        product_details_specification_visibility_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj,\r\n                modeNone = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_NONE'),\r\n                modeDoesNotApply = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_DOES_NOT_APPLY');\r\n\r\n            var isNotAttributeMode = function(element) {\r\n                return element.value == modeNone || element.value == modeDoesNotApply;\r\n            };\r\n\r\n            if ($('product_details_ean', 'product_details_upc', 'product_details_isbn', 'product_details_brand')\r\n                    .every(isNotAttributeMode) && $('product_details_epid').value == modeNone\r\n            ) {\r\n                $('product_details_specification_separator').hide();\r\n                $$('.product-details-specification').each(function(element) {\r\n                    element.hide();\r\n                    element.down('.select').down().selectedIndex = 1;\r\n                });\r\n            } else {\r\n                $('product_details_specification_separator').show();\r\n                var hiddenElement = $(this.id+'_attribute');\r\n                if (!hiddenElement) {\r\n                    return;\r\n                }\r\n                $$('.product-details-specification').invoke('show');\r\n                self.updateHiddenValue(this, hiddenElement);\r\n            }\r\n        },\r\n\r\n        product_details_brand_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_NONE') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_DOES_NOT_APPLY')) {\r\n                $('product_details_mpn_tr').hide();\r\n                $('product_details_mpn').selectedIndex = 0;\r\n            } else {\r\n                $('product_details_mpn_tr').show();\r\n                $$('.product-details-specification').invoke('show');\r\n                self.updateHiddenValue(this, $(this.id+'_attribute'));\r\n            }\r\n\r\n            self.product_details_specification_visibility_change();\r\n        },\r\n\r\n        product_details_mpn_change: function()\r\n        {\r\n            var self = EbayTemplateDescriptionObj;\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::PRODUCT_DETAILS_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $(this.id+'_attribute'));\r\n            }\r\n        },\r\n\r\n        showHideWYSIWYG: function ()\r\n        {\r\n            var label;\r\n            if ($('description_template').visible()) {\r\n                label = M2ePro.translator.translate('Show Editor');\r\n                $('description_editor_type').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_SIMPLE');\r\n            } else {\r\n                label = M2ePro.translator.translate('Hide Editor');\r\n                $('description_editor_type').value = M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::EDITOR_TYPE_TINYMCE');\r\n            }\r\n            this.select('span').first().update(label);\r\n        },\r\n\r\n        initCustomInsertsPopup: function ()\r\n        {\r\n            var popup = jQuery('#custom_inserts_popup');\r\n            if (!popup.find('form').length) {\r\n                popup.wrapInner('<form id=\"description_custom_inserts_form\"></form>');\r\n                CommonObj.initFormValidation('#description_custom_inserts_form');\r\n            }\r\n\r\n            popup.modal({\r\n                title: M2ePro.translator.translate('Custom Insertions'),\r\n                type: 'slide',\r\n                buttons: [],\r\n                closed: function () {\r\n                    EbayTemplateDescriptionObj.customInsertsOnClosePopup();\r\n                }\r\n            });\r\n        },\r\n\r\n        customInsertsOpenPopup: function ()\r\n        {\r\n            jQuery('#custom_inserts_popup').modal('openModal');\r\n\r\n            EbayTemplateDescriptionObj.observeImageAttributes();\r\n        },\r\n\r\n        customInsertsOnClosePopup: function ()\r\n        {\r\n            jQuery('#description_custom_inserts_form').trigger('reset').validate().resetForm();\r\n            EbayTemplateDescriptionObj.stopObservingImageAttributes();\r\n        },\r\n\r\n        customInsertsClosePopup: function (callback)\r\n        {\r\n            jQuery('#custom_inserts_popup').modal({\r\n                closed: function () {\r\n                    callback && callback();\r\n\r\n                    // prevent callback closure\r\n                    callback = undefined;\r\n\r\n                    EbayTemplateDescriptionObj.customInsertsOnClosePopup();\r\n                }\r\n            }).modal('closeModal');\r\n        },\r\n\r\n        insertProductAttribute: function ()\r\n        {\r\n            this.customInsertsClosePopup(function () {\r\n                AttributeObj.appendToTextarea('#' + $('custom_inserts_product_attribute').value + '#');\r\n            });\r\n        },\r\n\r\n        insertM2eProAttribute: function ()\r\n        {\r\n            this.customInsertsClosePopup(function () {\r\n                AttributeObj.appendToTextarea('#value[' + $('custom_inserts_m2epro_attribute').value + ']#');\r\n            });\r\n        },\r\n\r\n        insertGallery: function()\r\n        {\r\n            if (!jQuery('#description_custom_inserts_form').valid()) {\r\n                return;\r\n            }\r\n\r\n            var template = '#' + $('select_attributes_image').value;\r\n\r\n            if ($('image_width_mode').value == '1') {\r\n                template += '[' + $('image_width').value + ',';\r\n            } else {\r\n                template += '[,';\r\n            }\r\n\r\n            if ($('image_height_mode').value == '1') {\r\n                template += '' + $('image_height').value + ',';\r\n            } else {\r\n                template += ',';\r\n            }\r\n\r\n            if ($('image_margin_mode').value == '1') {\r\n                template += '' + $('image_margin').value + ',';\r\n            } else {\r\n                template += ',';\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'media_gallery' && $('display_products_images').value == 'gallery_view')  {\r\n                template += '2';\r\n            } else if ($('image_linked_mode').value == '1') {\r\n                template += '1';\r\n            } else {\r\n                template += \"0\";\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'media_gallery') {\r\n                template += ',' + $('select_attributes_image_layout').value + ',' + $('select_attributes_image_count').value;\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'media_gallery' && $('display_products_images').value == 'gallery_view') {\r\n                template += ',\"' + $('gallery_hint_text').value + '\"';\r\n            } else if ($('select_attributes_image').value == 'media_gallery') {\r\n                // media_gallery with empty gallery hint\r\n                template += ',\"\"';\r\n            }\r\n\r\n            if ($('image_insertion_watermark_mode').value == '1') {\r\n                template += ',1';\r\n            } else {\r\n                template += ',';\r\n            }\r\n\r\n            if ($('select_attributes_image').value == 'image') {\r\n                template += ',' + $('select_attributes_image_order_position').value;\r\n            }\r\n\r\n            template += ']#';\r\n\r\n            this.customInsertsClosePopup(function () {\r\n                AttributeObj.appendToTextarea(template);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        observeImageAttributes: function()\r\n        {\r\n            $('image_width_mode').observe('change', EbayTemplateDescriptionObj.image_width_mode_change).simulate('change');\r\n            $('image_height_mode').observe('change', EbayTemplateDescriptionObj.image_height_mode_change).simulate('change');\r\n            $('image_margin_mode').observe('change', EbayTemplateDescriptionObj.image_margin_mode_change).simulate('change');\r\n\r\n            $('select_attributes_image')\r\n                    .observe('change', EbayTemplateDescriptionObj.select_attributes_image_change)\r\n                    .simulate('change');\r\n\r\n            $('display_products_images')\r\n                    .observe('change', EbayTemplateDescriptionObj.display_products_images_change)\r\n                    .simulate('change');\r\n\r\n            if($('watermark_mode').value == 1) {\r\n                this.setTextVisibilityMode($('watermark_mode'), 'products_images_watermark_mode');\r\n                $('image_insertion_watermark_mode').selectedIndex = 1;\r\n            } else {\r\n                this.setTextVisibilityMode($('watermark_mode'), 'products_images_watermark_mode');\r\n                $('image_insertion_watermark_mode').selectedIndex = 0;\r\n            }\r\n        },\r\n\r\n        stopObservingImageAttributes: function()\r\n        {\r\n            $('image_width_mode').stopObserving();\r\n            $('image_height_mode').stopObserving();\r\n            $('image_margin_mode').stopObserving();\r\n\r\n            $('select_attributes_image').stopObserving();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveWatermarkImage: function(callback, params)\r\n        {\r\n            var form  = $('edit_form');\r\n\r\n            form.action = M2ePro.url.get('ebay_template_description/saveWatermarkImage');\r\n            form.target = 'watermark_image_frame';\r\n\r\n            if ($('watermark_image_frame') === null) {\r\n                document.body.appendChild(new Element('iframe', {\r\n                    id: 'watermark_image_frame',\r\n                    name: 'watermark_image_frame',\r\n                    style: 'display: none'\r\n                }));\r\n            }\r\n\r\n            $('watermark_image_frame').observe('load', function() {\r\n                if (typeof callback == 'function') {\r\n                    callback(params);\r\n                }\r\n            });\r\n\r\n            form.submit();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initPreviewPopup: function ()\r\n        {\r\n            var popup = jQuery('#description_preview_popup');\r\n            if (!popup.find('form').length) {\r\n                popup.wrapInner(new Element('form', {\r\n                    id: 'description_preview_form',\r\n                    method: 'post',\r\n                    target: '_blank',\r\n                    action: M2ePro.url.get('ebay_template_description/preview')\r\n                }));\r\n                this.initFormValidation('#description_preview_form');\r\n            }\r\n\r\n            popup.modal({\r\n                title: M2ePro.translator.translate('Description Preview'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        if (!jQuery('#description_preview_form').valid()) {\r\n                            return;\r\n                        }\r\n\r\n                        $('description_preview_description_mode').value = $('description_mode').value;\r\n                        $('description_preview_description_template').value = $('description_template').value;\r\n                        $('description_preview_watermark_mode').value = $('watermark_mode').value;\r\n\r\n                        $('description_preview_form').submit();\r\n\r\n                        this.closeModal(event);\r\n                    }\r\n                }],\r\n                closed: function () {\r\n                    jQuery('#description_preview_form').trigger('reset').validate().resetForm();\r\n                }\r\n            });\r\n        },\r\n\r\n        openPreviewPopup: function ()\r\n        {\r\n            if ($('description_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Ebay_Template_Description::DESCRIPTION_MODE_CUSTOM') && !$('description_template').value.length) {\r\n                this.alert(M2ePro.translator.translate('Please enter Description Value.'));\r\n                return;\r\n            }\r\n\r\n            jQuery('#description_preview_popup').modal('openModal');\r\n        },\r\n\r\n        selectProductIdRandomly: function ()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('ebay_template_description/getRandomMagentoProductId'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    store_id: $('description_preview_store_id').value\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.success) {\r\n                        $('description_preview_magento_product_id').value = response.product_id;\r\n                    } else {\r\n                        self.alert(response.message);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Ebay/Template/Payment.js":"define([\n    'jquery',\n    'M2ePro/Common'\n], function (jQuery) {\n    window.EbayTemplatePayment = Class.create(Common, {\n\n        // ---------------------------------------\n\n        initialize: function()\n        {\n            jQuery.validator.addMethod('M2ePro-validate-payment-methods', function(value) {\n\n                if ($('pay_pal_mode').checked) {\n                    return true;\n                }\n\n                return $$('input[name=\"payment[services][]\"]').any(function(o) {\n                    return o.checked;\n                });\n            }, M2ePro.translator.translate('Payment method should be specified.'));\n\n            jQuery.validator.addMethod('M2ePro-validate-ebay-payment-email', function(value, el) {\n\n                var advice = Validation.getAdvice('M2ePro-validate-ebay-payment-email',el);\n                advice && advice.remove();\n\n                if (!Validation.get('M2ePro-required-when-visible').test(value,el)) {\n                    this.error = Validation.get('M2ePro-required-when-visible').error;\n                    return false;\n                }\n\n                this.error = Validation.get('validate-email').error;\n                return Validation.get('validate-email').test(value,el);\n            }, M2ePro.translator.translate('Email is not valid.'));\n        },\n\n        // ---------------------------------------\n\n        initObservers: function()\n        {\n            jQuery('#pay_pal_mode')\n                .on('change', EbayTemplatePaymentObj.payPalModeChange)\n                .trigger('change');\n            jQuery('#pay_pal_immediate_payment')\n                .on('change', EbayTemplatePaymentObj.immediatePaymentChange)\n                .trigger('change');\n        },\n\n        // ---------------------------------------\n\n        payPalModeChange: function()\n        {\n            if (this.checked) {\n                $('pay_pal_email_address_container').show();\n                $('pay_pal_immediate_payment_container').show();\n            } else {\n                $('pay_pal_email_address').setValue('');\n                $('pay_pal_email_address_container').hide();\n                $('pay_pal_immediate_payment_container').hide();\n                $('pay_pal_immediate_payment').checked = false;\n                jQuery('#pay_pal_immediate_payment').trigger('change');\n            }\n        },\n\n        // ---------------------------------------\n\n        immediatePaymentChange: function()\n        {\n            var wrapper = $('magento_block_ebay_template_payment_form_data_additional_service');\n            if (this.checked) {\n                wrapper.hide();\n\n                $$('input.additional-payment-service').each(function(payment) {\n                    payment.checked = false;\n                });\n            } else {\n                wrapper && wrapper.show();\n            }\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Template/Edit/Form.js":"define([\n    'jquery',\n    'M2ePro/Template/Edit'\n],\nfunction(jQuery) {\n\n    window.EbayTemplateEdit = Class.create(TemplateEdit, {\n\n        // ---------------------------------------\n\n        templateNick: null,\n\n        // ---------------------------------------\n\n        initialize: function()\n        {\n            jQuery.validator.addMethod('validate-title-uniqueness', function(value) {\n\n                var unique = false;\n                var templateId = 0;\n\n                if ($(EbayTemplateEditObj.templateNick + '_id')) {\n                    templateId = $(EbayTemplateEditObj.templateNick + '_id').value;\n                }\n\n                new Ajax.Request(M2ePro.url.get('ebay_template/isTitleUnique'), {\n                    method: 'post',\n                    asynchronous: false,\n                    parameters: {\n                        id_value: templateId,\n                        title: value\n                    },\n                    onSuccess: function(transport)\n                    {\n                        unique = transport.responseText.evalJSON()['unique'];\n                    }\n                });\n\n                return unique;\n            }, M2ePro.translator.translate('Policy Title is not unique.'));\n        },\n\n        // ---------------------------------------\n\n        initObservers: function ()\n        {\n            var $marketplace = jQuery('#marketplace_id');\n            if ($marketplace.length) {\n                $marketplace.on('change', this.loadTemplateData)\n                    .trigger('change');\n            } else {\n                this.loadTemplateData(null);\n            }\n        },\n\n        // ---------------------------------------\n\n        getComponent: function()\n        {\n            return 'ebay';\n        },\n\n        // ---------------------------------------\n\n        loadTemplateData: function(marketplaceId, callback)\n        {\n            if (typeof this.value != 'undefined' && this.value === '') {\n                return;\n            }\n\n            var self = EbayTemplateEditObj;\n            marketplaceId = this.value || marketplaceId;\n\n            new Ajax.Request(M2ePro.url.get('ebay_template/getTemplateHtml'), {\n                method: 'get',\n                asynchronous: true,\n                parameters: {\n                    marketplace_id: marketplaceId\n                },\n                onSuccess: function(transport) {\n\n                    var editFormData = $('edit_form_data');\n                    if (!editFormData) {\n                        editFormData = document.createElement('div');\n                        editFormData.id = 'edit_form_data';\n\n                        $('edit_form').appendChild(editFormData);\n                    }\n\n                    editFormData.innerHTML = transport.responseText;\n                    editFormData.innerHTML.extractScripts()\n                        .map(function(script) {\n                            try {\n                                eval(script);\n                            } catch(e) {}\n                        });\n\n                    var titleInput = $$('input[name=\"'+self.templateNick+'[title]\"]')[0];\n                    var marketplaceIdInput = $$('input[name=\"'+self.templateNick+'[marketplace_id]\"]')[0];\n\n                    if ($('title').value.trim() == '') {\n                        $('title').value = titleInput.value;\n                    }\n\n                    if (marketplaceIdInput) {\n                        marketplaceIdInput.value = marketplaceId;\n                    }\n\n                    callback && callback();\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        isValidForm: function()\n        {\n            var validationResult = true;\n\n            validationResult &= jQuery('#edit_form').valid();\n            validationResult &= Validation.validate($('title'));\n\n            if ($('marketplace_id')) {\n                validationResult &= Validation.validate($('marketplace_id'));\n            }\n\n            if ($('ebay_template_synchronization_edit_form_container')) {\n                //EbayTemplateSynchronizationHandlerObj.checkVirtualTabValidation();\n            }\n\n            var titleInput = $$('input[name=\"'+EbayTemplateEditObj.templateNick+'[title]\"]')[0];\n\n            if (titleInput) {\n                titleInput.value = $('title').value;\n            }\n\n            return validationResult;\n        },\n\n        // ---------------------------------------\n\n        duplicateClick: function($super, headId, chapter_when_duplicate_text, templateNick)\n        {\n            $$('input[name=\"'+templateNick+'[id]\"]')[0].value = '';\n\n            // we don't need it here, but parent method requires the formSubmitNew url to be defined\n            M2ePro.url.add({'formSubmitNew': ' '});\n\n            $super(headId, chapter_when_duplicate_text);\n        },\n\n        // ---------------------------------------\n\n        saveAndCloseClick: function(url, confirmText)\n        {\n            if (!this.isValidForm()) {\n                return;\n            }\n\n            var self = this;\n\n            if (confirmText && this.showConfirmMsg) {\n                this.confirm(this.templateNick, confirmText, function () {\n                    self.saveFormUsingAjax(url, self.templateNick);\n                });\n                return;\n            }\n\n            self.saveFormUsingAjax(url, self.templateNick);\n        },\n\n        saveFormUsingAjax: function (url, templateNick)\n        {\n            new Ajax.Request(url, {\n                method: 'post',\n                parameters: Form.serialize($('edit_form')),\n                onSuccess: function(transport) {\n                    var templates = transport.responseText.evalJSON();\n\n                    if (templates.length && templates[0].nick == templateNick) {\n                        window.close();\n                    } else {\n                        console.error('Policy Saving Error');\n                    }\n                }\n            });\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Ebay/Configuration/General.js":"define(['knockout'], function(ko){\r\n    return {\r\n        mode: ko.observable()\r\n    }\r\n});","Ess_M2ePro/js/Ebay/Configuration/Account/ListingOther.js":"define(['knockout'], function(ko){\r\n    return {\r\n        synchronization: ko.observable(),\r\n        mappingMode: ko.observable(),\r\n        mappingSkuMode: ko.observable(),\r\n        mappingTitleMode: ko.observable(),\r\n    }\r\n});","Ess_M2ePro/js/Order/Debug.js":"define(function () {\r\n\r\n    var debugKeys = [68, 69, 66, 85, 71];\r\n    var debugPressedKeys = [];\r\n\r\n    document.observe('keydown', function(event) {\r\n\r\n        if (debugPressedKeys.length < debugKeys.length) {\r\n            if (debugKeys[debugPressedKeys.length] == event.keyCode) {\r\n                debugPressedKeys.push(event.keyCode);\r\n                if (debugPressedKeys.length == debugKeys.length) {\r\n\r\n                    if (!$('magento_block_debug_information')) {\r\n                        new Ajax.Request(M2ePro.url.get('order/getDebugInformation'), {\r\n                            method: 'get',\r\n                            asynchronous: true,\r\n                            onSuccess: function(transport)\r\n                            {\r\n                                $$('.content-header')[0].insert({\r\n                                    after: transport.responseText\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    debugPressedKeys = [];\r\n                }\r\n            } else {\r\n                debugPressedKeys = [];\r\n            }\r\n        }\r\n    });\r\n});","Ess_M2ePro/js/Order/Edit/Item.js":"define([\n    'M2ePro/Plugin/Messages',\n    'M2ePro/Common',\n    'Magento_Ui/js/modal/modal'\n], function (MessageObj) {\n\n    OrderEditItem = Class.create(Common, {\n\n        // ---------------------------------------\n\n        initialize: function()\n        {\n            this.popUp = null;\n            this.gridId = null;\n            this.orderItemId = null;\n        },\n\n        // ---------------------------------------\n\n        openPopUpMappingProduct: function(title, content)\n        {\n            var self = this;\n            var mappingProductModal = $('mapping_product_modal');\n\n            if (!mappingProductModal) {\n                mappingProductModal = new Element('div', {\n                    id: 'mapping_product_modal'\n                });\n            }\n\n            mappingProductModal.innerHTML = '';\n\n            this.mappingProductPopUp = jQuery(mappingProductModal).modal({\n                closed: function () {\n                    self.reloadGrid();\n                    self.orderItemId = null;\n                    self.gridId = null;\n                    self.mappingProductPopUp = null;\n                },\n                title: title,\n                type: 'slide',\n                buttons: []\n            });\n\n            this.mappingProductPopUp.modal('openModal');\n\n            mappingProductModal.insert(content);\n        },\n\n        openPopUpMappingOptions: function(title, content)\n        {\n            var self = this;\n            var mappingOptions = $('mapping_product_options');\n\n            if (!mappingOptions) {\n                mappingOptions = new Element('div', {\n                    id: 'mapping_product_options'\n                });\n            }\n\n            mappingOptions.innerHTML = '';\n\n            this.mappingOptionsPopUp = jQuery(mappingOptions).modal({\n                closed: function () {\n                    if (self.mappingProductPopUp) {\n                        self.mappingProductPopUp.modal('closeModal');\n                        return;\n                    }\n                    self.reloadGrid();\n                    self.orderItemId = null;\n                    self.gridId = null;\n                    self.mappingOptionsPopUp = null;\n                },\n                title: title,\n                type: 'slide',\n                buttons: [{\n                    text: M2ePro.translator.translate('Cancel'),\n                    click: function () {\n                        self.closePopUp();\n                    }\n                },{\n                    text: M2ePro.translator.translate('Confirm'),\n                    class: 'primary',\n                    click: function () {\n                        self.assignProductDetails();\n                    }\n                }]\n            });\n\n            this.mappingOptionsPopUp.modal('openModal');\n\n            mappingOptions.insert(content);\n            self.initMappingOptionsPopUp();\n        },\n\n        initMappingOptionsPopUp: function()\n        {\n            $$('.form-element').each(function (element) {\n                element.observe('change', function() {\n                    if (element.selectedIndex != 0) {\n                        CommonObj.hideEmptyOption(element);\n                    }\n\n                    var hasEmptyOptions = $$('.form-element').any(function(element) { return element.value == '' });\n                    if (hasEmptyOptions) {\n                        return;\n                    }\n\n                    new Ajax.Request(M2ePro.url.get('order/checkProductOptionStockAvailability'), {\n                        method: 'get',\n                        parameters: Form.serialize('mapping_product_options'),\n                        onSuccess: function(transport) {\n                            var isInStock = transport.responseText.evalJSON()['is_in_stock'];\n\n                            if (!isInStock) {\n                                $('selected_product_option_is_out_of_stock').show();\n                            } else {\n                                $('selected_product_option_is_out_of_stock').hide();\n                            }\n                        }\n                    });\n                });\n                element.simulate('change');\n            });\n        },\n\n        closePopUp: function()\n        {\n            if (this.mappingProductPopUp) {\n                this.mappingProductPopUp.modal('closeModal');\n            }\n            if (this.mappingOptionsPopUp) {\n                this.mappingOptionsPopUp.modal('closeModal');\n            }\n        },\n\n        reloadGrid: function()\n        {\n            var grid = window[this.gridId + 'JsObject'];\n\n            if (grid) {\n                grid.doFilter();\n            }\n        },\n\n        edit: function(gridId, orderItemId)\n        {\n            var self = this;\n\n            self.gridId = gridId;\n            self.orderItemId = orderItemId;\n\n            self.getItemEditHtml(orderItemId, function(transport) {\n                var response = transport.responseText.evalJSON();\n\n                if (response.error) {\n                    if (self.popUp) {\n                        self.alert(response.error, function () {\n                            self.closePopUp();\n                        });\n                    } else {\n                        MessageObj.addErrorMessage(response.error);\n                    }\n\n                    return;\n                }\n\n                var title = response.title;\n                var content = response.html;\n\n                if (response.type == M2ePro.php.constant('Ess_M2ePro_Controller_Adminhtml_Order_EditItem::MAPPING_PRODUCT')) {\n                    self.openPopUpMappingProduct(title, content);\n                } else if (response.type == M2ePro.php.constant('Ess_M2ePro_Controller_Adminhtml_Order_EditItem::MAPPING_OPTIONS')) {\n                    self.openPopUpMappingOptions(title, content);\n                }\n            });\n        },\n\n        getItemEditHtml: function(itemId, callback)\n        {\n            new Ajax.Request(M2ePro.url.get('order/editItem'), {\n                method: 'get',\n                parameters: {\n                    item_id: itemId\n                },\n                onSuccess: function(transport) {\n                    if (typeof callback == 'function') {\n                        callback(transport);\n                    }\n                }\n            });\n        },\n\n        afterActionCallback: function(transport)\n        {\n            var self = this;\n            var response = transport.responseText.evalJSON();\n\n            if (response.error) {\n                MessageObj.addErrorMessage(response.error);\n                return;\n            }\n\n            if (response.continue) {\n                self.edit(self.gridId, self.orderItemId);\n                return;\n            }\n\n            if (response.success) {\n                self.closePopUp();\n                self.scrollPageToTop();\n                MessageObj.addSuccessMessage(response.success);\n            }\n        },\n\n        // ---------------------------------------\n\n        assignProduct: function(id, productSku)\n        {\n            var self = this;\n            var productId = +id || '';\n            var sku = productSku || '';\n            var orderItemId = self.orderItemId;\n\n            MessageObj.clear();\n\n            if (orderItemId == '' || (/^\\s*(\\d)*\\s*$/i).test(orderItemId) == false) {\n                return;\n            }\n\n            if (sku == '' && productId == '') {\n                self.alert(M2ePro.translator.translate('Please enter correct Product ID or SKU.'));\n                return;\n            }\n\n            if (((/^\\s*(\\d)*\\s*$/i).test(productId) == false)) {\n                self.alert(M2ePro.translator.translate('Please enter correct Product ID.'));\n                return;\n            }\n\n            self.confirm({\n                actions: {\n                    confirm: function () {\n                        new Ajax.Request(M2ePro.url.get('order/assignProduct'), {\n                            method: 'post',\n                            parameters: {\n                                product_id: productId,\n                                sku: sku,\n                                order_item_id: orderItemId\n                            },\n                            onSuccess: self.afterActionCallback.bind(self)\n                        });\n                    },\n                    cancel: function () {\n                        return false;\n                    }\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        assignProductDetails: function()\n        {\n            var self = this,\n                confirmAction,\n                validationResult = $$('.form-element').collect(Validation.validate);\n\n            if (validationResult.indexOf(false) != -1) {\n                return;\n            }\n\n            confirmAction = function () {\n                new Ajax.Request(M2ePro.url.get('order/assignProductDetails'), {\n                    method: 'post',\n                    parameters: Form.serialize('mapping_product_options'),\n                    onSuccess: self.afterActionCallback.bind(self)\n                });\n            };\n\n            if ($('save_repair') && $('save_repair').checked) {\n                self.confirm({\n                    actions: {\n                        confirm: function () {\n                            confirmAction();\n                        },\n                        cancel: function () {\n                            return false;\n                        }\n                    }\n                });\n            } else {\n                confirmAction();\n            }\n        },\n\n        // ---------------------------------------\n\n        unassignProduct: function(gridId, orderItemId)\n        {\n            var self = this;\n\n            self.confirm({\n                actions: {\n                    confirm: function () {\n                        self.gridId = gridId;\n                        self.orderItemId = orderItemId;\n\n                        new Ajax.Request(M2ePro.url.get('order/unassignProduct'), {\n                            method: 'post',\n                            parameters: {\n                                order_item_id: orderItemId\n                            },\n                            onSuccess: function(transport) {\n                                self.afterActionCallback(transport);\n                                self.reloadGrid();\n                                self.gridId = null;\n                                self.orderItemId = null;\n                            }\n                        });\n                    },\n                    cancel: function () {\n                        return false;\n                    }\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        openEditShippingAddressPopup: function (orderId)\n        {\n            var self = this;\n            var shippingAddressModal = $('shipping_address_modal');\n\n            if (!shippingAddressModal) {\n                shippingAddressModal = new Element('div', {\n                    id: 'shipping_address_modal'\n                });\n            }\n\n            shippingAddressModal.innerHTML = '';\n\n            this.editShippingAddressPopUp = jQuery(shippingAddressModal).modal({\n                closed: function () {\n\n                },\n                title: M2ePro.translator.translate('Edit Shipping Address'),\n                type: 'slide',\n                buttons: [{\n                    text: M2ePro.translator.translate('Cancel'),\n                    click: function () {\n                        self.editShippingAddressPopUp.modal('closeModal');\n                    }\n                },{\n                    text: M2ePro.translator.translate('Save'),\n                    class: 'primary',\n                    click: function () {\n                        self.saveShippingAddress();\n                    }\n                }]\n            });\n\n            new Ajax.Request(M2ePro.url.get('getEditShippingAddressForm'), {\n                method: 'post',\n                parameters: {\n                    id: orderId\n                },\n                onSuccess: function(transport) {\n                    shippingAddressModal.insert(transport.responseText);\n\n                    self.initFormValidation('#edit_form');\n                    self.editShippingAddressPopUp.modal('openModal');\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        saveShippingAddress: function ()\n        {\n            var self = this;\n\n            if (!self.isValidForm()) {\n                return;\n            }\n\n            new Ajax.Request(M2ePro.url.get('saveShippingAddress'), {\n                method: 'post',\n                parameters: Form.serialize($('edit_form')),\n                onSuccess: function(transport) {\n                    var result = transport.responseText.evalJSON();\n\n                    if (result.success) {\n                        $('shipping_address_container').update(result.html);\n                        self.editShippingAddressPopUp.modal('closeModal');\n                    }\n                }\n            });\n        }\n    });\n});\n","Ess_M2ePro/js/Order/Edit/ShippingAddress.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    OrderEditShippingAddress = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function(countryElementId, regionContainerElementId, regionElementName)\r\n        {\r\n            this.countryElementId = countryElementId;\r\n            this.regionContainerElementId = regionContainerElementId;\r\n            this.regionElementName = regionElementName;\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('country_code')\r\n                .observe('change', OrderEditShippingAddressObj.countryCodeChange)\r\n                .simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        countryCodeChange: function()\r\n        {\r\n            var self = OrderEditShippingAddressObj;\r\n\r\n            new Ajax.Request(M2ePro.url.get('order/getCountryRegions'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    country: $(self.countryElementId).value\r\n                },\r\n                onSuccess: function(transport) {\r\n                    self.renderRegions(transport.responseText.evalJSON(true));\r\n                }\r\n            });\r\n        },\r\n\r\n        renderRegions: function(data)\r\n        {\r\n            var self = OrderEditShippingAddressObj,\r\n                regionContainer = $(self.regionContainerElementId).select('.control')[0],\r\n                html = '';\r\n\r\n            if (data.length == 0) {\r\n                html = '<input type=\"text\" name=\"%name%\" class=\"input-text admin__control-text\" value=\"%value%\" />'\r\n                    .replace(/%name%/, self.regionElementName)\r\n                    .replace(/%value%/, M2ePro.formData.region);\r\n            } else {\r\n                html += '<select class=\"admin__control-select\" name=\"'+self.regionElementName+'\">';\r\n                data.each(function(item) {\r\n                    var selected = (item.value == M2ePro.formData.region) ? 'selected=\"selected\"' : '';\r\n                    html += '<option value=\"'+item.value+'\" '+selected+'>'+item.label+'</option>';\r\n                });\r\n                html += '</select>';\r\n            }\r\n\r\n            regionContainer.innerHTML = html;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Log/View.js":"define([\r\n    'M2ePro/Plugin/RandomColor',\r\n    'M2ePro/Plugin/Messages'\r\n], function (RandomColor, MessagesObj) {\r\n\r\n    window.LogView = Class.create(Common, {\r\n\r\n        notificationWasAdded: false,\r\n\r\n        processColorMapping: function () {\r\n\r\n            if (\r\n                !LogViewObj.notificationWasAdded\r\n                && !_.isUndefined(M2ePro.formData.maxAllowedLogsCountExceededNotification)\r\n            ) {\r\n                LogViewObj.notificationWasAdded = true;\r\n                MessagesObj.addNoticeMessage(M2ePro.formData.maxAllowedLogsCountExceededNotification);\r\n            }\r\n\r\n            jQuery('.data-grid tbody tr:not(.data-grid-tr-no-data)').each(function () {\r\n\r\n                var row = jQuery(this);\r\n                var logHash = row.find('.log-hash').text().trim();\r\n\r\n                if (!logHash.length) {\r\n                    return;\r\n                }\r\n\r\n                var color = RandomColor({\r\n                    seed: +logHash\r\n                });\r\n\r\n                row.find('td:first').css({\r\n                    borderLeftWidth: '7px',\r\n                    borderLeftColor: '#' + color\r\n                });\r\n            });\r\n        }\r\n    });\r\n\r\n});","Ess_M2ePro/js/General/Common.js":"define([\r\n    'underscore'\r\n], function (_) {\r\n    return {\r\n        extend: function(extendBy) {\r\n            return _.extend({}, this, extendBy);\r\n        },\r\n        init: function() {\r\n\r\n        }\r\n    };\r\n});","Ess_M2ePro/js/General/Url.js":"define(['M2ePro/General/Common', 'underscore'], function(Common, _) {\r\n\r\n    return Common.extend({\r\n        urls: {},\r\n\r\n        add: function(urls)\r\n        {\r\n            _.extend(this.urls, urls);\r\n        },\r\n\r\n        get: function(route, params)\r\n        {\r\n            params = params || {};\r\n\r\n            if (!this.urls[route]) {\r\n                alert('Route \"' + route +'\" not found');\r\n                throw new Error('Route \"' + route +'\" not found');\r\n            }\r\n\r\n            var returnUrl = this.urls[route];\r\n\r\n            for (var key in params) {\r\n                if (!params.hasOwnProperty(key)) {\r\n                    continue\r\n                }\r\n                returnUrl += key + '/' + params[key] + '/';\r\n            }\r\n\r\n            return returnUrl;\r\n        }\r\n    });\r\n\r\n});","Ess_M2ePro/js/General/PhpFunctions.js":"define([], function(){\r\n\r\n    window.implode = function implode(glue, pieces)\r\n    {\r\n        return ((pieces instanceof Array) ? pieces.join (glue) : pieces);\r\n    };\r\n\r\n    window.explode = function explode(delimiter, string)\r\n    {\r\n        var emptyArray = { 0: '' };\r\n\r\n        if (arguments.length != 2\r\n            || typeof arguments[0] == 'undefined'\r\n            || typeof arguments[1] == 'undefined'\r\n        ) {\r\n            return null;\r\n        }\r\n\r\n        if (delimiter === ''\r\n            || delimiter === false\r\n            || delimiter === null\r\n        ) {\r\n            return false;\r\n        }\r\n\r\n        if (typeof delimiter == 'function'\r\n            || typeof delimiter == 'object'\r\n            || typeof string == 'function'\r\n            || typeof string == 'object'\r\n        ) {\r\n            return emptyArray;\r\n        }\r\n\r\n        if (delimiter === true) {\r\n            delimiter = '1';\r\n        }\r\n\r\n        return string.toString().split (delimiter.toString());\r\n    };\r\n\r\n    window.array_unique = function array_unique(array)\r\n    {\r\n        var p, i, j;\r\n        for (i = array.length; i;) {\r\n            for (p = --i; p > 0;) {\r\n                if (array[i] === array[--p]) {\r\n                    for (j = p; --p && array[i] === array[p];);\r\n                    i -= array.splice(p + 1, j - p).length;\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    window.trim = function trim(value)\r\n    {\r\n        var re = /\\s*((\\S+\\s*)*)/;\r\n        value = value.replace(re, \"$1\");\r\n\r\n        var re = /((\\s*\\S+)*)\\s*/;\r\n        value = value.replace(re, \"$1\");\r\n\r\n        return value;\r\n    };\r\n\r\n    window.ltrim = function ltrim(str, charlist)\r\n    {\r\n        charlist = !charlist ? ' \\\\s\\u00A0' : (charlist+'').replace(/([\\[\\]\\(\\)\\.\\?\\/\\*\\{\\}\\+\\$\\^\\:])/g, '$1');\r\n        var re = new RegExp('^[' + charlist + ']+', 'g');\r\n        return (str+'').replace(re, '');\r\n    };\r\n\r\n    window.rtrim = function rtrim(str, charlist)\r\n    {\r\n        charlist = !charlist ? ' \\\\s\\u00A0' : (charlist+'').replace(/([\\[\\]\\(\\)\\.\\?\\/\\*\\{\\}\\+\\$\\^\\:])/g, '\\\\$1');\r\n        var re = new RegExp('[' + charlist + ']+$', 'g');\r\n        return (str+'').replace(re, '');\r\n    };\r\n\r\n    window.getCookie = function getCookie(c_name)\r\n    {\r\n        if (document.cookie.length>0) {\r\n            c_start = document.cookie.indexOf(c_name + \"=\");\r\n            if (c_start != -1) {\r\n                c_start = c_start + c_name.length+1;\r\n                c_end=document.cookie.indexOf(\";\",c_start);\r\n                if (c_end==-1) c_end=document.cookie.length;\r\n                return unescape(document.cookie.substring(c_start,c_end));\r\n            }\r\n        }\r\n        return \"\";\r\n    };\r\n\r\n    window.setCookie = function setCookie(name, value, expires, path, domain, secure)\r\n    {\r\n        document.cookie = name + \"=\" + escape(value) +\r\n            ((expires) ? \"; expires=\" + \"Mon, 01-Jan-2020 00:00:00 GMT\" : \"\") +\r\n            ((path) ? \"; path=\" + path : \"\") +\r\n            ((domain) ? \"; domain=\" + domain : \"\") +\r\n            ((secure) ? \"; secure\" : \"\");\r\n    };\r\n\r\n    window.deleteCookie = function deleteCookie(name, path, domain)\r\n    {\r\n        if (getCookie(name)) {\r\n            document.cookie = name + \"=\" +\r\n                ((path) ? \";path=\" + path : \"\") +\r\n                ((domain) ? \";domain=\" + domain : \"\") +\r\n                \";expires=Thu, 01-Jan-1970 00:00:01 GMT\";\r\n        }\r\n    };\r\n\r\n    window.ucwords = function ucwords(str)\r\n    {\r\n        return (str + '').replace(/^([a-z])|\\s+([a-z])/g, function($1) {\r\n            return $1.toUpperCase();\r\n        });\r\n    };\r\n\r\n    window.strip_tags = function strip_tags(input, allowed)\r\n    {\r\n        allowed = (((allowed || \"\") + \"\").toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join(''); // making sure the allowed arg is a string containing only tags in lowercase (<a><b><c>)\r\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi,\r\n            commentsAndPhpTags = /<!--[\\s\\S]*?-->|<\\?(?:php)?[\\s\\S]*?\\?>/gi;\r\n        return input.replace(commentsAndPhpTags, '').replace(tags, function($0, $1) {        return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : '';\r\n        });\r\n    };\r\n\r\n    window.sha1 = function sha1(str)\r\n    {\r\n        var rotate_left = function(n,s) {\r\n            var t4 = (n<<s) | (n>>>(32-s));\r\n            return t4;\r\n        };\r\n\r\n        var lsb_hex = function(val) {\r\n            var str=\"\";\r\n            var i;\r\n            var vh;\r\n            var vl;\r\n\r\n            for(i=0; i<=6; i+=2) {\r\n                vh = (val>>>(i*4+4))&0x0f;\r\n                vl = (val>>>(i*4))&0x0f;\r\n                str += vh.toString(16) + vl.toString(16);\r\n            }\r\n            return str;\r\n        };\r\n\r\n        var cvt_hex = function(val) {\r\n            var str=\"\";\r\n            var i;\r\n            var v;\r\n\r\n            for(i=7; i>=0; i--) {\r\n                v = (val>>>(i*4))&0x0f;\r\n                str += v.toString(16);\r\n            }\r\n            return str;\r\n        };\r\n\r\n        var blockstart;\r\n        var i, j;\r\n        var W = new Array(80);\r\n        var H0 = 0x67452301;\r\n        var H1 = 0xEFCDAB89;\r\n        var H2 = 0x98BADCFE;\r\n        var H3 = 0x10325476;\r\n        var H4 = 0xC3D2E1F0;\r\n        var A, B, C, D, E;\r\n        var temp;\r\n\r\n        str = this.utf8_encode(str);\r\n        var str_len = str.length;\r\n\r\n        var word_array = new Array();\r\n        for(i=0; i<str_len-3; i+=4) {\r\n            j = str.charCodeAt(i)<<24 | str.charCodeAt(i+1)<<16 |\r\n                str.charCodeAt(i+2)<<8 | str.charCodeAt(i+3);\r\n            word_array.push(j);\r\n        }\r\n\r\n        switch (str_len % 4) {\r\n            case 0:\r\n                i = 0x080000000;\r\n                break;\r\n            case 1:\r\n                i = str.charCodeAt(str_len-1)<<24 | 0x0800000;\r\n                break;\r\n            case 2:\r\n                i = str.charCodeAt(str_len-2)<<24 | str.charCodeAt(str_len-1)<<16 | 0x08000;\r\n                break;\r\n            case 3:\r\n                i = str.charCodeAt(str_len-3)<<24 | str.charCodeAt(str_len-2)<<16 | str.charCodeAt(str_len-1)<<8    | 0x80;\r\n                break;\r\n        }\r\n\r\n        word_array.push(i);\r\n\r\n        while((word_array.length % 16) != 14) word_array.push(0);\r\n\r\n        word_array.push(str_len>>>29);\r\n        word_array.push((str_len<<3)&0x0ffffffff);\r\n\r\n        for (blockstart=0; blockstart<word_array.length; blockstart+=16) {\r\n            for(i=0; i<16; i++) W[i] = word_array[blockstart+i];\r\n            for(i=16; i<=79; i++) W[i] = rotate_left(W[i-3] ^ W[i-8] ^ W[i-14] ^ W[i-16], 1);\r\n\r\n            A = H0;\r\n            B = H1;\r\n            C = H2;\r\n            D = H3;\r\n            E = H4;\r\n\r\n            for(i= 0; i<=19; i++) {\r\n                temp = (rotate_left(A,5) + ((B&C) | (~B&D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;\r\n                E = D;\r\n                D = C;\r\n                C = rotate_left(B,30);\r\n                B = A;\r\n                A = temp;\r\n            }\r\n\r\n            for(i=20; i<=39; i++) {\r\n                temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;\r\n                E = D;\r\n                D = C;\r\n                C = rotate_left(B,30);\r\n                B = A;\r\n                A = temp;\r\n            }\r\n\r\n            for(i=40; i<=59; i++) {\r\n                temp = (rotate_left(A,5) + ((B&C) | (B&D) | (C&D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;\r\n                E = D;\r\n                D = C;\r\n                C = rotate_left(B,30);\r\n                B = A;\r\n                A = temp;\r\n            }\r\n\r\n            for(i=60; i<=79; i++) {\r\n                temp = (rotate_left(A,5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;\r\n                E = D;\r\n                D = C;\r\n                C = rotate_left(B,30);\r\n                B = A;\r\n                A = temp;\r\n            }\r\n\r\n            H0 = (H0 + A) & 0x0ffffffff;\r\n            H1 = (H1 + B) & 0x0ffffffff;\r\n            H2 = (H2 + C) & 0x0ffffffff;\r\n            H3 = (H3 + D) & 0x0ffffffff;\r\n            H4 = (H4 + E) & 0x0ffffffff;\r\n        }\r\n\r\n        var temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);\r\n        return temp.toLowerCase();\r\n    };\r\n\r\n    window.utf8_encode = function utf8_encode(str_data)\r\n    {\r\n        str_data = str_data.replace(/\\r\\n/g,\"\\n\");\r\n        var utftext = \"\";\r\n\r\n        for (var n = 0; n < str_data.length; n++) {\r\n            var c = str_data.charCodeAt(n);\r\n            if (c < 128) {\r\n                utftext += String.fromCharCode(c);\r\n            } else if ((c > 127) && (c < 2048)) {\r\n                utftext += String.fromCharCode((c >> 6) | 192);\r\n                utftext += String.fromCharCode((c & 63) | 128);\r\n            } else {\r\n                utftext += String.fromCharCode((c >> 12) | 224);\r\n                utftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n                utftext += String.fromCharCode((c & 63) | 128);\r\n            }\r\n        }\r\n\r\n        return utftext;\r\n    };\r\n\r\n    window.utf8_decode = function utf8_decode(utftext)\r\n    {\r\n        var string = \"\";\r\n        var i = 0;\r\n        var c = c1 = c2 = 0;\r\n\r\n        while (i < utftext.length) {\r\n\r\n            c = utftext.charCodeAt(i);\r\n\r\n            if (c < 128) {\r\n                string += String.fromCharCode(c);\r\n                i++;\r\n            } else if((c > 191) && (c < 224)) {\r\n                c2 = utftext.charCodeAt(i+1);\r\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n                i += 2;\r\n            } else {\r\n                c2 = utftext.charCodeAt(i+1);\r\n                c3 = utftext.charCodeAt(i+2);\r\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n                i += 3;\r\n            }\r\n        }\r\n\r\n        return string;\r\n    };\r\n\r\n    window.md5 = function md5(str)\r\n    {\r\n        var RotateLeft = function(lValue, iShiftBits) {\r\n            return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));\r\n        };\r\n\r\n        var AddUnsigned = function(lX,lY) {\r\n            var lX4,lY4,lX8,lY8,lResult;\r\n            lX8 = (lX & 0x80000000);\r\n            lY8 = (lY & 0x80000000);\r\n            lX4 = (lX & 0x40000000);\r\n            lY4 = (lY & 0x40000000);\r\n            lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);\r\n            if (lX4 & lY4) {\r\n                return (lResult ^ 0x80000000 ^ lX8 ^ lY8);\r\n            }\r\n            if (lX4 | lY4) {\r\n                if (lResult & 0x40000000) {\r\n                    return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);\r\n                } else {\r\n                    return (lResult ^ 0x40000000 ^ lX8 ^ lY8);\r\n                }\r\n            } else {\r\n                return (lResult ^ lX8 ^ lY8);\r\n            }\r\n        };\r\n\r\n        var F = function(x,y,z) { return (x & y) | ((~x) & z); };\r\n        var G = function(x,y,z) { return (x & z) | (y & (~z)); };\r\n        var H = function(x,y,z) { return (x ^ y ^ z); };\r\n        var I = function(x,y,z) { return (y ^ (x | (~z))); };\r\n\r\n        var FF = function(a,b,c,d,x,s,ac) {\r\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));\r\n            return AddUnsigned(RotateLeft(a, s), b);\r\n        };\r\n\r\n        var GG = function(a,b,c,d,x,s,ac) {\r\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));\r\n            return AddUnsigned(RotateLeft(a, s), b);\r\n        };\r\n\r\n        var HH = function(a,b,c,d,x,s,ac) {\r\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));\r\n            return AddUnsigned(RotateLeft(a, s), b);\r\n        };\r\n\r\n        var II = function(a,b,c,d,x,s,ac) {\r\n            a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));\r\n            return AddUnsigned(RotateLeft(a, s), b);\r\n        };\r\n\r\n        var ConvertToWordArray = function(str) {\r\n            var lWordCount;\r\n            var lMessageLength = str.length;\r\n            var lNumberOfWords_temp1=lMessageLength + 8;\r\n            var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;\r\n            var lNumberOfWords = (lNumberOfWords_temp2+1)*16;\r\n            var lWordArray=Array(lNumberOfWords-1);\r\n            var lBytePosition = 0;\r\n            var lByteCount = 0;\r\n            while (lByteCount < lMessageLength) {\r\n                lWordCount = (lByteCount-(lByteCount % 4))/4;\r\n                lBytePosition = (lByteCount % 4)*8;\r\n                lWordArray[lWordCount] = (lWordArray[lWordCount] | (str.charCodeAt(lByteCount)<<lBytePosition));\r\n                lByteCount++;\r\n            }\r\n            lWordCount = (lByteCount-(lByteCount % 4))/4;\r\n            lBytePosition = (lByteCount % 4)*8;\r\n            lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);\r\n            lWordArray[lNumberOfWords-2] = lMessageLength<<3;\r\n            lWordArray[lNumberOfWords-1] = lMessageLength>>>29;\r\n            return lWordArray;\r\n        };\r\n\r\n        var WordToHex = function(lValue) {\r\n            var WordToHexValue=\"\",WordToHexValue_temp=\"\",lByte,lCount;\r\n            for (lCount = 0;lCount<=3;lCount++) {\r\n                lByte = (lValue>>>(lCount*8)) & 255;\r\n                WordToHexValue_temp = \"0\" + lByte.toString(16);\r\n                WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);\r\n            }\r\n            return WordToHexValue;\r\n        };\r\n\r\n        var x=Array();\r\n        var k,AA,BB,CC,DD,a,b,c,d;\r\n        var S11=7, S12=12, S13=17, S14=22;\r\n        var S21=5, S22=9 , S23=14, S24=20;\r\n        var S31=4, S32=11, S33=16, S34=23;\r\n        var S41=6, S42=10, S43=15, S44=21;\r\n\r\n        str = this.utf8_encode(str);\r\n        x = ConvertToWordArray(str);\r\n        a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;\r\n\r\n        for (k=0;k<x.length;k+=16) {\r\n            AA=a; BB=b; CC=c; DD=d;\r\n            a=FF(a,b,c,d,x[k+0], S11,0xD76AA478);\r\n            d=FF(d,a,b,c,x[k+1], S12,0xE8C7B756);\r\n            c=FF(c,d,a,b,x[k+2], S13,0x242070DB);\r\n            b=FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);\r\n            a=FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);\r\n            d=FF(d,a,b,c,x[k+5], S12,0x4787C62A);\r\n            c=FF(c,d,a,b,x[k+6], S13,0xA8304613);\r\n            b=FF(b,c,d,a,x[k+7], S14,0xFD469501);\r\n            a=FF(a,b,c,d,x[k+8], S11,0x698098D8);\r\n            d=FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);\r\n            c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);\r\n            b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);\r\n            a=FF(a,b,c,d,x[k+12],S11,0x6B901122);\r\n            d=FF(d,a,b,c,x[k+13],S12,0xFD987193);\r\n            c=FF(c,d,a,b,x[k+14],S13,0xA679438E);\r\n            b=FF(b,c,d,a,x[k+15],S14,0x49B40821);\r\n            a=GG(a,b,c,d,x[k+1], S21,0xF61E2562);\r\n            d=GG(d,a,b,c,x[k+6], S22,0xC040B340);\r\n            c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);\r\n            b=GG(b,c,d,a,x[k+0], S24,0xE9B6C7AA);\r\n            a=GG(a,b,c,d,x[k+5], S21,0xD62F105D);\r\n            d=GG(d,a,b,c,x[k+10],S22,0x2441453);\r\n            c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);\r\n            b=GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);\r\n            a=GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);\r\n            d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);\r\n            c=GG(c,d,a,b,x[k+3], S23,0xF4D50D87);\r\n            b=GG(b,c,d,a,x[k+8], S24,0x455A14ED);\r\n            a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);\r\n            d=GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);\r\n            c=GG(c,d,a,b,x[k+7], S23,0x676F02D9);\r\n            b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);\r\n            a=HH(a,b,c,d,x[k+5], S31,0xFFFA3942);\r\n            d=HH(d,a,b,c,x[k+8], S32,0x8771F681);\r\n            c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);\r\n            b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);\r\n            a=HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);\r\n            d=HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);\r\n            c=HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);\r\n            b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);\r\n            a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);\r\n            d=HH(d,a,b,c,x[k+0], S32,0xEAA127FA);\r\n            c=HH(c,d,a,b,x[k+3], S33,0xD4EF3085);\r\n            b=HH(b,c,d,a,x[k+6], S34,0x4881D05);\r\n            a=HH(a,b,c,d,x[k+9], S31,0xD9D4D039);\r\n            d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);\r\n            c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);\r\n            b=HH(b,c,d,a,x[k+2], S34,0xC4AC5665);\r\n            a=II(a,b,c,d,x[k+0], S41,0xF4292244);\r\n            d=II(d,a,b,c,x[k+7], S42,0x432AFF97);\r\n            c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);\r\n            b=II(b,c,d,a,x[k+5], S44,0xFC93A039);\r\n            a=II(a,b,c,d,x[k+12],S41,0x655B59C3);\r\n            d=II(d,a,b,c,x[k+3], S42,0x8F0CCC92);\r\n            c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);\r\n            b=II(b,c,d,a,x[k+1], S44,0x85845DD1);\r\n            a=II(a,b,c,d,x[k+8], S41,0x6FA87E4F);\r\n            d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);\r\n            c=II(c,d,a,b,x[k+6], S43,0xA3014314);\r\n            b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);\r\n            a=II(a,b,c,d,x[k+4], S41,0xF7537E82);\r\n            d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);\r\n            c=II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);\r\n            b=II(b,c,d,a,x[k+9], S44,0xEB86D391);\r\n            a=AddUnsigned(a,AA);\r\n            b=AddUnsigned(b,BB);\r\n            c=AddUnsigned(c,CC);\r\n            d=AddUnsigned(d,DD);\r\n        }\r\n\r\n        var temp = WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);\r\n\r\n        return temp.toLowerCase();\r\n    };\r\n\r\n    window.base64_encode = function base64_encode(input)\r\n    {\r\n        var keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\r\n        var output = \"\";\r\n        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n        var i = 0;\r\n\r\n        input = utf8_encode(input);\r\n\r\n        while (i < input.length) {\r\n\r\n            chr1 = input.charCodeAt(i++);\r\n            chr2 = input.charCodeAt(i++);\r\n            chr3 = input.charCodeAt(i++);\r\n\r\n            enc1 = chr1 >> 2;\r\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n            enc4 = chr3 & 63;\r\n\r\n            if (isNaN(chr2)) {\r\n                enc3 = enc4 = 64;\r\n            } else if (isNaN(chr3)) {\r\n                enc4 = 64;\r\n            }\r\n\r\n            output = output +\r\n                keyStr.charAt(enc1) + keyStr.charAt(enc2) +\r\n                keyStr.charAt(enc3) + keyStr.charAt(enc4);\r\n\r\n        }\r\n\r\n        return output;\r\n    };\r\n\r\n    window.base64_decode = function base64_decode(input)\r\n    {\r\n        var keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\r\n        var output = \"\";\r\n        var chr1, chr2, chr3;\r\n        var enc1, enc2, enc3, enc4;\r\n        var i = 0;\r\n\r\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n\r\n        while (i < input.length) {\r\n\r\n            enc1 = keyStr.indexOf(input.charAt(i++));\r\n            enc2 = keyStr.indexOf(input.charAt(i++));\r\n            enc3 = keyStr.indexOf(input.charAt(i++));\r\n            enc4 = keyStr.indexOf(input.charAt(i++));\r\n\r\n            chr1 = (enc1 << 2) | (enc2 >> 4);\r\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n            chr3 = ((enc3 & 3) << 6) | enc4;\r\n\r\n            output = output + String.fromCharCode(chr1);\r\n\r\n            if (enc3 != 64) {\r\n                output = output + String.fromCharCode(chr2);\r\n            }\r\n            if (enc4 != 64) {\r\n                output = output + String.fromCharCode(chr3);\r\n            }\r\n        }\r\n\r\n        output = utf8_decode(output);\r\n\r\n        return output;\r\n\r\n    };\r\n\r\n    window.strpos = function strpos(haystack, needle, offset)\r\n    {\r\n        var i = haystack.indexOf(needle, offset); // returns -1\r\n        return i >= 0 ? i : false;\r\n    };\r\n\r\n    window.str_replace = function str_replace(search, replace, subject)\r\n    {\r\n        if(!(replace instanceof Array)) {\r\n            replace=new Array(replace);\r\n            if(search instanceof Array) {\r\n                while(search.length>replace.length) {\r\n                    replace[replace.length]=replace[0];\r\n                }\r\n            }\r\n        }\r\n\r\n        if(!(search instanceof Array))search=new Array(search);\r\n        while(search.length>replace.length) {\r\n            replace[replace.length]='';\r\n        }\r\n\r\n        if(subject instanceof Array) {\r\n            for(k in subject) {\r\n                subject[k]=str_replace(search,replace,subject[k]);\r\n            }\r\n            return subject;\r\n        }\r\n\r\n        for(var k=0; k<search.length; k++) {\r\n            var i = subject.indexOf(search[k]);\r\n            while(i>-1) {\r\n                subject = subject.replace(search[k], replace[k]);\r\n                i = subject.indexOf(search[k],i);\r\n            }\r\n        }\r\n\r\n        return subject;\r\n    };\r\n\r\n    window.substr_count = function substr_count(haystack, needle, offset, length)\r\n    {\r\n        var pos = 0,\r\n            cnt = 0;\r\n\r\n        haystack += '';\r\n        needle += '';\r\n        if (isNaN(offset)) {\r\n            offset = 0;\r\n        }\r\n        if (isNaN(length)) {\r\n            length = 0;\r\n        }\r\n        offset--;\r\n\r\n        while ((offset = haystack.indexOf(needle, offset + 1)) != -1) {\r\n            if (length > 0 && (offset + needle.length) > length) {\r\n                return false;\r\n            } else {\r\n                cnt++;\r\n            }\r\n        }\r\n\r\n        return cnt;\r\n    };\r\n\r\n    window.htmlentities = function htmlentities(s)\r\n    {\r\n        var div = document.createElement('div');\r\n        var text = document.createTextNode(s);\r\n        div.appendChild(text);\r\n\r\n        return div.innerHTML;\r\n    };\r\n\r\n    window.decodeHtmlentities = function decodeHtmlentities(s)\r\n    {\r\n        var y = document.createElement('textarea');\r\n        y.innerHTML = s;\r\n        return y.value;\r\n    };\r\n\r\n    window.version_compare = function version_compare(a, b)\r\n    {\r\n        if (a === b) {\r\n            return 0;\r\n        }\r\n\r\n        var a_components = a.split(\".\");\r\n        var b_components = b.split(\".\");\r\n\r\n        var len = Math.min(a_components.length, b_components.length);\r\n\r\n        // loop while the components are equal\r\n        for (var i = 0; i < len; i++)\r\n        {\r\n            // A bigger than B\r\n            if (parseInt(a_components[i]) > parseInt(b_components[i])) {\r\n                return 1;\r\n            }\r\n\r\n            // B bigger than A\r\n            if (parseInt(a_components[i]) < parseInt(b_components[i])) {\r\n                return -1;\r\n            }\r\n        }\r\n\r\n        // If one's a prefix of the other, the longer one is greater.\r\n        if (a_components.length > b_components.length) {\r\n            return 1;\r\n        }\r\n\r\n        if (a_components.length < b_components.length) {\r\n            return -1;\r\n        }\r\n\r\n        // Otherwise they are the same.\r\n        return 0;\r\n    };\r\n\r\n    window.array_intersect = function array_intersect(arr1)\r\n    {\r\n        var retArr = [],\r\n            argl = arguments.length,\r\n            arglm1 = argl - 1,\r\n            k1 = '',\r\n            arr = {},\r\n            i = 0,\r\n            k = '';\r\n\r\n        arr1keys: for (k1 in arr1) {\r\n            arrs: for (i = 1; i < argl; i++) {\r\n                arr = arguments[i];\r\n                for (k in arr) {\r\n                    if (arr[k] === arr1[k1]) {\r\n                        if (i === arglm1) {\r\n                            retArr[k1] = arr1[k1];\r\n                        }\r\n                        // If the innermost loop always leads at least once to an equal value, continue the loop until done\r\n                        continue arrs;\r\n                    }\r\n                }\r\n                // If it reaches here, it wasn't found in at least one array, so try next value\r\n                continue arr1keys;\r\n            }\r\n        }\r\n\r\n        return retArr;\r\n    };\r\n\r\n    // Quote string with slashes\r\n    window.addslashes = function addslashes(str)\r\n    {\r\n        return (str + '').replace(/[\\\\\"']/g, '\\\\$&').replace(/\\u0000/g, '\\\\0');\r\n    };\r\n\r\n    window.wait = function wait(conditionCallback, callback, time)\r\n    {\r\n        setTimeout(function run() {\r\n            if (conditionCallback()) {\r\n                callback();\r\n                return;\r\n            }\r\n\r\n            setTimeout(run, time);\r\n        }, time);\r\n    }\r\n});","Ess_M2ePro/js/General/Translator.js":"define(['M2ePro/General/Common', 'underscore'], function(Common, _) {\r\n\r\n    return Common.extend({\r\n        translations: {},\r\n\r\n        add: function(translations)\r\n        {\r\n            _.extend(this.translations, translations);\r\n        },\r\n\r\n        translate: function(text)\r\n        {\r\n            if (!this.translations[text]) {\r\n                alert('Translation not found : \"' + text + '\"');\r\n                throw new Error('Translation not found : \"' + text + '\"');\r\n            }\r\n\r\n            var textValue = this.translations[text],\r\n                values = Array.prototype.slice.call(arguments).slice(1),\r\n                placeholders = textValue.match(/%\\w*%/g);\r\n\r\n            if (!placeholders) {\r\n                return textValue;\r\n            }\r\n\r\n            _.each(placeholders, function(placeholder) {\r\n                var value = values.shift();\r\n\r\n                if (!value) {\r\n                    return;\r\n                }\r\n                textValue = textValue.replace(placeholder, value);\r\n            });\r\n\r\n            return textValue;\r\n        }\r\n    });\r\n\r\n});","Ess_M2ePro/js/General/Php.js":"define(['M2ePro/General/Common', 'underscore'], function(Common, _) {\r\n\r\n    return Common.extend({\r\n        constants: {},\r\n\r\n        add: function(constants)\r\n        {\r\n            _.extend(this.constants, constants);\r\n        },\r\n\r\n        constant: function(name)\r\n        {\r\n            var nameParts = name.split(/::/);\r\n            var className = nameParts[0];\r\n\r\n            if (className.indexOf('_') > -1) {\r\n                className = className.replace(/_/g, '\\\\');\r\n                name = '\\\\' + className + '::' + nameParts[1];\r\n            }\r\n\r\n            if (typeof this.constants[name] == 'undefined') {\r\n                alert('Constant not found : \"' + name + '\"');\r\n                throw new Error('Constant not found : \"' + name + '\"');\r\n            }\r\n\r\n            return this.constants[name];\r\n        }\r\n    });\r\n\r\n});","Ess_M2ePro/js/Settings/LogClearing.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n    window.SettingsLogClearing = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-logs-clearing-interval', function(value, el) {\r\n\r\n                if (jQuery.validator.methods['M2ePro-required-when-visible'](null, el)) {\r\n                    return true;\r\n                }\r\n\r\n                if (isNaN(parseInt(value))) {\r\n                    return false;\r\n                }\r\n\r\n                if (parseInt(value) < 14) {\r\n                    return false;\r\n                }\r\n\r\n                if (parseInt(value) > 90) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('logs_clearing_keep_for_days_validation_message'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearAllLog: function(log, el)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var form = el.up('form'),\r\n                            formData = form.serialize(true);\r\n                        SettingsObj.submitTab(M2ePro.url.get('formSubmit', {'task': 'clear_all','log': log}), formData);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeModeLog: function(log)\r\n        {\r\n            var value = $(log+'_log_mode').value,\r\n                button = $$('.clear_all_'+log).shift();\r\n\r\n            if (value == '1') {\r\n                $(log+'_log_days_container').style.display = '';\r\n                button && button.show();\r\n            } else {\r\n                $(log+'_log_days_container').style.display = 'none';\r\n                button && button.hide();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Settings/License.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal, MessagesObj) {\r\n    window.License = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        changeLicenseKeyPopup: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('settings_license/change'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function(transport) {\r\n\r\n                    var content = transport.responseText;\r\n                    var title = M2ePro.translator.translate('Use Existing License');\r\n\r\n                    LicenseObj.openPopup(title, content, LicenseObj.confirmLicenseKey.bind(self));\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirmLicenseKey: function()\r\n        {\r\n            var self = this;\r\n\r\n            if (!this.isValidForm()) {\r\n                return false;\r\n            }\r\n\r\n            var formData = $('edit_form').serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('settings_license/change'), {\r\n                method: 'post',\r\n                asynchronous: false,\r\n                parameters: formData,\r\n                onSuccess: function(transport) {\r\n                    var result = transport.responseText;\r\n\r\n                    if (!result.isJSON()) {\r\n                        MessagesObj.addErrorMessage(result);\r\n                    }\r\n\r\n                    result = JSON.parse(result);\r\n\r\n                    MessagesObj.clear();\r\n                    self.appendGlobalMessages();\r\n\r\n                    if (result.success) {\r\n                        MessagesObj.addSuccessMessage(result.message);\r\n                    } else {\r\n                        MessagesObj.addErrorMessage(result.message);\r\n                    }\r\n                    CommonObj.scrollPageToTop();\r\n                    self.reloadLicenseTab();\r\n                }\r\n            });\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        newLicenseKeyPopup: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('settings_license/create'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function(transport) {\r\n\r\n                    var content = transport.responseText;\r\n                    var title = M2ePro.translator.translate('Create New License');\r\n\r\n                    LicenseObj.openPopup(title, content, LicenseObj.newLicenseKey.bind(self), 'slide');\r\n                }\r\n            });\r\n        },\r\n\r\n        newLicenseKey: function()\r\n        {\r\n            var self = this;\r\n\r\n            if (!this.isValidForm()) {\r\n                return false;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('settings_license/create'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: $('edit_form').serialize(true),\r\n                onSuccess: function(transport) {\r\n                    var result = transport.responseText;\r\n\r\n                    if (!result.isJSON()) {\r\n                        MessagesObj.addErrorMessage(result);\r\n                    }\r\n\r\n                    result = JSON.parse(result);\r\n\r\n                    MessagesObj.clear();\r\n                    self.appendGlobalMessages();\r\n\r\n                    if (result.success) {\r\n                        if (typeof result.license_key !== 'undefined') {\r\n                            $('license_text_key_container').innerHTML = result.license_key;\r\n                        }\r\n                        MessagesObj.addSuccessMessage(result.message);\r\n                    } else {\r\n                        MessagesObj.addErrorMessage(result.message);\r\n                    }\r\n                    CommonObj.scrollPageToTop();\r\n                    self.reloadLicenseTab();\r\n                }\r\n            });\r\n\r\n            return true;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        completeStep: function()\r\n        {\r\n            var self = this;\r\n            var checkResult = false;\r\n\r\n            new Ajax.Request(M2ePro.url.get('adminhtml_configuration_license/checkLicense'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function(transport) {\r\n                    checkResult = transport.responseText.evalJSON()['ok'];\r\n                    if (checkResult) {\r\n                        window.opener.completeStep = 1;\r\n                        window.close();\r\n                    } else {\r\n                        MagentoMessageObj.addError(M2ePro.translator.translate('You must get valid Trial or Live License Key.'));\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopup: function(title, content, confirmCallback, type)\r\n        {\r\n            var type = type || 'popup';\r\n            if ($('modal_popup')) {\r\n                $('modal_popup').remove();\r\n            }\r\n\r\n            var modalDialogMessage = new Element('div', {\r\n                id: 'modal_popup'\r\n            });\r\n\r\n            var popup = jQuery(modalDialogMessage).modal({\r\n                title: title,\r\n                modalClass: type == 'popup' ? 'width-500' : '',\r\n                type: type,\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: type == 'popup' ? 'action-secondary action-dismiss' : 'action-default action-dismiss',\r\n                    click: function () {\r\n                        this.closeModal();\r\n                    }\r\n                },{\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    id: 'save_popup_button',\r\n                    click: function () {\r\n\r\n                        if (confirmCallback) {\r\n                            var result = confirmCallback();\r\n                            result && this.closeModal();\r\n                        } else {\r\n                            this.closeModal();\r\n                        }\r\n                    }\r\n                }],\r\n                closed: function() {\r\n                    modalDialogMessage.innerHTML = '';\r\n\r\n                    return true;\r\n                }\r\n            });\r\n            popup.modal('openModal');\r\n\r\n            modalDialogMessage.insert(content);\r\n            modalDialogMessage.innerHTML.evalScripts();\r\n\r\n            this.initFormValidation(popup.find('form'));\r\n\r\n            return popup;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        refreshStatus: function()\r\n        {\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('settings_license/refreshStatus'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                onSuccess: function(transport) {\r\n                    var result = transport.responseText;\r\n\r\n                    if (!result.isJSON()) {\r\n                        MessagesObj.addErrorMessage(result);\r\n                    }\r\n\r\n                    result = JSON.parse(result);\r\n                    MessagesObj.clear();\r\n                    self.appendGlobalMessages();\r\n\r\n                    if (result.success) {\r\n                        MessagesObj.addSuccessMessage(result.message);\r\n                    } else {\r\n                        MessagesObj.addErrorMessage(result.message);\r\n                    }\r\n\r\n                    CommonObj.scrollPageToTop();\r\n                    self.reloadLicenseTab();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        appendGlobalMessages: function()\r\n        {\r\n            new Ajax.Request(M2ePro.url.get('getGlobalMessages'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function(transport) {\r\n                    var result = transport.responseText;\r\n\r\n                    if (!result.isJSON()) {\r\n                        return;\r\n                    }\r\n\r\n                    result = JSON.parse(result);\r\n\r\n                    if (result && Array.isArray(result)) {\r\n                        MessagesObj.clearGlobal();\r\n                        result.forEach(function(item) {\r\n                            var key = Object.keys(item)[0];\r\n                            MessagesObj['addGlobal'+key.capitalize()+'Message'](item[key]);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        reloadLicenseTab: function()\r\n        {\r\n            BlockNoticeObj.removeInitializedBlock('block_notice_configuration_license');\r\n\r\n            new Ajax.Request(M2ePro.url.get('licenseTab'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                onSuccess: function(transport) {\r\n                    var result = transport.responseText;\r\n\r\n                    $('configuration_settings_tabs_license_content').innerHTML = result;\r\n                    $('configuration_settings_tabs_license_content').innerHTML.evalScripts();\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/AutoAction.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'underscore',\r\n    'jquery/validate',\r\n    'M2ePro/Common',\r\n    'prototype'\r\n], function (jQuery, modal, _) {\r\n\r\n    window.ListingAutoAction = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        controller: 'adminhtml_common_listing_autoAction',\r\n\r\n        internalData: {},\r\n\r\n        popupMode: '',\r\n        currentPopup: {},\r\n\r\n        magentoCategoryIdsFromOtherGroups: {},\r\n        magentoCategoryTreeChangeEventInProgress: false,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            jQuery.validator.addMethod('M2ePro-validate-mode', function() {\r\n                return $$('input[name=\"auto_mode\"]').any(function(el) {\r\n                    return el.checked;\r\n                })\r\n            }, jQuery.mage.__('Please select one of the options.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-category-selection', function() {\r\n                return categories_selected_items.length > 0\r\n            }, M2ePro.translator.translate('You must select at least 1 Category.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-category-group-title', function(value, element) {\r\n\r\n                var unique = true;\r\n\r\n                new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/isCategoryGroupTitleUnique'), {\r\n                    method: 'get',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        group_id: $('group_id').value,\r\n                        title: $('group_title').value\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        unique = transport.responseText.evalJSON()['unique'];\r\n                    }\r\n                });\r\n\r\n                return unique;\r\n            }, M2ePro.translator.translate('Rule with the same Title already exists.'));\r\n        },\r\n\r\n        clear: function()\r\n        {\r\n            this.internalData = {};\r\n            this.magentoCategoryTreeChangeEventInProgress = false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setPopupMode: function(mode)\r\n        {\r\n            if (mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Listing::AUTO_MODE_GLOBAL')) {\r\n                this.popupMode = 'global';\r\n            } else if (mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Listing::AUTO_MODE_WEBSITE')) {\r\n                this.popupMode = 'website';\r\n            } else if (mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Listing::AUTO_MODE_CATEGORY')) {\r\n                this.popupMode = 'category';\r\n            } else {\r\n                this.popupMode = '';\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        getPopupMode: function()\r\n        {\r\n            return this.popupMode != '' ? this.popupMode + '_' : '';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        loadAutoActionHtml: function(mode, callback)\r\n        {\r\n            mode = mode || null;\r\n\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/index'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    auto_mode: mode\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var responseData = JSON.parse(transport.responseText);\r\n                    var title = M2ePro.translator.translate('Auto Add/Remove Rules');\r\n\r\n                    this.clear();\r\n                    if (mode) {\r\n                        this.setPopupMode(mode);\r\n                    } else {\r\n                        this.setPopupMode(responseData.mode);\r\n                    }\r\n                    this.openPopUp(title, responseData.html);\r\n\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(title, content)\r\n        {\r\n            var popupMode = this.getPopupMode(),\r\n                popupData = {};\r\n\r\n            if (popupMode.indexOf('global') != -1) {\r\n                popupData = [\r\n                    {\r\n                        label: M2ePro.translator.translate('Continue'),\r\n                        class: 'next continue_button primary forward',\r\n                        attr: {style: 'display: none', id: popupMode+'continue_button'},\r\n                        callback: ListingAutoActionObj.globalStepTwo\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Reset Auto Rules'),\r\n                        attr: {style: 'display: none', id: popupMode+'reset_button'},\r\n                        callback: function() {\r\n                            ListingAutoActionObj.reset(false, function() {\r\n                                ListingAutoActionObj.global_popup.modal('closeModal');\r\n                            });\r\n                        }\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Complete'),\r\n                        class: 'confirm_button primary',\r\n                        attr: {id: popupMode+'confirm_button'},\r\n                        callback: function() {\r\n                            ListingAutoActionObj.confirm();\r\n                        }\r\n                    }\r\n                ];\r\n            } else if (popupMode.indexOf('website') != -1) {\r\n                popupData = [\r\n                    {\r\n                        label: M2ePro.translator.translate('Continue'),\r\n                        class: 'next continue_button primary forward',\r\n                        attr: {style: 'display: none', id: popupMode+'continue_button'},\r\n                        callback: ListingAutoActionObj.websiteStepTwo\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Reset Auto Rules'),\r\n                        attr: {style: 'display: none', id: popupMode+'reset_button'},\r\n                        callback: function() {\r\n                            ListingAutoActionObj.reset(false, function() {\r\n                                ListingAutoActionObj.website_popup.modal('closeModal');\r\n                            });\r\n                        }\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Complete'),\r\n                        class: 'confirm_button primary',\r\n                        attr: {id: popupMode+'confirm_button'},\r\n                        callback: function() {\r\n                            ListingAutoActionObj.confirm();\r\n                        }\r\n                    }\r\n                ];\r\n            } else if (popupMode.indexOf('category') != -1) {\r\n                popupData = [\r\n                    {\r\n                        label: M2ePro.translator.translate('Close'),\r\n                        class: 'next close_button',\r\n                        attr: {style: 'display:none', id: popupMode+'close_button'},\r\n                        closeModal: true\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Back'),\r\n                        attr: {style: 'display:none', id: popupMode+'cancel_button'},\r\n                        class: 'back',\r\n                        callback: function() {\r\n                            ListingAutoActionObj.reset(true);\r\n                        },\r\n                        closeModal: true\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Reset Auto Rules'),\r\n                        attr: {style: 'display: none', id: popupMode+'reset_button'},\r\n                        callback: function() {\r\n                            ListingAutoActionObj.reset(false, function() {\r\n                                ListingAutoActionObj.category_popup.modal('closeModal');\r\n                            });\r\n                        }\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Add New Group'),\r\n                        class: 'add_button add primary',\r\n                        attr: {id: 'add_button'},\r\n                        callback: function() {\r\n                            ListingAutoActionObj.categoryStepOne();\r\n                        }\r\n                    }\r\n                ];\r\n            } else {\r\n                popupData = [\r\n                    {\r\n                        label: M2ePro.translator.translate('Cancel'),\r\n                        closeModal: true\r\n                    },\r\n                    {\r\n                        label: M2ePro.translator.translate('Continue'),\r\n                        class: 'next continue_button primary forward',\r\n                        attr: {id: 'continue_button'},\r\n                        callback: function() {\r\n                            var contentWrapper = jQuery('#block-content-wrapper');\r\n                            contentWrapper.wrap('<form></form>');\r\n\r\n                            if (!contentWrapper.parent().validation().valid()) {\r\n                                return;\r\n                            }\r\n                            contentWrapper.unwrap();\r\n\r\n                            ListingAutoActionObj.loadAutoActionHtml(\r\n                                $$('input[name=\"auto_mode\"]:checked')[0].value\r\n                            );\r\n\r\n                            this.closeModal();\r\n                        }\r\n                    }\r\n                ];\r\n            }\r\n\r\n            this._createPopup(popupMode, title, content, popupData);\r\n        },\r\n\r\n        _createPopup: function(mode, title, content, popupData)\r\n        {\r\n            var self = this,\r\n                modalDialogMessage = $(mode+'modal_auto_action'),\r\n                buttonsConfig = [];\r\n\r\n            if (!modalDialogMessage) {\r\n                modalDialogMessage = new Element('div', {\r\n                    id: mode+'modal_auto_action'\r\n                });\r\n            }\r\n\r\n            modalDialogMessage.innerHTML = '';\r\n\r\n            if (typeof self[mode+'popup'] == 'undefined') {\r\n                _.each(popupData, function(buttonConfig) {\r\n                    var tmpConfig = {\r\n                        text: buttonConfig.label || '',\r\n                        class: buttonConfig.class || '',\r\n                        attr: buttonConfig.attr || {},\r\n                        click: function () {\r\n                            buttonConfig.callback && buttonConfig.callback.call(this);\r\n                            buttonConfig.closeModal && self[mode+'popup'].modal('closeModal');\r\n                        }\r\n                    };\r\n\r\n                    buttonsConfig.push(tmpConfig);\r\n                });\r\n\r\n                self[mode+'popup'] = jQuery(modalDialogMessage).modal({\r\n                    title: title + ' <span id=\"additional_autoaction_title\" style=\"font-size: inherit;\"></span>',\r\n                    type: 'slide',\r\n                    buttons: buttonsConfig,\r\n                    closed: function() {\r\n                        ListingAutoActionObj.clear();\r\n\r\n                        var node = this.up('.modal-slide').previousSibling.previousSibling;\r\n                        if (node.nodeType == node.COMMENT_NODE) {\r\n                            node.remove();\r\n                        }\r\n\r\n                        this.up('.modal-slide').remove();\r\n                        delete self[mode+'popup'];\r\n\r\n                        return true;\r\n                    }\r\n                });\r\n            }\r\n\r\n            self[mode+'popup'].modal('openModal');\r\n            self.currentPopup = self[mode+'popup'];\r\n\r\n            try {\r\n                modalDialogMessage.innerHTML = content;\r\n                modalDialogMessage.innerHTML.evalScripts();\r\n            } catch (ignored) {}\r\n\r\n            var additionalTitleEl = $('additional_autoaction_title_text');\r\n\r\n            $('additional_autoaction_title').innerHTML = additionalTitleEl ? '(' + additionalTitleEl.innerHTML + ')': '';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addingModeChange: function()\r\n        {\r\n            $('continue_button').hide();\r\n            $('confirm_button').show();\r\n\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_NONE')) {\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].show();\r\n            } else {\r\n                $$('[id$=\"adding_add_not_visible\"]')[0].value = M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_ADDING_ADD_NOT_VISIBLE_YES');\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].hide();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        loadAutoCategoryForm: function(groupId, callback)\r\n        {\r\n            var popupMode = this.getPopupMode();\r\n\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/getAutoCategoryFormHtml'), {\r\n                method: 'get',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    group_id: groupId || null\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    this._createPopup(\r\n                        'category_child_',\r\n                        M2ePro.translator.translate('Add/Edit Categories Rule'),\r\n                        transport.responseText,\r\n                        [{\r\n                            label: M2ePro.translator.translate('Back'),\r\n                            attr: {id: popupMode+'cancel_button'},\r\n                            class: 'back',\r\n                            callback: function() {\r\n                                listingAutoActionModeCategoryGroupGridJsObject.doFilter();\r\n                            },\r\n                            closeModal: true\r\n                        },\r\n                        {\r\n                            label: M2ePro.translator.translate('Continue'),\r\n                            class: 'next continue_button primary forward',\r\n                            attr: {style: 'display: none',id: popupMode+'continue_button'}\r\n                        },\r\n                        {\r\n                            label: M2ePro.translator.translate('Complete'),\r\n                            class: 'confirm_button primary',\r\n                            attr: {id: popupMode+'confirm_button'},\r\n                            callback: function() {\r\n                                ListingAutoActionObj.confirm();\r\n                                $(popupMode+'close_button').hide();\r\n                                $(popupMode+'cancel_button').hide();\r\n                                $(popupMode+'reset_button').show();\r\n                            }\r\n                        }]\r\n                    );\r\n\r\n                    this.magentoCategoryTreeChangeEventInProgress = false;\r\n\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n                }.bind(this)\r\n            });\r\n        },\r\n\r\n        magentoCategorySelectCallback: function(selectedCategories)\r\n        {\r\n            if (this.magentoCategoryTreeChangeEventInProgress) {\r\n                return;\r\n            }\r\n\r\n            this.magentoCategoryTreeChangeEventInProgress = true;\r\n\r\n            var latestCategory = selectedCategories[selectedCategories.length - 1];\r\n\r\n            if (!latestCategory || typeof this.magentoCategoryIdsFromOtherGroups[latestCategory] == 'undefined') {\r\n                this.magentoCategoryTreeChangeEventInProgress = false;\r\n                return;\r\n            }\r\n\r\n            var template = $('dialog_confirm_container');\r\n\r\n            if (!template) {\r\n                template = new Element('div', {\r\n                    id: 'dialog_confirm_container'\r\n                });\r\n            }\r\n\r\n            template.innerHTML = $('dialog_confirm_content').innerHTML\r\n                .replace('%s', this.magentoCategoryIdsFromOtherGroups[latestCategory].title);\r\n\r\n            jQuery(template).confirm({\r\n                title: M2ePro.translator.translate('Remove Category'),\r\n                actions: {\r\n                    confirm: function() {\r\n                        new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/deleteCategory'), {\r\n                            method: 'post',\r\n                            asynchronous: true,\r\n                            parameters: {\r\n                                group_id: ListingAutoActionObj.magentoCategoryIdsFromOtherGroups[latestCategory].id,\r\n                                category_id: latestCategory\r\n                            },\r\n                            onSuccess: function(transport) {\r\n                                delete ListingAutoActionObj.magentoCategoryIdsFromOtherGroups[latestCategory];\r\n                            }\r\n                        });\r\n\r\n                        return true;\r\n                    },\r\n                    cancel: function() {\r\n                        tree.getNodeById(latestCategory).ui.check(false);\r\n                    }\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }],\r\n                closed: function() {\r\n                    ListingAutoActionObj.magentoCategoryTreeChangeEventInProgress = false;\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        highlightBreadcrumbStep: function(step)\r\n        {\r\n            $$('[id$=\"breadcrumb_container\"] .breadcrumb').each(function(element) { element.removeClassName('selected'); });\r\n\r\n            $('step_' + step).addClassName('selected');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        globalStepTwo: function()\r\n        {\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                jQuery('#continue_button')\r\n                    .off('click')\r\n                    .on('click', ListingAutoActionObj.globalStepThree);\r\n\r\n                ListingAutoActionObj.highlightBreadcrumbStep(2);\r\n            };\r\n\r\n            ListingAutoActionObj.loadCategoryChooser(callback);\r\n        },\r\n\r\n        globalStepThree: function()\r\n        {\r\n            if (!ListingCategoryChooserHandlerObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                ListingAutoActionObj.highlightBreadcrumbStep(3);\r\n\r\n                $('confirm_button').show();\r\n                $('continue_button').hide();\r\n            };\r\n\r\n            ListingAutoActionObj.loadSpecific(callback);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        websiteStepTwo: function()\r\n        {\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                jQuery('#'+ListingAutoActionObj.getPopupMode() + 'continue_button')\r\n                    .off('click')\r\n                    .on('click', ListingAutoActionObj.websiteStepThree);\r\n\r\n                ListingAutoActionObj.highlightBreadcrumbStep(2);\r\n            };\r\n\r\n            ListingAutoActionObj.loadCategoryChooser(callback);\r\n        },\r\n\r\n        websiteStepThree: function()\r\n        {\r\n            if (!ListingCategoryChooserHandlerObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback = function() {\r\n                ListingAutoActionObj.highlightBreadcrumbStep(3);\r\n\r\n                $(ListingAutoActionObj.getPopupMode() + 'confirm_button').show();\r\n                $(ListingAutoActionObj.getPopupMode() + 'continue_button').hide();\r\n            };\r\n\r\n            ListingAutoActionObj.loadSpecific(callback);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isCategoryAlreadyUsed: function(categoryId)\r\n        {\r\n            return this.magentoCategoryUsedIds.indexOf(categoryId) != -1;\r\n        },\r\n\r\n        categoryCancel: function()\r\n        {\r\n            ListingAutoActionObj.loadAutoActionHtml(\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_CATEGORY')\r\n            );\r\n        },\r\n\r\n        categoryStepOne: function(groupId)\r\n        {\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            this.loadAutoCategoryForm(groupId, function() {\r\n                $(mode+'reset_button').hide();\r\n                $(mode+'close_button').hide();\r\n                $(mode+'cancel_button').show();\r\n            });\r\n        },\r\n\r\n        categoryStepTwo: function()\r\n        {\r\n            if (!ListingAutoActionObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            var callback = function() {\r\n                jQuery('#' + mode+ 'continue_button')\r\n                    .off('click')\r\n                    .on('click', ListingAutoActionObj.categoryStepThree);\r\n\r\n                ListingAutoActionObj.highlightBreadcrumbStep(2);\r\n            };\r\n\r\n            ListingAutoActionObj.loadCategoryChooser(callback);\r\n        },\r\n\r\n        categoryStepThree: function()\r\n        {\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var mode = ListingAutoActionObj.getPopupMode();\r\n            var callback = function() {\r\n                ListingAutoActionObj.highlightBreadcrumbStep(3);\r\n\r\n                $(mode+'confirm_button').show();\r\n                $(mode+'continue_button').hide();\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        categoryDeleteGroup: function(groupId)\r\n        {\r\n            this.confirmPopup(M2ePro.translator.translate('Are you sure?'), {\r\n                confirmCallback: function() {\r\n                    new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/deleteCategoryGroup'), {\r\n                        method: 'post',\r\n                        asynchronous: true,\r\n                        parameters: {\r\n                            group_id: groupId\r\n                        },\r\n                        onSuccess: function(transport) {\r\n                            listingAutoActionModeCategoryGroupGridJsObject.doFilter();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validate: function()\r\n        {\r\n            var validationResult = true;\r\n\r\n            this.currentPopup.find('form').each(function () {\r\n                validationResult = validationResult && jQuery(this).validation().valid();\r\n            });\r\n\r\n            return validationResult;\r\n        },\r\n\r\n        confirm: function()\r\n        {\r\n            if (!ListingAutoActionObj.validate()) {\r\n                return;\r\n            }\r\n\r\n            ListingAutoActionObj.collectData();\r\n\r\n            var callback;\r\n            if (ListingAutoActionObj.internalData.auto_mode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Listing::AUTO_MODE_CATEGORY')) {\r\n                callback = function() {\r\n                    this.category_child_popup.modal('closeModal');\r\n\r\n                    listingAutoActionModeCategoryGroupGridJsObject.doFilter();\r\n                }.bind(this);\r\n            } else {\r\n                callback = function() {\r\n                    this.currentPopup.modal('closeModal');\r\n                }.bind(this);\r\n            }\r\n\r\n            ListingAutoActionObj.submitData(callback);\r\n        },\r\n\r\n        collectData: function()\r\n        {\r\n            if ($('auto_mode')) {\r\n                switch (parseInt($('auto_mode').value)) {\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_GLOBAL'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_global_adding_mode: $('auto_global_adding_mode').value,\r\n                            auto_global_adding_add_not_visible: $('auto_global_adding_add_not_visible').value,\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_WEBSITE'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_website_adding_mode: $('auto_website_adding_mode').value,\r\n                            auto_website_adding_add_not_visible: $('auto_website_adding_add_not_visible').value,\r\n                            auto_website_deleting_mode: $('auto_website_deleting_mode').value\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_CATEGORY'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            id: $('group_id').value,\r\n                            title: $('group_title').value,\r\n                            auto_mode: $('auto_mode').value,\r\n                            adding_mode: $('adding_mode').value,\r\n                            adding_add_not_visible: $('adding_add_not_visible').value,\r\n                            deleting_mode: $('deleting_mode').value,\r\n                            categories: categories_selected_items\r\n                        };\r\n                        break;\r\n                }\r\n            }\r\n        },\r\n\r\n        submitData: function(callback)\r\n        {\r\n            var data = this.internalData;\r\n\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/save'), {\r\n                method: 'post',\r\n                asynchronous: true,\r\n                parameters: {\r\n                    auto_action_data: Object.toJSON(data)\r\n                },\r\n                onSuccess: function(transport) {\r\n                    if (typeof callback == 'function') {\r\n                        callback();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        reset: function(skipConfirmation, callback, closeCallback)\r\n        {\r\n            skipConfirmation = skipConfirmation || false;\r\n\r\n            var confirmCallback = function() {\r\n                new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/reset'), {\r\n                    method: 'post',\r\n                    asynchronous: true,\r\n                    parameters: {},\r\n                    onSuccess: function(transport) {\r\n                        callback && callback();\r\n                        ListingAutoActionObj.loadAutoActionHtml();\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (skipConfirmation) {\r\n                confirmCallback();\r\n                return\r\n            }\r\n\r\n            ListingAutoActionObj.confirmPopup(M2ePro.translator.translate('Are you sure?'), {\r\n                confirmCallback: confirmCallback,\r\n                closeCallback: closeCallback\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirmPopup: function(message, configData)\r\n        {\r\n            jQuery('<div>').confirm({\r\n                title: message,\r\n                actions: {\r\n                    always: function() {\r\n                        configData.closeCallback && configData.closeCallback();\r\n                    },\r\n                    confirm: function() {\r\n                        configData.confirmCallback && configData.confirmCallback();\r\n                        return true;\r\n                    },\r\n                    buttons: [\r\n                        {text: M2ePro.translator.translate('Cancel')},\r\n                        {text: M2ePro.translator.translate('Confirm'), class: 'primary'}\r\n                    ]\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Listing/EditTitle.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/confirm',\r\n    'Magento_Ui/js/modal/modal'\r\n], function (jQuery, confirm, modal) {\r\n\r\n    window.ListingEditListingTitle = Class.create();\r\n    ListingEditListingTitle.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function(gridId, component) {\r\n            this.gridId = gridId;\r\n\r\n            CommonObj.setValidationCheckRepetitionValue(\r\n                'M2ePro-listing-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Listing. Listing Title must be unique.'),\r\n                'Listing', 'title', 'id', null, component\r\n            );\r\n        },\r\n\r\n        openPopup: function(id)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('listing/edit'), {\r\n                method: 'GET',\r\n                parameters: {\r\n                    id: id\r\n                },\r\n                onSuccess: (function(transport) {\r\n                    if ($('edit_form')) {\r\n                        $('edit_form').remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    var form = jQuery('#edit_form');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Edit Listing Title'),\r\n                        type: 'popup',\r\n                        modalClass: 'width-50',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                form.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Save'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                EditListingTitleObj.saveListingTitle(id);\r\n                            }\r\n                        }]\r\n                    }, form);\r\n\r\n                    self.oldTitle = form.find('#title').val();\r\n                    jQuery('#edit_form').modal('openModal');\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        saveListingTitle: function()\r\n        {\r\n            var self = this,\r\n                form = $('edit_form'),\r\n                newTitle = form.select('#title')[0].value;\r\n\r\n            if (self.oldTitle == newTitle) {\r\n                jQuery('#edit_form').modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            if (!jQuery('#edit_form').valid()) {\r\n                return false;\r\n            }\r\n\r\n            confirm({\r\n                content: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('listing/edit'), {\r\n                            parameters: $('edit_form').serialize(true),\r\n                            onSuccess: (function(transport) {\r\n                                jQuery('#edit_form').modal('closeModal');\r\n                                window[self.gridId + 'JsObject'].reload();\r\n                            })\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        jQuery('#edit_form').modal('closeModal');\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Listing/Moving.js":"define([\n    'jquery',\n    'Magento_Ui/js/modal/modal',\n    'M2ePro/Plugin/Messages',\n    'M2ePro/Action'\n], function (jQuery, modal, MessagesObj) {\n    window.ListingMoving = Class.create(Action, {\n\n        // ---------------------------------------\n\n        options: {},\n\n        setOptions: function (options) {\n            this.options = Object.extend(this.options, options);\n            return this;\n        },\n\n        // ---------------------------------------\n\n        run: function () {\n            this.getGridHtml(\n                this.gridHandler.getSelectedProductsArray()\n            );\n        },\n\n        // ---------------------------------------\n\n        openPopUp: function (gridHtml, popup_title, buttons)\n        {\n            var self = this;\n\n            if (typeof buttons === 'undefined') {\n                buttons = [{\n                    class: 'action-default action-dismiss',\n                    text: M2ePro.translator.translate('Cancel'),\n                    click: function (event) {\n                        this.closeModal(event);\n                    }\n                }, {\n                    text: M2ePro.translator.translate('Add New Listing'),\n                    class: 'action-primary action-accept',\n                    click: function () {\n                        self.startListingCreation(M2ePro.url.get('add_new_listing_url'));\n                    }\n                }];\n            }\n\n            var modalDialogMessage = $('move_modal_dialog_message');\n\n            if (modalDialogMessage) {\n                modalDialogMessage.remove();\n            }\n\n            modalDialogMessage = new Element('div', {\n                id: 'move_modal_dialog_message'\n            });\n\n            modalDialogMessage.update(gridHtml);\n\n            this.popUp = jQuery(modalDialogMessage).modal({\n                title: popup_title,\n                type: 'slide',\n                buttons: buttons\n            });\n\n            this.popUp.modal('openModal');\n        },\n\n        // ---------------------------------------\n\n        getGridHtml: function (selectedProducts) {\n            var self = this;\n\n            MessagesObj.clear();\n\n            self.selectedProducts = selectedProducts;\n            self.gridHandler.unselectAll();\n\n            var callback = function (response) {\n                new Ajax.Request(self.options.url.get('moveToListingGridHtml'), {\n                    method: 'get',\n                    parameters: {\n                        componentMode: self.options.customData.componentMode,\n                        accountId: response.accountId,\n                        marketplaceId: response.marketplaceId,\n                        ignoreListings: self.options.customData.ignoreListings\n                    },\n                    onSuccess: function (transport) {\n                        var title = selectedProducts.length == 1 ?\n                        self.options.translator.translate('popup_title_single', self.gridHandler.getProductNameByRowId(selectedProducts[0])) :\n                            self.options.translator.translate('popup_title');\n                        self.openPopUp(transport.responseText, title);\n                    }\n                });\n            };\n\n            new Ajax.Request(self.options.url.get('prepareData'), {\n                method: 'post',\n                parameters: {\n                    componentMode: self.options.customData.componentMode,\n                    selectedProducts: Object.toJSON(self.selectedProducts)\n                },\n                onSuccess: function (transport) {\n\n                    if (transport.responseText == 1) {\n                        self.alert(self.options.translator.translate('select_only_mapped_products'));\n                    } else if (transport.responseText == 2) {\n                        self.alert(self.options.translator.translate('select_the_same_type_products'));\n                    } else {\n                        var response = transport.responseText.evalJSON();\n\n                        if (response.offerListingCreation) {\n                            return self.offerListingCreation(\n                                response.accountId,\n                                response.marketplaceId,\n                                function () {\n                                    callback.call(self, response);\n                                }\n                            );\n                        }\n\n                        callback.call(self, response);\n                    }\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        tryToSubmit: function (listingId) {\n            var self = this;\n\n            new Ajax.Request(this.options.url.get('tryToMoveToListing'), {\n                method: 'post',\n                parameters: {\n                    componentMode: this.options.customData.componentMode,\n                    selectedProducts: Object.toJSON(this.selectedProducts),\n                    listingId: listingId\n                },\n                onSuccess: (function (transport) {\n\n                    var response = transport.responseText.evalJSON();\n\n                    if (response.result == 'success') {\n                        return this.submit(listingId);\n                    }\n\n                    new Ajax.Request(this.options.url.get('getFailedProductsHtml'), {\n                        method: 'get',\n                        parameters: {\n                            componentMode: this.options.customData.componentMode,\n                            failed_products: Object.toJSON(response.failed_products)\n                        },\n                        onSuccess: (function (transport) {\n\n                            this.popUp.modal('closeModal');\n                            this.openPopUp(\n                                transport.responseText,\n                                this.options.translator.translate('failed_products_popup_title'),\n                                [{\n                                    class: 'back',\n                                    text: M2ePro.translator.translate('Back'),\n                                    click: function (event) {\n                                        this.closeModal(event);\n                                        self.getGridHtml(self.selectedProducts);\n                                    }\n                                }, {\n                                    text: M2ePro.translator.translate('Continue'),\n                                    class: 'action-primary',\n                                    click: function () {\n                                        self.submit(listingId);\n                                    }\n                                }]\n                            );\n\n                        }).bind(this)\n                    });\n\n                }).bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        submit: function (listingId) {\n            var self = this;\n            new Ajax.Request(self.options.url.get('moveToListing'), {\n                method: 'post',\n                parameters: {\n                    componentMode: self.options.customData.componentMode,\n                    selectedProducts: Object.toJSON(self.selectedProducts),\n                    listingId: listingId\n                },\n                onSuccess: function (transport) {\n\n                    self.popUp.modal('closeModal');\n                    self.scrollPageToTop();\n\n                    var response = transport.responseText.evalJSON();\n\n                    if (response.result == 'success') {\n                        self.gridHandler.unselectAllAndReload();\n                        MessagesObj.addSuccessMessage(self.options.translator.translate('successfully_moved'));\n                        return;\n                    }\n\n                    var message = '';\n                    if (response.errors == self.selectedProducts.length) { // all items failed\n                        message = self.options.translator.translate('products_were_not_moved');\n                    } else {\n                        message = self.options.translator.translate('some_products_were_not_moved');\n                        self.gridHandler.unselectAllAndReload();\n                    }\n\n                    MessagesObj.addErrorMessage(str_replace('%url%', self.options.url.get('logViewUrl'), message));\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        offerListingCreation: function (accountId, marketplaceId, callback) {\n\n            var self = this;\n\n            self.confirm({\n                content: self.options.translator.translate('create_listing'),\n                actions: {\n                    confirm: function () {\n                        new Ajax.Request(self.options.url.get('createDefaultListing'), {\n                            method: 'post',\n                            parameters: {\n                                componentMode: self.options.customData.componentMode,\n                                accountId: accountId,\n                                marketplaceId: marketplaceId\n                            },\n                            onSuccess: function (transport) {\n                                callback.call(self);\n                            }\n                        });\n                    },\n                    cancel: function () {\n                        return callback.call(self);\n                    }\n                }\n            });\n        },\n\n        // ---------------------------------------\n\n        startListingCreation: function (url, response) {\n            var self = this;\n            var win = window.open(url);\n\n            var intervalId = setInterval(function () {\n                if (!win.closed) {\n                    return;\n                }\n\n                clearInterval(intervalId);\n\n                listingMovingGridJsObject.reload();\n            }, 1000);\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Listing/Category/Tree.js":"define([\r\n    'M2ePro/Common',\r\n    'extjs/ext-tree-checkbox'\r\n], function () {\r\n    window.ListingCategoryTree = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function() {},\r\n\r\n        // ---------------------------------------\r\n\r\n        tree_buildCategory: function(parent, config)\r\n        {\r\n            if (!config) {\r\n                return;\r\n            }\r\n\r\n            if (parent && config && config.length) {\r\n                for (var i = 0; i < config.length; i++) {\r\n\r\n                    config[i].uiProvider = Ext.tree.CheckboxNodeUI;\r\n\r\n                    var node = new Ext.tree.TreeNode(config[i]);\r\n\r\n                    for (var j=0;j<initTreeSelectedNodes.length;j++) {\r\n                        if (config[i].id == initTreeSelectedNodes[j][0]) {\r\n                            initTreeSelectedNodes[j][1] = node;\r\n                            initTreeSelectedNodes[j][1].attributes.checked = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    for (var k=0;k<initTreeHighlightedNodes.length;k++) {\r\n                        if (config[i].id == initTreeHighlightedNodes[k][0]) {\r\n                            initTreeHighlightedNodes[k][1] = node;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    parent.appendChild(node);\r\n\r\n                    if (config[i].children) {\r\n                        ListingCategoryTreeObj.tree_buildCategory(node, config[i].children);\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        tree_processChildren: function(node, state)\r\n        {\r\n            if (!node.hasChildNodes()) {\r\n                return false;\r\n            }\r\n\r\n            for (var i = 0; i < node.childNodes.length; i++) {\r\n                node.childNodes[i].ui.check(state);\r\n                if (node.childNodes[i].hasChildNodes()) {\r\n                    ListingCategoryTreeObj.tree_processChildren(node.childNodes[i], state);\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        tree_categoryAdd: function(id)\r\n        {\r\n            categories_selected_items.push(id);\r\n            array_unique(categories_selected_items);\r\n        },\r\n\r\n        tree_categoryRemove: function(id)\r\n        {\r\n            while (categories_selected_items.indexOf(id) != -1) {\r\n                categories_selected_items.splice(categories_selected_items.indexOf(id), 1);\r\n            }\r\n\r\n            array_unique(categories_selected_items);\r\n        },\r\n\r\n        getCategoryTitleById: function(id)\r\n        {\r\n            return tree.getNodeById(id).ui.getTextEl().innerHTML;\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/Other/Mapping.js":"define([\r\n    'jquery',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Common'\r\n], function (jQuery, modal, MessagesObj) {\r\n    window.ListingOtherMapping = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function(gridHandler,component)\r\n        {\r\n            this.gridHandler = gridHandler;\r\n            this.component = component;\r\n\r\n            this.attachEvents();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(productTitle, otherProductId)\r\n        {\r\n            this.attachEvents();\r\n            this.gridHandler.unselectAll();\r\n\r\n            var modalDialogMessage = $('map_modal_dialog_message');\r\n\r\n            if (!modalDialogMessage) {\r\n                modalDialogMessage = new Element('div', {\r\n                    id: 'map_modal_dialog_message'\r\n                });\r\n            }\r\n\r\n            this.popUp = jQuery(modalDialogMessage).modal({\r\n                title: M2ePro.translator.translate('Map Item \"%product_title%\" with Magento Product', productTitle),\r\n                type: 'slide',\r\n                buttons: []\r\n            });\r\n            this.popUp.modal('openModal');\r\n\r\n            var content = $('pop_up_content');\r\n            modalDialogMessage.insert(content.show());\r\n\r\n            $('other_product_id').value = otherProductId;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        attachEvents: function()\r\n        {\r\n            var self = this;\r\n\r\n            $('mapping_submit_button').stopObserving('click').observe('click',function(event) {\r\n                self.map();\r\n            });\r\n            $('product_id').stopObserving('keypress').observe('keypress',function(event) {\r\n                event.keyCode == Event.KEY_RETURN && self.map();\r\n            });\r\n            $('sku').stopObserving('keypress').observe('keypress',function(event) {\r\n                event.keyCode == Event.KEY_RETURN && self.map();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        map: function()\r\n        {\r\n            var self = this;\r\n            var productId = $('product_id').value;\r\n            var sku = $('sku').value;\r\n            var otherProductId = $('other_product_id').value;\r\n\r\n            MessagesObj.clear();\r\n\r\n            if (otherProductId == '' || (/^\\s*(\\d)*\\s*$/i).test(otherProductId) == false) {\r\n                return;\r\n            }\r\n\r\n            if ((sku == '' && productId == '')) {\r\n                $('product_id').focus();\r\n                self.alert(M2ePro.translator.translate('Please enter correct Product ID or SKU'));\r\n                return;\r\n            }\r\n            if (((/^\\s*(\\d)*\\s*$/i).test(productId) == false)) {\r\n                self.alert(M2ePro.translator.translate('Please enter correct Product ID.'));\r\n                $('product_id').focus();\r\n                $('product_id').value = '';\r\n                $('sku').value = '';\r\n                return;\r\n            }\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('listing_other_mapping/map', {}), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                componentMode: self.component,\r\n                                productId: productId,\r\n                                sku: sku,\r\n                                otherProductId: otherProductId\r\n                            },\r\n                            onSuccess: function(transport) {\r\n\r\n                                if (transport.responseText == 0) {\r\n                                    self.gridHandler.unselectAllAndReload();\r\n                                    self.popUp.modal('closeModal');\r\n                                    self.scrollPageToTop();\r\n                                    MessagesObj.addSuccessMessage(\r\n                                        M2ePro.translator.translate('Product(s) was successfully Mapped.')\r\n                                    );\r\n                                } else if (transport.responseText == 1) {\r\n                                    self.alert(M2ePro.translator.translate('Product does not exist.'));\r\n                                } else if (transport.responseText == 2) {\r\n                                    self.alert(M2ePro.translator.translate('Current version only supports Simple Products. Please, choose Simple Product.'));\r\n                                } else if (transport.responseText == 3) {\r\n                                    self.popUp.modal('closeModal');\r\n                                    self.scrollPageToTop();\r\n                                    MessagesObj.addErrorMessage(\r\n                                        M2ePro.translator.translate('Item was not Mapped as the chosen %product_id% Simple Product has Custom Options.', productId)\r\n                                    );\r\n                                }\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/Other/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n    window.ListingOtherGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        productTitleCellIndex: 2,\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function()\r\n        {\r\n            this.movingHandler      = new ListingMoving(this);\r\n            this.autoMappingHandler = new ListingOtherAutoMapping(this);\r\n            this.removingHandler    = new ListingOtherRemoving(this);\r\n            this.unmappingHandler   = new ListingOtherUnmapping(this);\r\n\r\n            this.actions = {\r\n                movingAction: this.movingHandler.run.bind(this.movingHandler),\r\n                autoMappingAction: this.autoMappingHandler.run.bind(this.autoMappingHandler),\r\n                removingAction: this.removingHandler.run.bind(this.removingHandler),\r\n                unmappingAction: this.unmappingHandler.run.bind(this.unmappingHandler)\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function()\r\n        {\r\n            var submitButton = $$('#'+this.gridId+'_massaction-form .admin__grid-massaction-form button');\r\n\r\n            submitButton.each((function(s) {\r\n                s.writeAttribute(\"onclick\",'');\r\n                s.observe('click', (function() {\r\n                    this.massActionSubmitClick();\r\n                }).bind(this));\r\n            }).bind(this));\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/Other/Unmapping.js":"define([\r\n    'jquery',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (jQuery, MessagesObj) {\r\n\r\n    window.ListingOtherUnmapping = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        run: function()\r\n        {\r\n            this.unmappingProducts(\r\n                this.gridHandler.getSelectedProductsString()\r\n            );\r\n        },\r\n\r\n        unmappingProducts: function(productsString)\r\n        {\r\n            new Ajax.Request(this.options.url.get('unmappingProducts'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    componentMode: this.options.customData.componentMode,\r\n                    product_ids: productsString\r\n                },\r\n                onSuccess: (function(transport) {\r\n\r\n                    MessagesObj.clear();\r\n\r\n                    if (transport.responseText == '1') {\r\n                        MessagesObj.addSuccessMessage(\r\n                            this.options.translator.translate('successfully_unmapped')\r\n                        );\r\n                    } else {\r\n                        MessagesObj.addErrorMessage(\r\n                            this.options.translator.translate('not_enough_data')\r\n                        );\r\n                    }\r\n\r\n                    this.gridHandler.unselectAllAndReload();\r\n                }).bind(this)\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/Other/Removing.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (MessagesObj) {\r\n    window.ListingOtherRemoving = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        run: function()\r\n        {\r\n            this.removingProducts(\r\n                this.gridHandler.getSelectedProductsString()\r\n            );\r\n        },\r\n\r\n        removingProducts: function(productsString)\r\n        {\r\n            new Ajax.Request(this.options.url.get('removingProducts'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    componentMode: this.options.customData.componentMode,\r\n                    product_ids: productsString\r\n                },\r\n                onSuccess: (function(transport) {\r\n\r\n                    MessagesObj.clear();\r\n\r\n                    if (transport.responseText == '1') {\r\n                        MessagesObj.addSuccessMessage(this.options.translator.translate('successfully_removed'));\r\n                    } else {\r\n                        MessagesObj.addErrorMessage(this.options.translator.translate('not_enough_data'));\r\n                    }\r\n\r\n                    this.gridHandler.unselectAllAndReload();\r\n                }).bind(this)\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/Other/AutoMapping.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (MessagesObj) {\r\n    window.ListingOtherAutoMapping = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options,options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        run: function()\r\n        {\r\n            this.mapProductsAuto(\r\n                this.gridHandler.getSelectedProductsString()\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapProductsAuto: function(product_ids)\r\n        {\r\n            var self = this;\r\n            var selectedProductsString = product_ids;\r\n            var selectedProductsArray = selectedProductsString.split(\",\");\r\n\r\n            if (selectedProductsString == '' || selectedProductsArray.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var maxProductsInPart = 10;\r\n\r\n            var result = [];\r\n            for (var i=0;i<selectedProductsArray.length;i++) {\r\n                if (result.length == 0 || result[result.length-1].length == maxProductsInPart) {\r\n                    result[result.length] = [];\r\n                }\r\n                result[result.length-1][result[result.length-1].length] = selectedProductsArray[i];\r\n            }\r\n\r\n            var selectedProductsParts = result;\r\n\r\n            ListingProgressBarObj.reset();\r\n            ListingProgressBarObj.show(self.options.translator.translate('automap_progress_title'));\r\n            GridWrapperObj.lock();\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n\r\n            self.sendPartsOfProducts(selectedProductsParts,selectedProductsParts.length,0);\r\n        },\r\n\r\n        sendPartsOfProducts: function(parts,totalPartsCount,isFailed)\r\n        {\r\n            var self = this;\r\n\r\n            if (parts.length == 0) {\r\n                MessagesObj.clear();\r\n\r\n                if (isFailed == 1) {\r\n                    MessagesObj.addErrorMessage(self.options.translator.translate('failed_mapped'));\r\n                } else {\r\n                    MessagesObj.addSuccessMessage(self.options.translator.translate('successfully_mapped'));\r\n                }\r\n\r\n                ListingProgressBarObj.setStatus(self.options.translator.translate('task_completed_message'));\r\n                ListingProgressBarObj.hide();\r\n                ListingProgressBarObj.reset();\r\n                GridWrapperObj.unlock();\r\n                $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n\r\n                self.gridHandler.unselectAllAndReload();\r\n\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0,1);\r\n            part = part[0];\r\n            var partString = implode(',',part);\r\n\r\n            var partExecuteString = part.length;\r\n            partExecuteString += '';\r\n\r\n            ListingProgressBarObj.setStatus(str_replace('%product_title%', partExecuteString, self.options.translator.translate('processing_data_message')));\r\n\r\n            new Ajax.Request(self.options.url.get('mapAutoToProduct'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    componentMode: self.options.customData.componentMode,\r\n                    product_ids: partString\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    var percents = (100/totalPartsCount)*(totalPartsCount-parts.length);\r\n\r\n                    if (percents <= 0) {\r\n                        ListingProgressBarObj.setPercents(0,0);\r\n                    } else if (percents >= 100) {\r\n                        ListingProgressBarObj.setPercents(100,0);\r\n                    } else {\r\n                        ListingProgressBarObj.setPercents(percents,1);\r\n                    }\r\n\r\n                    if (transport.responseText == 1) {\r\n                        isFailed = 1;\r\n                    }\r\n\r\n                    setTimeout(function() {\r\n                        self.sendPartsOfProducts(parts,totalPartsCount,isFailed);\r\n                    },500);\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/Product/Grid.js":"define([\r\n    'M2ePro/Magento/Product/Grid'\r\n], function () {\r\n\r\n    window.ListingProductGrid = Class.create(MagentoProductGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        // ---------------------------------------\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Listing/View/Action.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action',\r\n    'M2ePro/Plugin/ProgressBar',\r\n    'M2ePro/Plugin/AreaWrapper'\r\n], function (MagentoMessageObj) {\r\n\r\n    window.ListingViewAction = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super, gridHandler)\r\n        {\r\n            $super(gridHandler);\r\n\r\n            this.magentoMessageObj = Object.create(MagentoMessageObj);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        sendPartsResponses: [],\r\n        errorsSummaryContainerId: 'listing_container_errors_summary',\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setProgressBar: function (progressBarId) {\r\n            this.progressBarObj = new ProgressBar(progressBarId);\r\n        },\r\n\r\n        setGridWrapper: function (wrapperId) {\r\n            this.gridWrapperObj = new AreaWrapper(wrapperId);\r\n        },\r\n\r\n        setErrorsSummaryContainer: function (containerId) {\r\n            this.errorsSummaryContainerId = containerId;\r\n        },\r\n\r\n        setActionMessagesContainer: function (containerId) {\r\n            this.magentoMessageObj.setContainer('#' + containerId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        startActions: function (title, url, selectedProductsParts, requestParams) {\r\n            var self = this;\r\n            self.magentoMessageObj.clear();\r\n\r\n            $(self.errorsSummaryContainerId).hide();\r\n\r\n            self.progressBarObj.reset();\r\n            self.progressBarObj.show(title);\r\n            self.gridWrapperObj.lock();\r\n\r\n            self.sendPartsOfProducts(selectedProductsParts, selectedProductsParts.length, url, requestParams);\r\n\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n        },\r\n\r\n        sendPartsOfProducts: function (parts, totalPartsCount, url, requestParams) {\r\n            var self = this;\r\n\r\n            if (parts.length == totalPartsCount) {\r\n                self.sendPartsResponses = new Array();\r\n            }\r\n\r\n            if (parts.length == 0) {\r\n\r\n                self.progressBarObj.setPercents(100, 0);\r\n                self.progressBarObj.setStatus(M2ePro.translator.translate('task_completed_message'));\r\n\r\n                var combineResult = 'success';\r\n                for (var i = 0; i < self.sendPartsResponses.length; i++) {\r\n                    if (self.sendPartsResponses[i].result != 'success' && self.sendPartsResponses[i].result != 'warning') {\r\n                        combineResult = 'error';\r\n                        break;\r\n                    }\r\n                    if (self.sendPartsResponses[i].result == 'warning') {\r\n                        combineResult = 'warning';\r\n                    }\r\n                }\r\n\r\n                for (var i = 0; i < self.sendPartsResponses.length; i++) {\r\n                    if (typeof self.sendPartsResponses[i].is_processing_items != 'undefined' &&\r\n                        self.sendPartsResponses[i].is_processing_items == true) {\r\n                        self.magentoMessageObj.addNoticeMessage(self.options.text.locked_obj_notice);\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (combineResult == 'error') {\r\n\r\n                    var message = M2ePro.translator.translate('task_completed_error_message');\r\n                    message = message.replace('%task_title%', self.progressBarObj.getTitle());\r\n                    message = message.replace('%url%', M2ePro.url.get('logViewUrl'));\r\n\r\n                    self.magentoMessageObj.addErrorMessage(message);\r\n\r\n                    var actionIds = '';\r\n                    for (var i = 0; i < self.sendPartsResponses.length; i++) {\r\n                        if (actionIds != '') {\r\n                            actionIds += ',';\r\n                        }\r\n                        actionIds += self.sendPartsResponses[i].action_id;\r\n                    }\r\n\r\n                    new Ajax.Request(M2ePro.url.get('getErrorsSummary') + 'action_ids/' + actionIds + '/', {\r\n                        method: 'get',\r\n                        onSuccess: function (transportSummary) {\r\n                            $(self.errorsSummaryContainerId).innerHTML = transportSummary.responseText;\r\n                            $(self.errorsSummaryContainerId).show();\r\n                        }\r\n                    });\r\n\r\n                } else if (combineResult == 'warning') {\r\n                    var message = M2ePro.translator.translate('task_completed_warning_message');\r\n                    message = message.replace('%task_title%', self.progressBarObj.getTitle());\r\n                    message = message.replace('%url%', M2ePro.url.get('logViewUrl'));\r\n\r\n                    self.magentoMessageObj.addWarningMessage(message);\r\n                } else {\r\n                    var message = M2ePro.translator.translate('task_completed_success_message');\r\n                    message = message.replace('%task_title%', self.progressBarObj.getTitle());\r\n\r\n                    self.magentoMessageObj.addSuccessMessage(message);\r\n                }\r\n\r\n                self.progressBarObj.hide();\r\n                self.progressBarObj.reset();\r\n                self.gridWrapperObj.unlock();\r\n                $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n\r\n                self.sendPartsResponses = new Array();\r\n\r\n                self.gridHandler.unselectAllAndReload();\r\n\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0, 1);\r\n            part = part[0];\r\n            var partString = implode(',', part);\r\n\r\n            var partExecuteString = '';\r\n\r\n            if (part.length <= 2 && self.gridHandler.gridId != 'amazonVariationProductManageGrid') {\r\n\r\n                for (var i = 0; i < part.length; i++) {\r\n\r\n                    if (i != 0) {\r\n                        partExecuteString += ', ';\r\n                    }\r\n\r\n                    var temp = self.gridHandler.getProductNameByRowId(part[i]);\r\n\r\n                    if (temp != '') {\r\n                        if (temp.length > 75) {\r\n                            temp = temp.substr(0, 75) + '...';\r\n                        }\r\n                        partExecuteString += '\"' + temp + '\"';\r\n                    } else {\r\n                        partExecuteString = part.length;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                partExecuteString = part.length;\r\n            }\r\n\r\n            partExecuteString += '';\r\n\r\n            self.progressBarObj.setStatus(\r\n                str_replace(\r\n                    '%product_title%',\r\n                    partExecuteString,\r\n                    M2ePro.translator.translate('sending_data_message')\r\n                )\r\n            );\r\n\r\n            if (typeof requestParams == 'undefined') {\r\n                requestParams = {}\r\n            }\r\n\r\n            requestParams['selected_products'] = partString;\r\n\r\n            new Ajax.Request(url + 'id/' + self.gridHandler.listingId, {\r\n                method: 'post',\r\n                parameters: requestParams,\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n\r\n                        if (transport.responseText != '') {\r\n                            self.alert(transport.responseText);\r\n                        }\r\n\r\n                        self.progressBarObj.hide();\r\n                        self.progressBarObj.reset();\r\n                        self.gridWrapperObj.unlock();\r\n                        $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n\r\n                        self.sendPartsResponses = new Array();\r\n\r\n                        self.gridHandler.unselectAllAndReload();\r\n\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON(true);\r\n\r\n                    if (response.error) {\r\n                        self.progressBarObj.hide();\r\n                        self.progressBarObj.reset();\r\n                        self.gridWrapperObj.unlock();\r\n                        $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n\r\n                        self.sendPartsResponses = new Array();\r\n\r\n                        self.alert(response.message);\r\n\r\n                        return;\r\n                    }\r\n\r\n                    self.sendPartsResponses[self.sendPartsResponses.length] = response;\r\n\r\n                    var percents = (100 / totalPartsCount) * (totalPartsCount - parts.length);\r\n\r\n                    if (percents <= 0) {\r\n                        self.progressBarObj.setPercents(0, 0);\r\n                    } else if (percents >= 100) {\r\n                        self.progressBarObj.setPercents(100, 0);\r\n                    } else {\r\n                        self.progressBarObj.setPercents(percents, 1);\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        self.sendPartsOfProducts(parts, totalPartsCount, url);\r\n                    }, 500);\r\n                }\r\n            });\r\n\r\n            return;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        listAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('listing_selected_items_message'),\r\n                M2ePro.url.get('runListProducts'),\r\n                selectedProductsParts\r\n            );\r\n        },\r\n\r\n        relistAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('relisting_selected_items_message'),\r\n                M2ePro.url.get('runRelistProducts'),\r\n                selectedProductsParts\r\n            );\r\n        },\r\n\r\n        reviseAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('revising_selected_items_message'),\r\n                M2ePro.url.get('runReviseProducts'),\r\n                selectedProductsParts\r\n            );\r\n        },\r\n\r\n        stopAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('stopping_selected_items_message'),\r\n                M2ePro.url.get('runStopProducts'),\r\n                selectedProductsParts\r\n            );\r\n        },\r\n\r\n        stopAndRemoveAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.startActions(\r\n                M2ePro.translator.translate('stopping_and_removing_selected_items_message'),\r\n                M2ePro.url.get('runStopAndRemoveProducts'),\r\n                selectedProductsParts\r\n            );\r\n        },\r\n\r\n        previewItemsAction: function () {\r\n            var orderedSelectedProductsArray = this.gridHandler.getOrderedSelectedProductsArray();\r\n            if (orderedSelectedProductsArray.length == 0) {\r\n                return;\r\n            }\r\n\r\n            this.openWindow(\r\n                M2ePro.url.get('previewItems') + 'productIds/' + implode(',', orderedSelectedProductsArray)\r\n                + '/currentProductId/' + orderedSelectedProductsArray[0]\r\n            );\r\n        },\r\n\r\n        startTranslateAction: function () {\r\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts(100);\r\n            if (selectedProductsParts.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var self = this;\r\n            EbayListingTransferringTranslateHandlerObj.loadActionHtml(\r\n                self.gridHandler.getSelectedProductsArray(),\r\n                function () {\r\n                    self.startActions(\r\n                        self.options.text.start_translate_selected_items_message,\r\n                        self.options.url.get('runStartTranslateProducts'),\r\n                        selectedProductsParts\r\n                    );\r\n                }, function () {\r\n                    self.gridHandler.unselectAll();\r\n                });\r\n        },\r\n\r\n        stopTranslateAction: function () {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var selectedProductsParts = self.gridHandler.getSelectedItemsParts(100);\r\n                        if (selectedProductsParts.length == 0) {\r\n                            return;\r\n                        }\r\n\r\n                        self.startActions(\r\n                            self.options.text.stop_translate_selected_items_message,\r\n                            self.options.url.get('runStopTranslateProducts'),\r\n                            selectedProductsParts\r\n                        );\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Listing/View/Grid.js":"define([\r\n    'M2ePro/Grid',\r\n    'M2ePro/Listing/View/Action'\r\n], function () {\r\n\r\n    window.ListingViewGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        productIdCellIndex: 1,\r\n        productTitleCellIndex: 2,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridId,listingId)\r\n        {\r\n            this.listingId = listingId;\r\n\r\n            $super(gridId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getProductIdByRowId: function(rowId)\r\n        {\r\n            return this.getCellContent(rowId,this.productIdCellIndex);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedItemsParts: function(maxProductsInPart)\r\n        {\r\n            var selectedProductsArray = this.getSelectedProductsArray();\r\n\r\n            if (this.getSelectedProductsString() == '' || selectedProductsArray.length == 0) {\r\n                return [];\r\n            }\r\n\r\n            maxProductsInPart = maxProductsInPart || this.getMaxProductsInPart();\r\n\r\n            var result = [];\r\n            for (var i=0;i<selectedProductsArray.length;i++) {\r\n                if (result.length == 0 || result[result.length-1].length == maxProductsInPart) {\r\n                    result[result.length] = [];\r\n                }\r\n                result[result.length-1][result[result.length-1].length] = selectedProductsArray[i];\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            alert('abstract getMaxProductsInPart');\r\n        },\r\n\r\n        //########################################\r\n\r\n        prepareActions: function()\r\n        {\r\n            this.actionHandler = new ListingViewAction(this);\r\n\r\n            this.actions = {\r\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\r\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\r\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\r\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\r\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\r\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\r\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\r\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\r\n            };\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Account.js":"define([\r\n    'M2ePro/Common'\r\n], function(){\r\n\r\n    window.AmazonAccount = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-account-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Account. Account Title must be unique.'),\r\n                'Account', 'title', 'id',\r\n                M2ePro.formData.id,\r\n                M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Helper\\\\Component\\\\Amazon::NICK'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-marketplace-merchant', function(value, el) {\r\n\r\n                if (jQuery.validator.methods['M2ePro-required-when-visible'](null, el)) {\r\n                    return true;\r\n                }\r\n\r\n                // reset error message to the default\r\n                this.error = M2ePro.translator.translate('M2E Pro was not able to get access to the Amazon Account. Please, make sure, that you choose correct Option on MWS Authorization Page and enter correct Merchant ID.');\r\n\r\n                var merchant_id    = $('merchant_id').value;\r\n                var token          = $('token').value;\r\n                var marketplace_id = $('marketplace_id').value;\r\n\r\n                var pattern = /^[A-Z0-9]*$/;\r\n                if (!pattern.test(merchant_id)) {\r\n                    return false;\r\n                }\r\n\r\n                var checkResult = false;\r\n                var checkReason = null;\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_account/checkAuth'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        merchant_id    : merchant_id,\r\n                        token          : token,\r\n                        marketplace_id : marketplace_id\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        var response = transport.responseText.evalJSON();\r\n                        checkResult = response['result'];\r\n                        checkReason = response['reason'];\r\n                    }\r\n                });\r\n\r\n                if (checkReason != null) {\r\n                    this.error = M2ePro.translator.translate('M2E Pro was not able to get access to the Amazon Account. Reason: %error_message%').replace('%error_message%', checkReason);\r\n                }\r\n\r\n                return checkResult;\r\n\r\n            }, M2ePro.translator.translate('M2E Pro was not able to get access to the Amazon Account. Please, make sure, that you choose correct Option on MWS Authorization Page and enter correct Merchant ID.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-customer-id', function(value) {\r\n\r\n                var checkResult = false;\r\n\r\n                if ($('magento_orders_customer_id_container').getStyle('display') == 'none') {\r\n                    return true;\r\n                }\r\n\r\n                new Ajax.Request(M2ePro.url.get('general/checkCustomerId'), {\r\n                    method: 'post',\r\n                    asynchronous: false,\r\n                    parameters: {\r\n                        customer_id: value,\r\n                        id         : M2ePro.formData.id\r\n                    },\r\n                    onSuccess: function(transport) {\r\n                        checkResult = transport.responseText.evalJSON()['ok'];\r\n                    }\r\n                });\r\n\r\n                return checkResult;\r\n            }, M2ePro.translator.translate('No Customer entry is found for specified ID.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-order-number-prefix', function(value) {\r\n\r\n                if ($('magento_orders_number_prefix_mode').value == 0) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length <= 5;\r\n            }, M2ePro.translator.translate('Prefix length should not be greater than 5 characters.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-require-select-attribute', function(value, el) {\r\n\r\n                if ($('other_listings_mapping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_MODE_NO')) {\r\n                    return true;\r\n                }\r\n\r\n                var isAttributeSelected = false;\r\n\r\n                $$('.attribute-mode-select').forEach(function(obj) {\r\n                    if (obj.value != 0) {\r\n                        isAttributeSelected = true;\r\n                    }\r\n                });\r\n\r\n                return isAttributeSelected;\r\n            }, M2ePro.translator.translate('If Yes is chosen, you must select at least one Attribute for Product Mapping.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-repricing-price-value', function(value, el) {\r\n\r\n                if (!el.up('div.admin__field.field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (!value.match(/^\\d+[.]?\\d*?$/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n\r\n            }, M2ePro.translator.translate('Invalid input data. Decimal value required. Example 12.05'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-account-repricing-price-percent', function(value, el) {\r\n\r\n                if (!el.up('div.admin__field.field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (!value.match(/^\\d+$/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0 || value > 100) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n\r\n            }, M2ePro.translator.translate('Please enter correct value.'));\r\n\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            //tab listingOther\r\n            $('other_listings_synchronization')\r\n                .observe('change', AmazonAccountObj.other_listings_synchronization_change)\r\n                .simulate('change');\r\n            $('other_listings_mapping_mode')\r\n                .observe('change', AmazonAccountObj.other_listings_mapping_mode_change)\r\n                .simulate('change');\r\n\r\n            $('mapping_general_id_mode')\r\n                .observe('change', AmazonAccountObj.mapping_general_id_mode_change)\r\n                .simulate('change');\r\n            $('mapping_sku_mode')\r\n                .observe('change', AmazonAccountObj.mapping_sku_mode_change)\r\n                .simulate('change');\r\n            $('mapping_title_mode')\r\n                .observe('change', AmazonAccountObj.mapping_title_mode_change)\r\n                .simulate('change');\r\n            $('other_listings_move_mode')\r\n                .observe('change', AmazonAccountObj.move_mode_change)\r\n                .simulate('change');\r\n\r\n            //$('amazonAccountEditTabs_listingOther').removeClassName('changed');\r\n\r\n            if ($('is_vat_calculation_service_enabled')) {\r\n                $('is_vat_calculation_service_enabled')\r\n                    .observe('change', AmazonAccountObj.vatCalculationModeChange)\r\n                    .simulate('change');\r\n            }\r\n\r\n            //tab order\r\n            $('magento_orders_listings_mode').observe('change', AmazonAccountObj.magentoOrdersListingsModeChange).simulate('change');\r\n            $('magento_orders_listings_store_mode').observe('change', AmazonAccountObj.magentoOrdersListingsStoreModeChange).simulate('change');\r\n\r\n            $('magento_orders_listings_other_mode').observe('change', AmazonAccountObj.magentoOrdersListingsOtherModeChange).simulate('change');\r\n            $('magento_orders_listings_other_product_mode').observe('change', AmazonAccountObj.magentoOrdersListingsOtherProductModeChange);\r\n\r\n            $('magento_orders_number_source').observe('change', AmazonAccountObj.magentoOrdersNumberSourceChange).simulate('change');\r\n            $('magento_orders_number_prefix_mode').observe('change', AmazonAccountObj.magentoOrdersNumberPrefixModeChange).simulate('change');\r\n            $('magento_orders_number_prefix_prefix').observe('keyup', AmazonAccountObj.magentoOrdersNumberPrefixPrefixChange).simulate('change');\r\n            AmazonAccountObj.renderOrderNumberExample();\r\n\r\n            $('magento_orders_fba_mode').observe('change', AmazonAccountObj.magentoOrdersFbaModeChange).simulate('change');\r\n\r\n            $('magento_orders_customer_mode').observe('change', AmazonAccountObj.magentoOrdersCustomerModeChange).simulate('change');\r\n            $('magento_orders_status_mapping_mode').observe('change', AmazonAccountObj.magentoOrdersStatusMappingModeChange);\r\n\r\n            $('order_number_example-note').previous().remove();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        deleteClick: function()\r\n        {\r\n            this.confirm({\r\n                content: M2ePro.translator.translate('Be attentive! By Deleting Account you delete all information on it from M2E Pro Server. This will cause inappropriate work of all Accounts\\' copies.'),\r\n                actions: {\r\n                    confirm: function () {\r\n                        setLocation(M2ePro.url.get('deleteAction'));\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getToken: function(marketplaceId) {\r\n            var title = $('title');\r\n\r\n            title.removeClassName('required-entry M2ePro-account-title');\r\n            $('merchant_id').removeClassName('M2ePro-marketplace-merchant');\r\n            $('token').removeClassName('M2ePro-marketplace-merchant');\r\n            $('other_listings_mapping_mode').removeClassName('M2ePro-require-select-attribute');\r\n\r\n            this.submitForm(M2ePro.url.get(\r\n                'amazon_account/beforeGetToken',\r\n                {\r\n                    'id': M2ePro.formData.id,\r\n                    'title': title.value,\r\n                    'marketplace_id': marketplaceId\r\n                }\r\n            ));\r\n\r\n            return false;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeMarketplace: function(id)\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            $$('[id^=\"marketplaces_developer_key_container_\"],[id^=\"marketplaces_register_url_container_\"]').invoke('hide');\r\n\r\n            $('marketplaces_related_store_id_container').show();\r\n            $('marketplaces_merchant_id_container').show();\r\n            $('marketplaces_token_container').show();\r\n\r\n            self.showGetAccessData(id);\r\n        },\r\n\r\n        showGetAccessData: function(id)\r\n        {\r\n            $('marketplaces_application_name_container').show();\r\n\r\n            $('marketplaces_developer_key_container_'+id).show();\r\n            $('marketplaces_register_url_container_'+id).show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        other_listings_synchronization_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_SYNCHRONIZATION_YES')) {\r\n                $('other_listings_mapping_mode_tr').show();\r\n                $('marketplaces_related_store_id_container').show();\r\n            } else {\r\n                $('other_listings_mapping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_MODE_NO');\r\n                $('other_listings_mapping_mode').simulate('change');\r\n                $('other_listings_mapping_mode_tr').hide();\r\n                $('marketplaces_related_store_id_container').hide();\r\n            }\r\n        },\r\n\r\n        other_listings_mapping_mode_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_MODE_YES')) {\r\n                $('magento_block_amazon_accounts_other_listings_product_mapping').show();\r\n                $('magento_block_amazon_accounts_other_listings_move_mode').show();\r\n            } else {\r\n                $('magento_block_amazon_accounts_other_listings_product_mapping').hide();\r\n                $('magento_block_amazon_accounts_other_listings_move_mode').hide();\r\n\r\n                $('other_listings_move_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MOVE_TO_LISTINGS_DISABLED');\r\n                $('mapping_general_id_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_GENERAL_ID_MODE_NONE');\r\n                $('mapping_sku_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_NONE');\r\n                $('mapping_title_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_NONE');\r\n            }\r\n\r\n            $('mapping_general_id_mode').simulate('change');\r\n            $('mapping_sku_mode').simulate('change');\r\n            $('mapping_title_mode').simulate('change');\r\n\r\n            $('other_listings_move_mode').simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapping_general_id_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_GENERAL_ID_MODE_NONE')) {\r\n                $('mapping_general_id_priority_td').hide();\r\n            } else {\r\n                $('mapping_general_id_priority_td').show();\r\n            }\r\n\r\n            $('mapping_general_id_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_GENERAL_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('mapping_general_id_attribute'));\r\n            }\r\n        },\r\n\r\n        mapping_sku_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_NONE')) {\r\n                $('mapping_sku_priority_td').hide();\r\n            } else {\r\n                $('mapping_sku_priority_td').show();\r\n            }\r\n\r\n            $('mapping_sku_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_SKU_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('mapping_sku_attribute'));\r\n            }\r\n        },\r\n\r\n        mapping_title_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_NONE')) {\r\n                $('mapping_title_priority_td').hide();\r\n            } else {\r\n                $('mapping_title_priority_td').show();\r\n            }\r\n\r\n            $('mapping_title_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MAPPING_TITLE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('mapping_title_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        move_mode_change: function()\r\n        {\r\n            if ($('other_listings_move_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::OTHER_LISTINGS_MOVE_TO_LISTINGS_ENABLED')) {\r\n                $('other_listings_move_synch_tr').show();\r\n            } else {\r\n                $('other_listings_move_synch_tr').hide();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        magentoOrdersListingsModeChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_listings_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_MODE_YES')) {\r\n                $('magento_orders_listings_store_mode_container').show();\r\n            } else {\r\n                $('magento_orders_listings_store_mode_container').hide();\r\n                $('magento_orders_listings_store_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_STORE_MODE_DEFAULT');\r\n            }\r\n\r\n            self.magentoOrdersListingsStoreModeChange();\r\n            self.changeVisibilityForOrdersModesRelatedBlocks();\r\n        },\r\n\r\n        magentoOrdersListingsStoreModeChange: function()\r\n        {\r\n            if ($('magento_orders_listings_store_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_STORE_MODE_CUSTOM')) {\r\n                $('magento_orders_listings_store_id_container').show();\r\n            } else {\r\n                $('magento_orders_listings_store_id_container').hide();\r\n                $('magento_orders_listings_store_id').value = '';\r\n            }\r\n        },\r\n\r\n        magentoOrdersListingsOtherModeChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_listings_other_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_MODE_YES')) {\r\n                $('magento_orders_listings_other_product_mode_container').show();\r\n                $('magento_orders_listings_other_store_id_container').show();\r\n            } else {\r\n                $('magento_orders_listings_other_product_mode_container').hide();\r\n                $('magento_orders_listings_other_store_id_container').hide();\r\n                $('magento_orders_listings_other_product_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_PRODUCT_MODE_IGNORE');\r\n                $('magento_orders_listings_other_store_id').value = '';\r\n            }\r\n\r\n            self.magentoOrdersListingsOtherProductModeChange();\r\n            self.changeVisibilityForOrdersModesRelatedBlocks();\r\n        },\r\n\r\n        magentoOrdersListingsOtherProductModeChange: function()\r\n        {\r\n            if ($('magento_orders_listings_other_product_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_PRODUCT_MODE_IGNORE')) {\r\n                $('magento_orders_listings_other_product_mode_note').hide();\r\n                $('magento_orders_listings_other_product_tax_class_id_container').hide();\r\n            } else {\r\n                $('magento_orders_listings_other_product_mode_note').show();\r\n                $('magento_orders_listings_other_product_tax_class_id_container').show();\r\n            }\r\n        },\r\n\r\n        magentoOrdersNumberSourceChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n            self.renderOrderNumberExample();\r\n        },\r\n\r\n        magentoOrdersNumberPrefixModeChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_number_prefix_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_YES')) {\r\n                $('magento_orders_number_prefix_container').show();\r\n            } else {\r\n                $('magento_orders_number_prefix_container').hide();\r\n                $('magento_orders_number_prefix_prefix').value = '';\r\n            }\r\n\r\n            self.renderOrderNumberExample();\r\n        },\r\n\r\n        magentoOrdersNumberPrefixPrefixChange: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n            self.renderOrderNumberExample();\r\n        },\r\n\r\n        renderOrderNumberExample: function()\r\n        {\r\n            var orderNumber = $('sample_magento_order_id').value;\r\n            if ($('magento_orders_number_source').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_SOURCE_CHANNEL')) {\r\n                orderNumber = $('sample_amazon_order_id').value;\r\n            }\r\n\r\n            if ($('magento_orders_number_prefix_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_YES')) {\r\n                orderNumber = $('magento_orders_number_prefix_prefix').value + orderNumber;\r\n            }\r\n\r\n            $('order_number_example_container').update(orderNumber);\r\n        },\r\n\r\n        magentoOrdersFbaModeChange: function()\r\n        {\r\n            if ($('magento_orders_fba_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_MODE_NO')) {\r\n                $('magento_orders_fba_stock_mode_container').hide();\r\n                $('magento_orders_fba_stock_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_STOCK_MODE_NO');\r\n            } else {\r\n                $('magento_orders_fba_stock_mode_container').show();\r\n            }\r\n        },\r\n\r\n        magentoOrdersCustomerModeChange: function()\r\n        {\r\n            var customerMode = $('magento_orders_customer_mode').value;\r\n\r\n            if (customerMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_PREDEFINED')) {\r\n                $('magento_orders_customer_id_container').show();\r\n                $('magento_orders_customer_id').addClassName('M2ePro-account-product-id');\r\n            } else {  // M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::ORDERS_CUSTOMER_MODE_GUEST') || M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::ORDERS_CUSTOMER_MODE_NEW')\r\n                $('magento_orders_customer_id_container').hide();\r\n                $('magento_orders_customer_id').value = '';\r\n                $('magento_orders_customer_id').removeClassName('M2ePro-account-product-id');\r\n            }\r\n\r\n            var action = (customerMode == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_NEW')) ? 'show' : 'hide';\r\n            $('magento_orders_customer_new_website_id_container')[action]();\r\n            $('magento_orders_customer_new_group_id_container')[action]();\r\n            $('magento_orders_customer_new_notifications_container')[action]();\r\n\r\n            if(action == 'hide') {\r\n                $('magento_orders_customer_new_website_id').value = '';\r\n                $('magento_orders_customer_new_group_id').value = '';\r\n                $('magento_orders_customer_new_notifications').value = '';\r\n            }\r\n        },\r\n\r\n        magentoOrdersStatusMappingModeChange: function()\r\n        {\r\n            // Reset dropdown selected values to default\r\n            $('magento_orders_status_mapping_processing').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_PROCESSING');\r\n            $('magento_orders_status_mapping_shipped').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_SHIPPED');\r\n            // Default auto create invoice & shipment\r\n            $('magento_orders_invoice_mode').checked = true;\r\n            $('magento_orders_shipment_mode').checked = true;\r\n            var disabled = $('magento_orders_status_mapping_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_MODE_DEFAULT');\r\n            $('magento_orders_status_mapping_processing').disabled = disabled;\r\n            $('magento_orders_status_mapping_shipped').disabled = disabled;\r\n            $('magento_orders_invoice_mode').disabled = disabled;\r\n            $('magento_orders_shipment_mode').disabled = disabled;\r\n        },\r\n\r\n        changeVisibilityForOrdersModesRelatedBlocks: function()\r\n        {\r\n            var self = AmazonAccountObj;\r\n\r\n            if ($('magento_orders_listings_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_MODE_NO') &&\r\n                $('magento_orders_listings_other_mode').value == M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_LISTINGS_OTHER_MODE_NO')) {\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_number-wrapper').hide();\r\n                $('magento_orders_number_source').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_SOURCE_MAGENTO');\r\n                $('magento_orders_number_prefix_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_NUMBER_PREFIX_MODE_NO');\r\n                self.magentoOrdersNumberPrefixModeChange();\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_fba-wrapper').hide();\r\n                $('magento_orders_fba_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_MODE_YES');\r\n                $('magento_orders_fba_stock_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_FBA_STOCK_MODE_YES');\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_refund_and_cancellation-wrapper').hide();\r\n                $('magento_orders_refund').value = 1;\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_customer-wrapper').hide();\r\n                $('magento_orders_customer_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_CUSTOMER_MODE_GUEST');\r\n                self.magentoOrdersCustomerModeChange();\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_status_mapping-wrapper').hide();\r\n                $('magento_orders_status_mapping_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_STATUS_MAPPING_MODE_DEFAULT');\r\n                self.magentoOrdersStatusMappingModeChange();\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_rules-wrapper').hide();\r\n                $('magento_orders_qty_reservation_days').value = 1;\r\n\r\n                $('magento_block_amazon_accounts_magento_orders_tax-wrapper').hide();\r\n                $('magento_orders_tax_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_TAX_MODE_MIXED');\r\n\r\n                $('magento_orders_customer_billing_address_mode').value = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Model\\\\Amazon\\\\Account::MAGENTO_ORDERS_BILLING_ADDRESS_MODE_SHIPPING_IF_SAME_CUSTOMER_AND_RECIPIENT');\r\n            } else {\r\n                $('magento_block_amazon_accounts_magento_orders_number-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_fba-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_refund_and_cancellation-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_customer-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_status_mapping-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_tax-wrapper').show();\r\n                $('magento_block_amazon_accounts_magento_orders_rules-wrapper').show();\r\n            }\r\n        },\r\n\r\n        vatCalculationModeChange: function()\r\n        {\r\n            $('is_magento_invoice_creation_disabled_tr').hide();\r\n\r\n            if ($('is_vat_calculation_service_enabled').value == 1) {\r\n                $('is_magento_invoice_creation_disabled_tr').show();\r\n            }\r\n        },\r\n\r\n        // Repricing Integration\r\n        // ---------------------------------------\r\n\r\n        linkOrRegisterRepricing: function()\r\n        {\r\n            return setLocation(M2ePro.url.get('amazon_account_repricing/linkOrRegister'));\r\n        },\r\n\r\n        unlinkRepricing: function()\r\n        {\r\n            this.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        AmazonAccountObj.openUnlinkPage();\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openUnlinkPage: function()\r\n        {\r\n            return setLocation(M2ePro.url.get('amazon_account_repricing/openUnlinkPage'));\r\n        },\r\n\r\n        openManagement: function()\r\n        {\r\n            window.open(M2ePro.url.get('amazon_account_repricing/openManagement'));\r\n        },\r\n\r\n        regular_price_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                regularPriceAttr = $('regular_price_attribute'),\r\n                regularPriceCoeficient = $('regular_price_coefficient_td'),\r\n                variationRegularPrice = $('regular_price_variation_mode_tr');\r\n\r\n            regularPriceAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, regularPriceAttr);\r\n            }\r\n\r\n            regularPriceCoeficient.hide();\r\n            variationRegularPrice.hide();\r\n\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL') &&\r\n                this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::REGULAR_PRICE_MODE_PRODUCT_POLICY')) {\r\n\r\n                regularPriceCoeficient.show();\r\n                variationRegularPrice.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL')) {\r\n                $$('.repricing-min-price-mode-regular-depended').each(function (element) {\r\n                    if (element.selected) {\r\n                        element.up().selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL');\r\n                        element.simulate('change');\r\n                    }\r\n\r\n                    element.hide();\r\n                });\r\n\r\n                $$('.repricing-max-price-mode-regular-depended').each(function (element) {\r\n                    if (element.selected) {\r\n                        element.up().selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL');\r\n                        element.simulate('change');\r\n                    }\r\n\r\n                    element.hide();\r\n                });\r\n            } else {\r\n                $$('.repricing-min-price-mode-regular-depended').each(function (element) {\r\n                    element.show();\r\n                });\r\n\r\n                $$('.repricing-max-price-mode-regular-depended').each(function (element) {\r\n                    element.show();\r\n                });\r\n            }\r\n        },\r\n\r\n        min_price_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                minPriceValueTr = $('min_price_value_tr'),\r\n                minPricePercentTr = $('min_price_percent_tr'),\r\n                minPriceWarning = $('min_price_warning_tr'),\r\n                minPriceAttr = $('min_price_attribute'),\r\n                minPriceCoeficient = $('min_price_coefficient_td'),\r\n                variationMinPrice = $('min_price_variation_mode_tr');\r\n\r\n            minPriceWarning.hide();\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL')) {\r\n                minPriceWarning.show();\r\n            }\r\n\r\n            minPriceCoeficient.hide();\r\n            variationMinPrice.hide();\r\n\r\n            minPriceAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, minPriceAttr);\r\n\r\n                minPriceCoeficient.show();\r\n                variationMinPrice.show();\r\n            }\r\n\r\n            minPriceValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MIN_PRICE_MODE_REGULAR_VALUE')) {\r\n                minPriceValueTr.show();\r\n            }\r\n\r\n            minPricePercentTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MIN_PRICE_MODE_REGULAR_PERCENT')) {\r\n                minPricePercentTr.show();\r\n            }\r\n        },\r\n\r\n        max_price_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                maxPriceValueTr = $('max_price_value_tr'),\r\n                maxPricePercentTr = $('max_price_percent_tr'),\r\n                maxPriceWarning = $('max_price_warning_tr'),\r\n                maxPriceAttr = $('max_price_attribute'),\r\n                maxPriceCoeficient = $('max_price_coefficient_td'),\r\n                variationMaxPrice = $('max_price_variation_mode_tr');\r\n\r\n            maxPriceWarning.hide();\r\n            if (this.value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_MANUAL')) {\r\n                maxPriceWarning.show();\r\n            }\r\n\r\n            maxPriceCoeficient.hide();\r\n            variationMaxPrice.hide();\r\n\r\n            maxPriceAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::PRICE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, maxPriceAttr);\r\n\r\n                maxPriceCoeficient.show();\r\n                variationMaxPrice.show();\r\n            }\r\n\r\n            maxPriceValueTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MAX_PRICE_MODE_REGULAR_VALUE')) {\r\n                maxPriceValueTr.show();\r\n            }\r\n\r\n            maxPricePercentTr.hide();\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::MAX_PRICE_MODE_REGULAR_PERCENT')) {\r\n                maxPricePercentTr.show();\r\n            }\r\n        },\r\n\r\n        disable_mode_change: function()\r\n        {\r\n            var self = AmazonAccountObj,\r\n                disableModeAttr = $('disable_mode_attribute');\r\n\r\n            disableModeAttr.value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account_Repricing::DISABLE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, disableModeAttr);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveAndClose: function()\r\n        {\r\n            var self = this,\r\n                url = typeof M2ePro.url.urls.formSubmit == 'undefined' ?\r\n                    M2ePro.url.formSubmit + 'back/'+base64_encode('list')+'/' :\r\n                    M2ePro.url.get('formSubmit', {'back': base64_encode('list')});\r\n\r\n            if (!self.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(url, {\r\n                method: 'post',\r\n                parameters: Form.serialize($('edit_form')),\r\n                onSuccess: function(transport) {\r\n                    transport = transport.responseText.evalJSON();\r\n\r\n                    if (transport.success) {\r\n                        window.close();\r\n                    } else {\r\n                        self.alert(transport.message);\r\n                        return;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/AutoAction.js":"define([\r\n    'jquery',\r\n    'M2ePro/Listing/AutoAction',\r\n    'prototype'\r\n], function (jQuery) {\r\n\r\n    window.AmazonListingAutoAction = Class.create(ListingAutoAction, {\r\n\r\n        // ---------------------------------------\r\n\r\n        controller: 'amazon_listing_autoAction',\r\n\r\n        // ---------------------------------------\r\n\r\n        addingModeChange: function(el)\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_ADD') &&\r\n                ListingAutoActionObj.showCreateNewAsin) {\r\n\r\n                $('auto_action_amazon_add_and_create_asin').show();\r\n            } else {\r\n                $('auto_action_amazon_add_and_create_asin').hide();\r\n                $('auto_action_amazon_add_and_assign_description_template').hide();\r\n                $('auto_action_create_asin').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::ADDING_MODE_ADD_AND_CREATE_NEW_ASIN_NO');\r\n                $('adding_description_template_id').value = '';\r\n            }\r\n\r\n            if (el.target.value != M2ePro.php.constant('Ess_M2ePro_Model_Listing::ADDING_MODE_NONE')) {\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].show();\r\n            } else {\r\n                $$('[id$=\"adding_add_not_visible\"]')[0].value = M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_ADDING_ADD_NOT_VISIBLE_YES');\r\n                $$('[id$=\"adding_add_not_visible_field\"]')[0].hide();\r\n            }\r\n        },\r\n\r\n        createAsinChange: function(el)\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::ADDING_MODE_ADD_AND_CREATE_NEW_ASIN_YES')) {\r\n                $('auto_action_amazon_add_and_assign_description_template').show();\r\n            } else {\r\n                $('auto_action_amazon_add_and_assign_description_template').hide();\r\n                $('adding_description_template_id').value = '';\r\n            }\r\n        },\r\n\r\n        categoryStepOne: function(groupId)\r\n        {\r\n            this.loadAutoCategoryForm(groupId, function() {\r\n                $('category_close_button').hide();\r\n            });\r\n        },\r\n\r\n        collectData: function()\r\n        {\r\n            if ($('auto_mode')) {\r\n                switch (parseInt($('auto_mode').value)) {\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_GLOBAL'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_global_adding_mode: $('auto_global_adding_mode').value,\r\n                            auto_global_adding_add_not_visible: $('auto_global_adding_add_not_visible').value,\r\n                            adding_description_template_id: $('adding_description_template_id').value\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_WEBSITE'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            auto_mode: $('auto_mode').value,\r\n                            auto_website_adding_mode: $('auto_website_adding_mode').value,\r\n                            auto_website_adding_add_not_visible: $('auto_website_adding_add_not_visible').value,\r\n                            auto_website_deleting_mode: $('auto_website_deleting_mode').value,\r\n                            adding_description_template_id: $('adding_description_template_id').value\r\n                        };\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Listing::AUTO_MODE_CATEGORY'):\r\n                        ListingAutoActionObj.internalData = {\r\n                            id: $('group_id').value,\r\n                            title: $('group_title').value,\r\n                            auto_mode: $('auto_mode').value,\r\n                            adding_mode: $('adding_mode').value,\r\n                            adding_add_not_visible: $('adding_add_not_visible').value,\r\n                            deleting_mode: $('deleting_mode').value,\r\n                            categories: categories_selected_items,\r\n                            adding_description_template_id: $('adding_description_template_id').value\r\n                        };\r\n                        break;\r\n                }\r\n            }\r\n        },\r\n\r\n        reloadDescriptionTemplates: function()\r\n        {\r\n            var select = $('adding_description_template_id');\r\n\r\n            new Ajax.Request(M2ePro.url.get(ListingAutoActionObj.controller + '/getDescriptionTemplatesList'), {\r\n                onSuccess: function(transport) {\r\n\r\n                    var data = transport.responseText.evalJSON(true);\r\n\r\n                    var options = '<option></option>';\r\n\r\n                    var firstItem = null;\r\n                    var currentValue = select.value;\r\n\r\n                    data.each(function(item) {\r\n                        var key = item.id;\r\n                        var val = item.title;\r\n                        var disabled = item.is_new_asin_accepted == 0 ? ' disabled=\"disabled\"' : '';\r\n\r\n                        options += '<option value=\"' + key + '\"' + disabled + '>' + val + '</option>\\n';\r\n\r\n                        if (!firstItem) {\r\n                            firstItem = item;\r\n                        }\r\n                    });\r\n\r\n                    select.update();\r\n                    select.insert(options);\r\n\r\n                    if (currentValue != '') {\r\n                        $('adding_description_template_id').value = currentValue;\r\n                    } else if (typeof id !== 'undefined' && M2ePro.formData[id] > 0) {\r\n                        select.value = M2ePro.formData[id];\r\n                    } else if (firstItem.is_new_asin_accepted != 0) {\r\n                        select.value = firstItem.id;\r\n                    }\r\n\r\n                    select.simulate('change');\r\n                }\r\n            });\r\n        },\r\n\r\n        addNewTemplate: function(url, callback)\r\n        {\r\n            var win = window.open(url);\r\n\r\n            var intervalId = setInterval(function() {\r\n\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                callback && callback();\r\n\r\n            }, 1000);\r\n        }\r\n    });\r\n\r\n    // ---------------------------------------\r\n});","Ess_M2ePro/js/Amazon/Listing/Settings.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingSettings = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        storeId: null,\r\n        marketplaceId: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        saveClick: function (url, skipValidation) {\r\n\r\n            if (typeof skipValidation == 'undefined' && !this.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            if (typeof categories_selected_items != 'undefined') {\r\n                array_unique(categories_selected_items);\r\n\r\n                var selectedCategories = implode(',', categories_selected_items);\r\n\r\n                $('selected_categories').value = selectedCategories;\r\n            }\r\n\r\n            if (typeof url == 'undefined' || url == '') {\r\n                url = M2ePro.url.formSubmit + 'back/' + base64_encode('list') + '/';\r\n            }\r\n\r\n            Common.prototype.saveClick.call(this, url);\r\n        },\r\n\r\n        saveAndEditClick: function (url, lastActiveTab, skipValidation) {\r\n            if (typeof skipValidation == 'undefined' && !this.isValidForm()) {\r\n                return;\r\n            }\r\n\r\n            if (typeof categories_selected_items != 'undefined' && !this.isValidForm()) {\r\n                array_unique(categories_selected_items);\r\n\r\n                var selectedCategories = implode(',', categories_selected_items);\r\n\r\n                $('selected_categories').value = selectedCategories;\r\n            }\r\n\r\n            if (lastActiveTab && url) {\r\n                var tabsUrl = '|tab=' + jQuery('#amazonListingEditTabs').data().tabs.active.find('a')[0].id.split('_').pop();\r\n                url = url + 'back/' + base64_encode('edit' + tabsUrl) + '/';\r\n            }\r\n\r\n            this.submitForm(url);\r\n        },\r\n\r\n        reloadSellingFormatTemplates: function () {\r\n            AmazonListingSettingsObj.reload(M2ePro.url.get('getSellingFormatTemplates'), 'template_selling_format_id');\r\n        },\r\n\r\n        reloadSynchronizationTemplates: function () {\r\n            AmazonListingSettingsObj.reload(M2ePro.url.get('getSynchronizationTemplates'), 'template_synchronization_id');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        selling_format_template_id_simulate_change: function () {\r\n            var intervalRestartLimit = 20;\r\n            var intervalRestartCount = 0;\r\n\r\n            var intervalId = setInterval(function simulateSellingFormatTemplateChange() {\r\n                intervalRestartCount++;\r\n\r\n                if (intervalRestartCount >= intervalRestartLimit || Ajax.activeRequestCount == 0) {\r\n                    $('template_selling_format_id').value && $('template_selling_format_id').simulate('change');\r\n\r\n                    clearInterval(intervalId);\r\n                }\r\n            }, 250);\r\n        },\r\n\r\n        selling_format_template_id_change: function () {\r\n            AmazonListingSettingsObj.checkMessages();\r\n            AmazonListingSettingsObj.hideEmptyOption(this);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        checkMessages: function () {\r\n            if (AmazonListingSettingsObj.storeId === null || AmazonListingSettingsObj.marketplaceId === null) {\r\n                return;\r\n            }\r\n\r\n            var id = $('template_selling_format_id').value,\r\n                nick = 'selling_format',\r\n                storeId = AmazonListingSettingsObj.storeId,\r\n                marketplaceId = AmazonListingSettingsObj.marketplaceId,\r\n                checkAttributesAvailability = false,\r\n                container = 'template_selling_format_messages',\r\n                callback = function () {\r\n                    var refresh = $(container).down('a.refresh-messages');\r\n                    if (refresh) {\r\n                        refresh.observe('click', function () {\r\n                            this.checkMessages();\r\n                        }.bind(this))\r\n                    }\r\n                }.bind(this);\r\n\r\n            TemplateHandlerObj.checkMessages(\r\n                id,\r\n                nick,\r\n                '',\r\n                storeId,\r\n                marketplaceId,\r\n                checkAttributesAvailability,\r\n                container,\r\n                callback\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        synchronization_template_id_change: function () {\r\n            AmazonListingSettingsObj.hideEmptyOption(this);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reload: function (url, id) {\r\n            new Ajax.Request(url, {\r\n                asynchronous: false,\r\n                onSuccess: function (transport) {\r\n\r\n                    var data = transport.responseText.evalJSON(true);\r\n\r\n                    var options = '';\r\n\r\n                    var firstItemValue = '';\r\n                    var currentValue = $(id).value;\r\n\r\n                    data.each(function (paris) {\r\n                        var key = (typeof paris.key != 'undefined') ? paris.key : paris.id;\r\n                        var val = (typeof paris.value != 'undefined') ? paris.value : paris.title;\r\n                        options += '<option value=\"' + key + '\">' + val + '</option>\\n';\r\n\r\n                        if (firstItemValue == '') {\r\n                            firstItemValue = key;\r\n                        }\r\n                    });\r\n\r\n                    $(id).update();\r\n                    $(id).insert(options);\r\n\r\n                    if (currentValue != '') {\r\n                        $(id).value = currentValue;\r\n                    } else {\r\n                        if (M2ePro.formData[id] > 0) {\r\n                            $(id).value = M2ePro.formData[id];\r\n                        } else {\r\n                            $(id).value = firstItemValue;\r\n                        }\r\n                    }\r\n                    $(id).simulate('change');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addNewTemplate: function (url, callback) {\r\n            var win = window.open(url);\r\n\r\n            var intervalId = setInterval(function () {\r\n\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                callback && callback();\r\n\r\n            }, 1000);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        newSellingFormatTemplateCallback: function () {\r\n            var noteEl = $('template_selling_format_note');\r\n\r\n            AmazonListingSettingsObj.reloadSellingFormatTemplates();\r\n            if ($('template_selling_format_id').children.length > 0) {\r\n                $('template_selling_format_id').show();\r\n                noteEl && $('template_selling_format_note').show();\r\n                $('template_selling_format_label').hide();\r\n            } else {\r\n                $('template_selling_format_id').hide();\r\n                noteEl && $('template_selling_format_note').hide();\r\n                $('template_selling_format_label').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        newSynchronizationTemplateCallback: function () {\r\n            var noteEl = $('template_synchronization_note');\r\n\r\n            AmazonListingSettingsObj.reloadSynchronizationTemplates();\r\n            if ($('template_synchronization_id').children.length > 0) {\r\n                $('template_synchronization_id').show();\r\n                noteEl && $('template_synchronization_note').show();\r\n                $('template_synchronization_label').hide();\r\n            } else {\r\n                $('template_synchronization_id').hide();\r\n                noteEl && $('template_synchronization_note').hide();\r\n                $('template_synchronization_label').show();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/AfnQty.js":"define([\r\n    'Magento_Ui/js/modal/alert'\r\n], function (alert) {\r\n    window.AmazonListingAfnQty = Class.create();\r\n    AmazonListingAfnQty.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function(containerId) {},\r\n\r\n        // ---------------------------------------\r\n\r\n        showAfnQty: function(el, selectedSku, selectedProductId, accountId) {\r\n\r\n            var self = this,\r\n                skus = [];\r\n\r\n            var i = 50,\r\n                hasSelected = false;\r\n            el.up('table').select('.m2ePro-online-sku-value').each(function (skuEl) {\r\n                if (i === 0) {\r\n                    throw $break;\r\n                }\r\n\r\n                if (skuEl.innerHTML == '') {\r\n                    return;\r\n                }\r\n\r\n                if (selectedSku == skuEl.innerHTML) {\r\n                    hasSelected = true;\r\n                }\r\n\r\n                skus.push({\r\n                    sku: skuEl.innerHTML,\r\n                    productId: skuEl.getAttribute('productId')\r\n                });\r\n                i--;\r\n            });\r\n\r\n            if (!hasSelected) {\r\n                skus.pop();\r\n                skus.push({\r\n                    sku: selectedSku,\r\n                    productId: selectedProductId\r\n                });\r\n            }\r\n\r\n            var skusStr = '';\r\n            skus.each(function(item) {\r\n                skusStr += item.sku + ','\r\n            });\r\n\r\n            skusStr = rtrim(skusStr, ',');\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing/getAFNQtyBySku'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    skus: skusStr,\r\n                    account_id: accountId\r\n                },\r\n                onSuccess: function(transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert({\r\n                            content: transport.responseText\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    var data = {};\r\n                    skus.each(function (item) {\r\n                        if (response.items[item.sku]) {\r\n                            data[item.productId] = response.items[item.sku].qty;\r\n                        } else {\r\n                            data[item.productId] = 'empty';\r\n                        }\r\n                    });\r\n\r\n                    self.renderAfnQty(data);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderAfnQty: function(data)\r\n        {\r\n            var self = this;\r\n\r\n            $H(data).each(function(item) {\r\n                var container = $('m2ePro_afn_qty_value_' + item.key);\r\n\r\n                container.down('a').hide();\r\n                container.down('.m2ePro-online-sku-value').remove();\r\n\r\n                if (item.value != 'empty') {\r\n                    container.down('.m2epro-afn-qty-data').show();\r\n\r\n                    container.down('.total span').update(item.value.total);\r\n                    container.down('.in-stock span').update(item.value.in_stock);\r\n                } else {\r\n                    container.down('.m2epro-empty-afn-qty-data').show();\r\n                }\r\n            });\r\n        }\r\n\r\n    };\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/General.js":"define([\r\n    'underscore',\r\n    'Magento_Ui/js/modal/alert',\r\n    'M2ePro/Amazon/Listing/Create/General/MarketplaceSynchProgress',\r\n    'M2ePro/Plugin/ProgressBar',\r\n    'M2ePro/Plugin/AreaWrapper'\r\n], function (_, alert) {\r\n\r\n    window.AmazonListingCreateGeneral = Class.create();\r\n    AmazonListingCreateGeneral.prototype = {\r\n\r\n        marketplaceSynchProgressObj: null,\r\n        accounts: null,\r\n        selectedAccountId: null,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            var self = this;\r\n\r\n            self.marketplaceSynchProgressObj = new AmazonListingCreateGeneralMarketplaceSynchProgress(\r\n                new ProgressBar('progress_bar'),\r\n                new AreaWrapper('content_container')\r\n            );\r\n\r\n            CommonObj.setValidationCheckRepetitionValue(\r\n                'M2ePro-listing-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Listing. Listing Title must be unique.'),\r\n                'Listing', 'title', 'id', null, M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK')\r\n            );\r\n\r\n            self.initAccount();\r\n            self.initMarketplace();\r\n        },\r\n\r\n        initAccount: function () {\r\n            var self = this;\r\n\r\n            $('account_id').observe('change', function() {\r\n                self.selectedAccountId = this.value;\r\n\r\n                if (this.value == '') {\r\n                    $('marketplace_info').hide();\r\n                    return;\r\n                }\r\n\r\n                var account = _.findWhere(self.accounts, {id: this.value});\r\n                if (!_.isUndefined(account)) {\r\n                    $('marketplace_info').show();\r\n                    $('marketplace_id').value = account.marketplace_id;\r\n                    $('marketplace_title').innerHTML = account.marketplace_title;\r\n                    $('marketplace_url').innerHTML = account.marketplace_url;\r\n                }\r\n            });\r\n\r\n            self.renderAccounts();\r\n\r\n            $('add_account_button').observe('click', function() {\r\n                var win = window.open(M2ePro.url.get('amazon_account/newAction'));\r\n\r\n                var intervalId = setInterval(function() {\r\n\r\n                    if (!win.closed) {\r\n                        return;\r\n                    }\r\n\r\n                    clearInterval(intervalId);\r\n\r\n                    self.renderAccounts();\r\n\r\n                }, 1000);\r\n            });\r\n        },\r\n\r\n        initMarketplace: function () {\r\n            var self = this;\r\n\r\n            $('save_and_next').observe('click', function() {\r\n                if (self.marketplaceSynchProgressObj.runningNow) {\r\n                    alert({\r\n                        content: M2ePro.translator.translate('Please wait while Synchronization is finished.')\r\n                    });\r\n                    return;\r\n                }\r\n                jQuery('#edit_form').valid() && self.synchronizeMarketplace($('marketplace_id').value);\r\n            });\r\n        },\r\n\r\n        renderAccounts: function (callback) {\r\n            var self = this;\r\n\r\n            var account_add_btn = $('add_account_button');\r\n            var account_label_el = $('account_label');\r\n            var account_select_el = $('account_id');\r\n            var marketplace_info = $('marketplace_info');\r\n\r\n            //firefox can't simulate events for disabled elements\r\n            if (account_select_el.disabled) {\r\n                account_select_el.enable();\r\n                self.accountDisabled = true;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/getAccounts'), {\r\n                method: 'get',\r\n                onSuccess: function(transport) {\r\n                    var accounts = transport.responseText.evalJSON();\r\n\r\n                    if (_.isNull(self.accounts)) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (_.isNull(self.selectedAccountId)) {\r\n                        self.selectedAccountId = account_select_el.value;\r\n                    }\r\n\r\n                    var isAccountsChanged = !self.isAccountsEqual(accounts);\r\n\r\n                    if (isAccountsChanged) {\r\n                        self.accounts = accounts;\r\n                    }\r\n\r\n                    if (accounts.length == 0) {\r\n                        account_add_btn.down('span').update(M2ePro.translator.translate('Add'));\r\n                        account_label_el.update(M2ePro.translator.translate('Account not found, please create it.'));\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                        marketplace_info.hide();\r\n                        return;\r\n                    }\r\n\r\n                    marketplace_info.show();\r\n\r\n                    account_select_el.update();\r\n                    account_select_el.appendChild(new Element('option', {style: 'display: none'}));\r\n                    accounts.each(function(account) {\r\n                        account_select_el.appendChild(new Element('option', {value: account.id})).insert(account.title);\r\n                    });\r\n\r\n                    account_add_btn.down('span').update(M2ePro.translator.translate('Add Another'));\r\n\r\n                    if (accounts.length === 1) {\r\n                        var account = _.first(accounts);\r\n\r\n                        self.selectedAccountId = account.id;\r\n\r\n                        var accountElement;\r\n\r\n                        if (M2ePro.formData.wizard) {\r\n                            accountElement = new Element('span').update(account.title);\r\n                        } else {\r\n                            var accountLink = M2ePro.url.get('amazon_account/edit', {'id': account.id, close_on_save: 1});\r\n                            accountElement = new Element('a', {\r\n                                'href': accountLink,\r\n                                'target': '_blank'\r\n                            }).update(account.title);\r\n                        }\r\n\r\n                        account_label_el.update(accountElement);\r\n\r\n                        account_label_el.show();\r\n                        account_select_el.hide();\r\n                    } else if (isAccountsChanged) {\r\n                        self.selectedAccountId = _.last(accounts).id;\r\n\r\n                        account_label_el.hide();\r\n                        account_select_el.show();\r\n                    }\r\n\r\n                    account_select_el.setValue(self.selectedAccountId);\r\n\r\n                    account_select_el.simulate('change');\r\n\r\n                    //firefox can't simulate events for disabled elements\r\n                    if (self.accountDisabled) {\r\n                        account_select_el.disable();\r\n                    }\r\n\r\n                    callback && callback();\r\n                }\r\n            });\r\n        },\r\n\r\n        synchronizeMarketplace: function (marketplaceId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('general/isMarketplaceEnabled'), {\r\n                method: 'get',\r\n                parameters: { marketplace_id: marketplaceId },\r\n                onSuccess: function(transport) {\r\n\r\n                    var result = transport.responseText.evalJSON();\r\n                    if (result.status) {\r\n                        return self.marketplaceSynchProgressObj.end();\r\n                    }\r\n\r\n                    var title = 'Amazon ' + $('marketplace_title').innerHTML;\r\n\r\n                    $('save_and_next').disable();\r\n\r\n                    self.marketplaceSynchProgressObj.runTask(\r\n                        title,\r\n                        M2ePro.url.get('amazon_marketplace/runSynchNow', {marketplace_id: marketplaceId})\r\n                    );\r\n                }\r\n            });\r\n        },\r\n\r\n        isAccountsEqual: function (newAccounts) {\r\n            if (!newAccounts.length && !this.accounts.length) {\r\n                return true;\r\n            }\r\n\r\n            if (newAccounts.length !== this.accounts.length) {\r\n                return false;\r\n            }\r\n\r\n            return _.every(this.accounts, function (account) {\r\n                return _.where(newAccounts, account).length > 0;\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    };\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/Search.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingCreateSearch = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        general_id_mode_change: function () {\r\n            var self = AmazonListingCreateSearchObj;\r\n\r\n            $('general_id_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GENERAL_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('general_id_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        worldwide_id_mode_change: function () {\r\n            var self = AmazonListingCreateSearchObj;\r\n\r\n            $('worldwide_id_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::WORLDWIDE_ID_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('worldwide_id_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/Selling.js":"define([\r\n    'M2ePro/Common'\r\n], function () {\r\n\r\n    window.AmazonListingCreateSelling = Class.create(Common, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function () {\r\n            jQuery.validator.addMethod('M2ePro-validate-condition-note-length', function(value) {\r\n                if ($('condition_note_mode').value != M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_NOTE_MODE_CUSTOM_VALUE')) {\r\n                    return true;\r\n                }\r\n\r\n                return value.length <= 2000;\r\n            }, M2ePro.translator.translate('condition_note_length_error'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-sku-modification-custom-value', function(value) {\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_NONE')) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_TEMPLATE')) {\r\n                    return value.match(/%value%/g);\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('sku_modification_custom_value_error'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-sku-modification-custom-value-max-length', function(value) {\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_NONE')) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_TEMPLATE')) {\r\n                    value = value.replace('%value%', '');\r\n                }\r\n\r\n                return value.length < M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing_Product_Action_Type_ListAction_Validator_Sku_General::SKU_MAX_LENGTH');\r\n            }, M2ePro.translator.translate('sku_modification_custom_value_max_length_error'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getAvailableConstantsForImages: function () {\r\n            return [\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_LIKE_NEW'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_VERY_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_USED_ACCEPTABLE'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_LIKE_NEW'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_VERY_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_GOOD'),\r\n                M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_COLLECTIBLE_ACCEPTABLE'),\r\n            ];\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        sku_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('sku_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('sku_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        sku_modification_mode_change: function () {\r\n            if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_TEMPLATE')) {\r\n                $('sku_modification_custom_value').value = '%value%';\r\n            } else {\r\n                $('sku_modification_custom_value').value = '';\r\n            }\r\n\r\n            if ($('sku_modification_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::SKU_MODIFICATION_MODE_NONE')) {\r\n                $('sku_modification_custom_value_tr').hide();\r\n            } else {\r\n                $('sku_modification_custom_value_tr').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        condition_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj,\r\n                attributeCode = this.options[this.selectedIndex].getAttribute('attribute_code'),\r\n                condition_note_mode = $('condition_note_mode'),\r\n                conditionValue = $('condition_value'),\r\n                conditionCustomAttribute = $('condition_custom_attribute');\r\n\r\n            $('magento_block_amazon_listing_add_images-wrapper').hide();\r\n            $('condition_note_mode_tr').show();\r\n            $('condition_note_value_tr').show();\r\n\r\n            conditionValue.value = '';\r\n            conditionCustomAttribute.value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_MODE_DEFAULT')) {\r\n                self.updateHiddenValue(this, conditionValue);\r\n\r\n                if (attributeCode == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_NEW')) {\r\n                    $('condition_note_mode_tr').hide();\r\n                    $('condition_note_value_tr').hide();\r\n                } else {\r\n                    self.condition_note_mode_change();\r\n                }\r\n\r\n                if (self.getAvailableConstantsForImages().indexOf(attributeCode) == -1) {\r\n                    $('image_main_attribute').value = '';\r\n                    $('image_main_mode').selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::IMAGE_MAIN_MODE_NONE');\r\n                    $('image_main_mode').simulate('change');\r\n                } else {\r\n                    $('magento_block_amazon_listing_add_images-wrapper').show();\r\n                }\r\n            } else {\r\n                self.updateHiddenValue(this, conditionCustomAttribute);\r\n                $('condition_note_mode_tr').show();\r\n                self.condition_note_mode_change();\r\n\r\n                $('magento_block_amazon_listing_add_images-wrapper').show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        image_main_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gallery_images_mode_tr').show();\r\n\r\n            $('image_main_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::IMAGE_MAIN_MODE_NONE')) {\r\n                $('gallery_images_mode_tr').hide();\r\n                $('gallery_images_limit').value = '';\r\n                $('gallery_images_attribute').value = '';\r\n                $('gallery_images_mode').selectedIndex = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GALLERY_IMAGES_MODE_NONE');\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::IMAGE_MAIN_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('image_main_attribute'));\r\n            }\r\n        },\r\n\r\n        gallery_images_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gallery_images_limit').value = '';\r\n            $('gallery_images_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GALLERY_IMAGES_MODE_PRODUCT')) {\r\n                self.updateHiddenValue(this, $('gallery_images_limit'));\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GALLERY_IMAGES_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gallery_images_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        gift_wrap_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gift_wrap_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GIFT_WRAP_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gift_wrap_attribute'));\r\n            }\r\n        },\r\n\r\n        gift_message_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('gift_message_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::GIFT_MESSAGE_MODE_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('gift_message_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        condition_note_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            if ($('condition_note_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::CONDITION_NOTE_MODE_CUSTOM_VALUE')) {\r\n                $('condition_note_value_tr').show();\r\n            } else {\r\n                $('condition_note_value_tr').hide();\r\n            }\r\n        },\r\n\r\n        handling_time_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('handling_time_custom_attribute').value = '';\r\n            $('handling_time_value').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::HANDLING_TIME_MODE_RECOMMENDED')) {\r\n                self.updateHiddenValue(this, $('handling_time_value'));\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::HANDLING_TIME_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('handling_time_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        restock_date_mode_change: function () {\r\n            var self = AmazonListingCreateSellingObj;\r\n\r\n            $('restock_date_value_tr').hide();\r\n\r\n            $('restock_date_custom_attribute').value = '';\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::RESTOCK_DATE_MODE_CUSTOM_VALUE')) {\r\n                $('restock_date_value_tr').show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Listing::RESTOCK_DATE_MODE_CUSTOM_ATTRIBUTE')) {\r\n                self.updateHiddenValue(this, $('restock_date_custom_attribute'));\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        appendToText: function (ddId, targetId) {\r\n            if ($(ddId).value == '') {\r\n                return;\r\n            }\r\n\r\n            var attributePlaceholder = '#' + $(ddId).value + '#',\r\n                element = $(targetId);\r\n\r\n            if (document.selection) {\r\n                /* IE */\r\n                element.focus();\r\n                document.selection.createRange().text = attributePlaceholder;\r\n                element.focus();\r\n            } else if (element.selectionStart || element.selectionStart == '0') {\r\n                /* Webkit */\r\n                var startPos = element.selectionStart,\r\n                    endPos = element.selectionEnd,\r\n                    scrollTop = element.scrollTop,\r\n                    tempValue;\r\n\r\n                tempValue = element.value.substring(0, startPos);\r\n                tempValue += attributePlaceholder;\r\n                tempValue += element.value.substring(endPos, element.value.length);\r\n                element.value = tempValue;\r\n\r\n                element.focus();\r\n                element.selectionStart = startPos + attributePlaceholder.length;\r\n                element.selectionEnd = startPos + attributePlaceholder.length;\r\n                element.scrollTop = scrollTop;\r\n            } else {\r\n                element.value += attributePlaceholder;\r\n                element.focus();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Create/General/MarketplaceSynchProgress.js":"define([\n    'M2ePro/SynchProgress'\n], function () {\n    AmazonListingCreateGeneralMarketplaceSynchProgress = Class.create(SynchProgress, {\n\n        // ---------------------------------------\n\n        runningNow: false,\n\n        // ---------------------------------------\n\n        start: function ($super, title, status) {\n            $super(title, status);\n            this.runningNow = true;\n        },\n\n        end: function ($super) {\n            $super();\n            this.runningNow = false;\n            this.saveClick(M2ePro.url.get('amazon_listing_create/index'), true)\n        },\n\n        runTask: function (title, url, callBackWhenEnd) {\n            title = title || '';\n            url = url || '';\n            callBackWhenEnd = callBackWhenEnd || '';\n\n            if (url == '') {\n                return;\n            }\n\n            var self = this;\n            new Ajax.Request(M2ePro.url.get('general/synchCheckState'), {\n                method: 'get',\n                asynchronous: true,\n                onSuccess: function (transport) {\n\n                    if (transport.responseText == self.stateExecuting) {\n\n                        self.start(\n                            M2ePro.translator.translate('Another Synchronization Is Already Running.'),\n                            M2ePro.translator.translate('Getting information. Please wait ...')\n                        );\n\n                        setTimeout(function () {\n                            self.startGetExecutingInfo('self.runTask(\\'' + title + '\\',\\'' + url + '\\',\"' + callBackWhenEnd + '\");');\n                        }, 2000);\n\n                    } else {\n\n                        self.start(title, M2ePro.translator.translate('Preparing to start. Please wait ...'));\n\n                        new Ajax.Request(url, {\n                            method: 'get', asynchronous: true\n                        });\n\n                        setTimeout(function () {\n                            self.startGetExecutingInfo(callBackWhenEnd);\n                        }, 2000);\n                    }\n                }\n            });\n        },\n\n        startGetExecutingInfo: function (callBackWhenEnd) {\n            callBackWhenEnd = callBackWhenEnd || '';\n\n            var self = this;\n            new Ajax.Request(M2ePro.url.get('general/synchGetExecutingInfo'), {\n                method: 'get',\n                asynchronous: true,\n                onSuccess: function (transport) {\n\n                    var data = transport.responseText.evalJSON(true);\n\n                    if (data.mode == self.stateExecuting) {\n\n                        self.progressBarObj.setTitle(data.title);\n                        if (data.percents <= 0) {\n                            self.progressBarObj.setPercents(0, 0);\n                        } else if (data.percents >= 100) {\n                            self.progressBarObj.setPercents(100, 0);\n                        } else {\n                            self.progressBarObj.setPercents(data.percents, 1);\n                        }\n                        self.progressBarObj.setStatus(data.status);\n\n                        self.wrapperObj.lock();\n                        $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\n\n                        setTimeout(function () {\n                            self.startGetExecutingInfo(callBackWhenEnd);\n                        }, 3000);\n\n                    } else {\n\n                        self.progressBarObj.setPercents(100, 0);\n\n                        // ---------------------------------------\n                        setTimeout(function () {\n\n                            if (callBackWhenEnd != '') {\n                                eval(callBackWhenEnd);\n                            } else {\n                                self.end();\n                            }\n\n                        }, 1500);\n                        // ---------------------------------------\n                    }\n                }\n            });\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Amazon/Listing/Other/Grid.js":"define([\r\n    'M2ePro/Listing/Other/Grid'\r\n], function () {\r\n    window.AmazonListingOtherGrid = Class.create(ListingOtherGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function(rowId)\r\n        {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Other\\\\AbstractGrid::LISTING_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('amazon_log_listing_other/index', params);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add.js":"define([\n    'M2ePro/Common'\n], function () {\n\n    window.AmazonListingProductAdd = Class.create();\n    AmazonListingProductAdd.prototype = Object.extend(new Common(), {\n\n        // ---------------------------------------\n\n        initialize: function (ProgressBarObj, WrapperObj) {\n            this.categories = '';\n            this.products = '';\n            this.listing_id = null;\n            this.is_list = null;\n            this.back = '';\n            this.emptyListing = 0;\n\n            this.categoriesAddAction = null;\n            this.categoriesDeleteAction = null;\n\n            this.progressBarObj = ProgressBarObj;\n            this.wrapperObj = WrapperObj;\n        },\n\n        // ---------------------------------------\n\n        add: function (items, back, isList) {\n            var self = this;\n            self.is_list = isList;\n            self.back = back;\n\n            self.getListingId(items);\n\n            if (self.emptyListing == 1) {\n                return;\n            }\n\n            self.products = items;\n\n            var parts = self.makeProductsParts();\n\n            self.progressBarObj.reset();\n            self.progressBarObj.setTitle('Adding Products to Listing');\n            self.progressBarObj.setStatus('Adding in process. Please wait...');\n            self.progressBarObj.show();\n            self.scrollPageToTop();\n\n            self.wrapperObj.lock();\n\n            self.sendPartsProducts(parts, parts.length);\n        },\n\n        setCategoriesActions: function (addAction, deleteAction) {\n            this.categoriesAddAction = addAction;\n            this.categoriesDeleteAction = deleteAction;\n        },\n\n        getListingId: function (items) {\n            var self = this;\n\n            if (self.listing_id) {\n                return;\n            }\n\n            var hrefParts = explode('/', window.location.href);\n\n            for (var i = 0; i < hrefParts.length; i++) {\n                if (hrefParts[i] == 'id') {\n                    self.listing_id = hrefParts[i + 1];\n                    break;\n                }\n            }\n        },\n\n        makeProductsParts: function () {\n            var self = this;\n\n            var productsInPart = 50;\n            var productsArray = explode(',', self.products);\n            var parts = new Array();\n\n            if (productsArray.length < productsInPart) {\n                return parts[0] = productsArray;\n            }\n\n            var result = new Array();\n            for (var i = 0; i < productsArray.length; i++) {\n                if (result.length == 0 || result[result.length - 1].length == productsInPart) {\n                    result[result.length] = new Array();\n                }\n                result[result.length - 1][result[result.length - 1].length] = productsArray[i];\n            }\n\n            return result;\n        },\n\n        sendPartsProducts: function (parts, partsCount) {\n            var self = this;\n\n            if (parts.length == 0) {\n                return;\n            }\n\n            var part = parts.splice(0, 1);\n            part = part[0];\n            var partString = implode(',', part);\n\n            var isLastPart = '';\n            if (parts.length <= 0) {\n                isLastPart = 'yes';\n            }\n\n            new Ajax.Request(M2ePro.url.get('add_products'), {\n                method: 'post',\n                parameters: {\n                    listing_id: self.listing_id,\n                    is_last_part: isLastPart,\n                    do_list: self.is_list,\n                    back: self.back,\n                    products: partString\n                },\n                onSuccess: function (transport) {\n\n                    var percents = (100 / partsCount) * (partsCount - parts.length);\n\n                    if (percents <= 0) {\n                        self.progressBarObj.setPercents(0, 0);\n                    } else if (percents >= 100) {\n                        self.progressBarObj.setPercents(100, 0);\n                        self.progressBarObj.setStatus('Adding has been completed.');\n\n                        return setLocation(transport.responseText.evalJSON()['redirect']);\n                    } else {\n                        self.progressBarObj.setPercents(percents, 1);\n                    }\n\n                    setTimeout(function () {\n                        self.sendPartsProducts(parts, partsCount);\n                    }, 500);\n                }\n            });\n\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\n        },\n\n        // ---------------------------------------\n\n        setHideProductsPresentedInOtherListings: function (hideProductsOthersListings) {\n            this.hideProductsOthersListings = hideProductsOthersListings;\n        }\n\n        // ---------------------------------------\n    });\n});","Ess_M2ePro/js/Amazon/Listing/Product/Repricing.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'Magento_Ui/js/modal/alert',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Action'\r\n], function (MessageObj, alert) {\r\n\r\n    window.AmazonListingProductRepricing = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openManagement: function () {\r\n            window.open(M2ePro.url.get('amazon_listing_product_repricing/openManagement'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addToRepricing: function (productsIds) {\r\n            var self = this;\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_repricing/validateProductsBeforeAdd'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert({\r\n                            content: transport.responseText\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if(response.products_ids.length === 0) {\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n                        return;\r\n                    }\r\n\r\n                    if (response.products_ids.length === productsIds.split(',').length) {\r\n                        self.addToRepricingConfirm(productsIds);\r\n                        return;\r\n                    }\r\n\r\n                    var popupEl = $('regular_price_popup');\r\n\r\n                    if (popupEl) {\r\n                        popupEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: response});\r\n\r\n                    self.regularPricePopup = jQuery('#regular_price_popup');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.regularPricePopup.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action primary',\r\n                            click: function () {\r\n                                self.addToRepricingConfirm(productsIds);\r\n                            }\r\n                        }]\r\n                    }, self.regularPricePopup);\r\n\r\n                    self.regularPricePopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        addToRepricingConfirm: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openAddProducts'), {'products_ids': productsIds});\r\n        },\r\n\r\n        showDetails: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openShowDetails'), {'products_ids': productsIds});\r\n        },\r\n\r\n        editRepricing: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openEditProducts'), {'products_ids': productsIds});\r\n        },\r\n\r\n        removeFromRepricing: function (productsIds) {\r\n            return this.postForm(M2ePro.url.get('amazon_listing_product_repricing/openRemoveProducts'), {'products_ids': productsIds});\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Search.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductSearch = Class.create(Action, {\r\n\r\n        MATCHING_TYPE_EQUAL: 1,\r\n        MATCHING_TYPE_VIRTUAL_AMAZON: 2,\r\n        MATCHING_TYPE_VIRTUAL_MAGENTO: 3,\r\n\r\n        searchData: {},\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n            self.searchBlock = $('productSearch_pop_up_content').outerHTML;\r\n            $('productSearch_pop_up_content').remove();\r\n        },\r\n\r\n        initSearchEvents: function () {\r\n            var self = this;\r\n\r\n            $('productSearch_submit_button').observe('click', function (event) {\r\n                self.searchGeneralIdManual(self.params.productId);\r\n            });\r\n\r\n            $('productSearch_reset_button').observe('click', function (event) {\r\n                $('query').value = '';\r\n                $('productSearch_grid').innerHTML = '';\r\n            });\r\n\r\n            $('query').observe('keypress', function (event) {\r\n                event.keyCode == Event.KEY_RETURN && self.searchGeneralIdManual(self.params.productId);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            this.initValidators();\r\n            return this;\r\n        },\r\n\r\n        initValidators: function () {\r\n            var self = this;\r\n\r\n            jQuery.validator.addMethod('M2ePro-amazon-attribute-unique-value', function (value, el) {\r\n\r\n                var existedValues = [],\r\n                    isValid = true,\r\n                    form = el.parent('form');\r\n\r\n                form.select('select').each(function (index, el) {\r\n                    if (el.value != '') {\r\n                        if (existedValues.indexOf(el.value) === -1) {\r\n                            existedValues.push(el.value);\r\n                        } else {\r\n                            isValid = false;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return isValid;\r\n\r\n            }, M2ePro.translator.translate('variation_manage_matched_attributes_error_duplicate'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        params: {autoMapErrorFlag: false},\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (mode, title, productId) {\r\n            MessageObj.clear();\r\n\r\n            var self = this;\r\n\r\n            this.gridHandler.unselectAll();\r\n\r\n            this.params = {\r\n                mode: mode,\r\n                title: title,\r\n                productId: productId,\r\n                autoMapErrorFlag: false\r\n            };\r\n\r\n            if (mode == 0) {\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/getSearchAsinMenu'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: productId\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        var containerEl = $('productSearchMenu_pop_up_content');\r\n\r\n                        if (containerEl) {\r\n                            containerEl.remove();\r\n                        }\r\n\r\n                        $('html-body').insert({bottom: transport.responseText});\r\n\r\n                        self.searchMenuPopup = jQuery('#productSearchMenu_pop_up_content');\r\n\r\n                        modal({\r\n                            title: title,\r\n                            modalClass: 'width-50',\r\n                            type: 'popup',\r\n                            buttons: [{\r\n                                text: M2ePro.translator.translate('Close'),\r\n                                class: 'action primary ',\r\n                                click: function () {\r\n                                    self.searchMenuPopup.modal('closeModal')\r\n                                }\r\n                            }]\r\n                        }, self.searchMenuPopup);\r\n\r\n                        self.searchMenuPopup.modal('openModal');\r\n                    }\r\n                });\r\n            } else {\r\n                if ($('productSearch_pop_up_content')) {\r\n                    $('productSearch_pop_up_content').remove();\r\n                }\r\n\r\n                $('html-body').insert({bottom: self.searchBlock});\r\n\r\n                self.popup = jQuery('#productSearch_pop_up_content');\r\n\r\n                modal({\r\n                    title: title,\r\n                    type: 'slide',\r\n                    buttons: [{\r\n                        text: M2ePro.translator.translate('Cancel'),\r\n                        class: 'action default',\r\n                        click: function () {\r\n                            self.popup.modal('closeModal');\r\n                        }\r\n                    }, {\r\n                        text: M2ePro.translator.translate('Clear Search Results'),\r\n                        class: 'action primary',\r\n                        click: function () {\r\n                            ListingGridHandlerObj.productSearchHandler.clearSearchResultsAndOpenSearchMenu();\r\n                        }\r\n                    }]\r\n                }, this.popup);\r\n\r\n                self.popup.modal('openModal');\r\n\r\n                $('productSearch_pop_up_content').show();\r\n                $('productSearch_form').hide();\r\n                $('suggested_asin_grid_help_block').show();\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/suggestedAsinGrid'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: productId\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        $('productSearch_grid').update(transport.responseText);\r\n                    }\r\n                });\r\n            }\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearSearchResultsAndOpenSearchMenu: function () {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.popup.modal('closeModal');\r\n                        self.unmapFromGeneralId(self.params.productId, function () {\r\n                            self.openPopUp(0, self.params.title, self.params.productId);\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        clearSearchResultsAndManualSearch: function () {\r\n            var self = this;\r\n\r\n            self.popup.modal('closeModal');\r\n            self.unmapFromGeneralId(self.params.productId, function () {\r\n                self.showSearchManualPrompt(self.params.title, self.params.productId);\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showSearchManualPrompt: function (title, listingProductId) {\r\n            var self = this,\r\n                title = title || self.params.title;\r\n\r\n            if (self.searchMenuPopup) {\r\n                self.searchMenuPopup.modal('closeModal');\r\n            }\r\n\r\n            if ($('productSearch_pop_up_content')) {\r\n                $('productSearch_pop_up_content').remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: self.searchBlock});\r\n\r\n            self.popup = jQuery('#productSearch_pop_up_content');\r\n\r\n            var buttons = [];\r\n            if (!listingProductId) {\r\n                buttons.push({\r\n                    text: M2ePro.translator.translate('Back'),\r\n                    class: 'back',\r\n                    click: function() {\r\n                        self.popup.modal('closeModal');\r\n                        self.openPopUp(0, self.params.title, self.params.productId);\r\n                    }\r\n                });\r\n            }\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                buttons: buttons\r\n            }, self.popup);\r\n\r\n            self.popup.modal('openModal');\r\n\r\n            if (listingProductId) {\r\n                self.params = {\r\n                    mode: 0,\r\n                    title: title,\r\n                    productId: listingProductId,\r\n                    autoMapErrorFlag: false\r\n                };\r\n            }\r\n\r\n            self.initSearchEvents();\r\n            // search manual\r\n            $('productSearch_form').show();\r\n            $('productSearch_error_block').hide();\r\n            $('suggested_asin_grid_help_block').hide();\r\n            $('query').value = '';\r\n\r\n            setTimeout(function () {\r\n                $('query').focus();\r\n            }, 500);\r\n        },\r\n\r\n        showSearchGeneralIdAutoPrompt: function () {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        if (self.searchMenuPopup) {\r\n                            self.searchMenuPopup.modal('closeModal');\r\n                        }\r\n                        self.searchGeneralIdAuto(self.params.productId);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        showUnmapFromGeneralIdPrompt: function (productId) {\r\n            MessageObj.clear();\r\n\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.unmapFromGeneralId(productId);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        addNewGeneralId: function (listingProductIds) {\r\n            var self = this;\r\n\r\n            if (!M2ePro.customData.isNewAsinAvailable) {\r\n                self.alert(M2ePro.translator.translate('new_asin_not_available').replace('%code%', M2ePro.customData.marketplace.code));\r\n                return;\r\n            }\r\n\r\n            listingProductIds = listingProductIds || self.params.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/mapToNewAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: listingProductIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (typeof self.searchMenuPopup != 'undefined') {\r\n                        self.searchMenuPopup.modal('closeModal')\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n                    self.flagSuccess = true;\r\n\r\n                    if (response.products_ids.length > 0) {\r\n                        ListingGridHandlerObj.templateDescriptionHandler.openPopUp(\r\n                            0, M2ePro.translator.translate('templateDescriptionPopupTitle'),\r\n                            response.products_ids, response.html, 1);\r\n                    } else {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        searchGeneralIdManual: function (productId) {\r\n            var self = this;\r\n            var query = $('query').value;\r\n\r\n            MessageObj.clear();\r\n\r\n            if (query == '') {\r\n                $('query').focus();\r\n                self.alert(M2ePro.translator.translate('enter_productSearch_query'));\r\n                return;\r\n            }\r\n\r\n            $('productSearch_error_block').hide();\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/searchAsinManual'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    query: query,\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    transport = transport.responseText.evalJSON();\r\n\r\n                    if (transport.result == 'success') {\r\n                        $('productSearch_grid').update(transport.html);\r\n                    } else {\r\n                        $('productSearch_error_message').update(transport.text);\r\n                        $('productSearch_error_block').show();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        searchGeneralIdAuto: function (productIds) {\r\n            MessageObj.clear();\r\n            var self = this;\r\n\r\n            var selectedProductsString = productIds.toString();\r\n            var selectedProductsArray = selectedProductsString.split(\",\");\r\n\r\n            if (selectedProductsString == '' || selectedProductsArray.length == 0) {\r\n                return;\r\n            }\r\n\r\n            var maxProductsInPart = 10;\r\n\r\n            var result = new Array();\r\n            for (var i = 0; i < selectedProductsArray.length; i++) {\r\n                if (result.length == 0 || result[result.length - 1].length == maxProductsInPart) {\r\n                    result[result.length] = new Array();\r\n                }\r\n                result[result.length - 1][result[result.length - 1].length] = selectedProductsArray[i];\r\n            }\r\n\r\n            var selectedProductsParts = result;\r\n\r\n            ListingGridHandlerObj.actionHandler.progressBarObj.reset();\r\n            ListingGridHandlerObj.actionHandler.progressBarObj.show(M2ePro.translator.translate('automap_asin_progress_title'));\r\n            ListingGridHandlerObj.actionHandler.gridWrapperObj.lock();\r\n            $$('.loading-mask').invoke('setStyle', {visibility: 'hidden'});\r\n\r\n            self.params.autoMapErrorFlag = false;\r\n\r\n            self.sendPartsOfProducts(selectedProductsParts, selectedProductsParts.length, selectedProductsString);\r\n        },\r\n\r\n        sendPartsOfProducts: function (parts, totalPartsCount, selectedProductsString) {\r\n            var self = this;\r\n\r\n            if (parts.length == 0) {\r\n\r\n                ListingGridHandlerObj.actionHandler.progressBarObj.setStatus(M2ePro.translator.translate('task_completed_message'));\r\n\r\n                ListingGridHandlerObj.actionHandler.gridWrapperObj.unlock();\r\n                $$('.loading-mask').invoke('setStyle', {visibility: 'visible'});\r\n\r\n                self.gridHandler.unselectAllAndReload();\r\n\r\n                if (self.params.autoMapErrorFlag == true) {\r\n                    MessageObj.addErrorMessage(M2ePro.translator.translate('automap_error_message'));\r\n                }\r\n\r\n                setTimeout(function () {\r\n                    ListingGridHandlerObj.actionHandler.progressBarObj.hide();\r\n                    ListingGridHandlerObj.actionHandler.progressBarObj.reset();\r\n                }, 2000);\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/getProductsSearchStatus'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        products_ids: selectedProductsString\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        if (!transport.responseText.isJSON()) {\r\n                            self.alert(transport.responseText);\r\n                            return;\r\n                        }\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if (response.messages) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            var part = parts.splice(0, 1);\r\n            part = part[0];\r\n            var partString = implode(',', part);\r\n\r\n            var partExecuteString = part.length;\r\n            partExecuteString += '';\r\n\r\n            ListingGridHandlerObj.actionHandler.progressBarObj.setStatus(str_replace('%product_title%', partExecuteString, M2ePro.translator.translate('automap_asin_search_products')));\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/searchAsinAuto'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: partString\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        self.params.autoMapErrorFlag = true;\r\n                    }\r\n\r\n                    var percents = (100 / totalPartsCount) * (totalPartsCount - parts.length);\r\n\r\n                    if (percents <= 0) {\r\n                        ListingGridHandlerObj.actionHandler.progressBarObj.setPercents(0, 0);\r\n                    } else if (percents >= 100) {\r\n                        ListingGridHandlerObj.actionHandler.progressBarObj.setPercents(100, 0);\r\n                    } else {\r\n                        ListingGridHandlerObj.actionHandler.progressBarObj.setPercents(percents, 1);\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        self.sendPartsOfProducts(parts, totalPartsCount, selectedProductsString);\r\n                    }, 500);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapToGeneralId: function (productId, generalId, optionsData) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        if (optionsData === undefined) {\r\n                            optionsData = '';\r\n                        }\r\n\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing/mapToAsin'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                product_id: productId,\r\n                                general_id: generalId,\r\n                                options_data: decodeURIComponent(optionsData),\r\n                                search_type: $('amazon_asin_search_type').value,\r\n                                search_value: $('amazon_asin_search_value').value\r\n                            },\r\n                            onSuccess: function (transport) {\r\n                                if (transport.responseText.isJSON()) {\r\n                                    var response = transport.responseText.evalJSON();\r\n\r\n                                    if (response['vocabulary_attributes']) {\r\n                                        self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                                    }\r\n\r\n                                    if (response['vocabulary_attribute_options']) {\r\n                                        self.openVocabularyOptionsPopUp(response['vocabulary_attribute_options']);\r\n                                    }\r\n\r\n                                    self.gridHandler.unselectAllAndReload();\r\n                                    return;\r\n                                }\r\n\r\n                                if (transport.responseText == 0) {\r\n                                    self.gridHandler.unselectAllAndReload();\r\n                                } else {\r\n                                    self.alert(transport.responseText);\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        self.popup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openVocabularyAttributesPopUp: function (attributes) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getAttributesPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_attributes_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyAttributesPupup = jQuery('#vocabulary_attributes_pupup');\r\n\r\n                    modal({\r\n                        title: 'Remember Attributes Accordance',\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyAttributesPupup);\r\n\r\n                    self.vocabularyAttributesPupup.modal('openModal');\r\n\r\n                    $('vocabulary_attributes_data').value = Object.toJSON(attributes);\r\n\r\n                    var attributesHtml = '';\r\n                    $H(attributes).each(function (element) {\r\n                        attributesHtml += '<li>' + element.key + ' > ' + element.value + '</li>';\r\n                    });\r\n\r\n                    attributesHtml = '<ul style=\"list-style-position: inside;\">' + attributesHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%attributes%', attributesHtml, $('vocabulary_attributes_pupup').innerHTML);\r\n\r\n                    $('vocabulary_attributes_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addAttributesToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_attributes_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyAttributesPupup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addAttributes'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    attributes: $('vocabulary_attributes_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyAttributesPupup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openVocabularyOptionsPopUp: function (options) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getOptionsPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_options_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyOptionsPopup = jQuery('#vocabulary_options_pupup');\r\n\r\n                    modal({\r\n                        title: 'Vocabulary',\r\n                        type: 'popup',\r\n                        closed: function() {\r\n                            self.reloadVariationsGrid();\r\n                        },\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyOptionsPopup);\r\n\r\n                    self.vocabularyOptionsPopup.modal('openModal');\r\n\r\n                    $('vocabulary_options_data').value = Object.toJSON(options);\r\n\r\n                    var optionsHtml = '';\r\n                    $H(options).each(function (element) {\r\n\r\n                        var valuesHtml = '';\r\n                        $H(element.value).each(function (value) {\r\n                            valuesHtml += value.key + ' > ' + value.value;\r\n                        });\r\n\r\n                        optionsHtml += '<li>' + element.key + ': ' + valuesHtml + '</li>';\r\n                    });\r\n\r\n                    optionsHtml = '<ul style=\"list-style-position: inside\">' + optionsHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%options%', optionsHtml, $('vocabulary_options_pupup').innerHTML);\r\n\r\n                    $('vocabulary_options_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addOptionsToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_options_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyOptionsPopup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addOptions'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    options_data: $('vocabulary_options_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyOptionsPopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        unmapFromGeneralId: function (productIds, afterDoneFunction) {\r\n            var self = this;\r\n\r\n            this.gridHandler.unselectAll();\r\n\r\n            self.flagSuccess = false;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/unmapFromAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n                    self.flagSuccess = true;\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n                },\r\n                onComplete: function () {\r\n                    if (self.flagSuccess == true && afterDoneFunction != undefined) {\r\n                        afterDoneFunction();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        specificsChange: function (select) {\r\n            var self = this;\r\n\r\n            var idParts = explode('_', select.id);\r\n            var id = idParts[2];\r\n            var specifics = [];\r\n            var selectedAsin = '';\r\n\r\n            $(select.id) && self.hideEmptyOption($(select.id));\r\n\r\n            self.validateSpecifics(id);\r\n\r\n            var asins = JSON.parse(decodeHtmlentities($('asins_' + id).innerHTML));\r\n\r\n            $('parent_asin_text_' + id).hide();\r\n            $('map_link_error_icon_' + id).hide();\r\n\r\n            $$('.specifics_' + id).each(function (el) {\r\n                var specificName = explode('_', el.id);\r\n                specificName = specificName[1];\r\n\r\n                specifics[specificName] = el.value;\r\n            });\r\n\r\n            for (var spec in asins) {\r\n                var productSpecifics = asins[spec].specifics;\r\n\r\n                var found = true;\r\n                for (var sName in productSpecifics) {\r\n\r\n                    if (productSpecifics[sName] != specifics[sName]) {\r\n                        found = false;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (found) {\r\n                    selectedAsin = spec;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            var asinLink = $('asin_link_' + id);\r\n\r\n            if (selectedAsin === '') {\r\n                $('map_link_error_icon_' + id).show();\r\n                asinLink.innerHTML = $('parent_asin_' + id).innerHTML;\r\n                asinLink.href = asinLink.href.slice(0, asinLink.href.lastIndexOf(\"/\")) + '/' + $('parent_asin_' + id).innerHTML;\r\n                $('parent_asin_text_' + id).show();\r\n                return $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n            }\r\n\r\n            asinLink.innerHTML = selectedAsin;\r\n            asinLink.href = asinLink.href.slice(0, asinLink.href.lastIndexOf(\"/\")) + '/' + selectedAsin;\r\n\r\n            var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n            mapLinkTemplate = mapLinkTemplate.replace('%general_id%', selectedAsin);\r\n\r\n            asins = addslashes(encodeURIComponent(JSON.stringify(asins)));\r\n\r\n            mapLinkTemplate = mapLinkTemplate.replace('%options_data%', asins);\r\n            $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n        },\r\n\r\n        validateSpecifics: function (id, variations, i) {\r\n            var variation = $H(variations || decodeHtmlentities($('channel_variations_tree_' + id).innerHTML).evalJSON()),\r\n                attributes = $$('.specifics_name_' + id),\r\n                options = $$('.specifics_' + id),\r\n                index = i || 0;\r\n\r\n            if (index === 0) {\r\n                options.each(function (el) {\r\n                    el.disable();\r\n                });\r\n            }\r\n\r\n            if (!attributes[index] || !options[index]) {\r\n                return;\r\n            }\r\n\r\n            var attr = variation.keys()[0];\r\n\r\n            var oldValue = decodeHtmlentities(options[index].value);\r\n            options[index].update();\r\n            options[index].enable();\r\n            options[index].appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            $H(variation.get(attr)).each(function (option) {\r\n                options[index].appendChild(new Element('option', {value: option[0]})).insert(option[0]);\r\n\r\n                if (option[0] == oldValue) {\r\n                    options[index].value = oldValue;\r\n                }\r\n            });\r\n\r\n            if (oldValue) {\r\n                index++;\r\n                this.validateSpecifics(id, variation.get(attr)[oldValue], index);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        attributesChange: function (select) {\r\n            var self = this;\r\n\r\n            var idParts = explode('_', select.id);\r\n            var id = idParts[4];\r\n            var optionsData = {\r\n                matched_attributes: {},\r\n                variations: null\r\n            };\r\n\r\n            $(select.id) && self.hideEmptyOption($(select.id));\r\n\r\n            $('map_link_error_icon_' + id).hide();\r\n\r\n            var existedValues = [];\r\n            $$('.amazon_product_attribute_' + id).each(function (el) {\r\n                var attributeNumber = explode('_', el.id);\r\n                attributeNumber = attributeNumber[3];\r\n\r\n                if (el.value != '' && existedValues.indexOf(el.value) === -1) {\r\n                    var magentoAttribute = $('magento_product_attribute_' + attributeNumber + '_' + id);\r\n                    optionsData.matched_attributes[magentoAttribute.value] = el.value;\r\n                    existedValues.push(el.value);\r\n                } else {\r\n                    optionsData = '';\r\n                    throw $break;\r\n                }\r\n            });\r\n\r\n            if (optionsData === '') {\r\n                $('map_link_error_icon_' + id).show();\r\n                return $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n            }\r\n\r\n            optionsData.variations = JSON.parse(decodeHtmlentities($('variations_' + id).innerHTML));\r\n            optionsData = addslashes(encodeURIComponent(JSON.stringify(optionsData)));\r\n\r\n            var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n            mapLinkTemplate = mapLinkTemplate.replace('%options_data%', optionsData);\r\n            $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showAsinCategories: function (link, rowId, asin, productId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_search/getCategoriesByAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    asin: asin,\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    link.hide();\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    var categoriesRow = $('asin_categories_' + rowId);\r\n\r\n                    if (response.data == '') {\r\n                        $('asin_categories_not_found_' + rowId).show();\r\n                    } else {\r\n                        var i = 3;\r\n                        response.data.each(function (item) {\r\n                            var str = item.title;\r\n                            if (item.path) {\r\n                                str = item.path + ' > ' + str;\r\n                            }\r\n\r\n                            str = str + ' (' + item.id + ')';\r\n\r\n                            var row = new Element('p');\r\n                            row.setStyle({\r\n                                'color': 'grey'\r\n                            });\r\n\r\n                            categoriesRow.appendChild(row).insert(str);\r\n\r\n                            i--;\r\n                            if (i <= 0) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualView: function (id) {\r\n            if (this.searchData[id].matchingType === this.MATCHING_TYPE_VIRTUAL_AMAZON) {\r\n                this.renderMatchedAttributesVirtualAmazonView(id);\r\n            }\r\n\r\n            if (this.searchData[id].matchingType === this.MATCHING_TYPE_VIRTUAL_MAGENTO) {\r\n                this.renderMatchedAttributesVirtualMagentoView(id);\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualAmazonView: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id),\r\n                tHeader = form.down('.matching-attributes-table-header'),\r\n                searchData = self.searchData[id];\r\n\r\n            form.select('.matching-attributes-table-attribute-row').each(function (el) {\r\n                el.remove();\r\n            });\r\n            searchData.selectedDestinationAttributes = [];\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(searchData.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('div', {\r\n                        style: 'display: table-row',\r\n                        class: 'matching-attributes-table-attribute-row'\r\n                    }),\r\n                    tdLabel = new Element('div', {\r\n                        class: 'label',\r\n                        style: 'display: table-cell; padding-bottom: 5px;'\r\n                    }),\r\n                    spanMagentoAttr = new Element('span', {\r\n                        class: 'magento-attribute-name'\r\n                    }),\r\n                    inputVirtualAttribute = new Element('input', {\r\n                        style: 'display: none',\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        disabled: 'disabled',\r\n                        class: 'virtual-amazon-attribute-name-value',\r\n                        name: 'virtual_amazon_attributes_' + i\r\n                    }),\r\n                    selectVirtualAttributeOption = new Element('select', {\r\n                        style: 'margin-top: 5px; display: none; width: 200px; font-size: 10px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0;',\r\n                        disabled: 'disabled',\r\n                        class: 'admin__control-select required-entry virtual-amazon-option',\r\n                        name: 'virtual_amazon_option_' + i\r\n                    }),\r\n                    selectVirtualAttributeOptionGroup = new Element('optgroup', {\r\n                        label: attribute.key\r\n                    }),\r\n                    spanVirtualAttributeAndOption = new Element('span', {\r\n                        style: 'display: none; line-height: 29px;',\r\n                        class: 'virtual-amazon-attribute-and-option'\r\n                    }),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('div', {\r\n                        class: 'value',\r\n                        style: 'display: table-cell; padding-bottom: 5px; padding-left: 10px;'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        class: 'magento-attribute-name-value',\r\n                        name: 'magento_attributes_' + i\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'amazon_attributes_' + i,\r\n                        style: 'width: 250px; font-size: 11px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0;'\r\n                    }),\r\n                    spanVirtualAttribute = new Element('span', {\r\n                        style: 'display: none; line-height: 33px;',\r\n                        class: 'virtual-amazon-attribute-name'\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('product_search_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_right'));\r\n\r\n                var attributeStr = attribute.key;\r\n                if (attributeStr.length > 16) {\r\n                    attributeStr = attribute.key.substr(0, 15) + '...';\r\n                    spanVirtualAttributeAndOption.title = attribute.key;\r\n                    spanVirtualAttribute.title = attribute.key;\r\n                }\r\n\r\n                if (attribute.key.length < 31) {\r\n                    spanMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    spanMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    spanMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                spanVirtualAttribute.update(attributeStr + ' (<span>&ndash;</span>)');\r\n                spanVirtualAttributeAndOption.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                spanVirtualAttributeAndOption.down('a').title = '';\r\n\r\n                spanVirtualAttributeAndOption.down('a').observe('click', function (event) {\r\n                    spanVirtualAttributeAndOption.hide();\r\n                    selectVirtualAttributeOption.show();\r\n                    selectVirtualAttributeOption.value = '';\r\n                    spanVirtualAttribute.down('span').update('&ndash;');\r\n                    spanVirtualAttribute.down('span').title = '';\r\n\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                searchData.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        searchData.productAttributes.indexOf(selectAmazonAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.text.duplicate_amazon_attribute_error);\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    var prevValueIndex = searchData.selectedDestinationAttributes.indexOf(selectAmazonAttr.prevValue);\r\n                    if (prevValueIndex > -1) {\r\n                        searchData.selectedDestinationAttributes.splice(prevValueIndex, 1);\r\n                    }\r\n\r\n                    if (selectAmazonAttr.value != '') {\r\n                        searchData.selectedDestinationAttributes.push(selectAmazonAttr.value);\r\n                    }\r\n                    selectAmazonAttr.prevValue = selectAmazonAttr.value;\r\n\r\n                    form.select('select').each(function (el) {\r\n                        result = Validation.get('M2ePro-amazon-attribute-unique-value').test($F(el), el) ? result : false;\r\n                    });\r\n\r\n                    if (result && searchData.selectedDestinationAttributes.length == searchData.destinationAttributes.length) {\r\n                        self.showVirtualAmazonAttributes(id);\r\n                    } else {\r\n                        self.hideVirtualAmazonAttributes(id);\r\n                    }\r\n                });\r\n\r\n                selectVirtualAttributeOption.observe('change', function (event) {\r\n                    var value = selectVirtualAttributeOption.value;\r\n\r\n                    spanVirtualAttributeAndOption.show();\r\n                    selectVirtualAttributeOption.hide();\r\n\r\n                    if (attributeStr.length + value.length < 28) {\r\n                        spanVirtualAttribute.down('span').update(value);\r\n                        spanVirtualAttribute.down('span').title = '';\r\n                        spanVirtualAttributeAndOption.down('a').update(value);\r\n                    } else {\r\n                        spanVirtualAttribute.down('span').update(value.substr(0, 22 - attributeStr.length) + '...');\r\n                        spanVirtualAttribute.down('span').title = value;\r\n                        spanVirtualAttributeAndOption.down('a').update(value.substr(0, 22 - attributeStr.length) + '...');\r\n                    }\r\n\r\n                    spanVirtualAttributeAndOption.down('a').title = M2ePro.text.change_option + ' \"' + value + '\"';\r\n\r\n                    var result = true;\r\n                    form.select('select').each(function (el) {\r\n                        if (Validation.isVisible(el)) {\r\n                            el.classNames().each(function (className) {\r\n                                var v = Validation.get(className),\r\n                                    validationResult = v.test($F(el), el);\r\n\r\n                                result = validationResult ? result : false;\r\n\r\n                                if (!validationResult) {\r\n                                    throw $break;\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    if (result) {\r\n                        $('map_link_error_icon_' + id).hide();\r\n\r\n                        var data = {};\r\n                        data.virtual_matched_attributes = form.serialize(true);\r\n                        data.variations = searchData.amazonVariation;\r\n                        data = addslashes(encodeURIComponent(JSON.stringify(data)));\r\n\r\n                        var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n                        mapLinkTemplate = mapLinkTemplate.replace('%options_data%', data);\r\n                        $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n                    } else {\r\n                        $('map_link_error_icon_' + id).show();\r\n                        $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                    }\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: option});\r\n\r\n                searchData.magentoVariationSet[attribute.key].each(function (optionValue) {\r\n                    var option = new Element('option', {\r\n                        value: optionValue\r\n                    });\r\n                    option.update(optionValue);\r\n                    selectVirtualAttributeOptionGroup.insert({bottom: option});\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: selectVirtualAttributeOptionGroup});\r\n\r\n                tdLabel.insert({bottom: spanMagentoAttr});\r\n                tdLabel.insert({bottom: inputVirtualAttribute});\r\n                tdLabel.insert({bottom: selectVirtualAttributeOption});\r\n                tdLabel.insert({bottom: spanVirtualAttributeAndOption});\r\n                tdLabel.insert({bottom: spanLeftHelpIcon});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n                tdValue.insert({bottom: spanVirtualAttribute});\r\n                tdValue.insert({bottom: spanRightHelpIcon});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tHeader.insert({after: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            // form.select('.tool-tip-image').each(function (element) {\r\n            //     element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            // });\r\n            //\r\n            // form.select('.tool-tip-message').each(function (element) {\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n            //     element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            // });\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n        },\r\n\r\n        showVirtualAmazonAttributes: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id);\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.disable().hide();\r\n\r\n                var tr = el.up('.matching-attributes-table-attribute-row');\r\n                tr.down('.magento-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-attribute-name').show();\r\n                tr.down('.magento-attribute-name').hide();\r\n                tr.down('.virtual-amazon-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-option').enable().show();\r\n                tr.down('.right-help-icon').show();\r\n                tr.down('.left-help-icon').show();\r\n            });\r\n        },\r\n\r\n        hideVirtualAmazonAttributes: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id);\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.enable().show();\r\n\r\n                var tr = el.up('.matching-attributes-table-attribute-row');\r\n                tr.down('.magento-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-attribute-name').hide();\r\n                tr.down('.magento-attribute-name').show();\r\n                tr.down('.virtual-amazon-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-option').disable().hide();\r\n                tr.down('.virtual-amazon-attribute-and-option').hide();\r\n                tr.down('.right-help-icon').hide();\r\n                tr.down('.left-help-icon').hide();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualMagentoView: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id),\r\n                tHeader = form.down('.matching-attributes-table-header'),\r\n                searchData = self.searchData[id];\r\n\r\n            form.select('.matching-attributes-table-attribute-row').each(function (el) {\r\n                el.remove();\r\n            });\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(searchData.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('div', {\r\n                        style: 'display: table-row',\r\n                        class: 'matching-attributes-table-attribute-row'\r\n                    }),\r\n                    tdLabel = new Element('div', {\r\n                        class: 'label',\r\n                        style: 'display: table-cell; padding-bottom: 5px;'\r\n                    }),\r\n                    spanMagentoAttr = new Element('span'),\r\n                    tdValue = new Element('div', {\r\n                        class: 'value',\r\n                        style: 'display: table-cell; padding-bottom: 5px; padding-left: 10px;'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        name: 'magento_attributes_' + i\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'amazon_attributes_' + i,\r\n                        style: 'width: 250px; font-size: 11px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0;'\r\n                    });\r\n\r\n                if (attribute.key.length < 31) {\r\n                    spanMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    spanMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    spanMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                searchData.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        searchData.destinationAttributes.indexOf(inputMagentoAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.text.duplicate_magento_attribute_error);\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    form.select('select.amazon-attribute-name').each(function (el) {\r\n                        el.classNames().each(function (className) {\r\n                            var v = Validation.get(className),\r\n                                validationResult = v.test($F(el), el);\r\n\r\n                            result = validationResult ? result : false;\r\n\r\n                            if (!validationResult) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (result) {\r\n                        self.showVirtualMagentoAttributes(id, i);\r\n                    } else {\r\n                        self.hideVirtualMagentoAttributes(id);\r\n                    }\r\n                });\r\n\r\n                tdLabel.insert({bottom: spanMagentoAttr});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tHeader.insert({after: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n        },\r\n\r\n        showVirtualMagentoAttributes: function (id, lastAttributeIndex) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id),\r\n                tBody = form.down('.matching-attributes-table'),\r\n                searchData = self.searchData[id];\r\n\r\n            form.select('div.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n\r\n            var selectedValues = [];\r\n            form.select('select.amazon-attribute-name').each(function (el) {\r\n                selectedValues.push(el.value);\r\n            });\r\n\r\n            var i = lastAttributeIndex;\r\n            searchData.destinationAttributes.each(function (attribute) {\r\n                if (selectedValues.indexOf(attribute) !== -1) {\r\n                    return true;\r\n                }\r\n                var tr = new Element('div', {\r\n                        style: 'display: table-row',\r\n                        class: 'matching-attributes-table-attribute-row virtual-attribute'\r\n                    }),\r\n                    tdLabel = new Element('div', {\r\n                        class: 'label',\r\n                        style: 'display: table-cell; padding-bottom: 5px;'\r\n                    }),\r\n                    spanMagentoAttr = new Element('div', {\r\n                        style: 'float: left; padding-top: 9px;'\r\n                    }),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('div', {\r\n                        class: 'value',\r\n                        style: 'display: table-cell; padding-bottom: 5px; padding-left: 10px;'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute,\r\n                        type: 'hidden',\r\n                        name: 'virtual_magento_attributes_' + i\r\n                    }),\r\n                    spanVirtualAttribute = new Element('div', {\r\n                        style: 'display: none; float: left; padding-top: 9px'\r\n                    }),\r\n                    selectVirtualAttrOption = new Element('select', {\r\n                        style: 'width: 200px; font-size: 11px; background-position: calc(100% - 12px) -38px, 100%, calc(100% - 3.2rem) 0; float: left; margin-top: 3px',\r\n                        class: 'admin__control-select required-entry virtual-magento-option',\r\n                        name: 'virtual_magento_option_' + i\r\n                    }),\r\n                    virtualAttrOptionGroup = new Element('optgroup', {\r\n                        label: attribute\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('product_search_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_right'));\r\n\r\n                var attributeStr = attribute;\r\n                if (attributeStr.length > 13) {\r\n                    attributeStr = attribute.substr(0, 12) + '...';\r\n                    spanMagentoAttr.title = attribute;\r\n                    spanVirtualAttribute.title = attribute;\r\n                }\r\n\r\n                spanMagentoAttr.update(attributeStr + ' (<span>&ndash;</span>)');\r\n                spanVirtualAttribute.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                spanVirtualAttribute.down('a').title = '';\r\n\r\n                spanVirtualAttribute.down('a').observe('click', function (event) {\r\n                    spanVirtualAttribute.hide();\r\n                    selectVirtualAttrOption.show();\r\n                    selectVirtualAttrOption.value = '';\r\n                    spanMagentoAttr.down('span').update('&ndash;');\r\n                    spanMagentoAttr.down('span').title = '';\r\n\r\n                    $('map_link_error_icon_' + id).show();\r\n                    $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectVirtualAttrOption.insert({bottom: option});\r\n\r\n                searchData.amazonVariation.set[attribute].each(function (optionValue) {\r\n                    var option = new Element('option', {\r\n                        value: optionValue\r\n                    });\r\n                    option.update(optionValue);\r\n                    virtualAttrOptionGroup.insert({bottom: option});\r\n                });\r\n                selectVirtualAttrOption.insert({bottom: virtualAttrOptionGroup});\r\n\r\n                selectVirtualAttrOption.observe('change', function (event) {\r\n                    var value = selectVirtualAttrOption.value;\r\n\r\n                    spanVirtualAttribute.show();\r\n                    selectVirtualAttrOption.hide();\r\n\r\n                    if (attributeStr.length + value.length < 28) {\r\n                        spanMagentoAttr.down('span').update(value);\r\n                        spanMagentoAttr.down('span').title = '';\r\n                        spanVirtualAttribute.down('a').update(value);\r\n                    } else {\r\n                        spanMagentoAttr.down('span').update(value.substr(0, 27 - attributeStr.length) + '...');\r\n                        spanMagentoAttr.down('span').title = value;\r\n                        spanVirtualAttribute.down('a').update(value.substr(0, 27 - attributeStr.length) + '...');\r\n                    }\r\n\r\n                    spanVirtualAttribute.down('a').title = M2ePro.text.change_option + ' \"' + value + '\"';\r\n\r\n                    var result = true;\r\n                    form.select('select').each(function (el) {\r\n                        el.classNames().each(function (className) {\r\n                            var v = Validation.get(className),\r\n                                validationResult = v.test($F(el), el);\r\n\r\n                            result = validationResult ? result : false;\r\n\r\n                            if (!validationResult) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (result) {\r\n                        $('map_link_error_icon_' + id).hide();\r\n\r\n                        var data = {};\r\n                        data.virtual_matched_attributes = form.serialize(true);\r\n                        data.variations = searchData.amazonVariation;\r\n                        data = addslashes(encodeURIComponent(JSON.stringify(data)));\r\n\r\n                        var mapLinkTemplate = $('template_map_link_' + id).innerHTML;\r\n                        mapLinkTemplate = mapLinkTemplate.replace('%options_data%', data);\r\n                        $('map_link_' + id).innerHTML = mapLinkTemplate;\r\n                    } else {\r\n                        $('map_link_error_icon_' + id).show();\r\n                        $('map_link_' + id).innerHTML = '<span style=\"color: #808080\">' + M2ePro.translator.translate('assign') + '</span>';\r\n                    }\r\n                });\r\n\r\n                tdLabel.insert({bottom: spanMagentoAttr});\r\n                tdLabel.insert({bottom: spanLeftHelpIcon});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: spanVirtualAttribute});\r\n                tdValue.insert({bottom: selectVirtualAttrOption});\r\n                tdValue.insert({bottom: spanRightHelpIcon});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            // tBody.select('.tool-tip-image').each(function (element) {\r\n            //     element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            // });\r\n            //\r\n            // tBody.select('.tool-tip-message').each(function (element) {\r\n            //     element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n            //     element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            // });\r\n        },\r\n\r\n        hideVirtualMagentoAttributes: function (id) {\r\n            var self = this,\r\n                form = $('matching_attributes_form_' + id);\r\n\r\n            form.select('div.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Variation.js":"define([\n    'Magento_Ui/js/modal/modal',\n    'M2ePro/Plugin/Messages',\n    'M2ePro/Common'\n], function (modal, MessageObj) {\n\n    window.AmazonListingProductVariation = Class.create();\n    AmazonListingProductVariation.prototype = Object.extend(new Common(), {\n\n        // ---------------------------------------\n\n        initialize: function (gridHandler) {\n            this.gridHandler = gridHandler;\n        },\n\n        setListingProductId: function (listingProductId) {\n            this.listingProductId = listingProductId;\n            return this;\n        },\n\n        setNeededVariationData: function (variationAttributes, variationsTree) {\n            this.variationAttributes = variationAttributes;\n            this.variationsTree = variationsTree;\n\n            return this;\n        },\n\n        //########################################\n\n        showSwitchToIndividualModePopUp: function (title) {\n            var self = this;\n\n            if (self.switchToIndividualModePopUp) {\n                self.switchToIndividualModePopUp.modal('openModal');\n                return;\n            }\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation/getSwitchToIndividualModePopUp'), {\n                method: 'post',\n                onSuccess: function (transport) {\n\n                    $('html-body').insert({bottom: transport.responseText});\n\n                    self.switchToIndividualModePopUp = jQuery('#switch_to_individual_popup');\n\n                    modal({\n                        title: M2ePro.translator.translate('switch_to_individual_mode_popup_title'),\n                        type: 'popup',\n                        modalClass: 'width-50',\n                        buttons: [{\n                            text: M2ePro.translator.translate('No'),\n                            class: 'action-secondary action-dismiss',\n                            click: function () {\n                                self.switchToIndividualModePopUp.modal('closeModal');\n                            }\n                        }, {\n                            text: M2ePro.translator.translate('Yes'),\n                            class: 'action-primary action-accept',\n                            click: function () {\n                                if ($('switch_to_individual_remember_checkbox').checked) {\n                                    new Ajax.Request(M2ePro.url.get('saveListingAdditionalData'), {\n                                        method: 'post',\n                                        parameters: {\n                                            param_name: 'hide_switch_to_individual_confirm',\n                                            param_value: 1\n                                        },\n                                        onSuccess: function (transport) {\n                                            self.gridHandler.unselectAllAndReload();\n                                        }\n                                    });\n                                }\n\n                                self.switchToIndividualModePopUp.modal('closeModal');\n                                self.showManagePopup(title);\n                            }\n                        }]\n                    }, self.switchToIndividualModePopUp);\n\n                    self.switchToIndividualModePopUp.modal('openModal');\n                }\n            });\n        },\n\n        showSwitchToParentModePopUp: function () {\n            var self = this;\n\n            if (self.switchToParentModePopUp) {\n                self.switchToParentModePopUp.modal('openModal');\n                return;\n            }\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation/getSwitchToParentModePopUp'), {\n                method: 'post',\n                onSuccess: function (transport) {\n\n                    $('html-body').insert({bottom: transport.responseText});\n\n                    self.switchToParentModePopUp = jQuery('#switch_to_parent_popup');\n\n                    modal({\n                        title: M2ePro.translator.translate('switch_to_parent_mode_popup_title'),\n                        type: 'popup',\n                        buttons: [{\n                            text: M2ePro.translator.translate('No'),\n                            class: 'action-secondary action-dismiss',\n                            click: function () {\n                                self.switchToParentModePopUp.modal('closeModal');\n                            }\n                        }, {\n                            text: M2ePro.translator.translate('Yes'),\n                            class: 'action-primary action-accept',\n                            click: function () {\n                                if ($('switch_to_parent_remember_checkbox').checked) {\n                                    new Ajax.Request(M2ePro.url.get('saveListingAdditionalData'), {\n                                        method: 'post',\n                                        parameters: {\n                                            param_name: 'hide_switch_to_parent_confirm',\n                                            param_value: 1\n                                        }\n                                    });\n                                }\n\n                                self.switchToParentModePopUp.modal('closeModal');\n                                self.resetListingProductVariation();\n                            }\n                        }]\n                    }, self.switchToParentModePopUp);\n\n                    self.switchToParentModePopUp.modal('openModal');\n                }\n            });\n        },\n\n        //########################################\n\n        showEditPopup: function (popupTitle) {\n            var self = this;\n\n            MessageObj.clear();\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/getEditPopup'), {\n                method: 'get',\n                parameters: {\n                    listing_product_id: this.listingProductId\n                },\n                onSuccess: (function (transport) {\n\n                    try {\n                        var response = transport.responseText.evalJSON();\n\n                        if (response.type == 'error') {\n                            MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\n                            return;\n                        }\n\n                        var popupContent = $('variation_individual_edit_popup');\n\n                        if (popupContent) {\n                            popupContent.remove();\n                        }\n\n                        $('html-body').insert({bottom: response.html});\n\n                        var variationForm = jQuery('#variation_edit_form').form();\n\n                        self.editPopup = jQuery('#variation_individual_edit_popup');\n\n                        modal({\n                            title: popupTitle,\n                            type: 'slide',\n                            buttons: [{\n                                text: M2ePro.translator.translate('Cancel'),\n                                click: function () {\n                                    self.editPopup.modal('closeModal');\n                                }\n                            },{\n                                text: M2ePro.translator.translate('Confirm'),\n                                class: 'action primary',\n                                click: function () {\n                                    if (!variationForm.valid()) {\n                                        return;\n                                    }\n\n                                    var variationData = {};\n                                    Form.getElements('variation_edit_form').each(function (selectElement) {\n                                        var attribute = selectElement.readAttribute('name');\n                                        selectElement.value && (variationData[attribute] = selectElement.value);\n                                    });\n\n                                    self.editAction(variationData);\n\n                                    self.editPopup.modal('closeModal');\n                                }\n                            }]\n                        }, self.editPopup);\n\n                        self.editPopup.modal('openModal');\n\n                    } catch (e) {\n                        this.editPopup.modal('closeModal');\n                        MessageObj.addErrorMessage('Internal Error.');\n                    }\n                }).bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        editPopupInit: function (currentVariation) {\n            var container = $('variation_edit_container');\n\n            var filters = {};\n\n            this.variationAttributes.each((function (attribute, i) {\n\n                var tr = container.appendChild(new Element('tr'));\n                tr.appendChild(new Element('td', {class: 'label', style: 'width: 25%; vertical-align: inherit;'}))\n                    .insert(attribute + ': <span class=\"required\">*</span>');\n\n                var select = tr\n                    .appendChild(new Element('td', {class: 'value'}))\n                    .appendChild(new Element('select', {\n                        name: 'variation_data[' + attribute + ']',\n                        class: 'required-entry admin__control-select',\n                        index: i\n                    }));\n\n                select\n                    .appendChild(new Element('option', {value: currentVariation[attribute]}))\n                    .insert(currentVariation[attribute]);\n\n                this.eachAttributeHandler(\n                    select,\n                    i,\n                    function () {\n                        return container.select('select[index]').filter(function (select) {\n                            return select.readAttribute('index') > i;\n                        });\n                    },\n                    filters\n                );\n\n            }).bind(this));\n\n            container.select('select[index]').each(function (select) {\n                select.simulate('change');\n            });\n        },\n\n        // ---------------------------------------\n\n        resetListingProductVariation: function () {\n            MessageObj.clear();\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/variationReset'), {\n                method: 'get',\n                parameters: {\n                    listing_product_id: this.listingProductId\n                },\n                onSuccess: (function (transport) {\n\n                    try {\n                        var response = transport.responseText.evalJSON();\n\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\n\n                        this.gridHandler.unselectAllAndReload();\n                    } catch (e) {\n                        this.editPopup.modal('closeModal');\n                        MessageObj.addErrorMessage('Internal Error.');\n                    }\n                }).bind(this)\n            });\n        },\n\n        //########################################\n\n        showManagePopup: function (popupTitle) {\n            var self = this;\n\n            MessageObj.clear();\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/getManagePopup'), {\n                method: 'get',\n                parameters: {\n                    listing_product_id: this.listingProductId\n                },\n                onSuccess: (function (transport) {\n\n                    try {\n                        var response = transport.responseText.evalJSON();\n\n                        if (response.type == 'error') {\n                            MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\n                            return;\n                        }\n\n                        var popupContent = $('variation_individual_manage_popup');\n\n                        if (popupContent) {\n                            popupContent.remove();\n                        }\n\n                        $('html-body').insert({bottom: response.html});\n\n                        var variationForm = jQuery('#variation_manage_form');\n                        self.initFormValidation(variationForm);\n\n                        self.managePopup = jQuery('#variation_individual_manage_popup');\n\n                        modal({\n                            title: popupTitle,\n                            type: 'slide',\n                            buttons: [{\n                                text: M2ePro.translator.translate('Cancel'),\n                                click: function () {\n                                    self.managePopup.modal('closeModal');\n                                }\n                            },{\n                                text: M2ePro.translator.translate('Confirm'),\n                                class: 'action primary',\n                                click: function () {\n                                    if (!variationForm.valid()) {\n                                        return;\n                                    }\n\n                                    var variationData = {};\n                                    Form.getElements('variation_manage_form').each(function (selectElement) {\n                                        var attribute = selectElement.readAttribute('name');\n                                        selectElement.value && (variationData[attribute] = selectElement.value);\n                                    });\n\n                                    self.manageAction(variationData);\n\n                                    self.managePopup.modal('closeModal');\n                                }\n                            }]\n                        }, self.managePopup);\n\n                        self.managePopup.modal('openModal');\n\n                        $('add_more_variation_button').observe('click', (function () {\n                            if (!variationForm.valid()) {\n                                return;\n                            }\n                            self.manageAddRow();\n                        }));\n\n                    } catch (e) {\n                        self.managePopup.modal('closeModal');\n                        MessageObj.addErrorMessage('Internal Error.');\n                    }\n                })\n            });\n        },\n\n        // ---------------------------------------\n\n        managePopupInit: function()\n        {\n            $('add_more_variation_button').simulate('click');\n        },\n\n        // ---------------------------------------\n\n        manageAddRow: function () {\n            var container = $('variation_manage_tbody');\n\n            var lastTr = container.select('tr').last();\n            var index = lastTr ? parseInt(lastTr.readAttribute('index')) + 1 : 1;\n\n            var tr = container.appendChild(new Element('tr', {index: index}));\n\n            var filters = {};\n\n            this.variationAttributes.each((function (attribute, i) {\n\n                var select = tr\n                    .appendChild(new Element('td', {style: 'vertical-align: top; padding: 5px 4px'}))\n                    .appendChild(new Element('select', {\n                        name: 'variation_data[' + index + '][' + attribute + ']',\n                        class: 'required-entry admin__control-select',\n                        style: 'width: 100%',\n                        index: i,\n                        disabled: true\n                    }));\n\n                this.eachAttributeHandler(\n                    select,\n                    i,\n                    function () {\n                        return tr.select('select[index]').filter(function (select) {\n                            return select.readAttribute('index') > i;\n                        });\n                    },\n                    filters\n                );\n\n            }).bind(this));\n\n            tr.appendChild(new Element('td', {style: 'vertical-align: top; padding: 10px 4px'}))\n                .appendChild(new Element('a', {class: 'remove-variation', href: 'javascript:void(0)'})).insert('<span></span>')\n                .observe('click', function () {\n                    if (container.select('tr').length > 1) {\n                        tr.remove();\n                    }\n\n                    if (container.select('tr').length == 1) {\n                        container.select('a.remove-variation').each(function (btn) {\n                            btn.hide();\n                        });\n                    }\n                });\n\n            container.select('a.remove-variation').each(function (btn) {\n                btn.hide();\n            });\n\n            if (container.select('tr').length > 1) {\n                container.select('a.remove-variation').each(function (btn) {\n                    btn.show();\n                });\n            }\n        },\n\n        //########################################\n\n        eachAttributeHandler: function (select, i, getNextSelects, filters) {\n            var attribute = this.variationAttributes[i];\n\n            if (!i) {\n                select.disabled = false;\n                this.renderAttributeValues(select, attribute);\n            }\n\n            select.observe('change', (function () {\n                filters[attribute] = select.value;\n\n                var nextSelects = getNextSelects.call(this);\n\n                if (nextSelects.length < 1) {\n                    return;\n                }\n\n                nextSelects.each(function (select) {\n                    select.disabled = true;\n                });\n\n                var nextSelect = nextSelects[0];\n\n                nextSelect.disabled = false;\n\n                this.renderAttributeValues(\n                    nextSelect, this.variationAttributes[i + 1], filters\n                );\n            }).bind(this));\n        },\n\n        // ---------------------------------------\n\n        renderAttributeValues: function (container, attribute, filters) {\n            filters = filters || {};\n\n            var values = this.getAttributeValues(attribute, this.variationsTree, filters);\n\n            var oldValue = container.value;\n            container.update();\n\n            container.appendChild(new Element('option', {style: 'display: none'}));\n\n            if (typeof values != 'undefined') {\n\n                values.each(function (value) {\n                    container.appendChild(new Element('option', {value: value})).insert(value);\n\n                    if (value == oldValue) {\n                        container.value = oldValue;\n                        container.simulate('change');\n                    }\n                });\n            }\n        },\n\n        // ---------------------------------------\n\n        getAttributeValues: function (attribute, attributesTree, filters) {\n            for (var treeAttribute in attributesTree) {\n\n                if (attribute == treeAttribute) {\n\n                    var values = [];\n                    for (var value in attributesTree[treeAttribute]) {\n                        value && values.push(value);\n                    }\n\n                    return values;\n                }\n\n                for (var filterAttribute in filters) {\n\n                    if (filterAttribute == treeAttribute) {\n                        return this.getAttributeValues(\n                            attribute,\n                            attributesTree[treeAttribute][filters[filterAttribute]],\n                            filters\n                        )\n                    }\n                }\n            }\n        },\n\n        //########################################\n\n        editAction: function (variationData) {\n            MessageObj.clear();\n\n            var parameters = Object.extend(\n                {\n                    listing_product_id: this.listingProductId\n                },\n                variationData\n            );\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/edit'), {\n                method: 'post',\n                parameters: parameters,\n                onSuccess: (function (transport) {\n\n                    try {\n                        this.editPopup.modal('closeModal');\n\n                        var response = transport.responseText.evalJSON();\n\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\n\n                        if (response.type == 'error') {\n                            this.scrollPageToTop();\n                        } else {\n                            this.gridHandler.unselectAllAndReload();\n                        }\n\n                    } catch (e) {\n                        console.log(e.stack);\n                        this.scrollPageToTop();\n                        this.editPopup.modal('closeModal');\n                        MessageObj.addErrorMessage('Internal Error.');\n                    }\n                }).bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        manageAction: function (variationData) {\n            MessageObj.clear();\n\n            var parameters = Object.extend(\n                {\n                    listing_product_id: this.listingProductId\n                },\n                variationData\n            );\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/manage'), {\n                method: 'post',\n                parameters: parameters,\n                onSuccess: (function (transport) {\n\n                    try {\n                        this.managePopup.modal('closeModal');\n\n                        var response = transport.responseText.evalJSON();\n\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\n\n                        if (response.type == 'error') {\n                            this.scrollPageToTop();\n                        } else {\n                            this.gridHandler.unselectAllAndReload();\n                        }\n\n                    } catch (e) {\n                        this.scrollPageToTop();\n                        this.managePopup.modal('closeModal');\n                        MessageObj.addErrorMessage('Internal Error.');\n                    }\n                }).bind(this)\n            });\n        },\n\n        // ---------------------------------------\n\n        manageGenerateAction: function (unique) {\n            var self = this,\n                attributesIndexes = {};\n\n            $('variation_manage').select('th.data-grid-th').each(function (el, i) {\n                attributesIndexes[el.readAttribute('attribute').toLowerCase()] = i;\n            });\n\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_individual/generate'), {\n                method: 'post',\n                parameters: {\n                    listing_product_id: self.listingProductId,\n                    unique: +(unique)\n                },\n                onSuccess: function (transport) {\n\n                    try {\n                        var response = transport.responseText.evalJSON();\n\n                        if (response.type == 'error') {\n                            MessageObj.addErrorMessage(response.message);\n                            self.managePopup.modal('closeModal');\n                            return self.scrollPageToTop();\n                        }\n\n                        if (response.text.length < 1 && Boolean(unique)) {\n                            self.alert(M2ePro.translator.translate('no_variations_left'));\n                            return;\n                        }\n\n                        $('variation_manage_tbody').select('tr').invoke('remove');\n\n                        response.text.each(function (attributes) {\n\n                            self.manageAddRow();\n\n                            var tr = $('variation_manage_tbody').select('tr').last();\n\n                            var temp = [];\n\n                            attributes.each(function (attribute) {\n                                var index = attributesIndexes[attribute.attribute.toLowerCase()];\n                                var select = tr.down('select[index=' + index + ']');\n                                temp[index] = {select: select, value: attribute.option};\n                            });\n\n                            temp.each(function (obj) {\n                                obj.select.value = obj.value;\n                                obj.select.simulate('change');\n                            });\n                        });\n                    } catch (e) {\n                        self.scrollPageToTop();\n                        self.managePopup.modal('closeModal');\n                        MessageObj.addErrorMessage('Internal Error.');\n                    }\n                }\n            });\n        }\n\n        // ---------------------------------------\n    });\n\n});","Ess_M2ePro/js/Amazon/Listing/Product/Variation/Manage.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Action'\r\n], function (MessageObj, modal) {\r\n\r\n    window.AmazonListingProductVariationManage = Class.create(Action, {\r\n\r\n        MATCHING_TYPE_EQUAL: 1,\r\n        MATCHING_TYPE_VIRTUAL_AMAZON: 2,\r\n        MATCHING_TYPE_VIRTUAL_MAGENTO: 3,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n        matchingType: 1,\r\n        matchedAttributes: [],\r\n        productAttributes: [],\r\n        destinationAttributes: [],\r\n        selectedDestinationAttributes: [],\r\n        magentoVariationSet: [],\r\n        amazonVariationSet: false,\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            this.initValidators();\r\n            return this;\r\n        },\r\n\r\n        initValidators: function () {\r\n            var self = this;\r\n\r\n            jQuery.validator.addMethod('M2ePro-amazon-attribute-unique-value', function(value, el) {\r\n                var existedValues = [],\r\n                    isValid = true,\r\n                    form = el.up('form');\r\n\r\n                form.select('select').each(function (el) {\r\n                    if (el.value != '') {\r\n                        if (existedValues.indexOf(el.value) === -1) {\r\n                            existedValues.push(el.value);\r\n                        } else {\r\n                            isValid = false;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return isValid;\r\n            }, M2ePro.translator.translate('variation_manage_matched_attributes_error_duplicate'));\r\n        },\r\n\r\n        initSettingsTab: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            if (form && self.matchingType == self.MATCHING_TYPE_EQUAL) {\r\n                form.observe('change', function (e) {\r\n                    if (e.target.tagName != 'SELECT') {\r\n                        return;\r\n                    }\r\n\r\n                    $(e.target).select('.empty') && $(e.target).select('.empty').length && $(e.target).select('.empty')[0].hide();\r\n                });\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (productId, title, filter) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation/manage'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId,\r\n                    filter: filter\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('variation_manage_tabs_container');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.variationProductManagePopup = jQuery('#variation_manage_tabs_container');\r\n\r\n                    modal({\r\n                        title: title.escapeHTML(),\r\n                        type: 'slide',\r\n                        closed: function() {\r\n                            self.gridHandler.unselectAllAndReload();\r\n                        },\r\n                        buttons: [\r\n                        //     {\r\n                        //     text: M2ePro.translator.translate('Close'),\r\n                        //     class: 'action primary ',\r\n                        //     click: function () {\r\n                        //         self.searchMenuPopup.modal('closeModal')\r\n                        //     }\r\n                        // }\r\n                        ]\r\n                    }, self.variationProductManagePopup);\r\n\r\n                    self.variationProductManagePopup.modal('openModal');\r\n                    self.variationProductManagePopup.productId = productId;\r\n\r\n                    self.initSettingsTab();\r\n                }\r\n            });\r\n        },\r\n\r\n        closeManageVariationsPopup: function () {\r\n            this.variationProductManagePopup.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openVocabularyAttributesPopUp: function (attributes) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getAttributesPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_attributes_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyAttributesPupup = jQuery('#vocabulary_attributes_pupup');\r\n\r\n                    modal({\r\n                        title: 'Vocabulary',\r\n                        type: 'popup',\r\n                        closed: function() {\r\n                            self.reloadVariationsGrid();\r\n                        },\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addAttributesToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyAttributesPupup);\r\n\r\n                    self.vocabularyAttributesPupup.modal('openModal');\r\n\r\n                    $('vocabulary_attributes_data').value = Object.toJSON(attributes);\r\n\r\n                    var attributesHtml = '';\r\n                    $H(attributes).each(function (element) {\r\n                        attributesHtml += '<li>' + element.key + ' > ' + element.value + '</li>';\r\n                    });\r\n\r\n                    attributesHtml = '<ul style=\"list-style-position: inside;\">' + attributesHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%attributes%', attributesHtml, $('vocabulary_attributes_pupup').innerHTML);\r\n\r\n                    $('vocabulary_attributes_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addAttributesToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_attributes_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyAttributesPupup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addAttributes'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    attributes: $('vocabulary_attributes_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyAttributesPupup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        openVocabularyOptionsPopUp: function (options) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/getOptionsPopup'), {\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('vocabulary_options_pupup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.vocabularyOptionsPopup = jQuery('#vocabulary_options_pupup');\r\n\r\n                    modal({\r\n                        title: 'Vocabulary',\r\n                        type: 'popup',\r\n                        closed: function() {\r\n                            self.reloadVariationsGrid();\r\n                        },\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('No'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(false);\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.addOptionsToVocabulary(true);\r\n                            }\r\n                        }]\r\n                    }, self.vocabularyOptionsPopup);\r\n\r\n                    self.vocabularyOptionsPopup.modal('openModal');\r\n\r\n                    $('vocabulary_options_data').value = Object.toJSON(options);\r\n\r\n                    var optionsHtml = '';\r\n                    $H(options).each(function (element) {\r\n\r\n                        var valuesHtml = '';\r\n                        $H(element.value).each(function (value) {\r\n                            valuesHtml += value.key + ' > ' + value.value;\r\n                        });\r\n\r\n                        optionsHtml += '<li>' + element.key + ': ' + valuesHtml + '</li>';\r\n                    });\r\n\r\n                    optionsHtml = '<ul style=\"list-style-position: inside;\">' + optionsHtml + '</ul>';\r\n\r\n                    var bodyHtml = str_replace('%options%', optionsHtml, $('vocabulary_options_pupup').innerHTML);\r\n\r\n                    $('vocabulary_options_pupup').update(bodyHtml);\r\n                }\r\n            });\r\n        },\r\n\r\n        addOptionsToVocabulary: function (needAdd) {\r\n            var self = this;\r\n\r\n            var isRemember = $('vocabulary_options_remember_checkbox').checked;\r\n\r\n            if (!needAdd && !isRemember) {\r\n                self.vocabularyOptionsPopup.modal('closeModal');\r\n                return;\r\n            }\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/addOptions'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    options_data: $('vocabulary_options_data').value,\r\n                    need_add: needAdd ? 1 : 0,\r\n                    is_remember: isRemember ? 1 : 0\r\n                },\r\n                onSuccess: function (transport) {\r\n                    self.vocabularyOptionsPopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setGeneralIdOwner: function (value, hideConfirm) {\r\n            var self = this,\r\n                confirmAction;\r\n\r\n            confirmAction = function () {\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setGeneralIdOwner'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: self.variationProductManagePopup.productId,\r\n                        general_id_owner: value\r\n                    },\r\n                    onSuccess: function (transport) {\r\n\r\n                        var response = self.parseResponse(transport);\r\n                        if (response.success) {\r\n                            return self.reloadVariationsGrid();\r\n                        }\r\n\r\n                        if (response.empty_sku) {\r\n                            return self.openSkuPopUp();\r\n                        }\r\n                        self.openDescriptionTemplatePopUp(response.html);\r\n                    }\r\n                });\r\n            };\r\n\r\n            if (hideConfirm) {\r\n                confirmAction();\r\n            } else {\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            confirmAction();\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        openSkuPopUp: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/getSkuPopup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: self.variationProductManagePopup.productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('manage_variation_sku_popup');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.skuPopup = jQuery('#manage_variation_sku_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('variation_manage_matched_sku_popup_title'),\r\n                        type: 'popup',\r\n                        modalClass: 'width-50',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            class: 'action-secondary action-dismiss',\r\n                            click: function () {\r\n                                self.skuPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.setProductSku();\r\n                            }\r\n                        }]\r\n                    }, self.skuPopup);\r\n\r\n                    self.skuPopup.modal('openModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        setProductSku: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            this.initFormValidation('#variation_manager_sku_form');\r\n\r\n            if (!jQuery('#variation_manager_sku_form').valid()) {\r\n                return;\r\n            }\r\n\r\n            data = $('variation_manager_sku_form').serialize(true);\r\n            data.product_id = self.variationProductManagePopup.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setListingProductSku'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.success) {\r\n                        self.skuPopup.modal('closeModal');\r\n                        self.setGeneralIdOwner(1, true);\r\n                    } else {\r\n                        var skuError = $('sku-error');\r\n\r\n                        if (!skuError) {\r\n                            skuError = new Element('label', {\r\n                                id : 'sku-error',\r\n                                for : 'sku',\r\n                                class: 'error',\r\n                                generated: true\r\n                            });\r\n\r\n                            $('sku').insert({after: skuError})\r\n                        }\r\n\r\n                        skuError.update(response.msg);\r\n                        skuError.show();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        openDescriptionTemplatePopUp: function (contentData) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            MessageObj.clear();\r\n\r\n            if (!$('template_description_pop_up_content')) {\r\n                $('html-body').insert({bottom: contentData});\r\n            }\r\n\r\n            self.templateDescriptionPopup = jQuery('#template_description_pop_up_content');\r\n\r\n            modal({\r\n                title: M2ePro.translator.translate('templateDescriptionPopupTitle'),\r\n                type: 'slide',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Add New Description Policy'),\r\n                    class: 'action primary ',\r\n                    click: function () {\r\n                        ListingGridHandlerObj.templateDescriptionHandler.createTemplateDescriptionInNewTab(M2ePro.url.get('newTemplateDescriptionUrl'));\r\n                    }\r\n                }]\r\n            }, self.templateDescriptionPopup);\r\n\r\n            self.templateDescriptionPopup.modal('openModal');\r\n\r\n            self.templateDescriptionPopup.productsIds = self.variationProductManagePopup.productId;\r\n            self.templateDescriptionPopup.checkIsNewAsinAccepted = 1;\r\n\r\n            self.loadTemplateDescriptionGrid();\r\n        },\r\n\r\n        loadTemplateDescriptionGrid: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.variationProductManagePopup.productId,\r\n                    check_is_new_asin_accepted: 1,\r\n                    map_to_template_js_fn: 'ListingGridHandlerObj.variationProductManageHandler.mapToTemplateDescription'\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('template_description_grid').update(transport.responseText);\r\n                    $('template_description_grid').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        mapToTemplateDescription: function (el, templateId, mapToGeneralId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/assign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.variationProductManagePopup.productId,\r\n                    template_id: templateId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.type == 'success') {\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                        self.setGeneralIdOwner(1, true);\r\n                    }\r\n                }\r\n            });\r\n\r\n            self.templateDescriptionPopup.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeVariationTheme: function (el) {\r\n            var attrs = $('variation_manager_theme_attributes');\r\n            attrs.hide();\r\n            attrs.next().show();\r\n\r\n            el.hide();\r\n            el.next().show();\r\n\r\n            var channelVariationThemeNote = $('channel_variation_theme_note');\r\n            channelVariationThemeNote && channelVariationThemeNote.hide();\r\n        },\r\n\r\n        setVariationTheme: function () {\r\n            var self = this,\r\n                value = $('variation_manager_theme').value;\r\n\r\n            if (value) {\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setVariationTheme'), {\r\n                    method: 'post',\r\n                    parameters: {\r\n                        product_id: self.variationProductManagePopup.productId,\r\n                        variation_theme: value\r\n                    },\r\n                    onSuccess: function (transport) {\r\n                        var response = self.parseResponse(transport);\r\n                        if (response.success) {\r\n                            self.reloadSettings();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        cancelVariationTheme: function (el) {\r\n            var attrs = $('variation_manager_theme_attributes');\r\n            attrs.show();\r\n            attrs.next().hide();\r\n\r\n            el.up().previous().show();\r\n            el.up().hide();\r\n\r\n            var channelVariationThemeNote = $('channel_variation_theme_note');\r\n            channelVariationThemeNote && channelVariationThemeNote.show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        changeMatchedAttributes: function (el) {\r\n            $$('.variation_manager_attributes_amazon_value').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            $$('.variation_manager_attributes_amazon_select').each(function (el) {\r\n                el.show();\r\n            });\r\n\r\n            el.hide();\r\n            el.next().show();\r\n            el.next().next().show();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isValidAttributes: function () {\r\n            var self = this,\r\n                existedValues = [],\r\n                isValid = true,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            if (!form || (form && form.serialize() == '')) {\r\n                return true;\r\n            }\r\n            var data = form.serialize(true);\r\n\r\n            form.select('.validation-advice').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            if (typeof data['variation_attributes[amazon_attributes][]'] == 'string') {\r\n\r\n                if (data['variation_attributes[amazon_attributes][]'] != '') {\r\n                    return true;\r\n                }\r\n\r\n                var errorEl = form.select('.validation-advice')[0];\r\n                errorEl.show();\r\n                errorEl.update(M2ePro.translator.translate('variation_manage_matched_attributes_error'));\r\n\r\n                return false;\r\n            }\r\n\r\n            var i = 0;\r\n            data['variation_attributes[amazon_attributes][]'].each(function (attrVal) {\r\n                if (attrVal != '' && existedValues.indexOf(attrVal) === -1) {\r\n                    existedValues.push(attrVal);\r\n                } else {\r\n                    isValid = false;\r\n\r\n                    var errorEl = $('variation_manager_attributes_error_' + i);\r\n                    errorEl.show();\r\n                    if (attrVal == '') {\r\n                        errorEl.update(M2ePro.translator.translate('variation_manage_matched_attributes_error'));\r\n                    } else {\r\n                        errorEl.update(M2ePro.translator.translate('variation_manage_matched_attributes_error_duplicate'))\r\n                    }\r\n                }\r\n                i++;\r\n            });\r\n\r\n            return isValid;\r\n        },\r\n\r\n        setMatchedAttributes: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            if (!self.isValidAttributes()) {\r\n                return;\r\n            }\r\n\r\n            $('variation_manager_attributes_form').select('.validation-advice').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            data = $('variation_manager_attributes_form').serialize(true);\r\n            data.product_id = self.variationProductManagePopup.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setMatchedAttributes'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.success) {\r\n                        self.reloadVariationsGrid();\r\n\r\n                        if (response['vocabulary_attributes']) {\r\n                            self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        cancelMatchedAttributes: function (el) {\r\n            $$('.variation_manager_attributes_amazon_value').each(function (el) {\r\n                el.show();\r\n            });\r\n\r\n            $$('.variation_manager_attributes_amazon_select').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            $('variation_manager_attributes_form').select('.validation-advice').each(function (el) {\r\n                el.hide();\r\n            });\r\n\r\n            el.hide();\r\n            el.previous().show();\r\n            el.next().hide();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesNotSetView: function (type) {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                tBody = form.down('tbody');\r\n\r\n            tBody.update();\r\n\r\n            $H(self.matchedAttributes).each(function (attribute) {\r\n                var tr = new Element('tr'),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label',\r\n                        style: 'border-right: 1px solid #D6D6D6 !important;'\r\n                    }),\r\n                    label = new Element('label'),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    valueSpan = new Element('span', {\r\n                        style: 'color: red;'\r\n                    });\r\n\r\n                label.innerHTML = attribute.key;\r\n                valueSpan.innerHTML = M2ePro.translator.translate('not_set');\r\n\r\n                tdLabel.insert({bottom: label});\r\n                tdValue.insert({bottom: valueSpan});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n            });\r\n\r\n            var tr = new Element('tr'),\r\n                tdBtns = new Element('td', {\r\n                    class: 'label',\r\n                    colspan: '2',\r\n                    style: 'text-align: right; border: none'\r\n                }),\r\n                setBtn = new Element('button', {class: 'action primary'});\r\n\r\n            setBtn.update(M2ePro.translator.translate('set_attributes'));\r\n            setBtn.observe('click', function (event) {\r\n                if (self.matchingType === self.MATCHING_TYPE_VIRTUAL_AMAZON) {\r\n                    self.renderMatchedAttributesVirtualAmazonView();\r\n                }\r\n\r\n                if (self.matchingType === self.MATCHING_TYPE_VIRTUAL_MAGENTO) {\r\n                    self.renderMatchedAttributesVirtualMagentoView();\r\n                }\r\n            });\r\n\r\n            tdBtns.insert({bottom: setBtn});\r\n            tr.insert({bottom: tdBtns});\r\n            tBody.insert({bottom: tr});\r\n\r\n        },\r\n\r\n        renderMatchedAttributesVirtualAmazonView: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                tBody = form.down('tbody');\r\n\r\n            tBody.update();\r\n            self.selectedDestinationAttributes = [];\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(self.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('tr'),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label value',\r\n                        style: 'border-right: 1px solid #D6D6D6 !important; vertical-align: inherit;'\r\n                    }),\r\n                    labelMagentoAttr = new Element('label', {\r\n                        class: 'magento-attribute-name'\r\n                    }),\r\n                    inputVirtualAttribute = new Element('input', {\r\n                        style: 'display: none',\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        disabled: 'disabled',\r\n                        class: 'virtual-amazon-attribute-name-value',\r\n                        name: 'variation_attributes[virtual_amazon_attributes][' + i + ']'\r\n                    }),\r\n                    selectVirtualAttributeOption = new Element('select', {\r\n                        style: 'display: none; width: 200px; margin-top: -3px',\r\n                        disabled: 'disabled',\r\n                        class: 'admin__control-select required-entry virtual-amazon-option',\r\n                        name: 'variation_attributes[virtual_amazon_option][' + i + ']'\r\n                    }),\r\n                    selectVirtualAttributeOptionGroup = new Element('optgroup', {\r\n                        label: attribute.key\r\n                    }),\r\n                    labelVirtualAttributeAndOption = new Element('span', {\r\n                        style: 'display: none; line-height: 20px; vertical-align: baseline;',\r\n                        class: 'virtual-amazon-attribute-and-option'\r\n                    }),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        class: 'magento-attribute-name-value',\r\n                        name: 'variation_attributes[magento_attributes][' + i + ']'\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'variation_attributes[amazon_attributes][' + i + ']'\r\n                    }),\r\n                    spanVirtualAttribute = new Element('span', {\r\n                        style: 'display: none; line-height: 20px; vertical-align: baseline;',\r\n                        class: 'virtual-amazon-attribute-name'\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        style: 'display: none',\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('variation_settings_form_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_magento_greater_right'));\r\n\r\n                var attributeStr = attribute.key;\r\n                if (attribute.key.length > 13) {\r\n                    attributeStr = attribute.key.substr(0, 12) + '...';\r\n                    labelVirtualAttributeAndOption.title = attribute.key;\r\n                    spanVirtualAttribute.title = attribute.key;\r\n                }\r\n\r\n                if (attribute.key.length < 31) {\r\n                    labelMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    labelMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    labelMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                spanVirtualAttribute.update(attributeStr + ' (<span>&ndash;</span>)');\r\n                labelVirtualAttributeAndOption.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                labelVirtualAttributeAndOption.down('a').title = '';\r\n\r\n                labelVirtualAttributeAndOption.down('a').observe('click', function (event) {\r\n                    labelVirtualAttributeAndOption.hide();\r\n                    selectVirtualAttributeOption.show();\r\n                    selectVirtualAttributeOption.value = '';\r\n                    spanVirtualAttribute.down('span').update('&ndash;');\r\n                    spanVirtualAttribute.down('span').title = '';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                self.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        self.productAttributes.indexOf(selectAmazonAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.translator.translate('duplicate_amazon_attribute_error'));\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    var prevValueIndex = self.selectedDestinationAttributes.indexOf(selectAmazonAttr.prevValue);\r\n                    if (prevValueIndex > -1) {\r\n                        self.selectedDestinationAttributes.splice(prevValueIndex, 1);\r\n                    }\r\n\r\n                    if (selectAmazonAttr.value != '') {\r\n                        self.selectedDestinationAttributes.push(selectAmazonAttr.value);\r\n                    }\r\n                    selectAmazonAttr.prevValue = selectAmazonAttr.value;\r\n\r\n                    form.select('select').each(function (el) {\r\n                        result = Validation.get('M2ePro-amazon-attribute-unique-value').test($F(el), el) ? result : false;\r\n                    });\r\n\r\n                    if (result && self.selectedDestinationAttributes.length == self.destinationAttributes.length) {\r\n                        self.showVirtualAmazonAttributes();\r\n                    } else {\r\n                        self.hideVirtualAmazonAttributes();\r\n                    }\r\n                });\r\n\r\n                selectVirtualAttributeOption.observe('change', function (event) {\r\n                    var value = selectVirtualAttributeOption.value;\r\n\r\n                    labelVirtualAttributeAndOption.show();\r\n                    selectVirtualAttributeOption.hide();\r\n\r\n                    if (attributeStr.length + value.length < 28) {\r\n                        spanVirtualAttribute.down('span').update(value);\r\n                        spanVirtualAttribute.down('span').title = '';\r\n                        labelVirtualAttributeAndOption.down('a').update(value);\r\n                    } else {\r\n                        spanVirtualAttribute.down('span').update(value.substr(0, 24 - attributeStr.length) + '...');\r\n                        spanVirtualAttribute.down('span').title = value;\r\n                        labelVirtualAttributeAndOption.down('a').update(value.substr(0, 24 - attributeStr.length) + '...');\r\n                    }\r\n\r\n                    labelVirtualAttributeAndOption.down('a').title = M2ePro.translator.translate('change_option') + ' \"' + value + '\"';\r\n                });\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: option});\r\n\r\n                self.magentoVariationSet[attribute.key].each(function (optionValue) {\r\n                    var option = new Element('option', {\r\n                        value: optionValue\r\n                    });\r\n                    option.update(optionValue);\r\n                    selectVirtualAttributeOptionGroup.insert({bottom: option});\r\n                });\r\n                selectVirtualAttributeOption.insert({bottom: selectVirtualAttributeOptionGroup});\r\n\r\n                tdLabel.insert({bottom: labelMagentoAttr});\r\n                tdLabel.insert({bottom: inputVirtualAttribute});\r\n                tdLabel.insert({bottom: labelVirtualAttributeAndOption});\r\n                tdLabel.insert({bottom: selectVirtualAttributeOption});\r\n                tdLabel.insert({bottom: spanLeftHelpIcon});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n                tdValue.insert({bottom: spanVirtualAttribute});\r\n                tdValue.insert({bottom: spanRightHelpIcon});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            var tr = new Element('tr'),\r\n                tdBtns = new Element('td', {\r\n                    class: 'label',\r\n                    colspan: '2',\r\n                    style: 'text-align: right; border: none'\r\n                }),\r\n                cancelBtn = new Element('a', {\r\n                    href: 'javascript:void(0);',\r\n                    style: 'margin-left: 9px;'\r\n                }),\r\n                confirmBtn = new Element('button', {\r\n                    style: 'margin-left: 9px;',\r\n                    class: 'action primary'\r\n                });\r\n\r\n            cancelBtn.update(M2ePro.translator.translate('Cancel'));\r\n            confirmBtn.update(M2ePro.translator.translate('Confirm'));\r\n\r\n            cancelBtn.observe('click', function (event) {\r\n                self.renderMatchedAttributesNotSetView();\r\n            });\r\n            confirmBtn.observe('click', function (event) {\r\n                form.select('.validation-advice').each(function (el) {\r\n                    el.hide();\r\n                });\r\n\r\n                var result = true;\r\n                form.select('select').each(function (el) {\r\n                    el.classNames().each(function (className) {\r\n                        var validationResult = Validation.test(className, el);\r\n                        result = validationResult ? result : false;\r\n\r\n                        if (!validationResult) {\r\n                            throw $break;\r\n                        }\r\n                    });\r\n                });\r\n\r\n                form.select('.validation-advice').each(function (el) {\r\n                    jQuery(el).wrapInner('<label class=\"mage-error\">');\r\n                });\r\n\r\n                if (result) {\r\n                    var data = form.serialize(true);\r\n                    data.product_id = self.variationProductManagePopup.productId;\r\n\r\n                    new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setMatchedAttributes'), {\r\n                        method: 'post',\r\n                        parameters: data,\r\n                        onSuccess: function (transport) {\r\n                            var response = self.parseResponse(transport);\r\n                            if (response.success) {\r\n                                self.reloadVariationsGrid();\r\n\r\n                                if (response['vocabulary_attributes']) {\r\n                                    self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            tdBtns.insert({bottom: cancelBtn});\r\n            tdBtns.insert({bottom: confirmBtn});\r\n            tr.insert({bottom: tdBtns});\r\n            tBody.insert({bottom: tr});\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n\r\n            tBody.select('.tool-tip-image').each(function (element) {\r\n                element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            });\r\n\r\n            tBody.select('.tool-tip-message').each(function (element) {\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n                element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            });\r\n        },\r\n\r\n        showVirtualAmazonAttributes: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.disable().hide();\r\n\r\n                var tr = el.up('tr');\r\n                tr.down('.magento-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-attribute-name').show();\r\n                tr.down('.magento-attribute-name').hide();\r\n                tr.down('.virtual-amazon-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-option').enable().show();\r\n                tr.down('.right-help-icon').show();\r\n                tr.down('.left-help-icon').show();\r\n            });\r\n        },\r\n\r\n        hideVirtualAmazonAttributes: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            var virtualAmazonAttr = form.select('select.amazon-attribute-name[value=\"\"]');\r\n            virtualAmazonAttr.each(function (el) {\r\n                el.enable().show();\r\n\r\n                var tr = el.up('tr');\r\n                tr.down('.magento-attribute-name-value').enable();\r\n                tr.down('.virtual-amazon-attribute-name').hide();\r\n                tr.down('.magento-attribute-name').show();\r\n                tr.down('.virtual-amazon-attribute-name-value').disable();\r\n                tr.down('.virtual-amazon-option').disable().hide();\r\n                tr.down('.virtual-amazon-attribute-and-option').hide();\r\n                tr.down('.right-help-icon').hide();\r\n                tr.down('.left-help-icon').hide();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        renderMatchedAttributesVirtualMagentoView: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                tBody = form.down('tbody');\r\n\r\n            tBody.update();\r\n\r\n            var prematchedAttributes = [];\r\n            var i = 0;\r\n            $H(self.matchedAttributes).each(function (attribute) {\r\n\r\n                var tr = new Element('tr'),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label',\r\n                        style: 'border-right: 1px solid #D6D6D6 !important;'\r\n                    }),\r\n                    labelMagentoAttr = new Element('label'),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute.key,\r\n                        type: 'hidden',\r\n                        name: 'variation_attributes[magento_attributes][' + i + ']'\r\n                    }),\r\n                    selectAmazonAttr = new Element('select', {\r\n                        class: 'admin__control-select required-entry M2ePro-amazon-attribute-unique-value amazon-attribute-name',\r\n                        name: 'variation_attributes[amazon_attributes][' + i + ']'\r\n                    });\r\n\r\n                if (attribute.key.length < 31) {\r\n                    labelMagentoAttr.update(attribute.key);\r\n                } else {\r\n                    labelMagentoAttr.update(attribute.key.substr(0, 28) + '...');\r\n                    labelMagentoAttr.title = attribute.key;\r\n                }\r\n\r\n                var option = new Element('option', {\r\n                    value: ''\r\n                });\r\n                selectAmazonAttr.insert({bottom: option});\r\n\r\n                self.destinationAttributes.each(function (destinationAttribute) {\r\n                    var option = new Element('option', {\r\n                        value: destinationAttribute\r\n                    });\r\n                    option.update(destinationAttribute);\r\n                    selectAmazonAttr.insert({bottom: option});\r\n\r\n                    if (attribute.value == destinationAttribute) {\r\n                        selectAmazonAttr.value = destinationAttribute;\r\n                        prematchedAttributes.push(selectAmazonAttr);\r\n                    }\r\n                });\r\n                selectAmazonAttr.prevValue = '';\r\n\r\n                selectAmazonAttr.observe('change', function (event) {\r\n                    var result = true;\r\n                    if (selectAmazonAttr.value != '' && inputMagentoAttr.value != selectAmazonAttr.value &&\r\n                        self.destinationAttributes.indexOf(inputMagentoAttr.value) !== -1) {\r\n                        result = false;\r\n\r\n                        if (attribute.value == null) {\r\n                            self.alert(M2ePro.translator.translate('duplicate_magento_attribute_error'));\r\n                        }\r\n                        selectAmazonAttr.value = '';\r\n                    }\r\n                    attribute.value = null;\r\n\r\n                    form.select('select.amazon-attribute-name').each(function (el) {\r\n                        el.classNames().each(function (className) {\r\n                            var v = Validation.get(className),\r\n                                validationResult = v.test($F(el), el);\r\n\r\n                            result = validationResult ? result : false;\r\n\r\n                            if (!validationResult) {\r\n                                throw $break;\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    if (result) {\r\n                        self.showVirtualMagentoAttributes(i);\r\n                    } else {\r\n                        self.hideVirtualMagentoAttributes();\r\n                    }\r\n                });\r\n\r\n                tdLabel.insert({bottom: labelMagentoAttr});\r\n                tdValue.insert({bottom: inputMagentoAttr});\r\n                tdValue.insert({bottom: selectAmazonAttr});\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                tBody.insert({bottom: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            var tr = new Element('tr', {\r\n                    class: 'buttons-row'\r\n                }),\r\n                tdBtns = new Element('td', {\r\n                    class: 'label',\r\n                    colspan: '2',\r\n                    style: 'text-align: right; border: none'\r\n                }),\r\n                cancelBtn = new Element('a', {\r\n                    href: 'javascript:void(0);',\r\n                    style: 'margin-left: 9px;'\r\n                }),\r\n                confirmBtn = new Element('button', {\r\n                    style: 'margin-left: 9px;',\r\n                    class: 'action primary'\r\n                });\r\n\r\n            cancelBtn.update(M2ePro.translator.translate('Cancel'));\r\n            confirmBtn.update(M2ePro.translator.translate('Confirm'));\r\n\r\n            cancelBtn.observe('click', function (event) {\r\n                self.renderMatchedAttributesNotSetView();\r\n            });\r\n            confirmBtn.observe('click', function (event) {\r\n                form.select('.validation-advice').each(function (el) {\r\n                    el.hide();\r\n                });\r\n\r\n                var result = true;\r\n                form.select('select', 'input').each(function (el) {\r\n                    el.classNames().each(function (className) {\r\n                        var validationResult = Validation.test(className, el);\r\n                        result = validationResult ? result : false;\r\n\r\n                        if (!validationResult) {\r\n                            throw $break;\r\n                        }\r\n                    });\r\n                });\r\n\r\n                form.select('.validation-advice').each(function (el) {\r\n                    jQuery(el).wrapInner('<label class=\"mage-error\">');\r\n                });\r\n\r\n                if (result) {\r\n                    var data = form.serialize(true);\r\n                    data.product_id = self.variationProductManagePopup.productId;\r\n\r\n                    new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setMatchedAttributes'), {\r\n                        method: 'post',\r\n                        parameters: data,\r\n                        onSuccess: function (transport) {\r\n                            var response = self.parseResponse(transport);\r\n                            if (response.success) {\r\n                                self.reloadVariationsGrid();\r\n\r\n                                if (response['vocabulary_attributes']) {\r\n                                    self.openVocabularyAttributesPopUp(response['vocabulary_attributes']);\r\n                                }\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            tdBtns.insert({bottom: cancelBtn});\r\n            tdBtns.insert({bottom: confirmBtn});\r\n            tr.insert({bottom: tdBtns});\r\n            tBody.insert({bottom: tr});\r\n\r\n            prematchedAttributes.each(function (el) {\r\n                el.simulate('change');\r\n            });\r\n        },\r\n\r\n        showVirtualMagentoAttributes: function (lastAttributeIndex) {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form'),\r\n                buttonsRow = form.down('.buttons-row');\r\n\r\n            form.select('tr.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n\r\n            var selectedValues = [];\r\n            form.select('select.amazon-attribute-name').each(function (el) {\r\n                selectedValues.push(el.value);\r\n            });\r\n\r\n            var i = lastAttributeIndex;\r\n            self.destinationAttributes.each(function (attribute) {\r\n                if (selectedValues.indexOf(attribute) !== -1) {\r\n                    return true;\r\n                }\r\n                var tr = new Element('tr', {\r\n                        class: 'virtual-attribute'\r\n                    }),\r\n                    tdLabel = new Element('td', {\r\n                        class: 'label',\r\n                        style: 'line-height: 26px; border-right: 1px solid #D6D6D6 !important;'\r\n                    }),\r\n                    labelMagentoAttr = new Element('label'),\r\n                    spanLeftHelpIcon = new Element('span', {\r\n                        class: 'left-help-icon'\r\n                    }),\r\n                    tdValue = new Element('td', {\r\n                        class: 'value'\r\n                    }),\r\n                    inputMagentoAttr = new Element('input', {\r\n                        value: attribute,\r\n                        type: 'hidden',\r\n                        name: 'variation_attributes[virtual_magento_attributes][' + i + ']'\r\n                    }),\r\n                    spanVirtualAttribute = new Element('span', {\r\n                        style: 'display: none'\r\n                    }),\r\n                    spanRightHelpIcon = new Element('span', {\r\n                        class: 'right-help-icon'\r\n                    });\r\n\r\n                var helpIconTpl = $('variation_settings_form_help_icon_tpl');\r\n\r\n                spanLeftHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanLeftHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_left'));\r\n                spanRightHelpIcon.update(helpIconTpl.innerHTML);\r\n                spanRightHelpIcon.down('.tool-tip-message-text').update(M2ePro.translator.translate('help_icon_amazon_greater_right'));\r\n\r\n                var attributeStr = attribute;\r\n                if (attribute.length > 13) {\r\n                    attributeStr = attribute.substr(0, 12) + '...';\r\n                    labelMagentoAttr.title = attribute;\r\n                    spanVirtualAttribute.title = attribute;\r\n                }\r\n\r\n                labelMagentoAttr.update(attributeStr + ' (<span>&ndash;</span>)');\r\n\r\n                if (self.amazonVariationSet === false) {\r\n                    spanVirtualAttribute.update(attributeStr + ' (<span></span>)');\r\n                    spanVirtualAttribute.show();\r\n\r\n                    var virtualAttrOption = new Element('input', {\r\n                        type: 'text',\r\n                        style: 'width: 153px;',\r\n                        class: 'required-entry',\r\n                        name: 'variation_attributes[virtual_magento_option][' + i + ']'\r\n                    });\r\n\r\n                    virtualAttrOption.observe('keyup', function (event) {\r\n                        var value = virtualAttrOption.value;\r\n\r\n                        if (value == '') {\r\n                            labelMagentoAttr.down('span').update('&ndash;');\r\n                            labelMagentoAttr.down('span').title = '';\r\n                            return;\r\n                        }\r\n\r\n                        if (attributeStr.length + value.length < 21) {\r\n                            labelMagentoAttr.down('span').update(value);\r\n                            labelMagentoAttr.down('span').title = '';\r\n                        } else {\r\n                            labelMagentoAttr.down('span').update(value.substr(0, 20 - attributeStr.length) + '...');\r\n                            labelMagentoAttr.down('span').title = value;\r\n                        }\r\n                    });\r\n\r\n                    labelMagentoAttr.insert({bottom: spanLeftHelpIcon});\r\n                    spanVirtualAttribute.down('span').insert({bottom: virtualAttrOption});\r\n\r\n                    tdLabel.insert({bottom: labelMagentoAttr});\r\n                    tdValue.insert({bottom: inputMagentoAttr});\r\n                    tdValue.insert({bottom: spanVirtualAttribute});\r\n                    tdValue.insert({bottom: spanRightHelpIcon});\r\n                } else {\r\n                    var virtualAttrOption = new Element('select', {\r\n                            style: 'width: 255px;',\r\n                            class: 'admin__control-select required-entry virtual-magento-option',\r\n                            name: 'variation_attributes[virtual_magento_option][' + i + ']'\r\n                        }),\r\n                        virtualAttrOptionGroup = new Element('optgroup', {\r\n                            label: attribute\r\n                        });\r\n\r\n                    spanVirtualAttribute.update(attributeStr + ' (<a href=\"javascript:void(0);\"></a>)');\r\n                    spanVirtualAttribute.down('a').title = '';\r\n\r\n                    spanVirtualAttribute.down('a').observe('click', function (event) {\r\n                        spanVirtualAttribute.hide();\r\n                        virtualAttrOption.show();\r\n                        virtualAttrOption.value = '';\r\n                        labelMagentoAttr.down('span').update('&ndash;');\r\n                        labelMagentoAttr.down('span').title = '';\r\n                    });\r\n\r\n                    var option = new Element('option', {\r\n                        value: ''\r\n                    });\r\n                    virtualAttrOption.insert({bottom: option});\r\n\r\n                    self.amazonVariationSet[attribute].each(function (optionValue) {\r\n                        var option = new Element('option', {\r\n                            value: optionValue\r\n                        });\r\n                        option.update(optionValue);\r\n                        virtualAttrOptionGroup.insert({bottom: option});\r\n                    });\r\n                    virtualAttrOption.insert({bottom: virtualAttrOptionGroup});\r\n\r\n                    virtualAttrOption.observe('change', function (event) {\r\n                        var value = virtualAttrOption.value;\r\n\r\n                        spanVirtualAttribute.show();\r\n                        virtualAttrOption.hide();\r\n\r\n                        if (attributeStr.length + value.length < 28) {\r\n                            labelMagentoAttr.down('span').update(value);\r\n                            labelMagentoAttr.down('span').title = '';\r\n                        } else {\r\n                            labelMagentoAttr.down('span').update(value.substr(0, 22 - attributeStr.length) + '...');\r\n                            labelMagentoAttr.down('span').title = value;\r\n                        }\r\n\r\n                        if (attributeStr.length + value.length < 45) {\r\n                            spanVirtualAttribute.down('a').update(value);\r\n                        } else {\r\n                            spanVirtualAttribute.down('a').update(value.substr(0, 40 - attributeStr.length) + '...');\r\n                        }\r\n                        spanVirtualAttribute.down('a').title = M2ePro.translator.translate('change_option') + ' \"' + value + '\"';\r\n                    });\r\n\r\n                    labelMagentoAttr.insert({bottom: spanLeftHelpIcon});\r\n                    tdLabel.insert({bottom: labelMagentoAttr});\r\n                    tdValue.insert({bottom: inputMagentoAttr});\r\n                    tdValue.insert({bottom: spanVirtualAttribute});\r\n                    tdValue.insert({bottom: virtualAttrOption});\r\n                    tdValue.insert({bottom: spanRightHelpIcon});\r\n                }\r\n\r\n                tr.insert({bottom: tdLabel});\r\n                tr.insert({bottom: tdValue});\r\n\r\n                buttonsRow.insert({before: tr});\r\n\r\n                i++;\r\n            });\r\n\r\n            form.select('.tool-tip-image').each(function (element) {\r\n                element.observe('mouseover', MagentoFieldTipObj.showToolTip);\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipIconMouseLeave);\r\n            });\r\n\r\n            form.select('.tool-tip-message').each(function (element) {\r\n                element.observe('mouseout', MagentoFieldTipObj.onToolTipMouseLeave);\r\n                element.observe('mouseover', MagentoFieldTipObj.onToolTipMouseEnter);\r\n            });\r\n        },\r\n\r\n        hideVirtualMagentoAttributes: function () {\r\n            var self = this,\r\n                form = $('variation_manager_attributes_form');\r\n\r\n            form.select('tr.virtual-attribute').each(function (el) {\r\n                el.remove();\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadSettings: function (callback) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/viewVariationsSettingsAjax'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: self.variationProductManagePopup.productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var response = self.parseResponse(transport);\r\n\r\n                    $('amazonVariationProductManageTabs_settings_content').update(response.html);\r\n                    self.initSettingsTab();\r\n\r\n                    var img = $('amazonVariationProductManageTabs_settings').down('img');\r\n\r\n                    img.hide();\r\n                    if (response.error_icon != '') {\r\n                        img.src = M2ePro.url.get('m2epro_skin_url') + '/images/' + response.error_icon + '.png';\r\n                        img.show();\r\n                    }\r\n\r\n                    if (callback) {\r\n                        callback.call();\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        reloadVariationsGrid: function () {\r\n            ListingProductVariationManageVariationsGridObj.actionHandler.gridHandler.unselectAllAndReload();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openVariationsTab: function (createNewAsin) {\r\n            jQuery('#amazonVariationProductManageTabs').tabs('option', 'active', 0);\r\n            ListingProductVariationManageVariationsGridObj.showNewChildForm(\r\n                createNewAsin,\r\n                ListingGridHandlerObj.variationProductManageHandler.variationProductManagePopup.productId\r\n            );\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reloadVocabulary: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/viewVocabularyAjax'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: self.variationProductManagePopup.productId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('amazonVariationProductManageTabs_vocabulary_content').update(transport.responseText);\r\n                }\r\n            });\r\n        },\r\n\r\n        saveAutoActionSettings: function () {\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/saveAutoActionSettings'), {\r\n                method: 'post',\r\n                parameters: $('auto_action_settings_form').serialize(true)\r\n            });\r\n        },\r\n\r\n        removeAttributeFromVocabulary: function (el) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/removeAttribute'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                magento_attr: decodeHtmlentities(el.up().down('.magento-attribute-name').innerHTML),\r\n                                channel_attr: decodeHtmlentities(el.up().down('.channel-attribute-name').innerHTML)\r\n                            },\r\n                            onSuccess: function (transport) {\r\n                                self.reloadVocabulary();\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        removeOptionFromVocabulary: function (el) {\r\n            var self = this,\r\n                optionGroupRowEl = el.up('.channel-attribute-options-group');\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_vocabulary/removeOption'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                product_option: decodeHtmlentities(optionGroupRowEl.down('.product-option').innerHTML),\r\n                                product_options_group: decodeHtmlentities(optionGroupRowEl.down('.product-options-group').innerHTML),\r\n                                channel_attr: decodeHtmlentities(optionGroupRowEl.down('.channel-attribute-name').innerHTML)\r\n                            },\r\n                            onSuccess: function (transport) {\r\n                                self.reloadVocabulary();\r\n                            }\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Variation/Manage/Tabs/Variations/Grid.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/Product/Template/Description'\r\n], function (MessageObj, modal) {\r\n\r\n    window.AmazonListingProductVariationManageTabsVariationsGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridId,listingId)\r\n        {\r\n            this.messageObj = Object.create(MessageObj);\r\n            this.messageObj.setContainer('#listing_product_variation_action_messages_container');\r\n\r\n            $super(gridId,listingId);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function (rowId) {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Product\\\\AbstractGrid::LISTING_PRODUCT_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('amazon_log_listing_product/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function () {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n\r\n            this.actions = {\r\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\r\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\r\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\r\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\r\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\r\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\r\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\r\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\r\n            };\r\n\r\n            this.templateDescriptionHandler = new AmazonListingProductTemplateDescription(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n                deleteAndRemoveAction: this.actionHandler.deleteAndRemoveAction.bind(this.actionHandler)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function ($super) {\r\n            $super();\r\n\r\n            $$('.attributes-options-filter').each(this.initAttributesOptionsFilter, this);\r\n        },\r\n\r\n        initAttributesOptionsFilter: function (filterEl) {\r\n            var srcElement = Element.down(filterEl, 'select');\r\n\r\n            srcElement.observe('change', this.onAttributesOptionsFilterChange.bind(this));\r\n\r\n            var valuesDiv = Element.down(filterEl, '.attributes-options-filter-values');\r\n            valuesDiv.optionsCount = valuesDiv.childElementCount;\r\n\r\n            if (valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            valuesDiv.optionsIterator = 0;\r\n            valuesDiv.childElements().each(function (attrValue) {\r\n\r\n                var removeImg = Element.down(attrValue, '.filter-param-remove'),\r\n                    attrName = Element.down(attrValue, 'input[type=\"hidden\"]'),\r\n                    selectedOption = Element.down(filterEl, 'select option[value=\"' + attrName.value + '\"]');\r\n\r\n                selectedOption.hide();\r\n\r\n                valuesDiv.optionsIterator++;\r\n\r\n                removeImg.show();\r\n                removeImg.observe('click', function () {\r\n                    valuesDiv.optionsCount--;\r\n                    selectedOption.show();\r\n                    srcElement.show();\r\n                    Element.remove(attrValue);\r\n                });\r\n            }, this);\r\n        },\r\n\r\n        onAttributesOptionsFilterChange: function (e) {\r\n            var srcElement = e.target || e.srcElement,\r\n                parentDiv = Element.up(srcElement, '.attributes-options-filter'),\r\n                valuesDiv = Element.down(parentDiv, '.attributes-options-filter-values'),\r\n                selectedOption = Element.down(srcElement, '[value=\"' + srcElement.value + '\"]');\r\n\r\n            selectedOption.hide();\r\n\r\n            valuesDiv.optionsCount++;\r\n            valuesDiv.optionsIterator++;\r\n\r\n            srcElement.enable();\r\n            if (valuesDiv.optionsCount == srcElement.childElementCount - 1) {\r\n                srcElement.hide();\r\n            }\r\n\r\n            var filterName = parentDiv.id.replace('attributes-options-filter_', '');\r\n\r\n            var newOptionContainer = new Element('div'),\r\n                newOptionLabel = new Element('div'),\r\n                newOptionValue = new Element('input', {\r\n                    type: 'text',\r\n                    style: 'width: 85%;',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][value]'\r\n                }),\r\n                newOptionAttr = new Element('input', {\r\n                    type: 'hidden',\r\n                    name: filterName + '[' + valuesDiv.optionsIterator + '][attr]',\r\n                    value: srcElement.value\r\n                }),\r\n                removeImg = Element.clone(Element.down(parentDiv, '.attributes-options-filter-selector .filter-param-remove'));\r\n\r\n            newOptionLabel.innerHTML = srcElement.value + ': ';\r\n            removeImg.show();\r\n\r\n            Event.observe(newOptionValue, 'keypress', this.getGridObj().filterKeyPress.bind(this.getGridObj()));\r\n\r\n            newOptionContainer.insert({bottom: newOptionLabel});\r\n            newOptionContainer.insert({bottom: newOptionValue});\r\n            newOptionContainer.insert({bottom: newOptionAttr});\r\n            newOptionContainer.insert({bottom: removeImg});\r\n\r\n            valuesDiv.insert({bottom: newOptionContainer});\r\n\r\n            removeImg.observe('click', function () {\r\n                valuesDiv.optionsCount--;\r\n                selectedOption.show();\r\n                srcElement.show();\r\n                newOptionContainer.remove();\r\n            }, this);\r\n\r\n            srcElement.value = '';\r\n        },\r\n\r\n        editProductOptions: function (el, attributes, variationsTree, listingProductId) {\r\n            this.renderProductOptionsForm(el, attributes, variationsTree, listingProductId);\r\n            this.validateAttributeOptions(el, variationsTree);\r\n\r\n            var mainContainer = Element.up(el, '.product-options-main'),\r\n                listContainer = Element.down(mainContainer, '.product-options-list'),\r\n                form = mainContainer.down('.product-options-edit'),\r\n                options = form.select('select.product-option');\r\n\r\n            var productOptions = [];\r\n            listContainer.select('.attribute-row').each(function (el) {\r\n                productOptions.push(el.down('.value').innerHTML);\r\n            });\r\n\r\n            var i = 0;\r\n            options.each(function (el) {\r\n                el.setValue(productOptions[i]).simulate('change');\r\n                i++;\r\n            });\r\n        },\r\n\r\n        renderProductOptionsForm: function (el, attributes, variationsTree, listingProductId) {\r\n            var mainContainer = Element.up(el, '.product-options-main'),\r\n                editContainer = Element.down(mainContainer, '.product-options-edit'),\r\n                listContainer = Element.down(mainContainer, '.product-options-list'),\r\n                self = this;\r\n\r\n            el.hide();\r\n            listContainer && listContainer.hide();\r\n\r\n            for (var i = 0; i < attributes.length; i++) {\r\n\r\n                var optionContainer = new Element('div'),\r\n                    optionLabel = new Element('div'),\r\n                    optionValue = new Element('select', {\r\n                        class: 'product-option admin__control-select',\r\n                        style: 'width: 100%',\r\n                        name: 'product_options[values][]'\r\n                    }),\r\n                    optionAttr = new Element('input', {\r\n                        class: 'product-attribute',\r\n                        type: 'hidden',\r\n                        name: 'product_options[attr][]',\r\n                        value: attributes[i]\r\n                    });\r\n\r\n                optionLabel.update(attributes[i] + ': ');\r\n                optionValue.observe('change', function () {\r\n                    self.validateAttributeOptions(el, variationsTree);\r\n                });\r\n\r\n                optionContainer.insert({bottom: optionLabel});\r\n                optionContainer.insert({bottom: optionValue});\r\n                optionContainer.insert({bottom: optionAttr});\r\n\r\n                editContainer.insert({bottom: optionContainer});\r\n            }\r\n\r\n            var confirmBtn = new Element('button', {\r\n                    class: 'action primary confirm-btn',\r\n                    style: 'font-size: 1.1rem; margin-top: 8px; margin-right: 9px;'\r\n                }),\r\n                cancelBtn = new Element('a', {\r\n                    href: 'javascript:void(0);',\r\n                    class: 'scalable',\r\n                    style: 'line-height: 27px; margin: 7px 8px;'\r\n                }),\r\n                listingProductIdEl = new Element('input', {\r\n                    type: 'hidden',\r\n                    name: 'product_id',\r\n                    value: listingProductId\r\n                }),\r\n                errorMsg = new Element('p', {\r\n                    class: 'error',\r\n                    style: 'display: none;'\r\n                });\r\n\r\n            confirmBtn.update(M2ePro.translator.translate('Confirm'));\r\n            confirmBtn.observe('click', function (event) {\r\n                event.stop();\r\n                var data = editContainer.serialize(true);\r\n\r\n                if (!self.validateAttributeOptions(el, variationsTree)) {\r\n                    var errorMsg = editContainer.down('p.error');\r\n                    errorMsg.show();\r\n                    errorMsg.innerHTML = M2ePro.translator.translate('error_changing_product_options');\r\n                    return;\r\n                }\r\n\r\n                new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/setChildListingProductOptions'), {\r\n                    method: 'post',\r\n                    parameters: data,\r\n                    onSuccess: function (transport) {\r\n\r\n                        var response = self.parseResponse(transport);\r\n\r\n                        if (response['vocabulary_attribute_options']) {\r\n                            ListingGridHandlerObj.variationProductManageHandler.openVocabularyOptionsPopUp(response['vocabulary_attribute_options']);\r\n                            return;\r\n                        }\r\n\r\n                        if (response.success) {\r\n                            self.actionHandler.gridHandler.unselectAllAndReload();\r\n                        }\r\n                    }\r\n                });\r\n\r\n                el.show();\r\n                listContainer && listContainer.show();\r\n                editContainer.childElements().each(Element.remove);\r\n            });\r\n\r\n            cancelBtn.update(M2ePro.translator.translate('Cancel'));\r\n            cancelBtn.observe('click', function (event) {\r\n                event.stop();\r\n                el.show();\r\n                listContainer && listContainer.show();\r\n                editContainer.childElements().each(Element.remove);\r\n            });\r\n\r\n            editContainer.insert({bottom: listingProductIdEl});\r\n            editContainer.insert({bottom: errorMsg});\r\n            editContainer.insert({bottom: cancelBtn});\r\n            editContainer.insert({bottom: confirmBtn});\r\n        },\r\n\r\n        validateAttributeOptions: function (el, variations, i) {\r\n            var variation = $H(variations),\r\n                mainContainer = Element.up(el, '.product-options-main'),\r\n                form = mainContainer.down('.product-options-edit'),\r\n                attributes = form.select('input.product-attribute'),\r\n                options = form.select('select.product-option'),\r\n\r\n                index = i || 0,\r\n                valid = false;\r\n\r\n            if (index === 0) {\r\n                options.each(function (el) {\r\n                    el.disable();\r\n                });\r\n            }\r\n\r\n            if (!attributes[index] || !options[index]) {\r\n                if (variation.size() === 0) {\r\n                    valid = true;\r\n                    options.each(function (el) {\r\n                        if (el.value == '') {\r\n                            valid = false;\r\n                            throw $break;\r\n                        }\r\n                    });\r\n\r\n                    return valid;\r\n                }\r\n            }\r\n\r\n            var attr = variation.keys()[0];\r\n            attributes[index].value = attr;\r\n\r\n            var oldValue = options[index].value;\r\n            options[index].update();\r\n            options[index].enable();\r\n            options[index].appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            $H(variation.get(attr)).each(function (option) {\r\n                options[index].appendChild(new Element('option', {value: option[0]})).insert(option[0]);\r\n\r\n                if (option[0] == oldValue) {\r\n                    options[index].value = oldValue;\r\n                }\r\n            });\r\n\r\n            if (oldValue && variation.get(attr)[oldValue]) {\r\n                index++;\r\n                valid = this.validateAttributeOptions(el, variation.get(attr)[oldValue], index);\r\n            }\r\n\r\n            return valid;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showNewChildForm: function (createNewAsin, productId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/getNewChildForm'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    product_id: productId\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    var containerEl = $('variation_manager_product_options_form_container');\r\n\r\n                    if (containerEl) {\r\n                        containerEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: transport.responseText});\r\n\r\n                    self.newChildPopup = jQuery('#variation_manager_product_options_form_container');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('Add New Child Product'),\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Close'),\r\n                            click: function () {\r\n                                self.newChildPopup.modal('closeModal')\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action primary ',\r\n                            click: function () {\r\n                                self.addNewChildProduct();\r\n                                self.newChildPopup.modal('closeModal')\r\n                            }\r\n                        }]\r\n                    }, self.newChildPopup);\r\n\r\n                    self.newChildPopup.modal('openModal');\r\n\r\n                    $$('#manage_variations_new_child_product_variation select').each(function (el) {\r\n                        el.select('option').invoke('remove');\r\n                    });\r\n\r\n                    $$('#manage_variations_new_child_channel_variation select').each(function (el) {\r\n                        el.select('option').invoke('remove');\r\n                    });\r\n\r\n                    $('new_child_product_product_options_error').hide();\r\n                    $('new_child_product_channel_options_error').hide();\r\n\r\n                    self.validateNewChildAttributeOptions('product');\r\n                    self.validateNewChildAttributeOptions('channel');\r\n\r\n                    if (createNewAsin) {\r\n                        self.createNewAsinBtn();\r\n                    } else {\r\n                        self.selectOptionsBtn();\r\n                    }\r\n\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validateNewChildAttributeOptions: function (type, variations, i) {\r\n            if (!$('variation_manager_unused_' + type + '_variations_tree')) {\r\n                return true;\r\n            }\r\n\r\n            var variation = $H(variations || decodeHtmlentities($('variation_manager_unused_' + type + '_variations_tree').innerHTML).evalJSON()),\r\n                attributes = $$('.new-child-' + type + '-attribute'),\r\n                options = $$('.new-child-' + type + '-option'),\r\n                index = i || 0,\r\n                valid = false;\r\n\r\n            if (type == 'product') {\r\n                var channelOptions = $$('.new-child-channel-option'),\r\n                    formData = $('variation_manager_product_options_form').serialize(true);\r\n            }\r\n\r\n            if (index === 0) {\r\n                options.each(function (el) {\r\n                    el.disable();\r\n                });\r\n            }\r\n\r\n            if (!attributes[index] || !options[index]) {\r\n                if (variation.size() === 0) {\r\n                    valid = this.validateNewChild();\r\n                }\r\n                return valid;\r\n            }\r\n\r\n            var attr = variation.keys()[0];\r\n            attributes[index].value = attr;\r\n\r\n            var oldValue = options[index].value;\r\n            options[index].update();\r\n            options[index].enable();\r\n            options[index].appendChild(new Element('option', {style: 'display: none'}));\r\n\r\n            if (type == 'product' && formData.create_new_asin == 1) {\r\n                var channelEl = $('new_child_product_channel_option_' + index);\r\n\r\n                channelEl.update();\r\n                channelEl.appendChild(new Element('option', {value: oldValue})).insert(oldValue);\r\n                channelEl.value = oldValue;\r\n            }\r\n\r\n            $H(variation.get(attr)).each(function (option) {\r\n                options[index].appendChild(new Element('option', {value: option[0]})).insert(option[0]);\r\n\r\n                if (option[0] == oldValue) {\r\n                    options[index].value = oldValue;\r\n                }\r\n            });\r\n\r\n            if (oldValue) {\r\n                index++;\r\n                valid = this.validateNewChildAttributeOptions(type, variation.get(attr)[oldValue], index);\r\n            }\r\n\r\n            return valid;\r\n        },\r\n\r\n        validateNewChild: function (showErrors) {\r\n            var data = $('variation_manager_product_options_form').serialize(true),\r\n                valid = true;\r\n\r\n            $('new_child_product_product_options_error').hide();\r\n            $$('#manage_variations_new_child_product_variation select').each(function (el) {\r\n                if (el.value == '') {\r\n                    showErrors && $('new_child_product_product_options_error').show();\r\n                    valid = false;\r\n                    throw $break;\r\n                }\r\n            });\r\n\r\n            if (data.create_new_asin != 1) {\r\n                $('new_child_product_channel_options_error').hide();\r\n                $$('#manage_variations_new_child_channel_variation select').each(function (el) {\r\n                    if (el.value == '') {\r\n                        showErrors && $('new_child_product_channel_options_error').show();\r\n                        valid = false;\r\n                        throw $break;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return valid;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        addNewChildProduct: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            if (!self.validateNewChild(true)) {\r\n                return;\r\n            }\r\n\r\n            data = $('variation_manager_product_options_form').serialize(true);\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_variation_manage/createNewChild'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n                    if (response.msg) {\r\n                        self.messageObj.clear();\r\n                        self.messageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.msg);\r\n                    }\r\n\r\n                    if (response['vocabulary_attribute_options']) {\r\n                        ListingGridHandlerObj.variationProductManageHandler.openVocabularyOptionsPopUp(response['vocabulary_attribute_options']);\r\n                        return;\r\n                    }\r\n\r\n                    self.actionHandler.gridHandler.unselectAllAndReload();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createNewAsinBtn: function () {\r\n            var optEl = $('manage_variations_select_options'),\r\n                newAsinLinkEl = $('manage_variations_create_new_asin');\r\n\r\n            optEl && optEl.show().down('input').enable();\r\n\r\n            $('new_child_product_channel_options_error_row').setStyle({visibility: 'hidden'});\r\n            newAsinLinkEl && newAsinLinkEl.hide();\r\n\r\n            $$('.new-child-channel-option').each(function (el) {\r\n                el.disable();\r\n            });\r\n\r\n            $('manage_variations_create_new_asin_title').show();\r\n\r\n            ListingProductVariationManageVariationsGridObj.validateNewChildAttributeOptions('product');\r\n        },\r\n\r\n        selectOptionsBtn: function () {\r\n            var optEl = $('manage_variations_select_options'),\r\n                newAsinEl = $('manage_variations_create_new_asin');\r\n\r\n            optEl && optEl.hide().down('input').disable();\r\n\r\n            $('new_child_product_channel_options_error_row').setStyle({visibility: 'visible'});\r\n            newAsinEl && newAsinEl.show();\r\n\r\n            $$('.new-child-channel-option').each(function (el) {\r\n                el.enable();\r\n                el.update();\r\n            });\r\n\r\n            $('manage_variations_create_new_asin_title').hide();\r\n\r\n            ListingProductVariationManageVariationsGridObj.validateNewChildAttributeOptions('channel');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unselectAllAndReload: function ($super) {\r\n            $super();\r\n\r\n            ListingGridHandlerObj.variationProductManageHandler.reloadSettings(null);\r\n            ListingGridHandlerObj.variationProductManageHandler.reloadVocabulary(null);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add/SourceMode/Category/Summary/Grid.js":"define([\r\n    'M2ePro/Grid'\r\n], function () {\r\n\r\n    window.AmazonListingProductAddSourceModeCategorySummaryGrid = Class.create(Grid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function () {\r\n            this.actions = {\r\n                removeAction: this.remove.bind(this)\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        remove: function () {\r\n            var self = this;\r\n\r\n            Grid.prototype.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        var url = M2ePro.url.get('amazon_listing_product_add/removeSessionProductsByCategory');\r\n                        new Ajax.Request(url, {\r\n                            parameters: {\r\n                                ids: self.getSelectedProductsString()\r\n                            },\r\n                            onSuccess: self.unselectAllAndReload.bind(self)\r\n                        });\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        confirm: function (config) {\r\n            if (config.actions && config.actions.confirm) {\r\n                config.actions.confirm();\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add/NewAsin/Template/Description/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/Product/Template/Description'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductAddNewAsinTemplateDescriptionGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function () {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            $super();\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n            this.templateDescriptionHandler = new AmazonListingProductTemplateDescription(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                setDescriptionTemplateAction: (function () {\r\n                    this.mapToNewAsin(this.getSelectedProductsString())\r\n                }).bind(this),\r\n                resetDescriptionTemplateAction: (function () {\r\n                    this.unmapFromNewAsin(this.getSelectedProductsString())\r\n                }).bind(this),\r\n\r\n                setDescriptionTemplateByCategoryAction: (function () {\r\n                    this.mapToNewAsin(this.getSelectedProductsStringFromCategory())\r\n                }).bind(this),\r\n                resetDescriptionTemplateByCategoryAction: (function () {\r\n                    this.unmapFromNewAsin(this.getSelectedProductsStringFromCategory())\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function ($super) {\r\n            $super();\r\n        },\r\n\r\n        setDescriptionTemplateRowAction: function (id) {\r\n            this.mapToNewAsin(id);\r\n        },\r\n\r\n        resetDescriptionTemplateRowAction: function (id) {\r\n            this.unmapFromNewAsin(id);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        setDescriptionTemplateByCategoryRowAction: function (id) {\r\n            this.mapToNewAsin(this.getSelectedProductsStringFromCategory(id));\r\n        },\r\n\r\n        resetDescriptionTemplateByCategoryRowAction: function (id) {\r\n            this.unmapFromNewAsin(this.getSelectedProductsStringFromCategory(id));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getSelectedProductsStringFromCategory: function (categoryIds) {\r\n            var productsIdsStr = '';\r\n\r\n            categoryIds = categoryIds || this.getGridMassActionObj().checkedString;\r\n            categoryIds = explode(',', categoryIds);\r\n\r\n            categoryIds.each(function (categoryId) {\r\n\r\n                if (productsIdsStr != '') {\r\n                    productsIdsStr += ',';\r\n                }\r\n                productsIdsStr += $('products_ids_' + categoryId).value;\r\n            });\r\n\r\n            return productsIdsStr;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapToNewAsin: function (listingProductIds) {\r\n            var self = this;\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/mapToNewAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: listingProductIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    self.templateDescriptionHandler.gridHandler.unselectAllAndReload();\r\n\r\n                    if (response.products_ids.length > 0) {\r\n                        ListingGridHandlerObj.templateDescriptionHandler.openPopUp(\r\n                            0, M2ePro.translator.translate('templateDescriptionPopupTitle'),\r\n                            response.products_ids, response.html, 1);\r\n                    } else {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        unmapFromNewAsin: function (productsIds) {\r\n            var self = this;\r\n\r\n            self.templateDescriptionHandler.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product/unmapFromAsin'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.type == 'success') {\r\n                        self.templateDescriptionHandler.unassignFromTemplateDescription(productsIds);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        mapToTemplateDescription: function (el, templateId, mapToGeneralId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/assign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: ListingGridHandlerObj.templateDescriptionHandler.templateDescriptionPopup.productsIds,\r\n                    template_id: templateId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n                    self.mapToNewAsin(response.products_ids);\r\n                }\r\n            });\r\n\r\n            ListingGridHandlerObj.templateDescriptionHandler.templateDescriptionPopup.modal('closeModal');\r\n        },\r\n\r\n        checkCategoryProducts: function (url) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/checkNewAsinCategoryProducts'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        setLocation(url);\r\n                    } else {\r\n                        if (!transport.responseText.isJSON()) {\r\n                            self.alert(transport.responseText);\r\n                            return;\r\n                        }\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj.clear();\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.text);\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        checkManualProducts: function (url) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/checkNewAsinManualProducts'), {\r\n                method: 'post',\r\n                onSuccess: function (transport) {\r\n\r\n                    if (transport.responseText == 1) {\r\n                        setLocation(url);\r\n                    } else {\r\n                        if (!transport.responseText.isJSON()) {\r\n                            self.alert(transport.responseText);\r\n                            return;\r\n                        }\r\n\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        if ($('new_asin_skip_popup_content')) {\r\n                            $('new_asin_skip_popup_content').remove();\r\n                        }\r\n                        $('html-body').insert({bottom: response.html});\r\n\r\n                        $('total_count').innerHTML = response.total_count;\r\n                        $('failed_count').update(response.failed_count);\r\n\r\n                        self.skipPopup = jQuery('#new_asin_skip_popup_content');\r\n\r\n                        modal({\r\n                            title: M2ePro.translator.translate('setDescriptionPolicy'),\r\n                            type: 'popup',\r\n                            buttons: [ {\r\n                                text: M2ePro.translator.translate('Cancel'),\r\n                                class: 'action-secondary action-dismiss',\r\n                                click: function () {\r\n                                    self.skipPopup.modal('closeModal');\r\n                                }\r\n                            }, {\r\n                                text: M2ePro.translator.translate('Continue'),\r\n                                class: 'action-primary action-accept',\r\n                                click: function () {\r\n                                    setLocation(response.continueUrl);\r\n                                    self.skipPopup.modal('closeModal');\r\n                                }\r\n                            }]\r\n                        }, self.skipPopup);\r\n\r\n                        self.skipPopup.modal('openModal');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Add/SearchAsin/Grid.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/Product/Search'\r\n], function (modal, MessageObj) {\r\n\r\n    AmazonListingProductAddSearchAsinGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getComponent: function () {\r\n            return 'amazon';\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function () {\r\n            return 1000;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function ($super) {\r\n            $super();\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n            this.productSearchHandler = new AmazonListingProductSearch(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n\r\n                assignGeneralIdAction: (function () {\r\n                    this.productSearchHandler.searchGeneralIdAuto(this.getSelectedProductsString())\r\n                }).bind(this),\r\n                unassignGeneralIdAction: (function () {\r\n                    this.productSearchHandler.unmapFromGeneralId(this.getSelectedProductsString())\r\n                }).bind(this)\r\n\r\n            });\r\n\r\n            this.productSearchHandler.clearSearchResultsAndOpenSearchMenu = function () {\r\n                var self = this;\r\n\r\n                self.confirm({\r\n                    actions: {\r\n                        confirm: function () {\r\n                            self.popup.modal('closeModal');\r\n                            self.unmapFromGeneralId(self.params.productId);\r\n                        },\r\n                        cancel: function () {\r\n                            return false;\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        parseResponse: function (response) {\r\n            if (!response.responseText.isJSON()) {\r\n                return;\r\n            }\r\n\r\n            return response.responseText.evalJSON();\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        afterInitPage: function ($super) {\r\n            $super();\r\n        },\r\n\r\n        editSearchSettings: function (title, listingId) {\r\n            var self = this;\r\n\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/viewSearchSettings'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!$('edit_search_settings_popup')) {\r\n                        $('html-body').insert({bottom: '<div id=\"edit_search_settings_popup\"></div>'});\r\n                    }\r\n\r\n                    $('edit_search_settings_popup').update(transport.responseText);\r\n\r\n                    $('breadcrumb_container').remove();\r\n\r\n                    self.searchSettnigsPopup = jQuery('#edit_search_settings_popup');\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.searchSettnigsPopup.modal('closeModal');\r\n                            }\r\n                        },{\r\n                            text: M2ePro.translator.translate('Confirm'),\r\n                            class: 'action primary',\r\n                            click: function () {\r\n                                ListingGridHandlerObj.saveSearchSettings();\r\n                                self.searchSettnigsPopup.modal('closeModal');\r\n                            }\r\n                        }]\r\n                    }, self.searchSettnigsPopup);\r\n\r\n                    self.searchSettnigsPopup.modal('openModal');\r\n                    self.searchSettnigsPopup.listingId = listingId;\r\n                }\r\n            });\r\n        },\r\n\r\n        saveSearchSettings: function () {\r\n            var self = this,\r\n                data;\r\n\r\n            if (self.searchSettingsForm && !self.searchSettingsForm.validate()) {\r\n                return;\r\n            }\r\n\r\n            data = $('edit_form').serialize(true);\r\n            data.id = self.searchSettnigsPopup.listingId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/saveSearchSettings'), {\r\n                method: 'post',\r\n                parameters: data,\r\n                onSuccess: function (transport) {\r\n                    self.actionHandler.gridHandler.unselectAllAndReload();\r\n                    self.searchSettnigsPopup.modal('closeModal');\r\n                }\r\n            });\r\n        },\r\n\r\n        checkSearchResults: function (listingId) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/checkSearchResults'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    id: listingId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n\r\n                    if (response.redirect) {\r\n                        return setLocation(response.redirect);\r\n                    }\r\n\r\n                    if (!$('search_asin_new_asin_popup')) {\r\n                        $('html-body').insert({bottom: response.html});\r\n                    }\r\n\r\n                    self.newAsinPopup = jQuery('#search_asin_new_asin_popup');\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('new_asin_popup_title'),\r\n                        type: 'popup',\r\n                        buttons: [{\r\n                            class: 'action-secondary action-dismiss',\r\n                            text: M2ePro.translator.translate('No'),\r\n                            click: function () {\r\n                                self.showNewAsinPopup(0);\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Yes'),\r\n                            class: 'action-primary action-accept',\r\n                            click: function () {\r\n                                self.showNewAsinPopup(1);\r\n                            }\r\n                        }]\r\n                    }, self.newAsinPopup);\r\n\r\n                    var modalHeader = jQuery('#search_asin_new_asin_popup')\r\n                                        .closest('.modal-inner-wrap')\r\n                                        .find('h1.modal-title'),\r\n                        tips = jQuery('#new_asin_title_help_tips');\r\n\r\n                    tips.insertAfter(modalHeader);\r\n                    tips.show();\r\n\r\n                    self.newAsinPopup.modal('openModal');\r\n                    self.newAsinPopup.listingId = listingId;\r\n                }\r\n            });\r\n        },\r\n\r\n        showNewAsinPopup: function (showNewAsinStep) {\r\n            var self = this,\r\n                remember = $('asin_search_new_asin_remember_checkbox').checked;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_add/showNewAsinStep'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    show_new_asin_step: +showNewAsinStep,\r\n                    remember: +remember,\r\n                    id: self.newAsinPopup.listingId\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var response = self.parseResponse(transport);\r\n\r\n                    if (response.redirect) {\r\n                        return setLocation(response.redirect);\r\n                    }\r\n                }\r\n            });\r\n\r\n            self.newAsinPopup.modal('closeModal');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showNotCompletedPopup: function () {\r\n            var self = this;\r\n\r\n            if (!$('not_completed_popup')) {\r\n                $('html-body').insert({bottom: '<div id=\"not_completed_popup\">' + M2ePro.translator.translate('not_completed_popup_text') + '</div>'});\r\n            }\r\n\r\n            var popup = jQuery('#not_completed_popup');\r\n\r\n            modal({\r\n                title: M2ePro.translator.translate('not_completed_popup_title'),\r\n                type: 'popup',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Close'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function () {\r\n                        popup.modal('closeModal');\r\n                    }\r\n                }]\r\n            }, popup);\r\n\r\n            popup.modal('openModal');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Repricing/Price.js":"define([\r\n], function () {\r\n\r\n    window.AmazonListingProductRepricingPrice = Class.create();\r\n    AmazonListingProductRepricingPrice.prototype = {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function (containerId) {\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        showRepricingPrice: function () {\r\n\r\n            var groupedSkus = {};\r\n\r\n            $$('.m2epro-repricing-price-value').each(function (el) {\r\n                var accountId = el.getAttribute('account_id');\r\n\r\n                if (typeof groupedSkus[accountId] == 'undefined') {\r\n                    groupedSkus[accountId] = []\r\n                }\r\n\r\n                groupedSkus[accountId][groupedSkus[accountId].length] = el.getAttribute('sku');\r\n            });\r\n\r\n            groupedSkus = JSON.stringify(groupedSkus);\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_repricing/getUpdatedPriceBySkus'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    grouped_skus: groupedSkus\r\n                },\r\n                onSuccess: function (transport) {\r\n                    var resultData = transport.responseText.evalJSON();\r\n\r\n                    $H(resultData).each(function (item) {\r\n                        $H(item.value).each(function (priceItem) {\r\n                            $('m2epro_repricing_price_value_' + priceItem.key).update(priceItem.value)\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Template/Shipping.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductTemplateShipping = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (productsIds, shippingMode) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/viewPopup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids:  productsIds,\r\n                    shipping_mode: shippingMode\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (!response.html) {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n\r\n                        return;\r\n                    }\r\n\r\n                    var popupElId = (shippingMode == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'))\r\n                        ? '#template_shippingOverride_pop_up_content'\r\n                        : '#template_shippingTemplate_pop_up_content';\r\n\r\n                    var popupEl = jQuery(popupElId);\r\n\r\n                    if (popupEl.length) {\r\n                        popupEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: response.html});\r\n\r\n                    self.templateShippingPopup = jQuery(popupElId);\r\n\r\n                    var title             = M2ePro.translator.translate('templateShippingTemplatePopupTitle');\r\n                    var addNewPolicyTitle = M2ePro.translator.translate('Add New Shipping Template Policy');\r\n\r\n                    if (shippingMode == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE')) {\r\n\r\n                        title             = M2ePro.translator.translate('templateShippingOverridePopupTitle');\r\n                        addNewPolicyTitle = M2ePro.translator.translate('Add New Shipping Override Policy');\r\n                    }\r\n\r\n                    modal({\r\n                        title: title,\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.templateShippingPopup.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: addNewPolicyTitle,\r\n                            class: 'action primary ',\r\n                            click: function () {\r\n                                self.createInNewTab(self.newTemplateUrl, shippingMode);\r\n                            }\r\n                        }]\r\n                    }, self.templateShippingPopup);\r\n\r\n                    self.templateShippingPopup.productsIds = response.products_ids;\r\n\r\n                    self.templateShippingPopup.modal('openModal');\r\n\r\n                    $('template_shipping_grid').observe('click', function (event) {\r\n                        if (!event.target.hasClassName('assign-shipping-template')) {\r\n                            return;\r\n                        }\r\n\r\n                        self.assign(event.target.getAttribute('templateShippingId'), shippingMode);\r\n                    });\r\n\r\n                    $('template_shipping_grid').on('click', '.new-shipping-template', function() {\r\n                        self.createInNewTab(self.newTemplateUrl, shippingMode);\r\n                    });\r\n\r\n                    self.loadGrid(shippingMode);\r\n                }\r\n            });\r\n        },\r\n\r\n        loadGrid: function (shippingMode) {\r\n\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.templateShippingPopup.productsIds,\r\n                    shipping_mode: shippingMode\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('template_shipping_grid').update(transport.responseText);\r\n                    $('template_shipping_grid').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        assign: function (templateId, shippingMode) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/assign'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                products_ids:  self.templateShippingPopup.productsIds,\r\n                                shipping_mode: shippingMode,\r\n                                template_id:   templateId\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (!transport.responseText.isJSON()) {\r\n                                    self.alert(transport.responseText);\r\n                                    return;\r\n                                }\r\n\r\n                                self.gridHandler.unselectAllAndReload();\r\n\r\n                                var response = transport.responseText.evalJSON();\r\n\r\n                                MessageObj.clear();\r\n                                response.messages.each(function (msg) {\r\n                                    MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                        self.templateShippingPopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassign: function (productsIds, shippingMode) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_shipping/unassign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids:  productsIds,\r\n                    shipping_mode: shippingMode\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createInNewTab: function (url, shippingMode) {\r\n            var self = this;\r\n            var win = window.open(url);\r\n\r\n            var intervalId = setInterval(function () {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                self.loadGrid(shippingMode);\r\n            }, 1000);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Template/ProductTaxCode.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductTemplateProductTaxCode = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function($super,gridHandler)\r\n        {\r\n            var self = this;\r\n            $super(gridHandler);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function(options)\r\n        {\r\n            this.options = Object.extend(this.options,options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function(productsIds)\r\n        {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/viewPopup'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids:  productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (!response.html) {\r\n                        if (response.messages.length > 0) {\r\n                            MessageObj.clear();\r\n                            response.messages.each(function (msg) {\r\n                                MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                            });\r\n                        }\r\n\r\n                        return;\r\n                    }\r\n\r\n                    var popupElId = '#template_productTaxCode_pop_up_content';\r\n\r\n                    var popupEl = jQuery(popupElId);\r\n\r\n                    if (popupEl.length) {\r\n                        popupEl.remove();\r\n                    }\r\n\r\n                    $('html-body').insert({bottom: response.html});\r\n\r\n                    self.templateProductTaxCodePopup = jQuery(popupElId);\r\n\r\n                    modal({\r\n                        title: M2ePro.translator.translate('templateProductTaxCodePopupTitle'),\r\n                        type: 'slide',\r\n                        buttons: [{\r\n                            text: M2ePro.translator.translate('Cancel'),\r\n                            click: function () {\r\n                                self.templateProductTaxCodePopup.modal('closeModal');\r\n                            }\r\n                        }, {\r\n                            text: M2ePro.translator.translate('Add New Product Tax Code Policy'),\r\n                            class: 'action primary ',\r\n                            click: function () {\r\n                                self.createInNewTab(self.newTemplateUrl);\r\n                            }\r\n                        }]\r\n                    }, self.templateProductTaxCodePopup);\r\n\r\n                    self.templateProductTaxCodePopup.productsIds = response.products_ids;\r\n\r\n                    self.templateProductTaxCodePopup.modal('openModal');\r\n\r\n                    var grid = $('template_productTaxCode_grid');\r\n\r\n                    grid.observe('click', function(event) {\r\n                        if (!event.target.hasClassName('assign-productTaxCode-template')) {\r\n                            return;\r\n                        }\r\n\r\n                        self.assign(event.target.getAttribute('templateProductTaxCodeId'));\r\n                    });\r\n\r\n                    grid.on('click', '.new-productTaxCode-template', function() {\r\n                        self.createInNewTab(self.newTemplateUrl);\r\n                    });\r\n\r\n                    self.loadGrid();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        assign: function(templateId)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/assign'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                products_ids:  self.templateProductTaxCodePopup.productsIds,\r\n                                template_id:   templateId\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (!transport.responseText.isJSON()) {\r\n                                    self.alert(transport.responseText);\r\n                                    return;\r\n                                }\r\n\r\n                                self.gridHandler.unselectAllAndReload();\r\n\r\n                                var response = transport.responseText.evalJSON();\r\n\r\n                                MessageObj.clear();\r\n                                response.messages.each(function (msg) {\r\n                                    MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                        self.templateProductTaxCodePopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassign: function(productsIds)\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/unassign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        loadGrid: function()\r\n        {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_productTaxCode/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.templateProductTaxCodePopup.productsIds\r\n                },\r\n                onSuccess: function(transport) {\r\n                    var grid = $('template_productTaxCode_grid');\r\n                    grid.update(transport.responseText);\r\n                    grid.show();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createInNewTab: function(stepWindowUrl)\r\n        {\r\n            var self = this;\r\n            var win = window.open(stepWindowUrl);\r\n\r\n            var intervalId = setInterval(function() {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                self.loadGrid();\r\n            }, 1000);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Listing/Product/Template/Description.js":"define([\r\n    'Magento_Ui/js/modal/modal',\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (modal, MessageObj) {\r\n\r\n    window.AmazonListingProductTemplateDescription = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        mapToTemplateDescription: function (el, templateId, mapToGeneralId) {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/assign'), {\r\n                            method: 'post',\r\n                            parameters: {\r\n                                products_ids: self.templateDescriptionPopup.productsIds,\r\n                                template_id: templateId\r\n                            },\r\n                            onSuccess: function (transport) {\r\n\r\n                                if (!transport.responseText.isJSON()) {\r\n                                    self.alert(transport.responseText);\r\n                                    return;\r\n                                }\r\n\r\n                                var response = transport.responseText.evalJSON();\r\n\r\n                                if (mapToGeneralId) {\r\n                                    ListingGridHandlerObj.productSearchHandler.addNewGeneralId(response.products_ids);\r\n                                } else {\r\n                                    self.gridHandler.unselectAllAndReload();\r\n\r\n                                    if (response.messages.length > 0) {\r\n                                        MessageObj.clear();\r\n                                        response.messages.each(function (msg) {\r\n                                            MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](msg);\r\n                                        });\r\n                                    }\r\n                                }\r\n                            }\r\n                        });\r\n\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n        unassignFromTemplateDescription: function (productsIds) {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/unassign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        validateProductsForTemplateDescriptionAssign: function (productsIds) {\r\n            var self = this;\r\n            self.flagSuccess = false;\r\n\r\n            productsIds = productsIds || ListingGridHandlerObj.productSearchHandler.params.productId;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/validateProductsForAssign'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    if (response.messages.length > 0) {\r\n                        MessageObj.clear();\r\n                        response.messages.each(function (msg) {\r\n                            MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                        });\r\n                    }\r\n\r\n                    if (!response.html) {\r\n                        return;\r\n                    }\r\n\r\n                    if (typeof popUp != 'undefined') {\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                    }\r\n\r\n                    self.openPopUp(0, M2ePro.translator.translate('templateDescriptionPopupTitle'), response.products_ids, response.html);\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        openPopUp: function (mode, title, productsIds, contentData, checkIsNewAsinAccepted) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            MessageObj.clear();\r\n\r\n            var popupEl = $('template_description_pop_up_content');\r\n\r\n            if (popupEl) {\r\n                popupEl.remove();\r\n            }\r\n\r\n            $('html-body').insert({bottom: contentData});\r\n\r\n            self.templateDescriptionPopup = jQuery('#template_description_pop_up_content');\r\n\r\n            modal({\r\n                title: title,\r\n                type: 'slide',\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    click: function () {\r\n                        self.templateDescriptionPopup.modal('closeModal');\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Add New Description Policy'),\r\n                    class: 'action primary ',\r\n                    click: function () {\r\n                        self.createTemplateDescriptionInNewTab(M2ePro.url.get('newTemplateDescriptionUrl'));\r\n                    }\r\n                }]\r\n            }, self.templateDescriptionPopup);\r\n\r\n            self.templateDescriptionPopup.modal('openModal');\r\n\r\n            self.templateDescriptionPopup.productsIds = productsIds;\r\n            self.templateDescriptionPopup.checkIsNewAsinAccepted = checkIsNewAsinAccepted || 0;\r\n\r\n            self.loadTemplateDescriptionGrid();\r\n        },\r\n\r\n        loadTemplateDescriptionGrid: function () {\r\n            var self = this;\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_template_description/viewGrid'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: self.templateDescriptionPopup.productsIds,\r\n                    check_is_new_asin_accepted: self.templateDescriptionPopup.checkIsNewAsinAccepted\r\n                },\r\n                onSuccess: function (transport) {\r\n                    $('template_description_grid').update(transport.responseText);\r\n                    $('template_description_grid').show();\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        createTemplateDescriptionInNewTab: function (stepWindowUrl) {\r\n            var self = this;\r\n            var win = window.open(stepWindowUrl);\r\n\r\n            var intervalId = setInterval(function () {\r\n                if (!win.closed) {\r\n                    return;\r\n                }\r\n\r\n                clearInterval(intervalId);\r\n\r\n                amazonTemplateDescriptionGridJsObject.reload();\r\n            }, 1000);\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/View/Action.js":"define([\n    'M2ePro/Listing/View/Action'\n], function () {\n\n    window.AmazonListingViewAction = Class.create(ListingViewAction, {\n\n        // ---------------------------------------\n\n        deleteAndRemoveAction: function () {\n            var selectedProductsParts = this.gridHandler.getSelectedItemsParts();\n            if (selectedProductsParts.length == 0) {\n                return;\n            }\n\n            this.startActions(\n                M2ePro.translator.translate('deleting_and_removing_selected_items_message'),\n                M2ePro.url.get('runDeleteAndRemoveProducts'),\n                selectedProductsParts\n            );\n        }\n\n        // ---------------------------------------\n    });\n\n});","Ess_M2ePro/js/Amazon/Listing/View/Grid.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Listing/View/Grid',\r\n    'M2ePro/Listing/Moving',\r\n    'M2ePro/Amazon/Listing/View/Action',\r\n    'M2ePro/Amazon/Listing/View/Fulfillment',\r\n    'M2ePro/Amazon/Listing/Product/Repricing',\r\n    'M2ePro/Amazon/Listing/Product/Search',\r\n    'M2ePro/Amazon/Listing/Product/Template/Description',\r\n    'M2ePro/Amazon/Listing/Product/Template/Shipping',\r\n    'M2ePro/Amazon/Listing/Product/Template/ProductTaxCode',\r\n    'M2ePro/Amazon/Listing/Product/Variation/Manage'\r\n], function (MessageObj) {\r\n\r\n    window.AmazonListingViewGrid = Class.create(ListingViewGrid, {\r\n\r\n        // ---------------------------------------\r\n\r\n        getLogViewUrl: function (rowId) {\r\n            var idField = M2ePro.php.constant('\\\\Ess\\\\M2ePro\\\\Block\\\\Adminhtml\\\\Log\\\\Listing\\\\Product\\\\AbstractGrid::LISTING_PRODUCT_ID_FIELD');\r\n\r\n            var params = {};\r\n            params[idField] = rowId;\r\n\r\n            return M2ePro.url.get('amazon_log_listing_product/index', params);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        getMaxProductsInPart: function()\r\n        {\r\n            return 10;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        prepareActions: function($super)\r\n        {\r\n            this.actionHandler = new AmazonListingViewAction(this);\r\n\r\n            this.actions = {\r\n                listAction: this.actionHandler.listAction.bind(this.actionHandler),\r\n                relistAction: this.actionHandler.relistAction.bind(this.actionHandler),\r\n                reviseAction: this.actionHandler.reviseAction.bind(this.actionHandler),\r\n                stopAction: this.actionHandler.stopAction.bind(this.actionHandler),\r\n                stopAndRemoveAction: this.actionHandler.stopAndRemoveAction.bind(this.actionHandler),\r\n                previewItemsAction: this.actionHandler.previewItemsAction.bind(this.actionHandler),\r\n                startTranslateAction: this.actionHandler.startTranslateAction.bind(this.actionHandler),\r\n                stopTranslateAction: this.actionHandler.stopTranslateAction.bind(this.actionHandler)\r\n            };\r\n\r\n            this.movingHandler = new ListingMoving(this);\r\n            this.productSearchHandler = new AmazonListingProductSearch(this);\r\n\r\n            this.templateDescriptionHandler    = new AmazonListingProductTemplateDescription(this);\r\n            this.templateShippingHandler       = new AmazonListingProductTemplateShipping(this);\r\n            this.templateProductTaxCodeHandler = new AmazonListingProductTemplateProductTaxCode(this);\r\n\r\n            this.variationProductManageHandler = new AmazonListingProductVariationManage(this);\r\n            this.fulfillmentHandler = new AmazonListingViewFulfillment(this);\r\n            this.repricingHandler = new AmazonListingProductRepricing(this);\r\n\r\n            this.actions = Object.extend(this.actions, {\r\n                duplicateAction: this.duplicateProducts.bind(this),\r\n                movingAction: this.movingHandler.run.bind(this.movingHandler),\r\n                deleteAndRemoveAction: this.actionHandler.deleteAndRemoveAction.bind(this.actionHandler),\r\n\r\n                assignTemplateDescriptionIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateDescriptionHandler.validateProductsForTemplateDescriptionAssign(id)\r\n                }).bind(this),\r\n                unassignTemplateDescriptionIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateDescriptionHandler.unassignFromTemplateDescription(id)\r\n                }).bind(this),\r\n\r\n                assignTemplateShippingTemplateIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.openPopUp(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_TEMPLATE'))\r\n                }).bind(this),\r\n                unassignTemplateShippingTemplateIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_TEMPLATE'))\r\n                }).bind(this),\r\n\r\n                assignTemplateShippingOverrideIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.openPopUp(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'))\r\n                }).bind(this),\r\n                unassignTemplateShippingOverrideIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'))\r\n                }).bind(this),\r\n\r\n                assignTemplateProductTaxCodeIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateProductTaxCodeHandler.openPopUp(id)\r\n                }).bind(this),\r\n                unassignTemplateProductTaxCodeIdAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.templateProductTaxCodeHandler.unassign(id)\r\n                }).bind(this),\r\n\r\n                switchToAfnAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.fulfillmentHandler.switchToAFN(id);\r\n                }).bind(this),\r\n                switchToMfnAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.fulfillmentHandler.switchToMFN(id);\r\n                }).bind(this),\r\n\r\n                addToRepricingAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.addToRepricing(id);\r\n                }).bind(this),\r\n                showDetailsAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.showDetails(id);\r\n                }).bind(this),\r\n                editRepricingAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.editRepricing(id);\r\n                }).bind(this),\r\n                removeFromRepricingAction: (function(id) {\r\n                    id = id || this.getSelectedProductsString();\r\n                    this.repricingHandler.removeFromRepricing(id);\r\n                }).bind(this),\r\n\r\n                assignGeneralIdAction: (function() { this.productSearchHandler.searchGeneralIdAuto(this.getSelectedProductsString())}).bind(this),\r\n                newGeneralIdAction: (function() { this.productSearchHandler.addNewGeneralId(this.getSelectedProductsString())}).bind(this),\r\n                unassignGeneralIdAction: (function() { this.productSearchHandler.unmapFromGeneralId(this.getSelectedProductsString())}).bind(this)\r\n\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateProducts: function () {\r\n            this.scrollPageToTop();\r\n            MessageObj.clear();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing/duplicateProducts'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    ids: this.getSelectedProductsString()\r\n                },\r\n                onSuccess: (function (transport) {\r\n\r\n                    try {\r\n                        var response = transport.responseText.evalJSON();\r\n\r\n                        MessageObj['add' + response.type[0].toUpperCase() + response.type.slice(1) + 'Message'](response.message);\r\n\r\n                        if (response.type != 'error') {\r\n                            this.unselectAllAndReload();\r\n                        }\r\n\r\n                    } catch (e) {\r\n                        MessageObj.addErrorMessage('Internal Error.');\r\n                    }\r\n                }).bind(this)\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassignTemplateDescriptionIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateDescriptionHandler.unassignFromTemplateDescription(id);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        unassignTemplateShippingTemplateIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_TEMPLATE'));\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        unassignTemplateShippingOverrideIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateShippingHandler.unassign(id, M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Account::SHIPPING_MODE_OVERRIDE'));\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        unassignTemplateProductTaxCodeIdActionConfrim: function (id)\r\n        {\r\n            var self = this;\r\n\r\n            self.confirm({\r\n                actions: {\r\n                    confirm: function () {\r\n                        self.templateProductTaxCodeHandler.unassign(id);\r\n                    },\r\n                    cancel: function () {\r\n                        return false;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Listing/View/Fulfillment.js":"define([\r\n    'M2ePro/Plugin/Messages',\r\n    'M2ePro/Action'\r\n], function (MessageObj) {\r\n\r\n    window.AmazonListingViewFulfillment = Class.create(Action, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function ($super, gridHandler) {\r\n            var self = this;\r\n\r\n            $super(gridHandler);\r\n\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        options: {},\r\n\r\n        setOptions: function (options) {\r\n            this.options = Object.extend(this.options, options);\r\n            return this;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchToAFN: function (productsIds) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_fulfillment/switchToAFN'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n\r\n                    if (!transport.responseText.isJSON()) {\r\n                        self.alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        switchToMFN: function (productsIds) {\r\n            var self = this;\r\n            self.gridHandler.unselectAll();\r\n\r\n            new Ajax.Request(M2ePro.url.get('amazon_listing_product_fulfillment/switchToMFN'), {\r\n                method: 'post',\r\n                parameters: {\r\n                    products_ids: productsIds\r\n                },\r\n                onSuccess: function (transport) {\r\n                    if (!transport.responseText.isJSON()) {\r\n                        alert(transport.responseText);\r\n                        return;\r\n                    }\r\n\r\n                    var response = transport.responseText.evalJSON();\r\n\r\n                    self.gridHandler.unselectAllAndReload();\r\n\r\n                    MessageObj.clear();\r\n                    response.messages.each(function (msg) {\r\n                        MessageObj['add' + msg.type[0].toUpperCase() + msg.type.slice(1) + 'Message'](msg.text);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Template/Synchronization.js":"define([\r\n    'M2ePro/Amazon/Template/Edit',\r\n    'Magento_Ui/js/modal/confirm'\r\n], function () {\r\n\r\n    window.AmazonTemplateSynchronization = Class.create(AmazonTemplateEdit, {\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-synchronization-tpl-title',\r\n                                                    M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                                                    'Template\\\\Synchronization', 'title', 'id',\r\n                                                    M2ePro.formData.id,\r\n                                                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-input-time', function(value) {\r\n                return value.match(/^\\d{2}:\\d{2}$/g);\r\n            }, M2ePro.translator.translate('Wrong time format string.'));\r\n\r\n            jQuery.validator.addMethod('validate-qty', function(value, el) {\r\n\r\n                if (!el.up('.admin__field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                if (value.match(/[^\\d]+/g)) {\r\n                    return false;\r\n                }\r\n\r\n                if (value <= 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Wrong value. Only integer numbers.'));\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-conditions-between', function(value, el) {\r\n\r\n                var minValue = $(el.id.replace('_max','')).value;\r\n\r\n                if (!el.up('.admin__field').visible()) {\r\n                    return true;\r\n                }\r\n\r\n                return parseInt(value) > parseInt(minValue);\r\n            }, M2ePro.translator.translate('Must be greater than \"Min\".'));\r\n            // ---------------------------------------\r\n\r\n            // ---------------------------------------\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-product-status', function(value, el) {\r\n\r\n                if (AmazonTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('stop_status_disabled').value == 1 && $('relist_status_enabled').value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-stock-availability', function(value, el) {\r\n\r\n                if (AmazonTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                if ($('stop_out_off_stock').value == 1 && $('relist_is_in_stock').value == 0) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n\r\n            jQuery.validator.addMethod('M2ePro-validate-stop-relist-conditions-item-qty', function(value, el) {\r\n\r\n                if (AmazonTemplateSynchronizationObj.isRelistModeDisabled()) {\r\n                    return true;\r\n                }\r\n\r\n                var stopMaxQty = 0,\r\n                    relistMinQty = 0;\r\n\r\n                var qtyType = el.getAttribute('qty_type');\r\n\r\n                switch (parseInt($('stop_qty_' + qtyType).value)) {\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_NONE'):\r\n                        return true;\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_LESS'):\r\n                        stopMaxQty = parseInt($('stop_qty_' + qtyType + '_value').value);\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_BETWEEN'):\r\n                        stopMaxQty = parseInt($('stop_qty_' + qtyType + '_value_max').value);\r\n                        break;\r\n                }\r\n\r\n                switch (parseInt($('relist_qty_' + qtyType).value)) {\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_NONE'):\r\n                        return false;\r\n                        break;\r\n\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_MORE'):\r\n                    case M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_BETWEEN'):\r\n                        relistMinQty = parseInt($('relist_qty_' + qtyType + '_value').value);\r\n                        break;\r\n                }\r\n\r\n                if (relistMinQty <= stopMaxQty) {\r\n                    return false;\r\n                }\r\n\r\n                return true;\r\n            }, M2ePro.translator.translate('Inconsistent Settings in Relist and Stop Rules.'));\r\n            // ---------------------------------------\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            //list\r\n            $('list_mode').observe('change', AmazonTemplateSynchronizationObj.listMode_change).simulate('change');\r\n            $('list_qty_magento').observe('change', AmazonTemplateSynchronizationObj.listQty_change).simulate('change');\r\n            $('list_qty_calculated').observe('change', AmazonTemplateSynchronizationObj.listQty_change).simulate('change');\r\n            $('list_advanced_rules_mode').observe('change', AmazonTemplateSynchronizationObj.listAdvancedRules_change).simulate('change');\r\n\r\n            //relist\r\n            $('relist_mode').observe('change', AmazonTemplateSynchronizationObj.relistMode_change).simulate('change');\r\n            $('relist_qty_magento').observe('change', AmazonTemplateSynchronizationObj.relistQty_change).simulate('change');\r\n            $('relist_qty_calculated').observe('change', AmazonTemplateSynchronizationObj.relistQty_change).simulate('change');\r\n            $('relist_advanced_rules_mode').observe('change', AmazonTemplateSynchronizationObj.relistAdvancedRules_change).simulate('change');\r\n\r\n            //revise\r\n            $('revise_update_qty')\r\n                .observe('change', AmazonTemplateSynchronizationObj.reviseQty_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_qty_max_applied_value_mode')\r\n                .observe('change', AmazonTemplateSynchronizationObj.reviseQtyMaxAppliedValueMode_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_price').observe('change', AmazonTemplateSynchronizationObj.revisePrice_change)\r\n                .simulate('change');\r\n\r\n            $('revise_update_price_max_allowed_deviation_mode').observe('change', AmazonTemplateSynchronizationObj.revisePriceMaxAllowedDeviationMode_change)\r\n                .simulate('change');\r\n\r\n            //stop\r\n            $('stop_qty_magento').observe('change', AmazonTemplateSynchronizationObj.stopQty_change).simulate('change');\r\n            $('stop_qty_calculated').observe('change', AmazonTemplateSynchronizationObj.stopQty_change).simulate('change');\r\n            $('stop_advanced_rules_mode').observe('change', AmazonTemplateSynchronizationObj.stopAdvancedRules_change).simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        isRelistModeDisabled: function()\r\n        {\r\n            return $('relist_mode').value == 0;\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($super, $headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-synchronization-tpl-title',\r\n                                                    M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                                                    'Template\\\\Synchronization', 'title', '','',\r\n                                                    M2ePro.php.constant('Ess_M2ePro_Helper_Component_Amazon::NICK'));\r\n\r\n            $super($headId, M2ePro.translator.translate('Add Synchronization Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        stopQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('stop_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('stop_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::STOP_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        stopAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('stop_advanced_rules_filters_container'),\r\n                warningContainer = $('stop_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        listMode_change: function()\r\n        {\r\n            var rulesContainer         = $('magento_block_amazon_template_synchronization_list_rules'),\r\n                advancedRulesContainer = $('magento_block_amazon_template_synchronization_list_advanced_filters');\r\n\r\n            if ($('list_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_MODE_NONE')) {\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            } else if ($('list_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_MODE_YES')) {\r\n                rulesContainer.show();\r\n                advancedRulesContainer.show();\r\n            } else {\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            }\r\n        },\r\n\r\n        listQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('list_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('list_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::LIST_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        listAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('list_advanced_rules_filters_container'),\r\n                warningContainer = $('list_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        relistMode_change: function()\r\n        {\r\n            var rulesContainer         = $('magento_block_amazon_template_synchronization_relist_rules'),\r\n                advancedRulesContainer = $('magento_block_amazon_template_synchronization_relist_advanced_filters'),\r\n                userLockContainer      = $('relist_filter_user_lock_tr_container'),\r\n                sendDataContainer      = $('relist_send_data_tr_container');\r\n\r\n            if ($('relist_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_MODE_NONE')) {\r\n                userLockContainer.hide();\r\n                sendDataContainer.hide();\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            } else if ($('relist_mode').value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_MODE_YES')) {\r\n                userLockContainer.show();\r\n                sendDataContainer.show();\r\n                rulesContainer.show();\r\n                advancedRulesContainer.show();\r\n            } else {\r\n                userLockContainer.hide();\r\n                sendDataContainer.hide();\r\n                rulesContainer.hide();\r\n                advancedRulesContainer.hide();\r\n            }\r\n        },\r\n\r\n        relistQty_change: function()\r\n        {\r\n            var qtyType = this.getAttribute('qty_type');\r\n\r\n            var valueContainer    = $('relist_qty_' + qtyType + '_value_container'),\r\n                valueMaxContainer = $('relist_qty_' + qtyType + '_value_max_container'),\r\n                item              = valueContainer.select('label span')[0];\r\n\r\n            valueContainer.hide();\r\n            valueMaxContainer.hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_LESS') ||\r\n                this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_MORE')) {\r\n                item.innerHTML = M2ePro.translator.translate('Quantity');\r\n                valueContainer.show();\r\n            }\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::RELIST_QTY_BETWEEN')) {\r\n                item.innerHTML = M2ePro.translator.translate('Min Quantity');\r\n                valueContainer.show();\r\n                valueMaxContainer.show();\r\n            }\r\n        },\r\n\r\n        relistAdvancedRules_change: function()\r\n        {\r\n            var rulesContainer = $('relist_advanced_rules_filters_container'),\r\n                warningContainer = $('relist_advanced_rules_filters_warning');\r\n\r\n            rulesContainer.hide();\r\n            warningContainer.hide();\r\n\r\n            if (this.value == 1) {\r\n                rulesContainer.show();\r\n                warningContainer.show();\r\n            }\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        reviseQty_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_UPDATE_QTY_YES')) {\r\n                $('revise_update_qty_max_applied_value_mode_tr').show();\r\n                $('revise_update_qty_max_applied_value_line_tr').show();\r\n                $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n            } else {\r\n                $('revise_update_qty_max_applied_value_mode_tr').hide();\r\n                $('revise_update_qty_max_applied_value_line_tr').hide();\r\n                $('revise_update_qty_max_applied_value_tr').hide();\r\n                $('revise_update_qty_max_applied_value_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_AFFECTED_QTY_MODE_OFF');\r\n            }\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueMode_change: function(event)\r\n        {\r\n            var self = AmazonTemplateSynchronizationObj;\r\n\r\n            $('revise_update_qty_max_applied_value_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_AFFECTED_QTY_MODE_ON')) {\r\n                $('revise_update_qty_max_applied_value_tr').show();\r\n            } else if (!event.cancelable) {\r\n                self.openReviseMaxAppliedQtyDisableConfirmationPopUp();\r\n            }\r\n        },\r\n\r\n        openReviseMaxAppliedQtyDisableConfirmationPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            var element = jQuery('#revise_qty_max_applied_value_confirmation_popup_template').clone();\r\n\r\n            element.confirm({\r\n                title: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: self.reviseQtyMaxAppliedValueDisableConfirm,\r\n                    cancel: self.reviseQtyMaxAppliedValueDisableCancel\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }]\r\n            });\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueDisableCancel: function()\r\n        {\r\n            $('revise_update_qty_max_applied_value_mode').selectedIndex = 1;\r\n            $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n        },\r\n\r\n        reviseQtyMaxAppliedValueDisableConfirm: function()\r\n        {\r\n            $('revise_update_qty_max_applied_value_mode').selectedIndex = 0;\r\n            $('revise_update_qty_max_applied_value_mode').simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        revisePrice_change: function()\r\n        {\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_UPDATE_PRICE_YES')) {\r\n                $('revise_update_price_max_allowed_deviation_mode_tr').show();\r\n                $('revise_update_price_max_allowed_deviation_tr').show();\r\n                $('revise_update_price_line').show();\r\n                $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n            } else {\r\n                $('revise_update_price_max_allowed_deviation_mode_tr').hide();\r\n                $('revise_update_price_max_allowed_deviation_tr').hide();\r\n                $('revise_update_price_line').hide();\r\n                $('revise_update_price_max_allowed_deviation_mode').value = M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_ALLOWED_PRICE_DEVIATION_MODE_OFF');\r\n            }\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationMode_change: function(event)\r\n        {\r\n            var self = AmazonTemplateSynchronizationObj;\r\n\r\n            $('revise_update_price_max_allowed_deviation_tr').hide();\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_Synchronization::REVISE_MAX_ALLOWED_PRICE_DEVIATION_MODE_ON')) {\r\n                $('revise_update_price_max_allowed_deviation_tr').show();\r\n            } else if (!event.cancelable) {\r\n                self.openReviseMaxAllowedDeviationPriceDisableConfirmationPopUp();\r\n            }\r\n        },\r\n\r\n        openReviseMaxAllowedDeviationPriceDisableConfirmationPopUp: function()\r\n        {\r\n            var self = this;\r\n\r\n            var element = jQuery('#revise_price_max_max_allowed_deviation_confirmation_popup_template').clone();\r\n\r\n            element.confirm({\r\n                title: M2ePro.translator.translate('Are you sure?'),\r\n                actions: {\r\n                    confirm: self.revisePriceMaxAllowedDeviationDisableConfirm,\r\n                    cancel: self.revisePriceMaxAllowedDeviationDisableCancel\r\n                },\r\n                buttons: [{\r\n                    text: M2ePro.translator.translate('Cancel'),\r\n                    class: 'action-secondary action-dismiss',\r\n                    click: function (event) {\r\n                        this.closeModal(event);\r\n                    }\r\n                }, {\r\n                    text: M2ePro.translator.translate('Confirm'),\r\n                    class: 'action-primary action-accept',\r\n                    click: function (event) {\r\n                        this.closeModal(event, true);\r\n                    }\r\n                }]\r\n            });\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationDisableCancel: function()\r\n        {\r\n            $('revise_update_price_max_allowed_deviation_mode').selectedIndex = 1;\r\n            $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n        },\r\n\r\n        revisePriceMaxAllowedDeviationDisableConfirm: function()\r\n        {\r\n            $('revise_update_price_max_allowed_deviation_mode').selectedIndex = 0;\r\n            $('revise_update_price_max_allowed_deviation_mode').simulate('change');\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/ProductTaxCode.js":"define([\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function () {\r\n\r\n    window.AmazonTemplateProductTaxCode = Class.create(AmazonTemplateEdit, {\r\n\r\n        rulesIndex: 0,\r\n\r\n        // ---------------------------------------\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ProductTaxCode', 'title', 'id',\r\n                M2ePro.formData.id);\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ProductTaxCode', 'title', 'id', '');\r\n\r\n            CommonObj.duplicateClick($headId, M2ePro.translator.translate('Add Product Tax Code Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        initObservers: function()\r\n        {\r\n            $('product_tax_code_mode')\r\n                .observe('change', AmazonTemplateProductTaxCodeObj.productTaxCodeModeChange)\r\n                .simulate('change');\r\n        },\r\n\r\n        productTaxCodeModeChange: function()\r\n        {\r\n            $('product_tax_code_custom_value_tr').hide();\r\n            $('product_tax_code_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ProductTaxCode::PRODUCT_TAX_CODE_MODE_VALUE')) {\r\n                $('product_tax_code_custom_value_tr').show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ProductTaxCode::PRODUCT_TAX_CODE_MODE_ATTRIBUTE')) {\r\n                AmazonTemplateProductTaxCodeObj.updateHiddenValue(this, $('product_tax_code_attribute'));\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n});","Ess_M2ePro/js/Amazon/Template/ShippingTemplate.js":"define([\r\n    'M2ePro/Amazon/Template/Edit'\r\n], function () {\r\n\r\n    window.AmazonTemplateShippingTemplate = Class.create(AmazonTemplateEdit,  {\r\n\r\n        initialize: function()\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-shipping-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ShippingTemplate', 'title', 'id',\r\n                M2ePro.formData.id\r\n            );\r\n        },\r\n\r\n        initObservers: function()\r\n        {\r\n            $('template_name_mode')\r\n                .observe('change', this.templateNameModeChange)\r\n                .simulate('change');\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        duplicateClick: function($headId)\r\n        {\r\n            this.setValidationCheckRepetitionValue('M2ePro-shipping-tpl-title',\r\n                M2ePro.translator.translate('The specified Title is already used for other Policy. Policy Title must be unique.'),\r\n                'Amazon\\\\Template\\\\ShippingTemplate', 'title', 'id', ''\r\n            );\r\n\r\n            CommonObj.duplicateClick($headId, M2ePro.translator.translate('Add Shipping Template Policy'));\r\n        },\r\n\r\n        // ---------------------------------------\r\n\r\n        templateNameModeChange: function()\r\n        {\r\n            $('template_name_custom_value_tr').hide();\r\n            $('template_name_attribute').value = '';\r\n\r\n            if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingTemplate::TEMPLATE_NAME_VALUE')) {\r\n                $('template_name_custom_value_tr').show();\r\n            } else if (this.value == M2ePro.php.constant('Ess_M2ePro_Model_Amazon_Template_ShippingTemplate::TEMPLATE_NAME_ATTRIBUTE')) {\r\n                CommonObj.updateHiddenValue(this, $('template_name_attribute'));\r\n            }\r\n        }\r\n\r\n        // ---------------------------------------\r\n    });\r\n\r\n});","Ess_M2ePro/js/Amazon/Template/Edit.js":"define([\n    'M2ePro/Template/Edit'\n], function () {\n\n    window.AmazonTemplateEdit = Class.create(TemplateEdit, {\n\n        // ---------------------------------------\n\n        getComponent: function()\n        {\n            return 'amazon';\n        },\n\n        // ---------------------------------------\n\n        saveAndCloseClick: function(confirmText, templateNick)\n        {\n            if (!this.isValidForm()) {\n                return;\n            }\n\n            if (confirmText && this.showConfirmMsg) {\n                this.confirm(templateNick, confirmText, this.saveFormUsingAjax);\n                return;\n            }\n\n            this.saveFormUsingAjax();\n        },\n\n        saveFormUsingAjax: function ()\n        {\n            new Ajax.Request(M2ePro.url.get('formSubmit'), {\n                method: 'post',\n                parameters: Form.serialize($('edit_form')),\n                onSuccess: function(transport) {\n                    var result = transport.responseText.evalJSON();\n\n                    if (result.status) {\n                        window.close();\n                    } else {\n                        console.error('Policy Saving Error');\n                    }\n                }\n            });\n        }\n\n        // ---------------------------------------\n    });\n});","mage/backend/jstree-mixin.js":"/**\n * Copyright \u00c2\u00a9 2016 Magento. All rights reserved.\n * See COPYING.txt for license details.\n */\ndefine([\n    'jquery'\n], function ($) {\n    'use strict';\n\n    return function () {\n        $.jstree._themes = require.s.contexts._.config.baseUrl + 'jquery/jstree/themes/';\n    };\n});\n"}
    }
});
